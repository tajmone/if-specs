<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="description" content="<strong>Blorb 2.0.4</strong>&#8201;&#8212;&#8201;Specification of Blorb, a standard format for Interactive Fictions resource collection.">
<meta name="keywords" content="blorb, interactive fiction, if, text adventures, standards, specification">
<meta name="author" content="Andrew Plotkin">
<title>Blorb: An IF Resource Collection Format Standard</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="article toc2 toc-left">
<div id="header">
<h1>Blorb: An IF Resource Collection Format Standard</h1>
<div class="details">
<span id="author" class="author">Andrew Plotkin</span><br>
<span id="email" class="email"><a href="mailto:erkyrath@eblong.com">erkyrath@eblong.com</a></span><br>
<span id="revnumber">blorb 2.0.4,</span>
<span id="revdate">2014-03-02</span>
<br><span id="revremark">AsciiDoc Port v1 (2021-01-12)</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_abstract">Abstract</a></li>
<li><a href="#_overall_structure">Overall Structure</a></li>
<li><a href="#_contents_of_the_resource_index_chunk">1. Contents of the Resource Index Chunk</a></li>
<li><a href="#_picture_resource_chunks">2. Picture Resource Chunks</a>
<ul class="sectlevel2">
<li><a href="#_png_pictures">2.1. PNG Pictures</a></li>
<li><a href="#_jpeg_pictures">2.2. JPEG Pictures</a></li>
<li><a href="#_placeholder_pictures">2.3. Placeholder Pictures</a></li>
</ul>
</li>
<li><a href="#_sound_resource_chunks">3. Sound Resource Chunks</a>
<ul class="sectlevel2">
<li><a href="#_aiff_sounds">3.1. AIFF Sounds</a></li>
<li><a href="#_ogg_sounds">3.2. Ogg Sounds</a></li>
<li><a href="#_mod_sounds">3.3. MOD Sounds</a></li>
<li><a href="#_song_sounds">3.4. Song Sounds</a></li>
</ul>
</li>
<li><a href="#_data_resource_chunks">4. Data Resource Chunks</a></li>
<li><a href="#_executable_resource_chunks">5. Executable Resource Chunks</a>
<ul class="sectlevel2">
<li><a href="#_multiple_executable_chunks">5.1. Multiple Executable Chunks</a></li>
</ul>
</li>
<li><a href="#_the_game_identifier_chunk">6. The Game Identifier Chunk</a></li>
<li><a href="#_the_color_palette_chunk">7. The Color Palette Chunk</a></li>
<li><a href="#_the_frontispiece_chunk">8. The Frontispiece Chunk</a></li>
<li><a href="#_the_resource_description_chunk">9. The Resource Description Chunk</a></li>
<li><a href="#_metadata">10. Metadata</a></li>
<li><a href="#_chunks_specific_to_the_z_machine">11. Chunks Specific to the Z-machine</a>
<ul class="sectlevel2">
<li><a href="#_the_release_number_chunk">11.1. The Release Number Chunk</a></li>
<li><a href="#_the_resolution_chunk">11.2. The Resolution Chunk</a></li>
<li><a href="#_the_adaptive_palette_chunk">11.3. The Adaptive Palette Chunk</a></li>
<li><a href="#_the_looping_chunk">11.4. The Looping Chunk</a></li>
</ul>
</li>
<li><a href="#_other_optional_chunks">12. Other Optional Chunks</a></li>
<li><a href="#_deprecated_chunks">13. Deprecated Chunks</a></li>
<li><a href="#_presentation_and_compatibility">14. Presentation and Compatibility</a>
<ul class="sectlevel2">
<li><a href="#_file_suffixes">14.1. File Suffixes</a></li>
<li><a href="#_mime_types">14.2. MIME Types</a></li>
<li><a href="#_z_machine_compatibility_issues">14.3. Z-Machine Compatibility Issues</a></li>
<li><a href="#_glk_compatibility_issues">14.4. Glk Compatibility Issues</a></li>
<li><a href="#_adrift_5_compatibility_issues">14.5. ADRIFT 5 Compatibility Issues</a></li>
</ul>
</li>
<li><a href="#_the_iff_format">15. The IFF Format</a></li>
<li><a href="#_other_resource_arrangements">16. Other Resource Arrangements</a></li>
<li><a href="#_rationales_and_rationalizations">17. Rationales and Rationalizations</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Format specification version 2.0.4</em><br>
<em>Maintained by IFTF: &lt;<a href="mailto:specs@ifarchive.org">specs@ifarchive.org</a>&gt;</em></p>
</div>
<div class="paragraph">
<p>Copyright 2020 by the <a href="https://iftechfoundation.org/" target="_blank" rel="noopener">Interactive Fiction Technology Foundation</a>.
This specification is licensed under a Creative Commons Attribution-Noncommercial-Share Alike 3.0 Unported License: <a href="https://creativecommons.org/licenses/by-nc-sa/3.0" class="bare" target="_blank" rel="noopener">https://creativecommons.org/licenses/by-nc-sa/3.0</a></p>
</div>
<div class="paragraph">
<p>This document and further Blorb information can be found at: <a href="https://github.com/iftechfoundation/ifarchive-if-specs" class="bare" target="_blank" rel="noopener">https://github.com/iftechfoundation/ifarchive-if-specs</a></p>
</div>
<div class="exampleblock">
<div class="content">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="title">AsciiDoc Edition v1 (2021-01-12)</div>
<div class="paragraph">
<p>This document was built from an independent port to AsciiDoc of the
<a href="https://eblong.com/zarf/blorb/Blorb-Spec.html" title="View upstream source document at eblong.com" target="_blank" rel="noopener">original HTML version</a>,
converted and maintained by Tristano Ajmone:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/tajmone/if-specs" class="bare">https://github.com/tajmone/if-specs</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The document underwent some cosmetic adaptations to abide to AsciiDoc&#8217;s idiomatic style conventions and semantics.
Some paragraphs and text-asides were arbitrarily converted to admonition blocks (when their context justified doing so) to improve the reading experience.
None of these changes altered nor affected the original text contents&#8201;&#8212;&#8201;they are editorial choices to enhance the portability of the source document across different formats and custom templates.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_abstract"><a class="anchor" href="#_abstract"></a>Abstract</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This is a formal specification for a common format for storing resources associated with an interactive fiction game file.
Resources are data which the game can invoke, such as sounds and pictures.
In addition, the executable game file may itself be a resource in a resource file.
This is a convenient way to package a game and all its resources together in one file.</p>
</div>
<div class="paragraph">
<p>Blorb was originally designed solely for the Z-machine, which is capable of playing sounds (Z-machine versions 3 and up) and showing images (the V6 Z-machine).
However, it has been extended for use with other IF systems.
The Glk portable I/O library uses Blorb as a resource format, and therefore so does the Glulx virtual machine.
(See <a href="https://eblong.com/zarf/glk/" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/glk/</a> and <a href="https://eblong.com/zarf/glulx/" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/glulx/</a>.)
ADRIFT 5 (see <a href="http://www.adrift.org.uk/" class="bare" target="_blank" rel="noopener">http://www.adrift.org.uk/</a>) also uses Blorb, albeit with an extended format list.</p>
</div>
<div class="paragraph">
<p>This format is named &#8220;Blorb&#8221; because it wraps your possessions up in a box, and because the common save file format was at one point named &#8220;Gnusto&#8221;.
That has been changed to &#8220;Quetzal&#8221;, but I&#8217;m not going to let that stop me.</p>
</div>
<div class="paragraph">
<p>This proposal is longer than I would have liked.
However, a large percentage of it is optional stuff&#8201;&#8212;&#8201;optional for either the interpreter writer, the game author, or both.
That may make you feel better.
I&#8217;ve also put in lots of examples, explication, and self-justification.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overall_structure"><a class="anchor" href="#_overall_structure"></a>Overall Structure</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The overall format will be a new IFF type.
The FORM type is '&#8288;<code>IFRS</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>The first chunk in the FORM must be a resource index (chunk type '&#8288;<code>RIdx</code>&#8288;'.)
This lists all the resources stored in the IFRS FORM.
There must be exactly one resource index chunk.</p>
</div>
<div class="paragraph">
<p>The resources are stored in the FORM as chunks; each resource is one chunk.
They do not need to be in any particular order, since the resource index contains all the information necessary to find a particular resource.</p>
</div>
<div class="paragraph">
<p>There are several optional chunks which may appear in the file: the release number (chunk type '&#8288;<code>RelN</code>&#8288;'), the game identifier (chunk type '&#8288;<code>IFhd</code>&#8288;'), and others defined hereafter.
They may occur anywhere in the file after the resource index.</p>
</div>
<div class="paragraph">
<p>Several optional chunks may also appear by convention in any IFF FORM: '&#8288;<code>(c)&#160;</code>&#8288;', '&#8288;<code>AUTH</code>&#8288;', and '&#8288;<code>ANNO</code>&#8288;'.
These may also appear anywhere in the file after the resource index.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_contents_of_the_resource_index_chunk"><a class="anchor" href="#_contents_of_the_resource_index_chunk"></a>1. Contents of the Resource Index Chunk</h2>
<div class="sectionbody">
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'RIdx'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length (4 + num*12)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of resources</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*12 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">index entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There is one index entry for each resource.
(But not for the optional chunks.)
Each index entry is 12 bytes long:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of resource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">start</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">starting position of resource</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The index entries should be in the same order as the resource chunks in the file.</p>
</div>
<div class="paragraph">
<p>The usage field tells what kind of resource is being described.
There are currently four values defined:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
'&#8288;<code>Pict</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Picture resource</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>Snd&#160;</code>&#8288;' 
</td>
<td class="hdlist2">
<p>Sound resource</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>Data</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Data file resource</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>Exec</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Code resource</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The number field tells which resource is being described, from the game&#8217;s point of view.
For example, when a Z-code game calls <code>@draw_picture</code> with an argument of 3, the interpreter would find the index entry whose usage is '&#8288;<code>Pict</code>&#8288;' and whose number is 3.
For code chunks (usage '&#8288;<code>Exec</code>&#8288;'), the number should contain 0.</p>
</div>
<div class="paragraph">
<p>The start field tells where the resource chunk begins.
This value is an offset, in bytes, from the start of the IFRS FORM (that is, from the start of the resource file.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Note that the start field must refer to the beginning of a chunk.
It is not strictly required for each resource to refer to a different chunk.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_picture_resource_chunks"><a class="anchor" href="#_picture_resource_chunks"></a>2. Picture Resource Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each picture is stored as one chunk, whose content is a PNG file, a JPEG (JFIF) file, or a placeholder rectangle.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these are various possible formats for a single resource.
It is not possible to have a PNG image and a JPEG image with the same image resource number.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_png_pictures"><a class="anchor" href="#_png_pictures"></a>2.1. PNG Pictures</h3>
<div class="paragraph">
<p>A PNG resource has a chunk type of '&#8288;<code>PNG&#160;</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>PNG is a lossless image compression format.
The PNG file format is available at</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.libpng.org/pub/png/" class="bare" target="_blank" rel="noopener">http://www.libpng.org/pub/png/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_jpeg_pictures"><a class="anchor" href="#_jpeg_pictures"></a>2.2. JPEG Pictures</h3>
<div class="paragraph">
<p>A JPEG resource has a chunk type of '&#8288;<code>JPEG</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>JPEG is a lossy image compression format, developed for photograph-like images.
For information on JPEG, see</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.jpeg.org/jpeg/" class="bare" target="_blank" rel="noopener">https://www.jpeg.org/jpeg/</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_placeholder_pictures"><a class="anchor" href="#_placeholder_pictures"></a>2.3. Placeholder Pictures</h3>
<div class="paragraph">
<p>A third form of picture resource is a placeholder rectangle.
A rectangle has only size, but no contents.
This format exists to describe the legacy behavior of some V6 Infocom games (Zork Zero, Shogun, and Arthur).
Its support in interpreters is optional, and its use is strongly discouraged for any purpose other than conversions of Infocom graphics.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'Rect'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rectangle width</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">height</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rectangle height</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Either or both of the width and height may be zero.</p>
</div>
<div class="paragraph">
<p>In a Z-code game, a rectangle exists for the purposes of <code>@picture_data</code> and <code>@erase_picture</code>, but its use in <code>@draw_picture</code> or <code>@picture_table</code> is an error.
The behavior of rectangles in Glulx and other game files is not defined.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Thanks to Kevin Bracey for this extension.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_sound_resource_chunks"><a class="anchor" href="#_sound_resource_chunks"></a>3. Sound Resource Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each sound is stored as one chunk, whose content is either an AIFF file, an Ogg file, a MOD file, or a song file.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that these are various possible formats for a single resource.
It is not possible to have an AIFF sound and a MOD sound with the same sound resource number.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>On the Z-machine, we must consider the problems of how the game knows the interpreter can play music, and how sampled sounds are played over music.
See the section <a href="#_z_machine_compatibility_issues">&#8220;Z-Machine Compatibility Issues&#8221;</a> later in this document.
(These issues are not relevant to Glk and Glulx.)</p>
</div>
<div class="sect2">
<h3 id="_aiff_sounds"><a class="anchor" href="#_aiff_sounds"></a>3.1. AIFF Sounds</h3>
<div class="paragraph">
<p>An AIFF (Audio IFF) file has chunk type '&#8288;<code>FORM</code>&#8288;', and formtype '&#8288;<code>AIFF</code>&#8288;'.
AIFF is an uncompressed digital-sample format developed in the late 1980s.
The AIFF format is available at these locations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000005.shtml" class="bare" target="_blank" rel="noopener">https://www.loc.gov/preservation/digital/formats/fdd/fdd000005.shtml</a></p>
</li>
<li>
<p><a href="https://eblong.com/zarf/ftp/aiff-c.9.26.91.ps" class="bare">https://eblong.com/zarf/ftp/aiff-c.9.26.91.ps</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_ogg_sounds"><a class="anchor" href="#_ogg_sounds"></a>3.2. Ogg Sounds</h3>
<div class="paragraph">
<p>An Ogg Vorbis file has chunk type '&#8288;<code>OGGV</code>&#8288;'.
This is a high-quality (but lossy) audio compression format, comparable to MP3 (but without the patent concerns that encumber MP3).
The Ogg format is available at:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://www.vorbis.com" class="bare" target="_blank" rel="noopener">http://www.vorbis.com</a></p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_mod_sounds"><a class="anchor" href="#_mod_sounds"></a>3.3. MOD Sounds</h3>
<div class="paragraph">
<p>MOD is an Amiga-originated format for music synthesized from note samples.
Over the years, other formats of this type&#8201;&#8212;&#8201;generally called &#8220;tracker&#8221; or &#8220;module music&#8221; formats&#8201;&#8212;&#8201;have arisen.
Blorb supports four: original &#8220;.MOD&#8221; files, ImpulseTracker (&#8220;.IT&#8221;), FastTracker 2 Extended (&#8220;.XM&#8221;), and ScreamTracker 3 (&#8220;.S3M&#8221;).</p>
</div>
<div class="paragraph">
<p>Because tracker-playing libraries typically handle many formats, it is most practical for Blorb to lump them all together. <em>Regardless of which tracker format is used,</em> the chunk type will be '&#8288;<code>MOD&#160;</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>The formats are described here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000126.shtml" class="bare" target="_blank" rel="noopener">https://www.loc.gov/preservation/digital/formats/fdd/fdd000126.shtml</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This spec does not attempt to distinguish variations within the four supported formats.
(&#8220;.MOD&#8221; is particularly ill-defined, although I have saved comments on the original MOD format at <a href="https://eblong.com/zarf/blorb/mod-spec.txt" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/blorb/mod-spec.txt</a>.)
Instead, we recommend that C implementations embed libmodplug, a public-domain tracker-playing library.
Its home page is:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="http://modplug-xmms.sourceforge.net" class="bare" target="_blank" rel="noopener">http://modplug-xmms.sourceforge.net</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, some bug fixes are included in the version packaged with Windows Glk:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://ifarchive.org/if-archive/programming/glk/implementations/" class="bare" target="_blank" rel="noopener">https://ifarchive.org/if-archive/programming/glk/implementations/</a></p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
Note that it may be safer to compile libmodplug with the <code>MODPLUG_BASIC_SUPPORT</code> option, which eliminates many obscure tracker formats that Blorb does not support.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Where libmodplug is not practical, implementations should use whatever tracker-playing library claims to support the four formats in question.
We trust, perhaps beyond reason, that implementation differences will not lead game creators to their doom.</p>
</div>
</div>
<div class="sect2">
<h3 id="_song_sounds"><a class="anchor" href="#_song_sounds"></a>3.4. Song Sounds</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><em>The song file format is deprecated, as of Blorb 2.0.</em> It is complicated, non-standard, and hard to use.
Its support in interpreters should be considered optional.
However, it will continue to be documented here.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A song file has chunk type '&#8288;<code>SONG</code>&#8288;'.
This is similar to a MOD file, but with no built-in sample data.
The samples are instead taken from AIFF sounds in the resource file.
For each sample, the 22-byte sample-name field in the song should contain the string &#8220;SND1&#8221; to refer to sound resource 1, &#8220;SND953&#8221; to refer to sound resource 953, and so on.
Any sound so referred to must be an AIFF, not a MOD or song.
(You can experiment with fractal recursive music on your own time.)</p>
</div>
<div class="paragraph">
<p>Each sample record in a MOD or song contains six fields: sample name, sample length, finetune value, volume, repeat start, repeat length.
In a MOD file, the sample name is ignored by Blorb (it is traditionally used to store a banner or comments from the author.)
In a song file, the sample name contains a resource reference as described above; but the sample length, repeat start, and repeat length fields are ignored.
These values are inferred from the AIFF resource.
(The repeat start and repeat length are taken from the <code>sustainLoop</code> of the AIFF&#8217;s instrument chunk.
If there is no instrument chunk, or if <code>sustainLoop.playMode</code> is <code>NoLooping</code>, there is no repeat; the repeat start and length values are then considered zero.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that an AIFF need not contain 8-bit sound samples, as a sound built into a MOD would.
A clever sound engine may take advantage of this to generate higher-quality music.
An unclever one can trim (or pad) the AIFF&#8217;s data to 8 bits before playing the song.
In the worst case, it is always possible to trim the AIFF data to 8 bits, append it to the song data, fill in the song&#8217;s sample records (with the appropriate lengths, etc., from the AIFF data); the result is a complete MOD file, which can then be played by a standard MOD engine.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The intent of allowing song files is both to allow higher quality, and to save space.
Note samples are the largest part of a MOD file, and if the samples are stored in resources, they can be shared between songs.
(Typically note samples will be given high resource numbers, so that they do not conflict with sounds used directly by the game.
However, it is legal for the game to use a note sample as a sampled-sound effect, if it wants.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_data_resource_chunks"><a class="anchor" href="#_data_resource_chunks"></a>4. Data Resource Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Each data file is stored as one chunk, with chunk type '&#8288;<code>TEXT</code>&#8288;' or '&#8288;<code>BINA</code>&#8288;' (denoting text or binary data).
The format and contents are up to the game to interpret.</p>
</div>
<div class="paragraph">
<p>This feature was designed to support Glulx, but data resources can be accessed by any game format if the interpreter supports them.</p>
</div>
<div class="paragraph">
<p>For Glulx games (and any other game format which uses the Glk API), the data format must follow the conventions described in the Glk spec.
(<a href="https://eblong.com/zarf/glk/" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/glk/</a>, &#8220;Resource Streams&#8221;.)</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>To summarize: if the data file is opened via <code>glk_stream_open_resource()</code>, then it will be read as a stream of bytes; text will be assumed to be encoded as Latin-1.
If it is opened via <code>glk_stream_open_resource_uni()</code>, then a '&#8288;<code>TEXT</code>&#8288;' chunk will be assumed to be a stream of characters encoded as UTF-8; '&#8288;<code>BINA</code>&#8288;' will be assumed to be a stream of big-endian four-byte integers.
If read by lines (<code>glk_get_line_stream()</code>, etc.), resource text should use Unix line breaks in all cases.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_executable_resource_chunks"><a class="anchor" href="#_executable_resource_chunks"></a>5. Executable Resource Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>There should at most one chunk with usage '&#8288;<code>Exec</code>&#8288;'. <span class="Comment">[But see below.]</span> If present, its number must be zero.
Its content is a VM or game executable.
Its chunk type describes its format:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
'&#8288;<code>ZCOD</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Z-code</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>GLUL</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Glulx</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>TAD2</code>&#8288;'      
</td>
<td class="hdlist2">
<p>TADS 2</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>TAD3</code>&#8288;'      
</td>
<td class="hdlist2">
<p>TADS 3</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>HUGO</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Hugo</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>ALAN</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Alan</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>ADRI</code>&#8288;'      
</td>
<td class="hdlist2">
<p>ADRIFT</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>LEVE</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Level 9</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>AGT&#160;</code>&#8288;' 
</td>
<td class="hdlist2">
<p>AGT</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>MAGS</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Magnetic Scrolls</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>ADVS</code>&#8288;'      
</td>
<td class="hdlist2">
<p>AdvSys</p>
</td>
</tr>
<tr>
<td class="hdlist1">
'&#8288;<code>EXEC</code>&#8288;'      
</td>
<td class="hdlist2">
<p>Native executable</p>
</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This list of formats is taken from the Babel format agreement.
See <a href="https://babel.ifarchive.org" class="bare" target="_blank" rel="noopener">https://babel.ifarchive.org</a> for more information.
Most of these development systems do not support Blorb at the present time; the list is available for future use.
Other executable formats may also be added in the future.
As a convention, the chunk types should be taken from the Babel format name, converted to upper case and padded (if necessary) with spaces.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The EXEC (native) chunk type is not likely to be useful, because it is underspecified.
Nothing (beyond the chunk data itself) indicates what CPU or operating system the executable is intended for.
Again, it is defined here following the Babel format list.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>A resource file which contains an executable chunk contains everything needed to run the executable.
An interpreter can begin interpreting when handed such a resource file; it sees that there is an executable chunk, loads it, and runs it.</p>
</div>
<div class="paragraph">
<p>A resource file which does not contain an executable chunk can only be used in tandem with an executable file.
The interpreter must be handed both the resource file and the executable file in order to begin interpreting.</p>
</div>
<div class="paragraph">
<p>If an interpreter is handed inconsistent arguments&#8201;&#8212;&#8201;that is, a resource file with no executable chunk, or a resource file with an executable chunk plus an executable file&#8201;&#8212;&#8201;it should complain righteously to the user.</p>
</div>
<div class="sect2">
<h3 id="_multiple_executable_chunks"><a class="anchor" href="#_multiple_executable_chunks"></a>5.1. Multiple Executable Chunks</h3>
<div class="paragraph">
<p>As of this spec, no IF system puts more than one '&#8288;<code>Exec</code>&#8288;' chunk in a Blorb file, or has any need to.
However, this could change in the future.</p>
</div>
<div class="paragraph">
<p>One possible use (noted as a comment in earlier versions of this spec) is to support several loadable libraries or game segments.
In such a case, chunk zero should contain the code to execute first, or at the top level.</p>
</div>
<div class="paragraph">
<p>Another possibility is to distribute several versions of a game in one Blorb package.
IF platforms are famed for the fragility of their save files; a player who downloads an updated game file is likely to find that it no longer loads her old saved games.
This could be avoided if the updated Blorb actually contained multiple game files, one per '&#8288;<code>Exec</code>&#8288;' chunk.
Chunk zero would be the preferred (most recent) game version, but when loading a save file, the interpreter would select whichever game version was compatible with it.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_game_identifier_chunk"><a class="anchor" href="#_the_game_identifier_chunk"></a>6. The Game Identifier Chunk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This identifies which game the resources are associated with.
The chunk type is '&#8288;<code>IFhd</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>This chunk is optional; at most one should appear.
If it is present, and the interpreter is given a game file along with a resource file, the interpreter can check that the game matches the IFhd chunk.
If they don&#8217;t, the interpreter should display an error.
The interpreter may want to provide a way for the user to ignore or skip this error (for example, if the user is a game author testing changes to the game file.)</p>
</div>
<div class="paragraph">
<p>If the resource file contains an executable chunk, there is little reason to have an IFhd chunk.
It is legal, however, as long as the identifier matches the executable.</p>
</div>
<div class="paragraph">
<p>For Z-code, the contents of the game identifier chunk are defined in the common save file format specification, section 5.
This spec can be found at</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://ifarchive.org/if-archive/infocom/interpreters/specification/savefile_14.txt" class="bare" target="_blank" rel="noopener">https://ifarchive.org/if-archive/infocom/interpreters/specification/savefile_14.txt</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The &#8220;Initial PC&#8221; field of the IFhd chunk (bytes 10 through 12) has no meaning for resource files.
It should be set to zero.</p>
</div>
<div class="paragraph">
<p>For Glulx, the contents of the game identifier chunk are defined in the Glulx specification.
This can be found at <a href="https://eblong.com/zarf/glulx/" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/glulx/</a>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_color_palette_chunk"><a class="anchor" href="#_the_color_palette_chunk"></a>7. The Color Palette Chunk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This contains information about which colors are used by picture resources in the file.
The chunk type is '&#8288;<code>Plte</code>&#8288;'.
It is optional, and should not appear if there are no '&#8288;<code>Pict</code>&#8288;' resources in the file.
At most one color palette chunk should appear.</p>
</div>
<div class="paragraph">
<p>The format is:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'Plte'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">color data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There are two possibilities for the color data format.
The first is an explicit list of colors.
In this case, the data consists of 1 to 256 color entries.
Each entry is three bytes, of the form:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">red value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(0 = black, 255 = red)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">green value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(0 = black, 255 = green)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1 byte</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">blue value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(0 = black, 255 = blue)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The second case is a single byte, which may have either the value 16 or 32 (decimal). 16 indicates that the picture resources are best displayed on a direct-color display which has 16 or more bits per pixel (5 or more bits per color component.) 32 indicates that the resources are best displayed with 32 or more bits per pixel (8 or more bits per color component.)</p>
</div>
<div class="paragraph">
<p>The two cases are differentiated by checking the chunk length (n).
If n is 1, it&#8217;s a direct color value; if it&#8217;s a positive multiple of 3, it&#8217;s a color list, and the number of entries is the length divided by 3.
Any other length is illegal.</p>
</div>
<div class="paragraph">
<p>This chunk is only a hint; there is no guarantee about what the interpreter will do with it.
A color list will most likely be useful if the interpreter&#8217;s display can only display a limited number of colors (for example, an 8-bit indexed color device).
The interpreter may set the display to the colors listed in the palette.
Or it may set the display to just some of the colors listed (for example, if it wishes to reserve some colors for text display, or if it just doesn&#8217;t have enough colors available.)
Or the interpreter may ignore the palette chunk, or do something else.</p>
</div>
<div class="paragraph">
<p>Similarly, if the interpreter finds a &#8220;16&#8221; or &#8220;32&#8221; value, it may set the display to the appropriate bit depth.
Or it may set the display to an 8-bit color cube, and dither the images for display.
Or, again, it may ignore the palette chunk entirely, or do something else.</p>
</div>
<div class="paragraph">
<p>It is not required that the palette chunk list every color used in the '&#8288;<code>Pict</code>&#8288;' resources.
It is not required that the colors in the palette all be different, or that they all are actually used by '&#8288;<code>Pict</code>&#8288;' resources.
It is not required that the palette have anything to do with the game art at all.
Of course, if you give the interpreter misleading hints, you deserve whatever you get.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_frontispiece_chunk"><a class="anchor" href="#_the_frontispiece_chunk"></a>8. The Frontispiece Chunk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Blorb format generally does not specify how images are loaded and displayed; that is the province of the game file format.
However, it may be desirable to associate a single image with the game.
The image would serve as a frontispiece, or &#8220;cover art&#8221;.</p>
</div>
<div class="paragraph">
<p>The exact use of a frontispiece image is left open to invention.
An interpreter may display it before starting a game.
Or it might display frontispieces while the player is <em>choosing</em> a game to play (as an aid to locating a particular game).
An index of games might extract the frontispieces and use them as catalog illustrations.</p>
</div>
<div class="paragraph">
<p>If present, the frontispiece is simply an ordinary picture resource.
It is singled out as a frontispiece by a chunk with type '&#8288;<code>Fspc</code>&#8288;'; this contains its image resource number.
There may not be more than one '&#8288;<code>Fspc</code>&#8288;' chunk.</p>
</div>
<div class="paragraph">
<p>The frontispiece image may be of any legal Blorb type (except a placeholder rectangle).
The image may be of any size, but is preferred to be square or approximately so.
This allows interpreters to display frontispieces in a systematic way, scaling them to fit a layout, without wasting screen space.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Since the frontispiece image is not loaded by the game file, it may be used even with game files that do not support graphics, such as the V5 Z-machine.
In a graphics-capable game file, it is legal for the frontispiece image to also be loaded by the game file in the usual way.</p>
</div>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'Fspc'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of a Pict resource</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="_the_resource_description_chunk"><a class="anchor" href="#_the_resource_description_chunk"></a>9. The Resource Description Chunk</h2>
<div class="sectionbody">
<div class="paragraph">
<p>For a game to be fully accessible to visually impaired users, it should provide textual descriptions to be displayed as alternatives to images.
Similarly, audio resources should have textual descriptions as alternatives for hearing-impaired users.</p>
</div>
<div class="paragraph">
<p>The resource description chunk allows the Blorb file to offer this information.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'RDes'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">len</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of entries</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The entries are variable-length, and look like:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">usage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">resource usage</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number of resource</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">length</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">length of text (bytes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">length bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">textual description (UTF-8, not null-terminated)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>There should be at most one entry for each resource&#8201;&#8212;&#8201;that is, each (usage, number) pair.</p>
</div>
<div class="paragraph">
<p>Resource descriptions are not required, but they are recommended for significant sounds and images.
(Images used for decoration, such as window borders or text dividers, may not need textual descriptions.)
Data and executable chunks do not need descriptions; if they appear in this chunk, the interpreter can ignore them.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
An interpreter with a web interface would apply the textual description of an image as an &#8220;alt&#8221; attribute on the <code>&lt;img&gt;</code> tag.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_metadata"><a class="anchor" href="#_metadata"></a>10. Metadata</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Metadata is a contentious topic, with which the Blorb spec is not entirely unentangled.
(The game identifier and frontispiece chunks are answers to small parts of the IF metadata problem.)</p>
</div>
<div class="paragraph">
<p>Rather than entangle ourselves further, we will merely say that metadata will be stored as XML, in a chunk of type '&#8288;<code>IFmd</code>&#8288;'.
The XML structure is documented in the Babel format agreement; see <a href="https://babel.ifarchive.org" class="bare" target="_blank" rel="noopener">https://babel.ifarchive.org</a>.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'IFmd'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">XML document (UTF-8 encoding)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The handling of metadata chunks will not be defined here.
In particular, the behavior of an interpreter which finds more than one metadata chunk is undefined.
It is likely to be a good idea to have at most one.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_chunks_specific_to_the_z_machine"><a class="anchor" href="#_chunks_specific_to_the_z_machine"></a>11. Chunks Specific to the Z-machine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Z-machine&#8217;s graphics and sound capabilities were added late in Infocom&#8217;s history, but early in the history of data format standardization.
As a result, the Z-machine&#8217;s audio and image models are both too rigid and too flexible to work well with modern file formats.</p>
</div>
<div class="paragraph">
<p>To compensate for this, we add additional information to the Blorb file.
Interpreters can use these hints to display the resource information correctly.</p>
</div>
<div class="paragraph">
<p>Some of these hints are needed only to handle legacy Infocom games and their resources.
Others will be useful for the creation of new Z-code games.</p>
</div>
<div class="paragraph">
<p>Each of these chunks is optional; no more than one of each should appear.</p>
</div>
<div class="sect2">
<h3 id="_the_release_number_chunk"><a class="anchor" href="#_the_release_number_chunk"></a>11.1. The Release Number Chunk</h3>
<div class="paragraph">
<p>This chunk is used to tell the interpreter the release number of the resource file.
It is meaningful only in Z-code resource files.</p>
</div>
<div class="paragraph">
<p>The interpreter passes this information to the game when the <code>@picture_data</code> opcode is executed with an argument of 0.
The release number is a 16-bit value.
The chunk format is:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'RelN'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">release number</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>This chunk is optional.
If it is not present, the interpreter should assume a release number of 0.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_resolution_chunk"><a class="anchor" href="#_the_resolution_chunk"></a>11.2. The Resolution Chunk</h3>
<div class="paragraph">
<p>This chunk contains information used to scale images.
The chunk type is '&#8288;<code>Reso</code>&#8288;'.
It is optional.
This chunk is meaningful only in Z-code resource files.</p>
</div>
<div class="paragraph">
<p>A scalable image is one which the author says should be larger when more space is available, and smaller when less space is available.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that the Z-code game does <em>not</em> directly control the scaling of images.
The interpreter controls the scaling of images, in response to the information in the resolution chunk.
The interpreter then provides the scaled size in response to <code>@picture_data</code> queries, and the game draws its display based on those queries.)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>It is also possible to create images that have a fixed scaling ratio; they are always scaled up or down by a particular amount, regardless of window size.</p>
</div>
<div class="paragraph">
<p>Not all images have to be scalable.
Unless the resolution chunk gives scaling data for an image, that image is assumed to be non-scalable.
Non-scalable images are always displayed at their actual size.
(One image pixel per screen pixel.)</p>
</div>
<div class="paragraph">
<p>This chunk is optional; if it is not present, then all of the images in this file are non-scalable.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'Reso'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*28+24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">px</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">standard window width</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">py</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">standard window height</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum window width</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">miny</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minimum window height</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum window width</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maximum window height</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*28 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">image resolution entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The &#8220;standard window size&#8221; is the normal size, the author&#8217;s original chosen size, for the Z-machine window.
It is not the only possible size; a good V6 game should be prepared for any window the interpreter chooses to create.
The idea is that when the Z-machine window is exactly the standard size, scalable images are presented at their original size.
When the Z-machine window is larger than the standard size, scalable images are scaled up; when it is smaller, scalable images are scaled down.</p>
</div>
<div class="paragraph">
<p>The minimum and maximum window sizes are provided as a hint to the interpreter, when it is choosing a window size.
It may also use the standard window size as a hint for this purpose.
(If the interpreter lacks the ability to choose its own window size, of course, it will ignore these hints.)
The idea is that the minimum and maximum sizes define the range in which the game can draw itself successfully.</p>
</div>
<div class="paragraph">
<p>Any or all of minx, miny, maxx, maxy can indicate &#8220;no limit in this direction&#8221; by containing a value of zero.
However, px and py must contain non-zero values.
Unless the min or max values are zero, it must be true that minx ≤ px ≤ maxx, miny ≤ py ≤ maxy.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The standard, minimum, and maximum window size values are measured in <em>screen pixels</em>.
Furthermore, unscaled pictures should be drawn in screen pixels&#8201;&#8212;&#8201;one image pixel per screen pixel.
(This may seem dumb as rocks, and maybe it is, but my rationale is presented at the end of this document.)</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Also note that I have not mentioned Z-pixels.
This standard does not concern itself with Z-pixels.</p>
</div>
<div class="paragraph">
<p>On with the show.</p>
</div>
<div class="paragraph">
<p>The standard, minimum, and maximum window sizes are followed by a set of image entries, one for each scalable image.
(Non-scalable images do not have an entry in this table; that&#8217;s how they are declared to be non-scalable.)
Each image entry is 28 bytes, of the form:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">image resource number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ratnum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numerator of standard ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ratden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">denominator of standard ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minnum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numerator of minimum ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">minden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">denominator of minimum ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxnum</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">numerator of maximum ratio</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">maxden</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">denominator of maximum ratio</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The number is the picture number; in other words, this entry applies to the resource whose usage is '&#8288;<code>Pict</code>&#8288;' and whose number matches this value.</p>
</div>
<div class="paragraph">
<p>The entry then contains a standard, minimum, and maximum image scaling ratio.
Each ratio is a real number, represented by two integers:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>stdratio = ratnum / ratden</p>
</li>
<li>
<p>minratio = minnum / minden,</p>
</li>
<li>
<p>maxratio = maxnum / maxden.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Minratio can indicate zero (&#8220;no minimum limit&#8221;) by having both minnum and minden equal to zero.
Similarly, maxratio can indicate infinity (&#8220;no maximum limit&#8221;) by having maxnum and maxden equal to zero.
It is illegal to have only half of a fraction be zero.</p>
</div>
<div class="paragraph">
<p>To compute the actual scaling ratio for this image, the interpreter must first compute the overall game scaling ratio, or Elbow Room Factor (ERF).
If the actual game window size is (wx,wy), and the standard window size is (px,py), then</p>
</div>
<div class="ulist">
<ul>
<li>
<p>ERF = (wx/px) or (wy/py), whichever is smaller.</p>
</li>
</ul>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that if the game&#8217;s window is exactly its standard size, ERF = 1.0.
If the window is twice the standard size, ERF = 2.0.
If the window is three times the standard width and four times the standard height, then ERF = 3.0, because there&#8217;s really only enough room for the game&#8217;s standard layout to be tripled before it overflows horizontally.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The scaling ratio R for this image is then determined:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If ERF*stdratio &lt; minratio, then R = minratio.</p>
</li>
<li>
<p>If ERF*sdtratio &gt; maxratio, then R = maxratio.</p>
</li>
<li>
<p>If minratio ≤ ERF*stdratio ≤ maxratio, then R = ERF * stdratio.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If minratio and maxratio are the same value, then R will always be this value; ERF and stdratio are ignored in this case.
(This indicates a scalable image with a fixed scaling ratio.)</p>
</div>
<div class="paragraph">
<p>The interpreter then knows that this image should be drawn at a scale of R screen pixels per image pixel, both vertically and horizontally.
The interpreter should report this scaled size to the game if queried with <code>@picture_data</code> (as opposed to the original image size).</p>
</div>
<div class="paragraph">
<p>Yes, this is an ornate system.
The author is free to ignore it by not including a resolution chunk.
If the author wants scaled images, or variably-scalable images, this system should suffice.</p>
</div>
<div class="paragraph">
<p>Here are some examples.
They&#8217;re not necessarily examples of good art design, but they do demonstrate how a given set of desires translate into images and resolution values.
All are for a game with a standard size of (600,400).</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The game wishes a title image that covers the entire window, and all the resolution should be visible at the standard size.
(So if the window is twice the standard size, the image will be stretched and coarse-looking; if the window is half the standard size, the image will be squashed and lose detail.)</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image size (600,400); stdratio 1.0; minratio zero; maxratio infinity.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The game has a background image of a cave, made from a scanned photograph.
At standard window size, this should cover the entire window, but not all the detail needs to be visible.
If the window is larger, the image should still cover the entire window; more detail will be visible, up to twice the standard size (at which point all the resolution should be visible.)
If the window is larger than twice the standard size, the image should not be stretched farther; instead the game will center it and have blank space around the edges.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image size (1200,800); stdratio 0.5; minratio zero; maxratio 1.0.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The game has small monochrome icons indicating different magical perceptions, which it will draw interspersed with the text.
The icons should always be drawn at double size, two screen pixels per image pixel, regardless of the window size.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image size (20,20); stdratio 1.0; minratio 2.0; maxratio 2.0.</p>
</li>
<li>
<p>(In this case, remember, the stdratio value is ignored.)</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The game has a graphical compass rose which it will draw in the top left corner.
This should be 1/4 of the window size in the standard case, and shrink proportionally if the window is smaller.
However, if the window is larger than standard, the rose should not grow; all the extra space can be allotted for text.
All detail (image pixels) should be visible in the standard case.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image size (150,100); stdratio 1.0; minratio zero; maxratio 1.0.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>The same compass rose, still to be 1/4 of the window size&#8201;&#8212;&#8201;but this time it is critical that all the image detail be visible when the window is as small as half-standard (that is, when the rose is 75 by 50 pixels).
At standard scale (150 by 100), it will therefore appear stretched and coarse.
If the window is smaller than half the standard size, the rose should not shrink beyond 75x50, so that pixels are never lost.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Image size (75,50); stdratio 2.0; minratio 1.0; maxratio 2.0.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="paragraph">
<p>End of verbose examples.</p>
</div>
</div>
<div class="sect2">
<h3 id="_the_adaptive_palette_chunk"><a class="anchor" href="#_the_adaptive_palette_chunk"></a>11.3. The Adaptive Palette Chunk</h3>
<div class="paragraph">
<p>This chunk contains a list of pictures that change their colors according to the pictures plotted before.
The chunk type is '&#8288;<code>APal</code>&#8288;'.
It is optional.
This chunk is meaningful only in Z-code resource files.</p>
</div>
<div class="paragraph">
<p>This format exists to describe the legacy behavior of some V6 Infocom games (Zork Zero and Arthur).
Its support in interpreters is optional, and its use is strongly discouraged for any purpose other than conversions of Infocom graphics.</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'APal'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adaptive palette entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each entry is 4 bytes, of the form:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">picture resource number</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>If this chunk is present:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All pictures in the Blorb file will be PNGs or Rects.</p>
</li>
<li>
<p>All PNGs will be indexed-color (color type 3).</p>
</li>
<li>
<p>All PNGs will use only color indices 2 through 15.</p>
</li>
<li>
<p>All PNGs will have no more than 16 entries in their PLTE chunk.</p>
</li>
<li>
<p>PNGs may have a tRNS chunk marking color 0 only as fully transparent, in which case color index 0 may also be used.
No other forms of the tRNS chunk are valid.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>However, the following rules still apply from the PNG standard:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Any bit depth of PNG is valid (1, 2, 4, or 8 bits per pixel).</p>
</li>
<li>
<p>The PLTE chunk is required by the PNG standard, and it must have sufficient entries to cover every color used in the PNG, even in adaptive-palette pictures.</p>
</li>
<li>
<p>The PLTE chunk may not have more entries than can be represented by the PNG&#8217;s bit depth.</p>
</li>
<li>
<p>The PNGs may have gAMA, cHRM and sRGB or iCCP chunks describing the color space.
Interpreters should make every effort to support at least gAMA.
For the Infocom graphics at least, cHRM, sRGB and iCCP are probably beyond the call of duty.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>These restrictions, though intricate, serve to make the interpreter&#8217;s life easier at the expense of constraining the creator.
The constraints are natural given the form of the original Infocom graphics.</p>
</div>
<div class="paragraph">
<p>The interpreter should keep track of the &#8220;Current Palette&#8221;.
This will be a 14-entry table, covering color indices 2-16.
For ease of implementation, this will probably be a 16-entry table, whose first two entries are not significant.</p>
</div>
<div class="paragraph">
<p>Whenever a picture <em>not</em> listed in the APal chunk is plotted, its palette (as derived from its PLTE, gAMA, cHRM and sRGB/iCCP chunks) should be copied into the Current Palette.
If its palette has fewer than 16 entries, then only those entries of the Current Palette are changed.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Possible interpreter implementation: transform the PNG&#8217;s PLTE chunk according to the gAMA, cHRM, sRGB chunks, then copy it into your Current Palette which is always in the screen color-space.
With libpng, use <code>png_get_PLTE</code>, after calling <code>png_update_info</code>.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Whenever a picture listed in the APal chunk is plotted, its palette should be ignored, and it should be plotted with the Current Palette.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Possible interpreter implementation: strip out the PLTE, gAMA, cHRM and sRGB/iCCP chunks from the PNG, and insert the Current Palette as its PLTE.
Or with libpng, use <code>png_set_PLTE</code> before reading the data.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The behavior is undefined if any adaptive-palette pictures are plotted before a non-adaptive picture has been plotted.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If picture caching (through <code>@picture_data</code> or otherwise) is implemented, special attention may need to be paid to ensure that adaptive images that are cached are still appropriate for the Current Palette when plotted.
It would appear that the Zork Zero does reset the cache after a palette change, but this has not been exhaustively investigated.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Alternatively, for the full retro-gaming experience, the pictures can be handled in the same way as the Amiga and IBM MCGA interpreters, as follows: Use a 16-color screen mode.
Copy non-adaptive pictures&#8217; palette (apart from the first two entries) into the screen palette when plotted.
Use color indices 0 and 1 for the window background and text respectively.
This mimics the IBM MGA and Amiga display, where drawing a picture can change the colors of graphics already on the screen, but it is not the preferred rendering.</p>
</div>
<div class="paragraph">
<p>Shogun and Journey do not use any adaptive-palette images, but on some platforms the effect of pictures already on the screen changing color is visible.
To give an interpreter the ability to do this if desired, and to signal that optimizations may be possible because of the limited nature of the graphics, the Blorb files for Shogun and Journey contain an empty APal chunk.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Thanks to Kevin Bracey for this extension.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_the_looping_chunk"><a class="anchor" href="#_the_looping_chunk"></a>11.4. The Looping Chunk</h3>
<div class="paragraph">
<p>This chunk contains information about which sounds are looped, in a V3 Z-machine game.
The chunk type is '&#8288;<code>Loop</code>&#8288;'.
It is optional.</p>
</div>
<div class="admonitionblock caution">
<table>
<tr>
<td class="icon">
<i class="fa icon-caution" title="Caution"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Note that in V5 and later, the <code>@sound_effect</code> opcode determines whether a sound loops.
The looping chunk is ignored.
Therefore, this chunk should not be used at all in Blorb files intended for games which are not V3 Z-machine games.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The format is:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'Loop'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk ID</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">chunk length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">num*8 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sound looping entries</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each entry is 8 bytes, of the form:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sound resource number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">repeats</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The repeats flag is one if the sound is to be played once; it is zero if the sound is to repeat indefinitely (until it is stopped or another sound started.)
If there is no entry for a particular sound resource, or if the looping chunk is absent, the V3 interpreter should assume the flag is one, and play the sound exactly once.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_optional_chunks"><a class="anchor" href="#_other_optional_chunks"></a>12. Other Optional Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A resource file can contain extra user-level information in '&#8288;<code>AUTH</code>&#8288;', '&#8288;<code>(c)&#160;</code>&#8288;', and '&#8288;<code>ANNO</code>&#8288;' chunks.
These are all optional.
An interpreter should not do anything with these other than ignore them or (optionally) display them.</p>
</div>
<div class="paragraph">
<p>These chunks all contain simple ASCII text (all characters in the range 0x20 to 0x7E).
The only indication of the length of this text is the chunk length (there is no zero byte termination as in C, for example).</p>
</div>
<div class="paragraph">
<p>The '&#8288;<code>AUTH</code>&#8288;' chunk, if present, contains the name of the author or creator of the file.
This could be a login name on multi-user systems, for example.
There should only be one such chunk per file.</p>
</div>
<div class="paragraph">
<p>The '&#8288;<code>(c)&#160;</code>&#8288;' chunk contains the copyright message (date and holder, without the actual copyright symbol).
There should only be one such chunk per file.</p>
</div>
<div class="paragraph">
<p>The '&#8288;<code>ANNO</code>&#8288;' chunk contains any textual annotation that the user or writing program sees fit to include.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_deprecated_chunks"><a class="anchor" href="#_deprecated_chunks"></a>13. Deprecated Chunks</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Some older Z-code Blorb files contain an '&#8288;<code>SNam</code>&#8288;' (story name) chunk, which contains the game&#8217;s title.
The format of this chunk is Unicode UTF-16, with the 16-bit values stored big-endian.
Modern Blorb files should not have an '&#8288;<code>SNam</code>&#8288;' chunk; this information should be stored in the metadata chunk instead.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_presentation_and_compatibility"><a class="anchor" href="#_presentation_and_compatibility"></a>14. Presentation and Compatibility</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_file_suffixes"><a class="anchor" href="#_file_suffixes"></a>14.1. File Suffixes</h3>
<div class="paragraph">
<p>Previous versions of the Blorb spec did not discuss file naming.
However, with the relapse of MacOS into filename suffix semantics, it is impossible for us to pretend that the issue is an implementation detail.</p>
</div>
<div class="paragraph">
<p>It is always legal for a Blorb file to have a &#8220;.blorb&#8221; filename suffix.
However, interpreters have a natural interest in locating <em>their</em> sort of Blorb files&#8201;&#8212;&#8201;Z-code, Glulx, or so on&#8201;&#8212;&#8201;and it is generally easier for them to do this by filename suffix, rather than by opening each Blorb and looking at its resource index.
Therefore, &#8220;.zblorb&#8221; and &#8220;.gblorb&#8221; should be used to designate Blorb files containing Z-code and Glulx games, respectively.</p>
</div>
<div class="paragraph">
<p>On platforms which limit filename suffixes to three characters, the suffixes &#8220;.blb&#8221;, &#8220;.zlb&#8221;, and &#8220;.glb&#8221; may be used instead.
But this practice, at least, I can deprecate without qualm.
I hope.</p>
</div>
</div>
<div class="sect2">
<h3 id="_mime_types"><a class="anchor" href="#_mime_types"></a>14.2. MIME Types</h3>
<div class="paragraph">
<p>Historically, Blorb files have been associated with the MIME type <code>application/x-blorb</code>.</p>
</div>
<div class="paragraph">
<p>We can use the profile feature of MIME to differentiate the contents: <code>application/x-blorb;profile="zcode"</code> and <code>application/x-blorb;profile="glulx"</code> for the common virtual machines.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Previous versions of this spec suggested <code>application/x-blorb-zmachine</code> and <code>application/x-blorb-glulx</code>.
These are now deprecated.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_z_machine_compatibility_issues"><a class="anchor" href="#_z_machine_compatibility_issues"></a>14.3. Z-Machine Compatibility Issues</h3>
<div class="paragraph">
<p>The image system presented in this document is fully backwards-compatible with Infocom&#8217;s interpreters.
Infocom V6 games, such as Arthur, Journey, and Zork Zero, contain only non-scalable image resources.
The game files are written to deal with both variations in window size and variations in image size (since the interpreters for different platforms had different window sizes and different art.)
Therefore, if you construct a Blorb file containing the images from a particular platform (say, the Mac) and give it the suggested window size of the Infocom Mac interpreter, the game file will deal with it correctly.</p>
</div>
<div class="paragraph">
<p>The image system is also sort of forwards-compatible, in the following sense.
If you take a Blorb file whose standard (intended) window size is the same as the Infocom interpreter&#8217;s, and break it out into Infocom image files, the Infocom interpreter should display it correctly.
The interpreter will not scale images, but since the window size is equal to the standard size, the Blorb rules require the images to be displayed unscaled anyway.</p>
</div>
<div class="paragraph">
<p>Also, of course, if you take a Blorb file which contains only non-scalable images, an Infocom interpreter will act correctly, since it will not scale the images regardless of the standard size.</p>
</div>
<div class="paragraph">
<p>The sound system is slightly more problematic.
A game file can announce that it uses sound, by setting a header bit; the interpreter can announce that it does not support sound, by clearing that bit.
But there is no way to distinguish a game that uses sampled sound only, from one that uses sampled sound and music.
(And similarly for the interpreter&#8217;s support of samples versus music.)
This may be addressed in a future revision of the Z-machine.
In the meantime, games should set that header bit if any kind of sound is used (samples or music or both.)
And interpreters should clear that bit only if <em>no</em> sound support is available.
If the interpreter supports sampled sound but not music, it should leave the header bit set, announcing that it does &#8220;support sound.&#8221;
It should then ignore any request to play a music resource.</p>
</div>
<div class="paragraph">
<p>There is also the question of overlapping sounds.
The Z-Spec (9.4.2) says that starting a new sound effect automatically stops any current one.
But it is not desirable that a sound effect such as footsteps should interrupt the playing of background music.
Therefore, the interpreter should amend this rule, and consider sampled sounds and music to be in seperate &#8220;channels&#8221;.
Samples interrupt samples, and music interrupts music, but one form of sound does not interrupt the other.</p>
</div>
<div class="paragraph">
<p>This is an actual variance in the behavior of the Z-machine, and worse, a variance which depends on data format.
(One sound will either stop another, or not, depending on whether the sound is stored in AIFF (sampled) or Ogg/MOD (music) format.)
We apologize for the ugliness.</p>
</div>
<div class="paragraph">
<p>Again, future versions of the Z-machine may address this issue, and allow a more general system where any sound can be overlaid on any other sound, or interrupt it, as the game desires and regardless of storage format.
(After all, there can be background <em>sounds</em> as well as background <em>music</em>.)
Such a system would also allow the interpreter to announce its limitations and capabilities&#8201;&#8212;&#8201;whether it can play music, whether it can play two pieces of music at once, how many sampled sounds it can play at once, etc.</p>
</div>
<div class="paragraph">
<p>A final, ah, note: The remark at the end of Z-Spec chapter 9, about sequencing sound effects to simulate the slow Amiga version of &#8220;The Lurking Horror&#8221;, should not be applied to music sounds.
New music should interrupt old music immediately, regardless of whether keyboard input has occurred since the old music started.</p>
</div>
</div>
<div class="sect2">
<h3 id="_glk_compatibility_issues"><a class="anchor" href="#_glk_compatibility_issues"></a>14.4. Glk Compatibility Issues</h3>
<div class="paragraph">
<p>The Glk I/O library was designed with portable resources in mind, so there should be no incompatibility.</p>
</div>
<div class="paragraph">
<p>Remember that the resolution and scaling data is not used by Glk.
That chunk is ignored by Blorb-capable Glk libraries.</p>
</div>
</div>
<div class="sect2">
<h3 id="_adrift_5_compatibility_issues"><a class="anchor" href="#_adrift_5_compatibility_issues"></a>14.5. ADRIFT 5 Compatibility Issues</h3>
<div class="paragraph">
<p>ADRIFT supports more media formats than Blorb, but has adopted Blorb as a packaging format.
To permit this, the following chunk types may be used in ADRIFT blorbs:</p>
</div>
<div class="paragraph">
<p>For images: '&#8288;<code>GIF&#160;</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>For sounds: '&#8288;<code>WAV&#160;</code>&#8288;', '&#8288;<code>MIDI</code>&#8288;', '&#8288;<code>MP3&#160;</code>&#8288;'.</p>
</div>
<div class="paragraph">
<p>ADRIFT Blorb files should use MIME type <code>application/x-blorb;profile="adrift"</code>.
The filename suffix should be &#8220;.blorb&#8221; or &#8220;.adriftblorb&#8221;.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>&#8220;A&#8221; or &#8220;AD&#8221; is unfortunately not a unique prefix when it comes to IF systems!</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_the_iff_format"><a class="anchor" href="#_the_iff_format"></a>15. The IFF Format</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A description of the IFF format can be found at</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://eblong.com/zarf/blorb/iff.html" class="bare" target="_blank" rel="noopener">https://eblong.com/zarf/blorb/iff.html</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>In the interests of simplicity, this proposal does not use IFF LISTs or CATs, even though its purpose is to contain concatenated lists of data.
Therefore, the format can be quickly described as follows:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'FORM'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Magic number indicating IFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM length (file length&#8201;&#8212;&#8201;8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>'IFRS'</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">FORM type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">n-4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The chunks, concatenated</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Each chunk has the following format:</p>
</div>
<table class="tableblock frame-all grid-all fit-content">
<colgroup>
<col>
<col>
<col>
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chunk type</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">m</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chunk data length</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">m bytes</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Chunk data</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Remember that the chunk length <em>never</em> includes the eight-byte header (the type and length).
This is true for the top-level FORM and internal FORMs as well.</p>
</div>
<div class="paragraph">
<p>If a chunk has an odd length, it <em>must</em> be followed by a single padding byte whose value is zero.
(This padding byte is not included in the chunk length m.)
This allows all chunks to be aligned on even byte boundaries.</p>
</div>
<div class="paragraph">
<p>All numbers are two-byte or four-byte unsigned integers, stored big-endian (most significant byte first.)
Character constants such as '&#8288;<code>FORM</code>&#8288;' are stored as four ASCII bytes, in order from left to right.</p>
</div>
<div class="paragraph">
<p>When reading an IFF file, a program should always ignore any chunk it doesn&#8217;t understand.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_other_resource_arrangements"><a class="anchor" href="#_other_resource_arrangements"></a>16. Other Resource Arrangements</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It may be convenient for an interpreter to be able to access resources in formats other than a resource file.
In particular, when developing a game, an author will want to load images and sounds from individual files, rather than having to re-package all the resources whenever any one of them changes.</p>
</div>
<div class="paragraph">
<p>Such resource arrangements are platform-specific, and the details are left to the interpreter.
However, one suggestion is to have a single directory which contains all the resources as files, with one file per resource.
(PNG files for images, and so on.
The contents of each file would be exactly the same as the contents of the equivalent chunk, minus the initial eight bytes of type/length information.)
Files would be named something like &#8220;PIC1&#8221;, &#8220;PIC2&#8221;&#8230;&#8203;, &#8220;SND1&#8221;, &#8220;SND2&#8221;&#8230;&#8203;, &#8220;DATA1&#8221;, &#8220;DATA2&#8221;&#8230;&#8203;, and so on.
An executable game file (if present) would be named &#8220;STORY&#8221;.
Other chunks would be named as follows:</p>
</div>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
&#8220;IDENT&#8221;    
</td>
<td class="hdlist2">
<p>game identifier chunk</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;PALETTE&#8221;  
</td>
<td class="hdlist2">
<p>color palette</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;FRONTIS&#8221;  
</td>
<td class="hdlist2">
<p>frontispiece identifier</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;RESDESC&#8221;  
</td>
<td class="hdlist2">
<p>resource textual descriptions</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;METADATA&#8221; 
</td>
<td class="hdlist2">
<p>metadata document</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;RELEASE&#8221;  
</td>
<td class="hdlist2">
<p>release number</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;RESOL&#8221;    
</td>
<td class="hdlist2">
<p>resolution chunk</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;ADAPTPAL&#8221; 
</td>
<td class="hdlist2">
<p>adaptive palette list</p>
</td>
</tr>
<tr>
<td class="hdlist1">
&#8220;LOOPING&#8221;  
</td>
<td class="hdlist2">
<p>looping chunk</p>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>(Naturally, file suffixes would be added in platforms that require them.)
The interpreter would be started up and handed the entire directory as an argument; or possibly the directory along with a separate Z-code file.</p>
</div>
<div class="paragraph">
<p>It is of course possible to break a Blorb file down into a directory in this format.
When doing this, one must remember that AIFF (and no other chunk type) uses an IFF form as its single-file representation.
Therefore, the SND&#8230;&#8203; file representing an AIFF will begin &#8220;FORM(length)AIFF&#8221;, followed by the chunk data.
All other chunk types would be turned into files simply by extracting the chunk data.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_rationales_and_rationalizations"><a class="anchor" href="#_rationales_and_rationalizations"></a>17. Rationales and Rationalizations</h2>
<div class="sectionbody">
<div class="qlist qanda">
<ol>
<li>
<p><em>Why have a common resource collection format?</em></p>
<p>Infocom chose not to standardize their resource formats; they had a different picture format for each platform.</p>
<div class="paragraph">
<p>This was a reasonable choice for them, since they were writing all the games, all the art, and all the interpreters.
They therefore had the capacity to translate the art into platform-specific formats for all the platforms they supported.</p>
</div>
<div class="paragraph">
<p>In the modern age, an IF author does not have access to all the platforms his game will be played on.
It is therefore reasonable to distribute art in a single format, and leave interpreter writers the job of supporting that format.</p>
</div>
</li>
<li>
<p><em>Why an IFF-based format?</em></p>
<p>IFF does what we want; it&#8217;s a known, very simple way to concatenate chunks of data together.</p>
<div class="paragraph">
<p>Also, the common save-file format is IFF-based.
This allows interpreters to use the same code for reading both save files and resource files.</p>
</div>
</li>
<li>
<p><em>Why not compress data as well as archiving it?</em></p>
<p><em>Why just concatenate everything together as chunks?</em></p>
<div class="paragraph">
<p>Any reasonable sound or image format already incorporates compression.</p>
</div>
</li>
<li>
<p><em>Why is there a &#8220;number&#8221; field in the entries in the resource index chunk?</em></p>
<p><em>Why not just assume chunks are numbered consecutively?</em></p>
<div class="paragraph">
<p>On the Z-machine, pictures are not necessarily numbered contiguously (Z-Spec 8.8.6.1.)
Sounds are numbered consecutively, but sounds 1 and 2 are bleeps, so the game-specific sound resources start at 3.
(Z-Spec 9.2.)
In Glk, resources need not be contiguous at all.
Rather than jigger the numbering or require place-holder chunks, I decided there should be an index which maps resource numbers to chunks.</p>
</div>
</li>
<li>
<p><em>Why only two image formats?</em></p>
<p><em>Why not allow any image format?</em></p>
<p>The whole point of this exercise is to assure the author that the player can view his art.
If we allow lots of different formats, we can&#8217;t possibly insist that every interpreter must display all the formats.
This leaves us just about back where we started.
Individual game authors would be negotiating with individual interpreter authors to support particular formats, and it would just be icky.</p>
<div class="paragraph">
<p>Therefore, we <em>do</em> insist that every interpreter be able to display all the formats listed in this standard.
That means a small number of formats.
See the next two questions.</p>
</div>
<div class="paragraph">
<p>It is very strongly suggested that an interpreter use standard open-source libraries for interpreting sound and image resources.
To rely on OS services, while tempting, is a road paved with incompatibility problems.</p>
</div>
</li>
<li>
<p><em>Okay, then, why three sound formats?</em></p>
<p>Because a sampled-sound format (like AIFF) can reproduce anything, and a compressed digital format (like Ogg) can reproduce large sounds efficiently.</p>
<div class="paragraph">
<p>MOD can reproduce music even more efficiently, but it&#8217;s really retained in the spec more for backwards compatibility than for any technical reason.
Existing games use it, and while it&#8217;s not very well standardized, it seems to work.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The &#8220;song&#8221; format was never widely used, which is both the qualification and the justification for deprecating it.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><em>Why PNG and JPEG for images?</em></p>
<p>The PNG format is not burdened with patent restrictions; it is free; it&#8217;s not lossy; and it can efficiently store many types of images, from 1-bit (monochrome) images up to 48-bit color images.
JPEG is lossy and not optimal for images other than photographs, but compresses photographs well.
Earlier versions of Blorb specified only PNG, but JPEG was a popular request, and the two formats should complement each other.</p>
<div class="paragraph">
<p>As to other possibilities: GIF is a popular format, but was previously owned by twits who restricted its use.
(Life has improved, but we have PNG now and we will stick with it.)
TIFF has been suggested, but it seems to be overly baroque.
Blorb is likely to stay with PNG and JPEG for the foreseeable future.</p>
</div>
</li>
<li>
<p><em>So why does ADRIFT get a bye on these format decisions?</em></p>
<p>Game authors and interpreters need to agree on what formats they will use.
Z-code had no cross-platform agreement when Blorb was invented, and Glulx was created to use Blorb, so Blorb&#8217;s role for them is normative.
GIF and MP3 are not going to become standard Blorb format types.</p>
<div class="paragraph">
<p>ADRIFT, in contrast, already had cross-platform interpreters when it adopted Blorb.
Blorb can therefore be valuable to ADRIFT as a packaging and metadata format, while taking a descriptive role on media formats.
(The alternative would be to disallow ADRIFT Blorb files, which seems silly.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It is worth noting, however, that IF interpreters are often ported by adapting existing IF display code.
IF interpreter ports can also be based on Glk libraries and the Glk API.
Both routes entail the Blorb standard media format list, to some extent.
Therefore, game authors have some reason to consider sticking to those formats.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p><em>What is the Blorb Policy on Color Depth?</em></p>
<p>The idea is that each author can decide what kind of color requirements his game will have.</p>
<div class="paragraph">
<p>The alternative (which we did <em>not</em> choose) would be to mandate a fixed set of color requirements for all graphical games&#8201;&#8212;&#8201;for example, an 8-bit color display set to a color-cube set of colors.
This seems like a dumb idea.
Any fixed set of requirements is going to be impossible for some machines and standard equipment on others, and both these sets will change over time.
The requirements would quickly become obsolete.</p>
</div>
<div class="paragraph">
<p>Instead, we choose to allow any kind of art in graphical games.
If the author includes only monochrome images, the game will run anywhere.
If the author includes full-color 32-bit images, he is creating a game which wants a powerful graphics machine to display itself on.
That&#8217;s the author&#8217;s choice.
If the player&#8217;s machine only allows 8-bit color, his interpreter will have to dither or otherwise reduce the color information of the game art.
The player can accept this, buy a more powerful computer, or throw away the game.
There&#8217;s no way around that.
The problem can only be avoided by outlawing 32-bit color images, which we do not wish to do.</p>
</div>
</li>
<li>
<p><em>What&#8217;s the idea of the palette chunk?</em></p>
<p>The palette chunk itself is provided for the benefit of interpreters which can control their display palettes or color depth.
The palette declares the minimum set of colors (or direct-color depth) which the author wants you to have in order for the game to &#8220;look okay.&#8221; It may be a good idea to switch palettes in order to play a particular game; the palette chunk tells the interpreter this advice.</p>
<div class="paragraph">
<p>Now, the interpreter is not <em>required</em> to follow this advice.
This is for the player&#8217;s benefit; if the player has a monochrome machine, or just doesn&#8217;t like changing palettes, he is not denied the opportunity to play the game.
He&#8217;ll just get reduced-quality art.
That&#8217;s his choice.
As stated above, he can accept it, upgrade, or throw the game away.</p>
</div>
</li>
<li>
<p><em>What is the Blorb Policy on Pixel Size?</em></p>
<p>We make a couple of assumptions.</p>
<div class="paragraph">
<p>Assumption one: Image pixels are square.
Your images should have the correct aspect ratio when drawn with square pixels&#8201;&#8212;&#8201;that is, when the number of image-pixels-per-inch is the same vertically and horizontally.
If your art program doesn&#8217;t understand square pixels, get a real art program.
There.
That&#8217;s resolved.</p>
</div>
<div class="paragraph">
<p>(This means that if an image is 400 pixels wide and 200 pixels high, the interpreter should draw it on the screen with a physical width twice its physical height.
Anything else will look distorted.)</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>It has been noted that this does not exactly apply to Infocom&#8217;s V6 games; their art was probably designed for an era of computers that did not have exactly square pixels (IBM EGA, Apple II machines displaying on television screens, and other such barbarisms.)
However, this does not seem to have concerned them.
Infocom interpreters which are running on modern machines, with square-pixel displays, display their art with square pixels.
We will do the same.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Assumption two: It is always okay to draw images at their &#8220;actual size&#8221;&#8201;&#8212;&#8201;one image pixel per screen pixel.</p>
</div>
<div class="paragraph">
<p>Now you think I&#8217;m crazy.
It is true that many modern screens can be adjusted to different pixel sizes.
However, <em>I declare this to be an illusion.</em> If a user sets his monitor to smaller pixels, it&#8217;s because he wants a given image to be smaller.
So he can fit more of them on screen.
He also wants his text to be smaller, and his windows.
That&#8217;s the way web browsers work, that&#8217;s the way Adobe Photoshop works, and that&#8217;s damn well good enough for the Z-machine.</p>
</div>
<div class="paragraph">
<p>Perhaps in the future there will be monitors that break this rule&#8201;&#8212;&#8201;much smaller pixels, 300 or 600 pixels per inch, for example.
At that time there will be some consensus on how to display images.
(Frankly, I expect it will be &#8220;draw them at 55, 72, or 88 pixels per inch, depending on the user&#8217;s previous preference.&#8221; Or some such set of standard options.)
Z-machine interpreters can follow that plan when it emerges.</p>
</div>
<div class="paragraph">
<p>Until then, the right size for a non-scaled picture is one image pixel per screen pixel.
If an image is to be scaled by a ratio of 2.0, then the right size for it is one image pixel per two screen pixels (vertically and horizontally).
And so on.</p>
</div>
</li>
<li>
<p><em>Where do Z-pixels come into all this?</em></p>
<p>The definition of Z-pixels is entirely up to the interpreter.
This standard says nothing on the subject, and does not care.</p>
<div class="paragraph">
<p>It is true that the interpreter must tell the game what the window size and image sizes are, as measured in Z-pixels.
That&#8217;s the interpreter&#8217;s job.
The interpreter knows how big its window is, in screen pixels; it translates that into Z-pixels&#8201;&#8212;&#8201;using whatever definition it has&#8201;&#8212;&#8201;and reports it to the game.
Then, the scaling rules of this spec define what the display sizes of the images will be, as measured in screen pixels.
The interpreter translates these sizes into Z-pixels&#8201;&#8212;&#8201;using the same definition&#8201;&#8212;&#8201;and reports them to the game.
All consistent and well-defined.</p>
</div>
</li>
<li>
<p><em>What is the Blorb Policy on Interpreters that do Funky Stuff?</em></p>
<p>The interpreter is Allowed.
It&#8217;s okay to be ugly.</p>
<div class="paragraph">
<p>For example, someone may (in a fit of insanity) write a Blorb-compliant interpreter for the Apple II.
The Apple II had non-square pixels.
But (assume) it doesn&#8217;t have the processing power to scale all its images by a factor of 1.2 (or whatever) to adjust for this.
Well, it&#8217;s legal to write an interpreter that draws art at one image pixel per (non-square) screen pixel.
The art will look distorted; the user can like it or play on a different machine.</p>
</div>
<div class="paragraph">
<p>For another example, someone may want their entire game display doubled in size.
All the art twice as large (in screen pixels) as this spec says it should be.
An interpreter which has this option is legal.
It&#8217;s the moral equivalent of mounting a magnifying glass on your monitor&#8201;&#8212;&#8201;that certainly doesn&#8217;t violate any software standards.</p>
</div>
</li>
<li>
<p><em>What about playing Blorb-packaged games on original Infocom interpreters?</em></p>
<p>It&#8217;s possible.
You&#8217;ll have to unpack the PNG art and translate it into the format that Infocom used.
Since the Infocom interpreters had a hard-wired screen size, you can precompute all the scaling factors, and do any necessary scaling in the translation process. 32-bit color images will have to be color-reduced; that&#8217;s the way it goes.
But the result should be fully playable on Infocom&#8217;s interpreters.</p>
</li>
<li>
<p><em>Have you considered&#8201;&#8212;&#8201;</em></p>
<p>Yes.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Blorb 2.0.4<br>
</div>
</div>
</body>
</html>