<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.12">
<meta name="author" content="Graham Nelson">
<title>The Z-Machine Standards Document</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/* Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment @import statement to use as custom stylesheet */
/*@import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700";*/
article,aside,details,figcaption,figure,footer,header,hgroup,main,nav,section{display:block}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
abbr[title]{border-bottom:1px dotted}
b,strong{font-weight:bold}
dfn{font-style:italic}
hr{-moz-box-sizing:content-box;box-sizing:content-box;height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type="button"],input[type="reset"],input[type="submit"]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,*::before,*::after{-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;font-weight:400;font-style:normal;line-height:1;position:relative;cursor:auto;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{font-family:inherit;font-weight:400;font-size:1em;line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em;height:0}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{font-size:1em;line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0;font-size:1em}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
abbr,acronym{text-transform:uppercase;font-size:90%;color:rgba(0,0,0,.8);border-bottom:1px dotted #ddd;cursor:help}
abbr{text-transform:none}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote cite{display:block;font-size:.9375em;color:rgba(0,0,0,.6)}
blockquote cite::before{content:"\2014 \0020"}
blockquote cite a,blockquote cite a:visited{color:rgba(0,0,0,.6)}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:solid 1px #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;-webkit-border-radius:4px;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em white inset;box-shadow:0 1px 0 rgba(0,0,0,.2),0 0 0 .1em #fff inset;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin-left:auto;margin-right:auto;margin-top:0;margin-bottom:0;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:-ms-flexbox;display:-webkit-flex;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border-style:solid;border-width:1px;border-color:#e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;-webkit-border-radius:4px;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:rgba(255,255,255,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details>summary:first-of-type{cursor:pointer;display:list-item;outline:none;margin-bottom:.75em}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p{font-size:inherit}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border-style:solid;border-width:1px;border-color:#e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;-webkit-border-radius:4px;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border-style:solid;border-width:1px;border-color:#dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;-webkit-border-radius:4px;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{-webkit-border-radius:4px;border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class="highlight"],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;-webkit-border-radius:4px;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos{border-right:1px solid currentColor;opacity:.35;padding-right:.5em}
pre.pygments .lineno{border-right:1px solid currentColor;opacity:.35;display:inline-block;margin-right:.75em}
pre.pygments .lineno::before{content:"";margin-right:-.125em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all tr,table.stripes-odd tr:nth-of-type(odd),table.stripes-even tr:nth-of-type(even),table.stripes-hover tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
ol>li p,ul>li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
ul.checklist{margin-left:.625em}
ul.checklist li>p:first-child>.fa-square-o:first-child,ul.checklist li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist li>p:first-child>input[type="checkbox"]:first-child{margin-right:.25em}
ul.inline{display:-ms-flexbox;display:-webkit-box;display:flex;-ms-flex-flow:row wrap;-webkit-flex-flow:row wrap;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:solid 4px #fff;-webkit-box-shadow:0 0 0 1px #ddd;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
.gist .file-data>table{border:0;background:#fff;width:100%;margin-bottom:0}
.gist .file-data>table td.line-data{width:99%}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);-webkit-border-radius:50%;border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;-webkit-box-shadow:0 1px 4px #e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{-webkit-box-shadow:none!important;box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media print,amzn-kf8{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>The Z-Machine Standards Document</h1>
<div class="details">
<span id="author" class="author">Graham Nelson</span><br>
<span id="revnumber">version 1.1,</span>
<span id="revdate">2014-02-24</span>
<br><span id="revremark">AsciiDoc Draft v1 (2021-01-06)</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#_preface">Preface</a>
<ul class="sectlevel2">
<li><a href="#_standardisation">Standardisation</a></li>
<li><a href="#_so_what_is_standard">So what is "standard"?</a></li>
<li><a href="#_notation">Notation</a></li>
<li><a href="#_where_are_all_the_grammar_tables">Where are all the grammar tables?</a></li>
<li><a href="#_acknowledgements">Acknowledgements</a></li>
</ul>
</li>
<li><a href="#_overview_of_z_machine_architecture">Overview of Z-machine architecture</a></li>
<li><a href="#_fundamentals">Fundamentals</a>
<ul class="sectlevel1">
<li><a href="#ch.1">1. The memory map</a>
<ul class="sectlevel2">
<li><a href="#s1.1">1.1. Regions of memory</a></li>
<li><a href="#s1.2">1.2. Addresses</a></li>
<li><a href="#remarks-01">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.2">2. Numbers and arithmetic</a>
<ul class="sectlevel2">
<li><a href="#s2.1">2.1. Numbers</a></li>
<li><a href="#s2.2">2.2. Signed operations</a></li>
<li><a href="#s2.3">2.3. Arithmetic errors</a></li>
<li><a href="#s2.4">2.4. Random number generator</a></li>
<li><a href="#remarks-02">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.3">3. How text and characters are encoded</a>
<ul class="sectlevel2">
<li><a href="#s3.1">3.1. Text</a></li>
<li><a href="#s3.2">3.2. Alphabets</a></li>
<li><a href="#s3.3">3.3. Abbreviations</a></li>
<li><a href="#s3.4">3.4. ZSCII escape</a></li>
<li><a href="#s3.5">3.5. Alphabet table</a></li>
<li><a href="#s3.6">3.6. Padding and incompleteness</a></li>
<li><a href="#s3.7">3.7. Dictionary truncation</a></li>
<li><a href="#s3.8">3.8. Definition of ZSCII and Unicode</a></li>
<li><a href="#remarks-03">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.4">4. How instructions are encoded</a>
<ul class="sectlevel2">
<li><a href="#s4.1">4.1. Instructions</a></li>
<li><a href="#s4.2">4.2. Operand types</a></li>
<li><a href="#s4.3">4.3. Form and operand count</a></li>
<li><a href="#s4.4">4.4. Specifying operand types</a></li>
<li><a href="#s4.5">4.5. Operands</a></li>
<li><a href="#s4.6">4.6. Stores</a></li>
<li><a href="#s4.7">4.7. Branches</a></li>
<li><a href="#s4.8">4.8. Text opcodes</a></li>
<li><a href="#remarks-04">Remarks</a></li>
<li><a href="#_on_disassembly">On disassembly</a></li>
</ul>
</li>
<li><a href="#ch.5">5. How routines are encoded</a>
<ul class="sectlevel2">
<li><a href="#s5.1">5.1. Start position</a></li>
<li><a href="#s5.2">5.2. Header</a></li>
<li><a href="#s5.3">5.3. First instruction</a></li>
<li><a href="#s5.4">5.4. Main routine (V6)</a></li>
<li><a href="#s5.5">5.5. Initial execution point (other versions)</a></li>
<li><a href="#remarks-05">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.6">6. The game state: storage and routine calls</a>
<ul class="sectlevel2">
<li><a href="#s6.1">6.1. Saved states</a></li>
<li><a href="#s6.2">6.2. Storage of global variables</a></li>
<li><a href="#s6.3">6.3. The stack</a></li>
<li><a href="#s6.4">6.4. Routine calls</a></li>
<li><a href="#s6.5">6.5. Stack frames</a></li>
<li><a href="#s6.6">6.6. User stacks (V6)</a></li>
<li><a href="#remarks-06">Remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_inputoutput">Input/Output</a>
<ul class="sectlevel1">
<li><a href="#ch.7">7. Output streams and file handling</a>
<ul class="sectlevel2">
<li><a href="#s7.1">7.1. Output streams</a></li>
<li><a href="#s7.2">7.2. Buffering</a></li>
<li><a href="#s7.3">7.3. Selection (V1 and V2)</a></li>
<li><a href="#s7.4">7.4. Selection (later versions)</a></li>
<li><a href="#s7.5">7.5. Dealing with Unicode or invalid characters</a></li>
<li><a href="#s7.6">7.6. File handling</a></li>
<li><a href="#remarks-07">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.8">8. The screen model</a>
<ul class="sectlevel2">
<li><a href="#s8.1">8.1. Fonts</a></li>
<li><a href="#s8.2">8.2. Status line</a></li>
<li><a href="#s8.3">8.3. Text colours</a></li>
<li><a href="#s8.4">8.4. Screen dimensions</a></li>
<li><a href="#s8.5">8.5. Screen model (V1, V2)</a></li>
<li><a href="#s8.6">8.6. Screen model (V3)</a></li>
<li><a href="#s8.7">8.7. Screen model (V4, V5)</a></li>
<li><a href="#s8.8">8.8. Screen model (V6)</a></li>
<li><a href="#remarks-08">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.9">9. Sound effects</a>
<ul class="sectlevel2">
<li><a href="#s9.1">9.1. Sound effects</a></li>
<li><a href="#s9.2">9.2. Numbering of</a></li>
<li><a href="#s9.3">9.3. Volume</a></li>
<li><a href="#s9.4">9.4. Sound playing autonymously</a></li>
<li><a href="#remarks-09">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.10">10. Input streams and devices</a>
<ul class="sectlevel2">
<li><a href="#s10.1">10.1. Keyboard only in V1</a></li>
<li><a href="#s10.2">10.2. Input streams</a></li>
<li><a href="#s10.3">10.3. Mouse support</a></li>
<li><a href="#s10.4">10.4. Menu support</a></li>
<li><a href="#s10.5">10.5. Terminating characters and timed input</a></li>
<li><a href="#s10.6">10.6. Single keypresses</a></li>
<li><a href="#s10.7">10.7. Reading ZSCII from the keyboard</a></li>
<li><a href="#remarks-10">Remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_tables">Tables</a>
<ul class="sectlevel1">
<li><a href="#ch.11">11. The format of the header</a>
<ul class="sectlevel2">
<li><a href="#remarks-11">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.12">12. The object table</a>
<ul class="sectlevel2">
<li><a href="#s12.1">12.1. Storage</a></li>
<li><a href="#s12.2">12.2. Property defaults table</a></li>
<li><a href="#s12.3">12.3. Object tree</a></li>
<li><a href="#s12.4">12.4. Property tables</a></li>
<li><a href="#s12.5">12.5. Well-foundedness of the tree</a></li>
<li><a href="#remarks-12">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.13">13. The dictionary and lexical analysis</a>
<ul class="sectlevel2">
<li><a href="#s13.1">13.1. Storage</a></li>
<li><a href="#s13.2">13.2. Header</a></li>
<li><a href="#s13.3">13.3. Entries (V1 to V3)</a></li>
<li><a href="#s13.4">13.4. Entries (later versions)</a></li>
<li><a href="#s13.5">13.5. Ordering</a></li>
<li><a href="#s13.6">13.6. Lexical analysis</a></li>
<li><a href="#remarks-13">Remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_instruction_set">Instruction Set</a>
<ul class="sectlevel1">
<li><a href="#ch.14">14. Complete table of opcodes</a>
<ul class="sectlevel2">
<li><a href="#s14.1">14.1. Contents</a></li>
<li><a href="#s14.2">14.2. Out of range opcodes</a></li>
<li><a href="#reading">Reading the opcode tables</a></li>
<li><a href="#inform">Inform assembly language</a></li>
<li><a href="#remarks-14">Remarks</a></li>
</ul>
</li>
<li><a href="#ch.15">15. Dictionary of opcodes</a>
<ul class="sectlevel2">
<li><a href="#_15_1">15.1. 15.1</a></li>
<li><a href="#_15_2">15.2. 15.2</a></li>
<li><a href="#_15_3">15.3. 15.3</a></li>
<li><a href="#_add">15.4. add</a></li>
<li><a href="#_and">15.5. and</a></li>
<li><a href="#_aread">15.6. aread</a></li>
<li><a href="#_art_shift">15.7. art_shift</a></li>
<li><a href="#_buffer_mode">15.8. buffer_mode</a></li>
<li><a href="#_buffer_screen">15.9. buffer_screen</a></li>
<li><a href="#_call">15.10. call</a></li>
<li><a href="#_call_1n">15.11. call_1n</a></li>
<li><a href="#_call_1s">15.12. call_1s</a></li>
<li><a href="#_call_2n">15.13. call_2n</a></li>
<li><a href="#_call_2s">15.14. call_2s</a></li>
<li><a href="#_call_vn">15.15. call_vn</a></li>
<li><a href="#_call_vs">15.16. call_vs</a></li>
<li><a href="#_call_vn2">15.17. call_vn2</a></li>
<li><a href="#_call_vs2">15.18. call_vs2</a></li>
<li><a href="#_catch">15.19. catch</a></li>
<li><a href="#_check_arg_count">15.20. check_arg_count</a></li>
<li><a href="#_check_unicode">15.21. check_unicode</a></li>
<li><a href="#_clear_attr">15.22. clear_attr</a></li>
<li><a href="#_copy_table">15.23. copy_table</a></li>
<li><a href="#_dec">15.24. dec</a></li>
<li><a href="#_dec_chk">15.25. dec_chk</a></li>
<li><a href="#_div">15.26. div</a></li>
<li><a href="#_draw_picture">15.27. draw_picture</a></li>
<li><a href="#_encode_text">15.28. encode_text</a></li>
<li><a href="#_erase_line">15.29. erase_line</a></li>
<li><a href="#_erase_picture">15.30. erase_picture</a></li>
<li><a href="#_erase_window">15.31. erase_window</a></li>
<li><a href="#_extended">15.32. "extended"</a></li>
<li><a href="#_get_child">15.33. get_child</a></li>
<li><a href="#_get_cursor">15.34. get_cursor</a></li>
<li><a href="#_get_next_prop">15.35. get_next_prop</a></li>
<li><a href="#_get_parent">15.36. get_parent</a></li>
<li><a href="#_get_prop">15.37. get_prop</a></li>
<li><a href="#_get_prop_addr">15.38. get_prop_addr</a></li>
<li><a href="#_get_prop_len">15.39. get_prop_len</a></li>
<li><a href="#_get_sibling">15.40. get_sibling</a></li>
<li><a href="#_get_wind_prop">15.41. get_wind_prop</a></li>
<li><a href="#_inc">15.42. inc</a></li>
<li><a href="#_inc_chk">15.43. inc_chk</a></li>
<li><a href="#_input_stream">15.44. input_stream</a></li>
<li><a href="#_insert_obj">15.45. insert_obj</a></li>
<li><a href="#_je">15.46. je</a></li>
<li><a href="#_jg">15.47. jg</a></li>
<li><a href="#_jin">15.48. jin</a></li>
<li><a href="#_jl">15.49. jl</a></li>
<li><a href="#_jump">15.50. jump</a></li>
<li><a href="#_jz">15.51. jz</a></li>
<li><a href="#_load">15.52. load</a></li>
<li><a href="#_loadb">15.53. loadb</a></li>
<li><a href="#_loadw">15.54. loadw</a></li>
<li><a href="#_log_shift">15.55. log_shift</a></li>
<li><a href="#_make_menu">15.56. make_menu</a></li>
<li><a href="#_mod">15.57. mod</a></li>
<li><a href="#_mouse_window">15.58. mouse_window</a></li>
<li><a href="#_move_window">15.59. move_window</a></li>
<li><a href="#_mul">15.60. mul</a></li>
<li><a href="#_new_line">15.61. new_line</a></li>
<li><a href="#_nop">15.62. nop</a></li>
<li><a href="#_not">15.63. not</a></li>
<li><a href="#_or">15.64. or</a></li>
<li><a href="#_output_stream">15.65. output_stream</a></li>
<li><a href="#_picture_data">15.66. picture_data</a></li>
<li><a href="#_picture_table">15.67. picture_table</a></li>
<li><a href="#_piracy">15.68. piracy</a></li>
<li><a href="#_pop">15.69. pop</a></li>
<li><a href="#_pop_stack">15.70. pop_stack</a></li>
<li><a href="#_print">15.71. print</a></li>
<li><a href="#_print_addr">15.72. print_addr</a></li>
<li><a href="#_print_char">15.73. print_char</a></li>
<li><a href="#_print_form">15.74. print_form</a></li>
<li><a href="#_print_num">15.75. print_num</a></li>
<li><a href="#_print_obj">15.76. print_obj</a></li>
<li><a href="#_print_paddr">15.77. print_paddr</a></li>
<li><a href="#_print_ret">15.78. print_ret</a></li>
<li><a href="#_print_table">15.79. print_table</a></li>
<li><a href="#_print_unicode">15.80. print_unicode</a></li>
<li><a href="#_pull">15.81. pull</a></li>
<li><a href="#_push">15.82. push</a></li>
<li><a href="#_push_stack">15.83. push_stack</a></li>
<li><a href="#_put_prop">15.84. put_prop</a></li>
<li><a href="#_put_wind_prop">15.85. put_wind_prop</a></li>
<li><a href="#_quit">15.86. quit</a></li>
<li><a href="#_random">15.87. random</a></li>
<li><a href="#_read">15.88. read</a></li>
<li><a href="#_read_char">15.89. read_char</a></li>
<li><a href="#_read_mouse">15.90. read_mouse</a></li>
<li><a href="#_remove_obj">15.91. remove_obj</a></li>
<li><a href="#_restart">15.92. restart</a></li>
<li><a href="#_restore">15.93. restore</a></li>
<li><a href="#_restore_undo">15.94. restore_undo</a></li>
<li><a href="#_ret">15.95. ret</a></li>
<li><a href="#_ret_popped">15.96. ret_popped</a></li>
<li><a href="#_rfalse">15.97. rfalse</a></li>
<li><a href="#_rtrue">15.98. rtrue</a></li>
<li><a href="#_save">15.99. save</a></li>
<li><a href="#_save_undo">15.100. save_undo</a></li>
<li><a href="#_scan_table">15.101. scan_table</a></li>
<li><a href="#_scroll_window">15.102. scroll_window</a></li>
<li><a href="#_set_attr">15.103. set_attr</a></li>
<li><a href="#_set_colour">15.104. set_colour</a></li>
<li><a href="#_set_cursor">15.105. set_cursor</a></li>
<li><a href="#_set_font">15.106. set_font</a></li>
<li><a href="#_set_margins">15.107. set_margins</a></li>
<li><a href="#_set_text_style">15.108. set_text_style</a></li>
<li><a href="#_set_true_colour">15.109. set_true_colour</a></li>
<li><a href="#_set_window">15.110. set_window</a></li>
<li><a href="#_show_status">15.111. show_status</a></li>
<li><a href="#_sound_effect">15.112. sound_effect</a></li>
<li><a href="#_split_window">15.113. split_window</a></li>
<li><a href="#_sread">15.114. sread</a></li>
<li><a href="#_store">15.115. store</a></li>
<li><a href="#_storeb">15.116. storeb</a></li>
<li><a href="#_storew">15.117. storew</a></li>
<li><a href="#_sub">15.118. sub</a></li>
<li><a href="#_test">15.119. test</a></li>
<li><a href="#_test_array">15.120. "test_array"</a></li>
<li><a href="#_test_attr">15.121. test_attr</a></li>
<li><a href="#_throw">15.122. throw</a></li>
<li><a href="#_tokenise">15.123. tokenise</a></li>
<li><a href="#_verify">15.124. verify</a></li>
<li><a href="#_window_size">15.125. window_size</a></li>
<li><a href="#_window_style">15.126. window_style</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_an_unusual_font">An Unusual Font</a>
<ul class="sectlevel1">
<li><a href="#ch.16">16. Font 3 and character graphics</a>
<ul class="sectlevel2">
<li><a href="#_16_1">16.1. 16.1</a></li>
<li><a href="#remarks-16">Remarks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#_appendices">Appendices</a>
<ul class="sectlevel1">
<li><a href="#app.a">Appendix A: Error messages and debugging</a></li>
<li><a href="#app.b">Appendix B: Conventional contents of the header</a></li>
<li><a href="#app.c">Appendix C: Resources available</a>
<ul class="sectlevel2">
<li><a href="#_public_interpreters">C.1. Public Interpreters</a></li>
<li><a href="#_testing_compliance">C.2. Testing compliance</a></li>
<li><a href="#_compilers">C.3. Compilers</a></li>
<li><a href="#_utility_programs">C.4. Utility programs</a></li>
<li><a href="#_story_files">C.5. Story files</a></li>
<li><a href="#_documents">C.6. Documents</a></li>
</ul>
</li>
<li><a href="#app.d">Appendix D: A short history of the Z-machine</a></li>
<li><a href="#app.e">Appendix E: Statistics</a></li>
<li><a href="#app.f">Appendix F: Canonical Story Files</a></li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>Z-Machine Standards Document version 1.1</p>
</div>
<div class="paragraph">
<p>Written by Graham Nelson.</p>
</div>
<div class="paragraph">
<p>1993-2018 by the <a href="https://iftechfoundation.org" title="Visit the Interactive Fiction Technology Foundation website" target="_blank" rel="noopener">Interactive Fiction Technology Foundation</a>.
This specification is licensed under a <a href="https://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener">Creative Commons Attribution-ShareAlike 4.0 International License</a>.</p>
</div>
<div class="exampleblock">
<div class="content">
<div class="paragraph">
<p>Ported to AsciiDoc by Tristano Ajmone.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>This AsciiDoc version of the
<a href="https://inform-fiction.org/zmachine/standards/z1point1/index.html" title="View original upstream document" target="_blank" rel="noopener">Z-Machine Standards Document</a>
is still a WIP draft!</p>
</div>
<div class="paragraph">
<p>Draft version 1, updated on 2021-01-06.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<hr>
</div>
</div>
<div class="sect1">
<h2 id="_preface"><a class="anchor" href="#_preface"></a>Preface</h2>
<div class="sectionbody">
<hr>
<div class="paragraph">
<p>The Z-machine was created on a coffee table in Pittsburgh in 1979. It is an imaginary computer whose programs are adventure games, and is well-adapted to its task, implementing complex games remarkably compactly. They were still perhaps 100K long, too large for the memory of the home computers of their day, and the Z-machine seems to have made the first usage of virtual memory on a microcomputer. Further ahead of its time was the ability to efficiently save and restore the entire execution state.</p>
</div>
<div class="paragraph">
<p>The design&#8217;s cardinal principle is that any game is 100% portable to different computers: that is, any legal program exactly determines its behaviour. This portability is largely made possible by a willingness to constrain maximum as well as minimum levels of performance (for instance, dynamic memory allocation is impossible).</p>
</div>
<div class="paragraph">
<p>Infocom&#8217;s catalogue continues to be sold and to be played under interpreter programs, either original Infocom ones or more recent and generally better freeware ones. About <a href="#app.f">130 story files</a> compiled by Infocom&#8217;s compiler <strong>Zilch</strong> survive and since 1993 very many more story files have been created with the Inform design system.</p>
</div>
<div class="paragraph">
<p>Eight Versions of the Z-machine exist, and the first byte of any "story file" (that is: any Z-machine program) gives the Version number it must be interpreted under.</p>
</div>
<hr>
<div class="sect2">
<h3 id="_standardisation"><a class="anchor" href="#_standardisation"></a>Standardisation</h3>
<div class="paragraph">
<p>The majority of opcode names used in this document were agreed between 1994 and 1995 as a standard set by Mark Howell, author of the disassembler <strong>Txd</strong> (part of the <strong>Ztools</strong> suite of utility programs), and Graham Nelson, author of the assembly level of Inform. They do not correspond to Infocom&#8217;s opcode names.</p>
</div>
<div class="paragraph">
<p>The first vesion of this Standard was drawn up in November 1995, drawing on a rougher description written in 1993 and, before that, sketches of table formats by Mike Threepoint and others. It formalised what different interpreter writers regard as the Z-machine, guaranteeing a reliable and well-featured platform for writers of new games. The initial 0.2 Standard was followed by the 1.0 Standard, which contained mostly corrections and clarifications, but also added some new features.</p>
</div>
<div class="paragraph">
<p>This third version of the Standard was initially put together by Kevin Bracey and Jason C. Penney and proposed on the Z-Machine Mailing List in December 2001. After much discussion, and nine drafts, the final list of changes to the Standard was uploaded to the if-archive in May 2006. This 2014 document adds no new material to that final draft, and is merely a merging of those changes to the main Standard.</p>
</div>
<div class="paragraph">
<p>The main additions in the 1.1 Standard are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Better colour support, giving games access to 32,768 colours as opposed to the previous 11. Version 6 games may also make use of the new 'transparent' background colour.</p>
</li>
<li>
<p>Version 6 games may now hint to the interpreter that it is safe to make changes to the display in a backing store and flush them to the screen later, rather than making changes directly to the screen. In a program carrying out a complex layered graphical composition, this may speed up the process.</p>
</li>
<li>
<p>The <strong>save</strong> and <strong>restore</strong> opcodes have a new optional operand that allow the game to control whether the interpreter prompts for a filename or executes the intructions silently.</p>
</li>
<li>
<p>The optional operand removed from <strong>set_font</strong> in the previous Standard has been reinstated.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are three companion documents are attached to this Standard.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Quetzal</strong> by Martin Frost, defines a standard format for saved-game files, the purpose of which is to allow a player to save a game using one interpreter, and then restore and continure playing on a new interpreter, or even an entirely new machine.</p>
</li>
<li>
<p><strong>Blorb</strong> by Andrew Plotkin is a standard for a "resources" file to accompany or encapsulate a Z-machine game, neatly packaging up sound and graphics in modern formats.</p>
</li>
<li>
<p><strong>The Treaty of Babel</strong> is a standard for bibliographic information for interactive fiction games. The aim is to provide a unified way to identify and describe story files of many different internal formats. The Treaty is not "owned" by any individual, but by a committee of representatives from each of the pieces of software which have signed up.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Standard interpreters are not <em>required</em> to support these standards, since they do not affect Z-Machine behaviour, but interpreter-writers are strongly encouraged to consider it.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_so_what_is_standard"><a class="anchor" href="#_so_what_is_standard"></a>So what is "standard"?</h3>
<div class="paragraph">
<p>To call itself "Standard", an interpreter should (as far as anyone knows) obey this document exactly for every Version of the Z-machine it claims to interpret. Interpreters need not provide optional features suggested in the "remarks" sections, and need not make their source code public. Each edition of this document has a Revision number, somewhat like the JFIF identification number used by the JPEG standard. A standard interpreter should communicate its revision number in three ways:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>To someone downloading it from the Internet: by including it in its filename.</p>
</li>
<li>
<p>To the player: for instance by means of an "information" option on a menu, or in an initialisation sequence.</p>
</li>
<li>
<p>To the game: by writing it into bytes in the header which were always left zero before this standard was devised (see <strong>S</strong>11). A game compiled with Inform library 5/12 or later prints the revision number in its banner (if this isn&#8217;t 0.0).</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Few arbitrary choices have been made in writing this document. Where Infocom&#8217;s own shipped interpreters disagree, or contain manifest bugs, it has usually been possible to decide which was "correct". Elsewhere, minimum levels of performance have been invented where necessary. (For example, a minimum call-stack size is needed for programmers to be sure of what level of recursion is safe.)</p>
</div>
<div class="paragraph">
<p>Those paragraphs which genuinely extend the Infocom format are marked <strong>*</strong>*<strong class="n.m">, where *n</strong> and <strong>m</strong> are the major and minor version numbers for the Standard in which the feature was added. In any event, Infocom&#8217;s original shipped interpreters do not conform to this standard document, because of bugs or because of slight variations between the Inform output format and Infocom&#8217;s.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_notation"><a class="anchor" href="#_notation"></a>Notation</h3>
<div class="paragraph">
<p>Hexadecimal numbers are written with an initial dollar, as in <strong>$ff</strong>, while binary numbers are written with a double-dollar as in <strong>$$11011</strong>, according to Inform conventions. The bits in a byte are numbered 0 to 7, 0 being the least significant and the top bit, 7, the most.</p>
</div>
<div class="paragraph">
<p>Story files are mechanically best identified by their release number and serial code, which are written into the header information at the bottom of Z-machine memory. The release number can be anything between 0 and 65535 but is usually between 1 and 100. The serial code can consist of any six textual characters but is usually the date of compilation, arranged <strong>YYMMDD</strong>: thus 970619 refers to June 19th, 1997.</p>
</div>
<div class="paragraph">
<p>Paul David Doherty, in his extensive investigations into Infocom&#8217;s released games, introduced the notation</p>
</div>
<div class="paragraph">
<p><strong>Release number.Serial code</strong></p>
</div>
<div class="paragraph">
<p>to identify particular story files: for example the first production copy of 'Enchanter' is 10.830810. This notation is used throughout the Standard when individual Infocom files need to be referred to.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_where_are_all_the_grammar_tables"><a class="anchor" href="#_where_are_all_the_grammar_tables"></a>Where are all the grammar tables?</h3>
<div class="paragraph">
<p>The Z-machine has some lexical acuity but it doesn&#8217;t contain a full parser: it&#8217;s like a computer without an operating system. A game program has to contain its own parser and the tables this uses are not part of the formal Z-machine specification. (Many Infocom games have similar parsing table formats simply because, until Version 6, they used an evolving version of the 'Zork I' parser. A quite different parser was used in Version 6.) Inform&#8217;s parsing table formats are documented in the <em>Inform Technical Manual</em>. For the usual format of Infocom&#8217;s parsing tables, see the <strong>Ztools</strong> utility <strong>Infodump</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_acknowledgements"><a class="anchor" href="#_acknowledgements"></a>Acknowledgements</h3>
<div class="quoteblock">
<blockquote>
There is an obvious resemblance between an unreadable script and a secret code; similar methods can be employed to break both.
But the differences must not be overlooked.
The code is deliberately designed to baffle the investigator; the script is only puzzling by accident.
</blockquote>
<div class="attribution">
&#8212; John Chadwick<br>
<cite>The Decipherment of Linear B</cite>
</div>
</div>
<div class="paragraph">
<p>The Z-machine was originally devised by Joel Berez and Marc Blank in 1979. Marc Blank made most of the Version 4 extensions, and Version 5 was created by Dave Lebling (with contributions from others including Brian Moriarty, Duncan Blanchard and Linde Dynneson). Version 6 was largely the work of Tim Anderson and Dave Lebling.</p>
</div>
<div class="paragraph">
<p>In the reverse direction, decipherment is mostly due to the InfoTaskForce (David Beazley, George Janczuk, Peter Lisle, Russell Hoare and Chris Tham), Matthias Pfaller, Mike Threepoint, Mark Howell, Paul David Doherty and Stefan Jokisch. Only a few of the pieces in the jigsaw were placed by myself.</p>
</div>
<div class="paragraph">
<p>I gratefully acknowledge the help of Paul David Doherty and Mark Howell, who each read drafts of this paper and sent back detailed corrections; also, of Stefan Jokisch and Marnix Klooster who have put a great deal of work into the fine detail of the specification; and of all those who commented on the circulated draft. Mistakes and misunderstandings remain my own.</p>
</div>
<div class="paragraph">
<p><em>Graham Nelson</em></p>
</div>
<div class="paragraph">
<p><em>15 November 1995</em></p>
</div>
<div class="paragraph">
<p>Kevin Bracey and Stefan Jokisch discovered most of the mistakes in Standard 0.2, in developing the first Version 6 interpreters of the modern age: <strong>Zip2000</strong> and <strong>Frotz</strong>. Matthew Russotto and Mark Knibbs supplied helpful information about Infocom&#8217;s own Version 6 interpreters. Stefan also kindly read and commented on numerous drafts of the present revision. Finally, discussion about this document was greatly assisted by the Z-Machine Mailing List, organised by Marnix Klooster.</p>
</div>
<div class="paragraph">
<p><em>Graham Nelson</em></p>
</div>
<div class="paragraph">
<p><em>22 June 1997</em></p>
</div>
<div class="paragraph">
<p>The majority of the clarifications and updates in this latest revision are the work of Kevin Bracey and Jason C. Penney. Thanks go also to the members of the (now defunct) Z-Machine Mailing List, and those of the intfiction.org forum, especially Dannii Willis, for bringing to light issues with my initial revision. Special thanks to Andrew Plotkin for his notes, advice and general help while working on this revised document.</p>
</div>
<div class="paragraph">
<p><em>David Fillmore</em></p>
</div>
<div class="paragraph">
<p><em>21 February 2014</em></p>
</div>
<div class="paragraph">
<p>The Z-Machine Standard Version 1.1 was the work of Kevin Bracey &amp; Jason C. Penney. The initial document went through several drafts before arriving at the finished document, thanks to the comments and advice of the members of the Z-Machine Mailing List.</p>
</div>
<div class="paragraph">
<p><em>David Fillmore</em></p>
</div>
<div class="paragraph">
<p><em>24 February 2014</em></p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_overview_of_z_machine_architecture"><a class="anchor" href="#_overview_of_z_machine_architecture"></a>Overview of Z-machine architecture</h2>
<div class="sectionbody">
<div class="paragraph">
<p><span class="image"><img src="data:image/gif;base64,R0lGODdhJgK7AecAAAAAABERESIiIjMzM0QAAFUREWYiInczMwAARBERVSIiZjMzd0QARFURVWYiZnczd4gAAJkREaoiIrszM8wAAN0REe4iIv8zM4gARJkRVaoiZrszd8wARN0RVe4iZv8zdwBEABFVESJmIjN3M0REAFVVEWZmInd3MwBERBFVVSJmZjN3d0RERFVVVWZmZnd3d4hEAJlVEapmIrt3M8xEAN1VEe5mIv93M4hERJlVVapmZrt3d8xERN1VVe5mZv93dwCIABGZESKqIjO7M0SIAFWZEWaqIne7MwCIRBGZVSKqZjO7d0SIRFWZVWaqZne7d4iIAJmZEaqqIru7M8yIAN2ZEe6qIv+7M4iIRJmZVaqqZru7d8yIRN2ZVe6qZv+7dwDMABHdESLuIjP/M0TMAFXdEWbuInf/MwDMRBHdVSLuZjP/d0TMRFXdVWbuZnf/d4jMAJndEaruIrv/M8zMAN3dEe7uIv//M4jMRJndVaruZrv/d8zMRN3dVe7uZv//dwAAiBERmSIiqjMzu0QAiFURmWYiqnczuwAAzBER3SIi7jMz/0QAzFUR3WYi7ncz/4gAiJkRmaoiqrszu8wAiN0Rme4iqv8zu4gAzJkR3aoi7rsz/8wAzN0R3e4i7v8z/wBEiBFVmSJmqjN3u0REiFVVmWZmqnd3uwBEzBFV3SJm7jN3/0REzFVV3WZm7nd3/4hEiJlVmapmqrt3u8xEiN1Vme5mqv93u4hEzJlV3apm7rt3/8xEzN1V3e5m7v93/wCIiBGZmSKqqjO7u0SIiFWZmWaqqne7uwCIzBGZ3SKq7jO7/0SIzFWZ3Waq7ne7/4iIiJmZmaqqqru7u8yIiN2Zme6qqv+7u4iIzJmZ3aqq7ru7/8yIzN2Z3e6q7v+7/wDMiBHdmSLuqjP/u0TMiFXdmWbuqnf/uwDMzBHd3SLu7jP//0TMzFXd3Wbu7nf//4jMiJndmaruqrv/u8zMiN3dme7uqv//u4jMzJnd3aru7rv//8zMzN3d3e7u7v///ywAAAAAJgK7AQAI/gD/CRxIsKDBgwgTKlzIsKHDhxAjSpxIsaLFixgzatzIsaPHjyBDihxJsqTJkyhTqlzJsqXLlzBjypxJs6bNmzhz6tzJs6fPn0CDCh1KtKjRo0iTKl3KtKnTp1CjSp1KtarVq1izat3KtavXr2DDih1LtqzZs2jTql3Ltq3bt3DjyvUZoK7du3jz6t3Lt6/fv4ADCx5MeG+/uYgNFl7MuLFjxh8BSJ5MubLly5gza97MubPnz6BDZ05MWqDo06hTq0YdGcCo17Bjy55Nu7bt27hz697Nu7fv2JNLk15NvLhx1a2fKV/OvLnz59CjS59Ovbr169izMw8uHLHkevXo/oEXH368+fLoyas/vz49+/fu47efD5++fPiSk2vfz7+///8ARsddd3JJds899hyYIIIKNsjggwtG6KCEEE5oYYUYUqjhhRtmeGF+HkkW4IgklmiifwMSCJeBHrbY4YscxuiijDDOaCOIHYl44o489nhiiiq6JZk9RBZp5JFIJqnkkkw26eSTUDaJI0c6+mjllVhWB2SQbLFY45c0hmkjmGOK2eGUG1WZ5ZpsYrkll2p5aeacZdZJ5p10LoimRmq26eefJL4JJ1pDRmnooYgmqiiTe2bUJ6CQRpqdoIOaJaedeWaK6aZ4PtgoRo9KKuqoz1FaKVmXdqqqpqtyKuan/heFSuqso5p6qliFLqrrrrzyCqtFstIqLKC23gpWqqwm6+qyreoJgH7DRhtpscZ6hSyzyjabLZ2/VhSstOBaSW21XOXa67nopptktxR9G+67P7JLbrkAbIvtvdpuKq9E7sLrb4DjzpvVtfkWbK/BGO4bUb//NsxfwAJfZe6iAwjwAroVS6OuugpDxLDDIF8HccRVETynZC3ge49k0KjssrPQhixzfyOTPJXJZaJcYTQunDBNhPz0/AKD07xwAjT8rAxAywg3fWDHD30889TO1WxzVBMrivKR00hWVwtETiMAAAEAEA2RZZctQNdLb5wu1A5JTfXcz1h99VM4g6lz/oQCCBCNNCz3M/bfLghgTz8BQNPPAAC0wPLLBz/9bIgA0G05dXbf3VTeYe59IOAa38P4AIDXe/jZ97jQQgtlO7405C7D3ZDcl8ucueZLZZ3o1kVCA8DP9rAAgAC+A1BkPfZ0HQALY7sOjdvoys4Q7bWDfDvuSXE+o2Qs1DMN8l27wI/gAIgvWT/Jt9CPCwEkzbjzsCMs/ULUV9/w9Smtrv/+/Pfv//8ADKAAB0jAAupPKNqDkdcGwMCLuQAALBDe2lIHwRZYzB6+Y4Hr4Oe02E0uR5WznwjrNj+VlO04KEyhagIQFN0hqmJ969vF7DGAurgAePWIRl0Mh7YAEE8A/i3IGPTOVcKE1G+E78LfSSZjwCY68YlQhGIRVZJATfWjHxW6YoO0GL/IeeqDVAohEmunRJOU0SlTTEkVu8jGDsKMcmOs3hlJMkempBElLhyiHveIpDsW5IhxjFYdRTJIpfjRjPVqI4eigTwLRQMa9YBQP7QwDS+26pADAWQghVVIkHQSKZikYyLdKCN+tM1CjwPa6xR5IzCmSYybpNonKefKsYRyJHk0FHiOd7xdEgl59qhHP14AvGD6kmXgAWbXnvdLXzYTmHu8pSZjSapZgrCWuMKmTta4oQGk7B71GEA/6PHAAAyASIuDxgtcsLjQFQ4AA3ge98rGAvQtE5wv/qghC6KBIHqMLXGk/GLMqGm7W3rSoKDUZk64icrf3cN3i1saNC6oPAAQs239gOdELToZFwjvefdkHBDrco9pLE+dZrOkg6QJS4KGzJphVOhXEHrQXgmvBWIDQD9awAJ6SAOIyRvez5Z5OBZIw5+N414wmccPokomGkXTaTQaNw16tOBsemSpS6cG01fK1FpftQlDKwS4ADjunNBgQV0aF9SWlbRtwSMbylLpu2nc02t24Qc/XFc+eqhUoHDcakHDOpOuDoWmrdlWRMv2SMlsYQsabOuBiOo7aEA2qY1D0AsC0I+7BuCoW5DGPa6oBWg8sJ5sZKkzVsva1rr2tbCN/q1sZ0vb2tr2trjNrW5ba1hHIbYovwXhuYoXAHu4rh7QMGtbw9Y2x32vdZOZBuBcsFzJvEAaarXHZqNBD3rAM5qE5ZcKx0ve8po3vDHpbQvRK5OxUogfYxtaTuE5ABbYw5RuxW9QJcM44Q1vMvy47+s2SraUTYOvpPvrG6953gY7+MGd+Yl6gRLcMB6MHoz8HDQoWY8tHI6SCmJkgqCxYeRu4ZHTIDE/P1zJe0hDCzDGIpFKC8mALjiMu82xjnfM4x77eLYTBlaFEcje9BqPj0hOspG0KtiXDhlUT6ZwkWHiXgVb2YMDbbK/guytKEt4yi+pMittrCwma/l+Xu4y/phLtuaW5FLJcI5emxUyzTO3KUXSoIk08pzJNPcETXxe6CivTOYxr3TORmypncM1IMfRBGV9RjTWwOhomrTgj4M2tKYDauZFJxFEGZV0TA/zDy7/eXKI87MROdvnOLt6iJ32NLiCUzpRexUAeTY1T0BEmZoMSMyFDramYi1rQc5V1wepDF8J9Sy+2tqrly51poW96b8Su9icvMwVt83tbnv72+AON7hHcxavVUbc6E63ur9NGc6++dXwRtS1sT0rCKuQ2fY+DqH3XW2lZZne9c73cfAtcOLwm9rUnjfARVVw4xC84amJt8R7pfCFTwviq3k4xkVz8I6zsuIWJ9Zl/vZM8pKb/OQoT7nKU05uS4185TCPucxPXpnSeRzhVwZ5dpxhV2csZ7XSATp1hP4fojvH6MrxuaQmc0JVJ7vdyN6mTpv+bD557TDvnrjWl6Rz6zjjBZNhATS0wY+yRafsinYO2gG0dugwljllj8bS87PswjJR2lW34+R6/WgcAfvmgE9Y3k2Tdu3g430kRhnborP46TTeP+tzgYCWxpxlzn1ypes7rgk/eENiPuoGkUyg/95vnAv+39oRXgCWo8MAPN4FFYuGz9kG+7UpJxrMw+kzHn/7FyxndbcXgDefsde/qQ/4ymHeAKahHMnUXvKWf4Y0LHjDpEdD+C3o0YDK/tZ3FnKe2QNJdU1Y3eqtm99QXcec2ZbTWbvqyHfCh+fuFzg2aeSjwIzlvfQBwI9nTFUA+eA4PBUAUPVfriciAWhWwiN3k1ExuGZ592dOQvUM/aVW0sAjKRJtMrE6BAF6OIEmGviB0xZ4ppcv6TcdksF8z4AN+rN4+bA82OAM1sU2p5ANxwBP7ZQP76N/9yd5jKM4DJQP/OBNygMNp7B4OWhK2ScZAmCDwmd5gIM0DzQAU8V/2vAC0ICBTrcwWyho60WCYHgvJygdKagcyZWCIjJVKihBj5eCFjQ2VPUow2NKAtB/0ycArdM1vjd/IfRTeNg4JLSHYGd5juNDJ5RT/jukdPHSeQfFiAm1XucXiU8yhtHROssBX7+ThriWfPDUhmYDQSuwg48SX5RXhStgCkRIeXzof6BoCoDofMoxiJT3QC9gCqZAYkKYVjXUAvmwIx4YN10ogl9YemFogp1XZ88AdgBwDPmgg2hYOWXHAtrwghbFNtigD9pQQe3zDM2jf89QTgCgDc9QiCsIRNG3eI7Tf9jwimSDjQLAApY3VdGQD8TQAi8QDauTD9lgQb24iF/miEcRjB7TOFFUkAZ5kAjJP5QYHexzF4zTeL6zVizQVHjlQ9MwVXYRh4pmUoDIimSDhziliouHkT7EjmRTNu6XhSSkNnv2T2Ojkv7o/hO/KFYA2RqPcZM4mZOFsZDRgQ+rkwLTSAr5QAoqsByksDqnoA/PMJQqYAqrI47j2AIqgA0qQAxM+RymoAL4sBynIJXHgA1WSQrHoBxX+QxdqQLHUJX6QJTGsDqksJRiqRynoAItsAL9qA31KJXaJ5Czw5e+VpOUU4yCqS/HWHj80YzTgZjOoZhL2Y/74ZjUAZnMwZiLuZiSaSIzOT1+2XfDWIKDeUmFGXLZBpheBX5SJomoyXWhKZoBR5pW55pE1pmfOZstwpOsqYWwCWW5KWWySYy+CZqod5t+kpn0s5l2B4mpmZxLtprCeXn/aJpfRpueSZjB2ZxrQpx0Zpzt/rWbUCad3nl6gWWdkIKdicadMmmeQqac6mkPtimeI0KeCAGfVIaeXfad00km7emeACKfoaedRtab92mfH8Kc+nln/vl0UzaEMQREgZY79NkuR7aeqclSv1GhFnqhGJqhGnob/IlpU8Y2DMQ4ZrM5DzoRpBeg/cZSG7eiLAoazxkRbLNtY0OF0cAP0JBn/iANL/AC/EAQOspOAtEPPCMN/jAQQXOPRmpa0VCkAuEP6/QCTVqj/dCg4gWgAvqbh2aTOrmlXNqlXuoXHdqBcMM2AyFB3NM4/wCHBSYQbFMX0fAPaQNBPco6a9WjcLpWdfgPiIimXaNWIVilpymhE0qg/gV6nQfanx8qenvmfJMBDdPgD8MjDcXzD/7QN9LQNWtTPtMgPPskGePjAtDwD1PFo+wDDZX6gJXFNvAoZFaKpa5aI/lZqA9zqB4qEWxDGfXkfAIBOgLBODm6ef+wZ6cVRM+oQeqjp8OjQYqTeaaxfOXDpF3Wqig6rTISq7KqHWEaabbKMtFQo0XKMgJRVwIhPP0grpTqD45jrBw4fWsFpf9gQWmDhX6XqaEaKyUqXr2STPoqqLtirdeKHdn6fTC6J+CKrC7gD+TzD6Z0sP/gTcn1qCl2qSTmD/zAPP6QYv7gD2woGRmbUTe0NFAmrWYSapXBT69qbYT6rz4SsHi3/q21VLDSxgIiJRDDalGQ+o5lAw1V2AKF4wKiCk8WVD7/cFoyuzbLFLJSti0u4FEoc0NXaozVqbIlwrI1o6AGkTEDEQ01FADi06R4+Fk0i4erGqx0KgBMWrZLSqmt1z4KKwBUaqL3yoXoojxGYkEDEGDG1QJ3qLPM8zM71a0CID5FUnsitlN6ywIXg3tEaLjY9QL2WCQtgLe64q9Sq35xC4w1Ca0EkbEFoblN6rmUahCcC0IiayeYqiCsw0ATtEALVBeO6jVjIwAIAn+js19kozpko1aZ6DUP5FBThT5llrKVG5Ondrk0Wbp3croutjQUKU7cUw8PxF2+E5ICsAXT/sA4/RCN0lAPM8gyWxBOpDOEu2tZ9VA2N8Q4Yii8wzu1tCqmxvuXyNkrmEokhdg3nsoyGKRTQRWSMwR2/KCGRLKxEXqHh5grD2Qxw0Nx6ru+79m+2lpu79uXB6O8tEhiJBZqLQNR+xs+B+K/UxU6wuOspqM0YveQBpIgIJpSUBueDEy8u+bAKwHDfTbBw3Mg8thU9qg0Gay/XROSn3W99RKN04B2FzXCZMMPP7W7D+JfxpO+UdvCNCPDLKtGEayZc5vA9HuSa8OebaPBPdymakMkJCmnbFMksIuS5lI6YKPATwzF+0G1MkzFyGsm/HACQ8MgJ7A6AZY6PlNSJ4A+/nVcgDvKs5WUIKpzVVgUNCfAIPiIU9JwAor8IIszQU7Mwm7cwFVcntB5np95T5AzpQBlL5R7ycsBx5n8n4G6dUS1MTXEf3LWxqQsMlIcx3h0yon2mXXcYk5jNEwjygscy9g6y7YcZsP8dE/7naMcy6a8yf9AaoLGr6iZzKS8zBDsoxFMpSd6zFhmycAcxcXsvtDpOr4Wgtl8sh/3y90sy9/8wC4nEE33l94nbdAsidJ8ydTczrUWwZPBZ+VMrecMy+lMhsLMbM6mz3fXz9q8wiAU0P9xz2WBGV/aGJVxQvVR0fdx0faR0Rat0Ri90R7NvejM0Cg40BDcoiZ90uQF/tAiXTUk7XIo/dIwnXHcvNLW4dCoEtOcsW46vdM83dM+zdP17MY2bUuXkZBGvTrKRsvHOdM0bbkv6nL5bNCiJ23eEdJNzdLrLLDtTLJSTWpKvZ0qTSKxYZ1DnU0CUXd2p4FfjcoLzSYpkAKU8dbCWdZhgSPMWlgNutbzGdb+4QxURxmKGHJ0fSxghDg14cyEV9V87c2YMQqsOdgzldV9pthMfSJwvRkpIJqQDVbrRdltbSV/nRnYsVrTENiB/XN0s9ldQct6TcyLHcydcR0voKa8SHzrB3cEeB35cArY0By7bQrj2dIPLdmJPRdBjdWcYR34wD2zbVHzB5PKsT4q/lgdgpN9zEE+wS3ZU1zLnW3cVr2fnmEdFph0jnOp5dOzzLdTKniH1bd7hWNU31hg/accvRu5xScNkvdTAyB5ysHe040iwn3T3V0g393Q4U0dpiR3y6EPGlmSlQOBZCNSKcZfZaMP5SSNy9G70oipS3NWD7mUET6BBq7drU1IxE3V3v3ak3Lg06GGzSFUw3MKxzA2+gCFzDuF9OQMU5UPiMMCkJlqvViEpdNUsKcPURg08jfiTz3cAx4Xx90cMhjb1PHBLw6Pzp2Mv0OIH0l1Kuhz1d0c2D1/vuc6fVM2e7Xldaba9NLkK1Lg/3HZmpHZkfmOULl/r8vf/mt5tGiL/om3ifnQDDwORGA+Nsqh55Jhi7do4RbF59A9qyR+4kt04iXuZm7+H6OgGY5tHRlkDPiwAj40fwGADdowNvkQj2ZDj/ZIT/qgQ4Fu3exH6M/tkfmAl74nj6i+hwD+6Mz8wp4dRmyyVhN92tRxQofIh3ga6ysZqZslV6v3DJw635w4kdFXiGVzgcnutuCt69XMmyle2T3y1pIh19qBlykglb29lCpgDE5JCuIYfXNZl/2YllIJldpQl0q5HNqgAiugD/mAllzZAimwAlxJl3YJMAFO1Gz+Fk8+0gBymWTJeqr48L498djh8A7v6Esu4NxO4Cpu4FfCkdbOVQdv1hvv/uSVHiiGSSJD+ZZzo+ZbwdqQDtbevrIpD3AurxUw3+uvJHLiefMDI+kxz9a+/ifISE0+jxU53+2fbaA9P/J1DfQ6b3U8T9ZOT9gJLyQn38BNr+3tXPJt3vEAvvUZj/Ber/BZb/Bif55BL0pX3xYLL9BpX7y7vhOTzhJvP3lx/8Jrj0tQr/RDP5w1T29HLzF9z/Ezv5d5T/d13xpt3yVnD96JL3V7b+KNvxZ3Dx1FH0uDbxVJb/hLzyaZzxyvIUKbfxQkV5yVHyeP3x/gDgDiHiCt/9ZyDvuy//qG+uhHnfu63z9MFECdb/Jgnx3A3m7CLvyhDQDFP9p+bRlIJy4y/pxqOL2i8XyeUe9ba3LpmZHp+4H9jZ3r3Z8l201AlrH75C9AvR9Asen3O48lcJ4Zs7/icc7YmHH7TVHQk9+yJFr9UIYlUZ7c2nH8AAFA4MBnBQ0eRHjQWYCBDR06SxhR4kSJA/9dxJhR40aOHT1+BOmxH0OHAAL0C5lS5UqWFlm+hBmTo0CZNW3exLmRZk6NAin+BHqw5FCfQQ+OIlrSKMKkSpc+TeiS51SZTQFIo5o1pFStXVXu9BpW7EqwVItCRWu1YVq1Z5+2dYv2bdmxY1uorRuWa968dPn+Fes3Z1y5QeGaDJBY8WLGiQ83htz4cGG2AACHJWk1wOWpezl3/hX8WbTN0DcJU6Z4WPVq1qpRz7U8emoL2rQd1qYtm3Rp3bt7/47Ju+bp1xEPj0KeXPly5XCZP2c+ubhh4cBfOrS+O3Z2nNW5W/cOk/h0hXDlmkebuWkA8kA9fxffEH787fOD17cPP/x1AO1/plArBbkAtErAAdXy76f38ksJOwYb3O9BjCKU8C8Kv+ovwYmQSmoUyjhMCjUENazowgcdrNCjBVOcCT8WdTNxqwxJjEi9hiBCzbGSAsCxMB137JFGoWLMD8UXeyLSviSPNMvFwWYUEqEUCARgSgOLo9JK8qgc6Mooh3SSyYyMFPOfFctcsszuwjQNyi+PQk5DDuVc/u7NqNL8jkwxz9yTTTX78nM4N+38cjxCSeSTST2Z7KfRP1t8VDQ8dRr0UBoNtdS/RI9cNFJPJ/W0pUCrqjTTBDE1dbpNX+w01D9BdRVC0EpNlTxUaxURVuBajbXPXvnS9aJbcT2PVmJfW5VFXn9ldVRm15z1WA2HlRa2Xpd9tsJgsx3T2fiq1dRYcCu7Vj5u1dz2XDO95W9cW8V1d6lkU8RWXSXZtZcsfPWNtzhq+51oXm3NzbfZgpuMFmDK/lX4zn0lrPfg7NI9d1uGGzboYowLEhhigtWUJuRyJebJYng3vhNlcmONmMGOT3yYZEi10hjjmm2meLSWi8xZ0phl/kYyYZWNurnhl13+GM2eP1uaWZOHlvdkqDlu+rKd7/2ZZ6DbFHrq1KSe+miexZ64asDMZjnrj4oGmO220QY26T7Vng/uUJ/2WsEq89abbv3kVtTuugSPFG++FVoos8SCPJxqv/MEnFPCA3ucZMMbf6YpDzF3vFyywZtcr8olvrzxAjnPPHSvrq5b9Vm39o1msBVeaETMP/8b99905851X2XnHL3bfc+K9dxHhp3UrvmGy0vmiW+Sdxih7wwA3K7HPnvtt+e+e++/Bz9820bvFnNnpDOd+pIjb5b8XVuDP37554drea+5tCp49Z+UXrb+gRNfAAU4QAIWcHv28xr6/g73v92xT1n7S96v3HYsuDAubwzsjfG+0yiURNCDouMc/oiCOgxOr4QfROGnZqcwEIVIf+5r4AlTOEOloe4ZNmoIj0gIwTbJkIY/fKANnyHCvdnQh0xzIBCVWLEVYiw5AEiOEFMHwwwmcYlXlGATUWbBHVLRhDzEYhiBJ0UyMgWMgjqiGNXoPy2WUWVptJoV1zhHybnRjnA8mxzpuEeP2dGNeLSQHhkUMqzwUYwT9KO7ABm3Ra7ujIbsXRsTqbBGDk6QY4NkGBE5yWpVciwajKQXM5k2TgrRk5Q7ZfRG6Q9/KHGTpSRWKh0py/WJ0l7+GEBiBACNVvqjgyrhxwAK/plFWHbRc4/EkC3V5QIAsKAFDBlAPwaAr2kAABrPemUxU0VL2XFzTcrklj8C8IJWQkMg0ThnK/nxAhdEo5UX8Qc7X/CPal7zH9GQxjtVqM3hgZMzoCybP5/FD+vxg5XTCKZABMCPfzCEIQKYBj0FYBIARKOe/oBGAIa5T34uEJn0+aiMBPqsFyiUBS6YxkgA0MqR8HKaLfDHRKUxDRdAFAAuuEtESdnR5400kN7sYSahgVOBnGSiGMHpM60njZ34Y6YU9WkgedrTY0Z1lobkB0P/4Y9pTLQfR6WnSVgw0RaYcztcbcgv7ybJqeIKqNV7KxoNyUx3/iOhX42NCwLA/tCXEnSl9GxBNdsZAJjutK1Qiyv/QgqSxLKIHwIIgDMnKoB/TJOc5nSmQFrwD2ZK9gX1/Ic57bnWw4ZtsfpqLH0gGVNduoChXWVBP8QZgF0KYLP+iIYu7SrMiwiABVrlaGnfeNpkErcjqX0RKz2i3I0wl4nCHRpy0WjcFll1lHWELsqkS6rtqoSD111iNrOLKOoy9pLgRe8/2TpeO3UXpNZNb3zNy16cwReV5ZWvJtdL3yi5lz/+zS8dxcvfd9lXdAAO8BoHTGB/4VdF501whKvH4H4huLgGlrB8F0zhhTn4uBDOcIhJxWFFeri6JhaxBzdM4pW5CqDWIWSKgbZi/hZbK20W/jCGZayz/dZYVShGEo6ru2PL9djHyAJyt4RMKR0TWb1HpmCSJwRiyDXZyXmEciylLCwqh/LKBaNxlr9m5eiheMlfvo+Ya3XmjFzvNtcLHJnR/EkjqxkqbMaISjWjVnptec4ftrOp8KzkpChNzn92ZKAzNWiMMDUpG20forkVZkWDyVV6ziGfIy1pbNa50u7xc0keNRBCltrUkN7IqVUd44+setWcxpCVZD1rWtfa1rfGda51vWte99rXv661dAlYEgIGtC3mrd/aDgNrCNHP2c+GdrSlfeiM4HDa6wFdsh+s7Rwf2yOKgbVAgD1ucpfb3OdGN66Rq1kD/hYQegP5HkjEJ+/wKZvasKP0p6d4L59l+8bh9rS+AwZGwkHvuy7286sCLnDjEBy+CQ8owBleKIf3O8GMRvjE+1txJEYY46TV+KU4rl6PQ7yGISfvvbls8QB/PLgoD5fK18Xy/Lq8cAuH+bofLnMV8rzIMJ/WyONYcp+TDuco1znNNWzyPgH9VELPI4xFhvCiHyzfn056x99XdVFxPV9XrzRXRjKak3RL6Wz0ukocKnH/5CMfSAeLo3k8zIKT2eb/2Czbp6MNFdAGH43LBymOES+pnLLwo/KHCxSv+GjkORo4fQFwZbV1ZhNzOi9wqElcECV+tEAA7fH85qcRAGgQ/p4mmOaxSVBSnWoiRiA6Vc9m9OXvyhsWNWY1hjawIRBoNKMZ2ijI75+Rj2Y8Q/fEN/4pjN+MYmDj7cTPhjOY0Yy3jx4A1D+I759xCmw8AxvFMIVBiF/84AMfmvnoBzT4AX3pY78g2jBF8w9F6hdrRyByB0k1WTANmkY2tEulKWuaPcqrvYwrDrIyCBcYAL0KgGh4Bn1owGfghwBwAWeawAoMAGxggYd6AQkMgAHIJQrUh2kyCX44iMTQqxbQhokCgAEIvwlkjwdsQH0YiKxqwAkEQRTUB+9jAYXawfYiinYzIKIIiWrKu38Yq68qrK1SvAGMoQI0QCSbBoVIndLr/gdreobWIz0tVKoBeIGJykLNKqmKsj5pMCPrgYYedIExtKiiuMLSg6YwhIbWawE2tL5o+MLNA8Jrk7YibKZGya0WQCedgid9khHag8Kb+7EpNCMrxEL9q75mejuBeIGhAoB+qKYOrEK8uhMWCEMHfIaJ2j83xEIErKdMpBpoMCtV1Kt+2EM+hDY/dAh+MCdCjA9ETESF+7HSK4hTUAFi4L1neEM5LIh6ohoBAMFoMsZNBMNGfIZaLIi7sKkMGUZTtKZl5L27aMFkdMU3gcU+zD8AsC3FuybQarTROkQCzEVdLI5pisEbuilKlMBHxEJizJwAmAZnaAYzxEZr4kRn/mQqXnyp1isIgio9a5zDeuS9kuIRfWREbySKyJDIiaRIyCDCcGQBVtKnXJqGg6JAJ6yitFtHQCuOY2CIFqjAFsyHiRqnaSq9ZVxGhmCBL+yPfoQGfZgoZni7jMFCfdjASjQJaVhJAHiBF3DJUFTJU1RIa8IHhoCGL9REiLSe+puuqRwVI9wIgiKsHvwrDMHFkQwc8mgGZqJEiJCGyXomByQoUJxAUGwGrtwlDwRFhnBAc4qmE6yogsgGkmCBaHi7sxTHu6hLgeiHtmzLgqDLZ3hLhQK+PfwHR5uchsCK6iAoF+CImlKoeQJJEwJLdPE0Z8hHhQjNHgmS0nSG0zQI/tJUTYRAzdTkv9IcTdcsCBxZzdnMRy4Sudi4wsgkzJULCdnqCF8CTlH5ykcBN04DO0WTCm3ksSOsu+JUOJF8LqdrD65gKp3ZqOdUx57TO+psMPzQtL/gM+38jYNbK+mctKMLuawjuYtjurD0zh+TOfKsuffErvhEsvncOaLrTvwsDPYcOvdEz2xJzkAD0KgT0P70zxaDnLNLr7tjxwX9T6gLJP5ETvXUuAOt0AS90Ir00A8F0RAV0REl0RL1UA2NGwuVtG9k0RZ1UfjhN637DVY7T4CDjhvF0RzV0R3l0R710R8FUh5FUUCBTs8c0E6T0A7TTwf1mSPtiLW70CSd/tAlldGQ7JUjXFEMnbghtaQi7cw+klIGjSQTJVOS8NIvRZowFVNje9HbOFM0vRc1vTMwcrU6tdM7NbWIg9NmkVMbg0IIZbYCtTNApbo95dM+JRr7HDVFnTNBVTNCrVFD7TNETVQntRdIzVJKpQ5LVRdMRTRHFTNPNc7EkNRJ1dS+KdXRyKpVZdVWddVXhdVYbdWlO1VUTdXPEMJcpdX2GABkLAzU7CpQzJTTBM1eHRdRZRCNdK6MUFZDHA3Fq4doldZppdZqtdZrxdZpbUL02qR8IAi0kCbRq8dMmSbXAsFjZdT8gLONWFfdoA17gNd4ldd5pdd6tdd7ldfc4NY6/qumidpJUzCFY1gBFQi/gsiHUyCFFfi7Z0AnATCFesIGFTiFnXwGU1ABUvhBgMUHYlC+gtAHU8AHbehYhFWBhf3Ygq1Y4FOoflC8BwxYbFgBU6BYviOFjt04Tn2UFmDVxsOIaIiGVuVZ2XhXfCXaojVaeNVX8Nokz8stTSwqkjBBpCyqFpAmhdJCgRiAgmDIyJpCgejBFjAI/SOsZ3C0xABbgpxHaNhNACDIalKMFjRBzHOMh8zNOcNSF1DWbUWqZnXWvBjaowXcwEVaLB0lRDLIZ/A8lRVHbDAnB/RWATgFYOyPkWCBfOhXUzCrMEQppqrcgSCG7itGr3U+AYDc/t27RlKEw2ZqW3E0BdNtQ7aVBhao3Ju1W43AjY7AHs74W3vYgt713d8F3uAV3uEF3nwl3ExCJGYCvmpyQHkcRqYyw2eYJn1QwjDswN18hs4aH7/Sw7C9qb+8ioKYpgFA22q0ntV1WmsiS9qYpqitWzQjXFbtCFZN2r/Y3VwVH+N90B6zPtJ9KL9yxNKDxmfoQX6oXmPE3rtwptoAYIRYxgHuwWksCPMNLJ+wSW3EDfdNudqVifrli791LVkV4RF+VReIVw9G3h4jy2Q8p2AcRsHSBmcAwwPGQuytxXzQBmgww2A8CJi8KW0YStcSCG3QhoBEygquyaVURZPA4VOI/l4hQVZ1vYissqtVnWIqrmIqRuG6+FuqlS2+VVYOEuMxJuMy5qAWOOHjhaQJIqtscOMeJMEAHj6vnabPy4dcWgEELopelV0s5GHv5cV86KwInoY7bqYNxEJ3XF1eDMZpkl3Sozic/ZO8y43bxTt9vd0ttgs0RlpH+QgzBuVQ7gdOtgdN5iM2Jl+DOEtkFAC1HABQjIYQRKmCkAaubWUJNNZnkOHEYMReFdZivGWDkGVGnIZnmslbPkt8NNZpeGXxvWVnYEBPjGQOruTauAhrvuRq1l1S9mKOEOVvBmVuVmNDAtUfPAhzngh0fgp9UOcHjIh2TmdCiWL7yDufvSef/uVZfL4IfG48Uw6LLvZkjQDngR5jcd7fWh0zDo4Jf/YKgFYrgoZoMTbofUXogZNkNcm7xVs8ztJopGpChu4Kh86ziCbpiVZaLWW4eZ4PSoazdrVmkNYKkb4Iki7pND7oim64iy4Tls5kS87mS97mEw5omo5ok74uUM0ylYaPvOPbrVJWjNBIoL4Mmf4HooZooy5clBY4pdYNybvmK7ZiVwVrhvJgrw5pbnYUqy5qm6ZonHYYGTtenq5mS+5p2+VitEYJtb5qtj5pt37rFENJjcapa+5pun7pwF68caYKkdZrgsbqFPbrM4RrwR7se9ZnfrZny+5nxFY8xZ4NvK7q/sYG58deY63WN64WWsyOBs+mN8xm7ZxwaOEUbVEmbXI2baxLVwBSbaZuVqfu7aimDde+a6Ge7YGu7VO+7bDL7d8QROHO5sNu6Wp2brFw6OL+5uPeI6SGMtQejebmZ7me68K+5On+Z7y2btrm66NObuVc7t7wbnzOaMHmaPne6OD+7uHu5PNG78G96cjuHMDe7Zqwb/jG71LW7/0u5ddWsPU20PZ21wDv4Pde7QL34gMfYwMe5fTOav/mSZ2WEAmf8Agn74Y2bwvnoJTKcP5uaw7nbtEAcQXHXQmHcZuobhNvFBTHbgFj8EF1cMDYbcoGcdUWcp+lDcEO8qyocRvH/nENh2wO37cE42zKlvIpp/Iq1+gZV4kkN/ElV/G+dvIW91vBFXOjxfKU0HL95j8uT/D+9m8w5+Ixh/N7LfOQOPPzTvNGyfE50u4jc3O7iFdphddptQdBP9psBXSkXdabqHPrvvMUX/MVb/Met994pYBKh1cwwHQwsAdQ4HRQANzvSeM594hFb+w0b/Q8X3Anf/IAI+VKp4BLz/RN7/RP955Q/2ziFm1XNXX+w3MmL21V73PqpnRLt4dM1/RO9/SjrcOiZPZmfwFxFvUYx/VS3/Vq7/UuV29gl/QPjlce8HZ4ZYNwZwN7KIZyL4ZPd/Z0h/Zbz28bL2hft21t9/Dv/iDlOLfXZU93Zl93nvjbLVDFfwf4gBf4gSd4gd8CeEdueY+werd3egX1wY12jthdK6f4ihds/YX0yA72f274ey14gD/hzIZthu94OIdpNdpzH9v4hi75ho94aW95oxX3cMd4L2fxbQ/zmDd5JCdlQ6+Hkjd2TUf47N7xR8X5N9f5MX95iSflfHd2oDf2ms/2Lz96P096MV96dm16p2d2qI/1oddxhYfyq8d6no/Xj1fFkg+DtV97qd9wqp937iB5sifarLfduad7fD35Qyr6UK16Yc97ZTf7wFd2u0chgSDWxFf8xWf8xnf8x4f8yJf8yaf8yrd8xl/5kLb4zef8/sTOCmj1+dAXfWzVW/Vu09NH/dOPsCFn/dZ3/dc/a/wtoKUL0tq3/dvH/dzX/Sf6+zki4d8H/lfd1ZuP+1t1spSvscw3/oSH++V3fh4T++eXfqlq/um3fkuK/uvX/jEi/u33/uLp+6Tu/e+/IuRnMeUn/x8yfxJDf6p4LM18TAFANZCQpvnPFmmirIx4LPvXiF6VhmACCAH/BhIsaPCgv37+/vEbIO0gxIgSJ1KsaNEgAADPNnLs6PEjyJAiR5IsafIkypQqO2YEcPElzJgyZ9KsOA1AC4LQAECL2Y9nzaBChf50WbDhw4oZoTUcUHMAABf/bvYcavUqRo0rt3Lt/ur1K1iRLbGSLWs25s2cA3f25PfCRbSF/qJF6wftodsX0gBMkxZtIL+kdPsxfPEi7r+5/OwO7OdC70G3cBcO9Pf2BUF/0gwT/tcvml7K/6A9Fs0P2mHKjiEDfrvXKEHH/P7Rlfx34OWljqUqZuz5cdJ/m110zijAH9WpwemebT4xY9jo0qdT9zrWOfbsZG8OmMaPnwugAQCMFzDtJnmcLsYHGA+Nhct+UKf9y3iaPQCBN1mMH91+/GwF4WfeVAKkd5uBGQUQDTT4sTBQC/8JMFuE7eXnn4UBsjcebAMlpyCHhIVnIU/oTQUAfy41mOGJ5C3oT0v8JPdCALPtJZB2/tpBVx2PPfpY3XU5CjnkS+i1pFsA0PgDVQvosQANei1I0wJPO/WDHmYADOCPAEk25JKTUGbUFwsPxpbkkjhxCYA007hwHIwCSBNegi5IAx9tALywWJL16elYAOiR+WBa01DZ4Yk9GTfNTtEU+pqYYGb0pKB3ssClnDcdNx6hQPEDFHyYEdncjj+aeiqqJgU5KqutepgfNLHC15MLLUSIE3qUkTfbp0yx+UJGA/QqXK0pnujCQuHh1AJUAQ5U661SZlSZNJqxmZg0r7HALAAy5rctNIQZZytpGdna7Hq8TlvQh3p6xlN4AS5l4k3I/qPsuWxeK1y1BuaUXH1b7upq/lmlpnowwqiuSjDD2qWlU4nkseCviQORR9hPPbHgwgABhFrjPwYG0IKBiUJorq0tdHaix/7uBNtCO9GXGIwopkyYNF22h9mUXZJ3aMoqR4jxugS121PGVBYXsaRVAZ2yzJUt5K/JfkbjbsNXGZww111Lt3DWYZf18FrwgsxkxX5We3VP0XC6k8cW1yhf02UH4A9ywd17Nk6fArCQof58iuw0A1AZKHI9MYr3p8fFKvis5OHdl3BszlX0q4oClfFe1dYcadVwTy7N4AsZvua/QP0DlYEri13T1l7LPrtKYL9+e1Bkj1alzeamDZ/H7r3LEz/C+8kCVHUnBlWZfUK8/q2599osgKiTGvgC68ZebXh4UgX75t/M89cTjMFjbvJS7yrJX5nzTgtwms3T2jtmUN0N8NVa4h5U7LT7/z9IbLe/Ab6EH9QjSM6q1R4BQEMALWgIjhKzngFAwyEDEYCw7iWAzqxnQQ0UnAUr00EzZWaBDczJXBZIkGh0SU4S7BILZiaN/yBmSgv8iz9GSJAOVjCCgHHhAFwon4f4oz0DCCLpgsiQEEqwPWbiUnuSMo0u9QMpjTHQbQgYk/4BsIv/E6AWwygTvJWFjBQRjUHMmEY0VsYiasxMGiHCxpjMcSJzfGNiDkK3OopRIlz0IiC9BsY+ErKQhsRdmnx4yIj8/jGQjjzYIBcpyUlSsjn9cODMKpmVR3JSkOfTJChDKcpRCqWRnTwlkD5JylWyspWrNCUqYxmWSLqylra85QBhKctdcoWWuPwlMIMpJF3yspgo8aUwk6nMZcJOK8Z8pnVUycxpUrOaFCEmNLP5EWRas5veDCY2tSnOZ3Dzm+Y85yudOc51ikWa6HwnPEcZTnY+s5zxvCc+tThPehbTnvn8J0Abtk9+7tKfAT0oQnM0UILG0qAJfShEsbJQhp7SoRG9KEa3qE6KstOiGf0oSCEyUY4+0qMhPSlIR0rSQJoUpS6NqEpX6sWWvrSmB42pTAFIU5vyFJ84zan/dtrToaLz/qdAnZ1QiarUbhr1qJ5E1FKj+tCmOpVrSZUqVoVJ1aoi7KpZ/eott8rVVHkVrGZlpVjHeqqynrWtoUyrWn/EVrfSdZJwjWuP5lrXvRYyIyn4K2ADK9jBErawhj0sYhOr2MUytrGODaxe+SpZfR6pspa9LGYzq9nNcraznv0saEPb2QBMtrTCDBpqU6va1bK2ta59LWxjK9vZ0ja2pr0tbnOr293ytre+/S1wgyvc4RK3uMY9LnKTq9zlMre5zn0udKMr3elSt7pXyaELqnIvF0jFut5FLnpIazF3fre8vDXSq9alGdIRhB94kwZh+uKswFSrve71znfay0fz8hei/jcZz0JekKCpwCc/CyketwZAo4FdMlh/KV7wIrQlhgTAdf29sH9RJIC/DEBZxQMAaAQglf8KeCnwyQl8spuRNimoBS/7S3gwLOOIpqVWNwEWT5ZCmgrfeHekLRSIL4iiXA2EeTOE6oyTjM+0zDA8LzvUEY94JaDsRD84ido/qGSeouWPSmpRMpiXjJOi5FhPkuvHlUxW5RNJqypoK1qDx5PJMNMZnQ8L1ss+jJoDJmfNafEHf14ANxZ36GWKrDOiuzm4kPEkfwwp8HEYEuTtUVgq/eAQCx7cn/YaL9Ge7qZCEqOQhHRGcKFujFxObUbBuTczrgO0yj4ta6lGg0pzK541rnkKFafkutc8Tch+fS3sYRO72MY+NrKTrexlM7vZzn42tKMt7Wl/NCAAOw==" alt="image"></span></p>
</div>
<div class="paragraph">
<p>The Z-machine is a design for an imaginary computer: Z is for 'Zork', the adventure game it was originally designed to play. Like any computer, it stores its information (mostly) in an array of variables numbered from 0 up to some large number: this is called its <strong>memory</strong>. A stock of some 240 memory locations are set aside for easy and quick access, and these are called <strong>global variables</strong> (since they are available to any part of the program which is running, at any time).</p>
</div>
<div class="paragraph">
<p>The two important pieces of information not stored in memory are the <strong>program counter</strong> (PC) and the <strong>stack</strong>. The Z-machine continuously runs a program by getting the instruction stored at position PC in memory, acting on the instruction and then moving the PC forward to the next. The <strong>instruction set</strong> of the Z-machine (the range of possible actions and how they are encoded as numbers in memory) occupies much of this document.</p>
</div>
<div class="paragraph">
<p>Programs are divided into <strong>routines</strong>: the Z-machine is always executing a particular routine, the one which the PC currently points inside. However, some instructions cause the Z-machine to <strong>call</strong> a new routine and then to return where the first routine left off. The Z-machine therefore needs to remember details of where to go back, and it stores these on the stack.</p>
</div>
<div class="paragraph">
<p>The stack is a second bank of memory, quite separate from the main one, which has variable size: initially it is empty. From time to time values are added to, or taken from, the top of the stack. As well as being used to keep return details, the stack is also used to store <strong>local variables</strong> (values needed only by a particular routine) and, for short periods only, the partial results of calculations.</p>
</div>
<div class="paragraph">
<p>Thus, whereas most physical processors (e.g. Z80 or 6502) have a number of quick-access variables outside of memory (called "registers") and a stack inside memory, the Z-machine has the reverse: it has global variables inside memory and a stack kept outside.</p>
</div>
<div class="paragraph">
<p>There is no access to hardware except by executing particular Z-machine instructions. For instance, <strong>read</strong> and <strong>read_char</strong> allow use of the keyboard; <strong>print</strong> and <strong>draw_picture</strong> allow use of the screen. The screen&#8217;s image is not stored anywhere in memory. Conversely, hardware can cause the Z-machine to <strong>interrupt</strong>, that is, to make a spontaneous call to a particular routine, interrupting what it was previously working on. This happens only if the program has previously requested it: for example, by setting a sound effect playing and asking for a routine to be called when it finishes; or by asking for an interrupt if thirty seconds pass while the player is thinking what to type.</p>
</div>
<hr>
<div class="paragraph">
<p>This simple architecture is overlaid by a number of special structures which the Z-machine maintains inside memory. There are around a dozen of these but the most important are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>the <strong>header</strong>, at the bottom of memory, giving details about the program and a map of the rest of memory;</p>
</li>
<li>
<p>the <strong>dictionary</strong>, a list of English words which the program expects that it might want to read from the keyboard;</p>
</li>
<li>
<p>the <strong>object tree</strong>, an arrangement of chunks of memory called <strong>objects</strong>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Z-machine is primarily used for adventure games, where the dictionary holds names of items and verbs that the player might type, and the objects tend to be the places and artifacts which make up the game. Each object in the tree may have a <strong>parent</strong>, a <strong>sibling</strong> and a <strong>child</strong>. For instance, in the start position of 'Zork I':</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p><strong>West of House</strong></p>
</div>
<div class="paragraph">
<p>You are standing in an open field west of a white house, with a boarded front door. There is a small mailbox here.</p>
</div>
<div class="paragraph">
<p>&gt;open mailbox</p>
</div>
<div class="paragraph">
<p>Opening the small mailbox reveals a leaflet.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>At this point (part of) the game&#8217;s object tree looks like this:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>[ 41] ""
 . [ 68] "West of House"
 .  . [ 21] "you"
 .  . [239] "small mailbox"
 .  .  . [ 80] "leaflet"
 .  . [127] "door"</pre>
</div>
</div>
<div class="paragraph">
<p>Note that objects are numbered from 1 upward. (Object 41 is a dummy object being used by the game to contain all the "rooms" or locations, and it has many more children besides object 68.) The parent of the player is "West of House", whose parent is 41, which has no parent. The sibling of the player is the mailbox; the child of the mailbox is the leaflet; the sibling of the mailbox is the door and so on.</p>
</div>
<div class="paragraph">
<p>Objects are bundled-up collections of variables, which come in two kinds: <strong>attributes</strong> and <strong>properties</strong>. Attributes are simply flags, that is, they can be set or unset, but have no numerical value. Properties hold numbers, which may in turn represent pieces of text or other information. For instance, one of the properties of the mailbox object above contains the information that the English word "mailbox" refers to it. One of the attributes of the mailbox object is set to indicate that it&#8217;s a container, whereas the same attribute for the leaflet object is unset. Here is a breakdown of the state of the mailbox:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>239. Attributes: 30, 34
     Parent object:  68  Sibling object: 127  Child object:  80
     Property address: 2b53
         Description: "small mailbox"
          Properties:
              [49] 00 0a
              [46] 54 bf 4a c3
              [45] 3e c1
              [44] 5b 1c</pre>
</div>
</div>
<div class="paragraph">
<p>So the only set attributes are 30 and 34: all others are unset. Values are given for properties 44, 45, 46 and 49. The Z-machine itself does not know or care what this information means: that is for the program to sort out.</p>
</div>
<div class="paragraph">
<p>As a final example, here is part of one of the routines in 'Zork I':</p>
</div>
<div class="literalblock">
<div class="content">
<pre>l0006: print_ret       "Suicide is not the answer."
l0007: je              g57 #84 ~l0008
       je              g48 #15 ~rfalse
       print_ret       "Why don't you just walk like normal people?"
l0008: je              g57 #63 ~l0009
       print_ret       "How romantic!"
l0009: je              g57 #3b ~rfalse
       get_parent      "mirror" local0
       get_parent      "mirror" sp
       je              g6b local0 sp ~l0010
       print_ret       "Your image in the mirror looks tired."
l0010: print_ret       "That's difficult unless your eyes are prehensile."</pre>
</div>
</div>
<hr>
<div class="paragraph">
<p>Z-machine programs are stored on disc, or archived on the Internet, in what are called <strong>story files</strong>. (Since they were introduced to hold interactive stories.) A story file consists of a snapshot of main memory only. The processor begins to run a story file by starting with an empty stack and a PC value set according to some information in the story file&#8217;s header. Note that the story file has to be set up with many of the structures in memory, such as the dictionary and the object tree, already created and with sensible contents.</p>
</div>
<div class="paragraph">
<p>The first byte of any story file, and so the byte at memory address 0, always contains the <strong>version number</strong> of the Z-machine to be used. The design was evolutionary over a period of a decade: as version number increases, the instruction set grows and tables are reformatted to allow more room for larger games. All of Infocom&#8217;s games can be played using versions between 3 (the majority) and 6. Games compiled by Inform mainly use versions 5 or 8.</p>
</div>
</div>
</div>
<h1 id="_fundamentals" class="sect0"><a class="anchor" href="#_fundamentals"></a>Fundamentals</h1>
<div class="sect1">
<h2 id="ch.1"><a class="anchor" href="#ch.1"></a>1. The memory map</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s1.1"><a class="anchor" href="#s1.1"></a>1.1. Regions of memory</h3>
<div class="paragraph">
<p>The memory map of the Z-machine is an array of bytes with "byte addresses" running from 0 upwards. This is divided into three regions: "dynamic", "static" and "high". Dynamic memory begins from byte address <strong>$00000</strong> and runs up to the byte before the byte address stored in the word at <strong>$0e</strong> in the header. (Dynamic memory must contain at least 64 bytes.) Static memory follows immediately on. Its extent is not defined in the header (or anywhere else), though it must end by the last byte of the story file or by byte address <strong>$0ffff</strong> (whichever is lower). High memory begins at the "high memory mark" (the byte address stored in the word at <strong>$04</strong> in the header) and continues to the end of the story file. The bottom of high memory may overlap with the top of static memory (but not with dynamic memory).</p>
</div>
<div id="p1.1.1" class="paragraph">
<p><span class="red">§1.1.1.</span>
Dynamic memory can be read or written to (either directly, using <strong>loadb</strong>, <strong>loadw</strong>, <strong>storeb</strong> and <strong>storew</strong>, or indirectly with opcodes such as <strong>insert_obj</strong> and <strong>remove_obj</strong>).</p>
</div>
<div id="p1.1.1.1" class="paragraph">
<p><span class="red">§1.1.1.1.</span>
By tradition, the first 64 bytes are known as the "header". The contents of this are given later but note that games are not permitted to alter many bits inside it.</p>
</div>
<div id="p1.1.1.2" class="paragraph">
<p><span class="red">§1.1.1.2.</span>
It is legal for games to alter any of the tables stored in dynamic memory above the header, provided they leave the tables in legal states.</p>
</div>
<div id="p1.1.2" class="paragraph">
<p><span class="red">§1.1.2.</span>
Static memory can be read using the opcodes <strong>loadb</strong> and <strong>loadw</strong>. It is illegal for a game to attempt to write to static memory.</p>
</div>
<div id="p1.1.3" class="paragraph">
<p><span class="red">§1.1.3.</span>
Except for its (possible) overlap with static memory, high memory cannot be directly accessed at all by a game program. It contains routines, which can be called, and strings, which can be printed using <strong>print_paddr</strong>.</p>
</div>
<div id="p1.1.4" class="paragraph">
<p><span class="red">§1.1.4.</span>
The maximum permitted length of a story file depends on the Version, as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    V1-3    V4-5    V6-8
    128     256     512</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="s1.2"><a class="anchor" href="#s1.2"></a>1.2. Addresses</h3>
<div class="paragraph">
<p>There are three kinds of address in the Z-machine, all of which can be stored in a 2-byte number: byte addresses, word addresses and packed addresses.</p>
</div>
<div id="p1.2.1" class="paragraph">
<p><span class="red">§1.2.1.</span>
A byte address specifies a byte in memory in the range 0 up to the last byte of static memory.</p>
</div>
<div id="p1.2.2" class="paragraph">
<p><span class="red">§1.2.2.</span>
A word address specifies an even address in the bottom 128K of memory (by giving the address divided by 2). (Word addresses are used only in the abbreviations table.)</p>
</div>
<div id="p1.2.3" class="paragraph">
<p><span class="red">§1.2.3.</span>
<strong>*</strong>*[1.0]* A packed address specifies where a routine or string begins in high memory. Given a packed address <em>P</em>, the formula to obtain the corresponding byte address <em>B</em> is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  2P           Versions 1, 2 and 3
  4P           Versions 4 and 5
  4P + 8R_O    Versions 6 and 7, for routine calls
  4P + 8S_O    Versions 6 and 7, for print_paddr
  8P           Version 8</pre>
</div>
</div>
<div class="paragraph">
<p><em>R_O</em> and <em>S_O</em> are the routine and strings offsets (specified in the header as words at <strong>$28</strong> and <strong>$2a</strong>, respectively).</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. <strong>An example memory map of a small game</strong></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Dynamic</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00000</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">header</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00040</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abbreviation strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00042</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">abbreviation table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00102</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">property defaults</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00140</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">objects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>002f0</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object descriptions and properties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>006e3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">global variables</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>008c3</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">arrays</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>00b48</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">grammar table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>010a7</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">actions table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>01153</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">preactions table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>01201</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">adjectives table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>0124d</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">dictionary</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">High</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>01a0a</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Z-code</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>05d56</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">static strings</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>06ae6</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">end of file</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="remarks-01"><a class="anchor" href="#remarks-01"></a>Remarks</h3>
<div class="paragraph">
<p>Inform never compiles any overlap between static and high memory (it places all data tables in dynamic memory). However, many Infocom games group tables of static data just above the high memory mark, before routines begin; some, such as 'Nord 'n' Bert&#8230;&#8203;', interleave static data between routines, so that static memory actually overlaps code; and a few, such as 'Seastalker' release 15, even contain routines placed below the high memory mark. (The original idea behind the high memory mark was that everything below it should be stored in the interpreter&#8217;s RAM, while what was above could reasonably be kept in "virtual memory", i.e., loaded off disc as needed.)</p>
</div>
<div class="paragraph">
<p>Note that the total of dynamic plus static memory must not exceed 64K. (In fact, 64K minus 2 bytes.) This is the most serious limitation on the Z-machine.</p>
</div>
<div class="paragraph">
<p>Throughout the specification, Versions 7 and 8 are identical to Version 5 except as stated at 1.1.4 and 1.2.3 above.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.2"><a class="anchor" href="#ch.2"></a>2. Numbers and arithmetic</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s2.1"><a class="anchor" href="#s2.1"></a>2.1. Numbers</h3>
<div class="paragraph">
<p>In the Z-machine, numbers are usually stored in 2 bytes (in the form most-significant-byte first, then least-significant) and hold any value in the range <strong>$0000</strong> to <strong>$ffff</strong> (0 to 65535 decimal).</p>
</div>
</div>
<div class="sect2">
<h3 id="s2.2"><a class="anchor" href="#s2.2"></a>2.2. Signed operations</h3>
<div class="paragraph">
<p>These values are sometimes regarded as signed, in the range -32768 to 32767. In effect -n is stored as 65536-n and so the top bit is the sign bit.</p>
</div>
<div id="p2.2.1" class="paragraph">
<p><span class="red">§2.2.1.</span>
The operations of numerical comparison, multiplication, addition, subtraction, division, remainder-after-division and printing of numbers are signed; bitwise operations are unsigned. (In particular, since comparison is signed, it is unsafe to compare two addresses using simply <strong>jl</strong> and <strong>jg</strong>.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s2.3"><a class="anchor" href="#s2.3"></a>2.3. Arithmetic errors</h3>
<div id="p2.3.1" class="paragraph">
<p><span class="red">§2.3.1.</span>
It is illegal to divide by 0 (or to ask for remainder after division by 0) and an interpreter should halt with an error message if this occurs.</p>
</div>
<div id="p2.3.2" class="paragraph">
<p><span class="red">§2.3.2.</span>
Formally it has never been specified what the result of an out-of-range calculation should be. The author suggests that the result should be reduced modulo <strong>$10000</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="s2.4"><a class="anchor" href="#s2.4"></a>2.4. Random number generator</h3>
<div class="paragraph">
<p>The Z-machine needs a random number generator which at any time has one of two states, "random" and "predictable". When the game starts or restarts the state becomes "random". Ideally the generator should not produce identical sequences after each restart.</p>
</div>
<div id="p2.4.1" class="paragraph">
<p><span class="red">§2.4.1.</span>
When "random", it must be capable of generating a uniformly random integer in the range 1 &#8656; x &#8656; n, for any value 1 &#8656; n &#8656; 32767. Any method can be used for this (for instance, using the host computer&#8217;s clock time in milliseconds). The uniformity of randomness should be optimised for low values of n (say, up to 100 or so) and it is especially important to avoid regular patterns appearing in remainders after division (most crudely, being alternately odd and even).</p>
</div>
<div id="p2.4.2" class="paragraph">
<p><span class="red">§2.4.2.</span>
The generator is switched into "predictable" state with a seed value. On any two occasions when the same seed is sown, identical sequences of values must result (for an indefinite period) until the generator is switched back into "random" mode. The generator should cope well with very low seed values, such as 10, and should not depend on the seed containing many non-zero bits.</p>
</div>
<div id="p2.4.3" class="paragraph">
<p><span class="red">§2.4.3.</span>
The interpreter is permitted to switch between these states on request of the player. (This is useful for testing purposes.)</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-02"><a class="anchor" href="#remarks-02"></a>Remarks</h3>
<div class="paragraph">
<p>It is dangerous to rely on the older ANSI C random number routines (rand() and srand()), as some implementations of these are very poor. This has made some games (in particular, 'Balances') unwinnable on some Unix ports of <strong>Zip</strong>.</p>
</div>
<div class="paragraph">
<p>The author suggests the following algorithm:</p>
</div>
<div class="paragraph">
<p><strong>1.</strong> In "random" mode, the generator uses the host computer&#8217;s clock to obtain a random sequence of bits.</p>
</div>
<div class="paragraph">
<p><strong>2.</strong> In "predictable" mode, the generator should store the seed value <em>S</em>. If <em>S</em> &lt; 1000 it should then internally generate</p>
</div>
<div class="paragraph">
<p>1, 2, 3, &#8230;&#8203;, <em>S</em>, 1, 2, 3, &#8230;&#8203;, <em>S</em>, 1, &#8230;&#8203;</p>
</div>
<div class="paragraph">
<p>so that <strong>random n</strong> produces the next entry in this sequence modulo n. If <em>S</em> &gt;= 1000 then <em>S</em> is used as a seed in a standard seeded random-number generator.</p>
</div>
<div class="paragraph">
<p>(The rising sequence is useful for testing, since it will produce all possible values in sequence. On the other hand, a seeded but fairly random generator is useful for testing entire scripts.)</p>
</div>
<div class="paragraph">
<p>Note that version 0.2 of this standard mistakenly asserted that division and remainder are unsigned, a myth deriving from a bug in <strong>Zip</strong>. Infocom&#8217;s interpreters do sign division (this is relied on when calculating pizza cooking times for the microwave oven in 'The Lurking Horror'). Here are some correct Z-machine calculations:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   -11 / 2 = -5       -11 / -2 = 5        11 / -2 = -5
   -13 % 5 = -3        13 % -5 = 3       -13 % -5 = -3</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.3"><a class="anchor" href="#ch.3"></a>3. How text and characters are encoded</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
This technique is similar to the five-bit Baudot code, which was used by early Teletypes before ASCII was invented.
</blockquote>
<div class="attribution">
&#8212; Marc S. Blank and S. W. Galley<br>
<cite>How to Fit a Large Program Into a Small Machine</cite>
</div>
</div>
<div class="sect2">
<h3 id="s3.1"><a class="anchor" href="#s3.1"></a>3.1. Text</h3>
<div class="paragraph">
<p>Z-machine text is a sequence of ZSCII character codes (ZSCII is a system similar to ASCII: see <strong>S</strong> 3.8 below). These ZSCII values are encoded into memory using a string of Z-characters. The process of converting between Z-characters and ZSCII values is given in <strong>SS</strong> 3.2 to 3.7 below.</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.2"><a class="anchor" href="#s3.2"></a>3.2. Alphabets</h3>
<div class="paragraph">
<p>Text in memory consists of a sequence of 2-byte words. Each word is divided into three 5-bit 'Z-characters', plus 1 bit left over, arranged as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   --first byte-------   --second byte---
   7    6 5 4 3 2  1 0   7 6 5  4 3 2 1 0
   bit  --first--  --second---  --third--</pre>
</div>
</div>
<div class="paragraph">
<p>The bit is set only on the last 2-byte word of the text, and so marks the end.</p>
</div>
<div id="p3.2.1" class="paragraph">
<p><span class="red">§3.2.1.</span>
There are three 'alphabets', A0 (lower case), A1 (upper case) and A2 (punctuation) and during printing one of these is current at any given time. Initially A0 is current. The meaning of a Z-character may depend on which alphabet is current.</p>
</div>
<div id="p3.2.2" class="paragraph">
<p><span class="red">§3.2.2.</span>
In Versions 1 and 2, the current alphabet can be any of the three. The Z-characters 2 and 3 are called 'shift' characters and change the alphabet for the next character only. The new alphabet depends on what the current one is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>             from A0  from A1  from A2
  Z-char 2      A1       A2       A0
  Z-char 3      A2       A0       A1</pre>
</div>
</div>
<div class="paragraph">
<p>Z-characters 4 and 5 permanently change alphabet, according to the same table, and are called 'shift lock' characters.</p>
</div>
<div id="p3.2.3" class="paragraph">
<p><span class="red">§3.2.3.</span>
In Versions 3 and later, the current alphabet is always A0 unless changed for 1 character only: Z-characters 4 and 5 are shift characters. Thus 4 means "the next character is in A1" and 5 means "the next is in A2". There are no shift lock characters.</p>
</div>
<div id="p3.2.4" class="paragraph">
<p><span class="red">§3.2.4.</span>
An indefinite sequence of shift or shift lock characters is legal (but prints nothing).</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.3"><a class="anchor" href="#s3.3"></a>3.3. Abbreviations</h3>
<div class="paragraph">
<p>In Versions 3 and later, Z-characters 1, 2 and 3 represent abbreviations, sometimes also called 'synonyms' (for traditional reasons): the next Z-character indicates which abbreviation string to print. If z is the first Z-character (1, 2 or 3) and x the subsequent one, then the interpreter must look up entry 32(z-1)+x in the abbreviations table and print the string at that word address. In Version 2, Z-character 1 has this effect (but 2 and 3 do not, so there are only 32 abbreviations).</p>
</div>
<div id="p3.3.1" class="paragraph">
<p><span class="red">§3.3.1.</span>
Abbreviation string-printing follows all the rules of this section except that an abbreviation string must not itself use abbreviations and must not end with an incomplete multi-Z-character construction (see <strong>S</strong> 3.6.1 below).</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.4"><a class="anchor" href="#s3.4"></a>3.4. ZSCII escape</h3>
<div class="paragraph">
<p>Z-character 6 from A2 means that the two subsequent Z-characters specify a ten-bit ZSCII character code: the next Z-character gives the top 5 bits and the one after the bottom 5.</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.5"><a class="anchor" href="#s3.5"></a>3.5. Alphabet table</h3>
<div class="paragraph">
<p>The remaining Z-characters are translated into ZSCII character codes using the "alphabet table".</p>
</div>
<div id="p3.5.1" class="paragraph">
<p><span class="red">§3.5.1.</span>
The Z-character 0 is printed as a space (ZSCII 32).</p>
</div>
<div id="p3.5.2" class="paragraph">
<p><span class="red">§3.5.2.</span>
In Version 1, Z-character 1 is printed as a new-line (ZSCII 13).</p>
</div>
<div id="p3.5.3" class="paragraph">
<p><span class="red">§3.5.3.</span>
In Versions 2 to 4, the alphabet table for converting Z-characters into ZSCII character codes is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   Z-char 6789abcdef0123456789abcdef
current   --------------------------
  A0      abcdefghijklmnopqrstuvwxyz
  A1      ABCDEFGHIJKLMNOPQRSTUVWXYZ
  A2       ^0123456789.,!?_#'"/\-:()
          --------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>(Character 6 in A2 is printed as a space here, but is not translated using the alphabet table: see <strong>S</strong> 3.4 above. Character 7 in A2, written here as a circumflex <strong>^</strong>, is a new-line.) For example, in alphabet A1 the Z-character 12 is translated as a capital G (ZSCII character code 71).</p>
</div>
<div id="p3.5.4" class="paragraph">
<p><span class="red">§3.5.4.</span>
Version 1 has a slightly different A2 row in its alphabet table (new-line is not needed, making room for the <strong>&lt;</strong> character):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>          6789abcdef0123456789abcdef
          --------------------------
  A2       0123456789.,!?_#'"/\&lt;-:()
          --------------------------</pre>
</div>
</div>
<div id="p3.5.5" class="paragraph">
<p><span class="red">§3.5.5.</span>
In Versions 5 and later, the interpreter should look at the word at <strong>$34</strong> in the header. If this is zero, then the alphabet table drawn out in <strong>S</strong> 3.5.3 continues in use. Otherwise it is interpreted as the byte address of an alphabet table specific to this story file.</p>
</div>
<div id="p3.5.5.1" class="paragraph">
<p><span class="red">§3.5.5.1.</span>
Such an alphabet table consists of 78 bytes arranged as 3 blocks of 26 ZSCII values, translating Z-characters 6 to 31 for alphabets A0, A1 and A2. Z-characters 6 and 7 of A2, however, are still translated as escape and newline codes (as above).</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.6"><a class="anchor" href="#s3.6"></a>3.6. Padding and incompleteness</h3>
<div class="paragraph">
<p>Since the end-bit only comes up once every three Z-characters, a string may have to be 'padded out' with null values. This is conventionally achieved with a sequence of 5&#8217;s, though a sequence of (for example) 4&#8217;s would work equally well.</p>
</div>
<div id="p3.6.1" class="paragraph">
<p><span class="red">§3.6.1.</span>
It is legal for the string to end while a multi-Z-character construction is incomplete: for instance, after only the top half of an ASCII value has been given. The partial construction is simply ignored. (This can happen in printing dictionary words which have been guillotined to the dictionary resolution of 6 or 9 Z-characters.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.7"><a class="anchor" href="#s3.7"></a>3.7. Dictionary truncation</h3>
<div class="paragraph">
<p>When an interpreter is encrypting typed-in text to match against dictionary words, the following restrictions apply. Text should be converted to lower case (as a result A1 will not be needed unless the game provides its own alphabet table). Abbreviations may not be used. The pad character, if needed, must be 5. The total string length must be 6 Z-characters (in Versions 1 to 3) or 9 (Versions 4 and later): any multi-Z-character constructions should be left incomplete (rather than omitted) if there&#8217;s no room to finish them. For example, "i" is encrypted as:</p>
</div>
<div class="paragraph">
<p><strong>14, 5, 5, 5, 5, 5, 5, 5, 5</strong></p>
</div>
<div class="paragraph">
<p><strong>$48a5</strong> <strong>$14a5</strong> <strong>$94a5</strong></p>
</div>
<div id="p3.7.1" class="paragraph">
<p><span class="red">§3.7.1.</span>
In Versions 1 and 2 only, when encoding text for dictionary words, shift-lock Z-characters 4 and 5 are used instead of the single-shift Z-characters 2 and 3 when the next two characters come from the same alphabet.</p>
</div>
</div>
<div class="sect2">
<h3 id="s3.8"><a class="anchor" href="#s3.8"></a>3.8. Definition of ZSCII and Unicode</h3>
<div class="paragraph">
<p>The character set of the Z-machine is called ZSCII (Zork Standard Code for Information Interchange; pronounced to rhyme with "xyzzy"). ZSCII codes are 10-bit unsigned values between 0 and 1023. Story files may only legally use the values which are defined below. Note that some values are defined only for input and some only for output.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. <strong>Table 2: summary of the ZSCII rules</strong></caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">null</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1-7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">delete</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tab (V6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sentence space (V6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">newline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input/Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">14-26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">escape</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28-31</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32-126</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">standard ASCII</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input/Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">127-128</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">129-132</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">cursor u/d/l/r</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">133-144</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">function keys f1 to f12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">145-154</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">keypad 0 to 9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">155-251</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">extra characters</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input/Output</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">252</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">menu click (V6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">253</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">double-click (V6)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">254</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">single-click</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Input</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">255-1023</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">----</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div id="p3.8.1" class="paragraph">
<p><span class="red">§3.8.1.</span>
The codes 256 to 1023 are undefined, so that for all practical purposes ZSCII is an 8-bit unsigned code.</p>
</div>
<div id="p3.8.2" class="paragraph">
<p><span class="red">§3.8.2.</span>
The codes 0 to 31 are undefined except as follows:</p>
</div>
<div id="p3.8.2.1" class="paragraph">
<p><span class="red">§3.8.2.1.</span>
ZSCII code 0 ("null") is defined for output but has no effect in any output stream. (It is also used as a value meaning "no character" when reporting terminating character codes, but is not formally defined for input.)</p>
</div>
<div id="p3.8.2.2" class="paragraph">
<p><span class="red">§3.8.2.2.</span>
ZSCII code 8 ("delete") is defined for input only.</p>
</div>
<div id="p3.8.2.3" class="paragraph">
<p><span class="red">§3.8.2.3.</span>
ZSCII code 9 ("tab") is defined for output in Version 6 only. At the start of a screen line this should print a paragraph indentation suitable for the font being used: if it is printed in the middle of a screen line, it should be converted to a space (Infocom&#8217;s own interpreters do not do this, however).</p>
</div>
<div id="p3.8.2.4" class="paragraph">
<p><span class="red">§3.8.2.4.</span>
ZSCII code 11 ("sentence space") is defined for output in Version 6 only. This should be printed as a suitable gap between two sentences (in the same way that typographers normally place larger spaces after the full stops ending sentences than after words or commas).</p>
</div>
<div id="p3.8.2.5" class="paragraph">
<p><span class="red">§3.8.2.5.</span>
ZSCII code 13 ("carriage return") is defined for input and output.</p>
</div>
<div id="p3.8.2.6" class="paragraph">
<p><span class="red">§3.8.2.6.</span>
ZSCII code 27 ("escape" or "break") is defined for input only.</p>
</div>
<div id="p3.8.3" class="paragraph">
<p><span class="red">§3.8.3.</span>
ZSCII codes between 32 ("space") and 126 ("tilde") are defined for input and output, and agree with standard ASCII (as well as all of the ISO 8859 character sets and Unicode). Specifically:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>      0123456789abcdef0123456789abcdef
      --------------------------------
 $20   !"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?
 $40  @ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_
 $60  'abcdefghijklmnopqrstuvwxyz{!}~
      --------------------------------</pre>
</div>
</div>
<div class="paragraph">
<p>Note that code <strong>$23</strong> (35 decimal) is a hash mark, not a pound sign. (Code <strong>$7c</strong> (124 decimal) is a vertical stroke which is shown as <strong>!</strong> here for typesetting reasons.)</p>
</div>
<div id="p3.8.3.1" class="paragraph">
<p><span class="red">§3.8.3.1.</span>
ZSCII codes 127 ("delete" in some forms of ASCII) and 128 are undefined.</p>
</div>
<div id="p3.8.4" class="paragraph">
<p><span class="red">§3.8.4.</span>
ZSCII codes 129 to 154 are defined for input only:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>129: cursor up  130: cursor down  131: cursor left  132: cursor right
133: f1         134: f2           ....              144: f12
145: keypad 0   146: keypad 1     ....              154: keypad 9</pre>
</div>
</div>
<div id="p3.8.5" class="paragraph">
<p><span class="red">§3.8.5.</span>
The block of codes between 155 and 251 are the "extra characters" and are used differently by different story files. Some will need accented Latin characters (such as French E-acute), others unusual punctuation (Spanish question mark), others new alphabets (Cyrillic or Hebrew); still others may want dingbat characters, mathematical or musical symbols, and so on.</p>
</div>
<div id="p3.8.5.1" class="paragraph">
<p><span class="red">§3.8.5.1.</span>
<strong>*</strong>*[1.0]* To define which characters are required, the Unicode (or ISO 10646-1) Basic Multilingual Plane character set is used: characters are specified by unsigned 16-bit codes. These values agree with ISO 8859 Latin-1 in the range 0 to 255, and with ASCII and ZSCII in the range 32 to 126. The Unicode standard leaves a range of values, the Private Use Area, free: however, an Internet group called the ConScript Unicode Registry is organising a standard mapping of invented scripts (such as Klingon, or Tolkien&#8217;s Elvish) into the Private Use Area, and this should be considered part of the Unicode standard for Z-machine purposes.</p>
</div>
<div class="paragraph">
<p>The Z-machine does not provide access to non-BMP characters (ie characters outside the range U+0000 to U+FFFF).</p>
</div>
<div id="p3.8.5.2" class="paragraph">
<p><span class="red">§3.8.5.2.</span>
<strong>*</strong>*[1.0]* The story file chooses its stock of extra characters with a "Unicode translation table" as follows. Under Versions 1 to 4, the "default table" is always used (see below). In Version 5 or later, if Word 3 of the header extension table is present and non-zero then it is interpreted as the byte address of the Unicode translation table. If Word 3 is absent or zero, the default table is used.</p>
</div>
<div id="p3.8.5.2.1" class="paragraph">
<p><span class="red">§3.8.5.2.1.</span>
The table consists of one byte giving a number N, followed by N two-byte words.</p>
</div>
<div id="p3.8.5.2.2" class="paragraph">
<p><span class="red">§3.8.5.2.2.</span>
This indicates that ZSCII characters 155 to 155+N-1 are defined for both input and output. (It&#8217;s possible for N to be zero, leaving the whole range 155 to 251 undefined.)</p>
</div>
<div id="p3.8.5.2.3" class="paragraph">
<p><span class="red">§3.8.5.2.3.</span>
The words in the table give Unicode character codes for each of the ZSCII characters 155 to 155+N-1 in turn.</p>
</div>
<div id="p3.8.5.3" class="paragraph">
<p><span class="red">§3.8.5.3.</span>
The default table is as shown in Table 1.</p>
</div>
<div id="p3.8.5.4" class="paragraph">
<p><span class="red">§3.8.5.4.</span>
The defined extra characters are entirely normal ZSCII characters. They can appear in a story file&#8217;s alphabet table, in an array created by print stream 3 and so on.</p>
</div>
<div id="p3.8.5.4.1" class="paragraph">
<p><span class="red">§3.8.5.4.1.</span>
<strong>*</strong>*[1.0]* The interpreter is required to be able to print representations of every defined Unicode character under <strong>$0100</strong> (i.e. of every defined ISO 8859-1 Latin1 character). If no suitable letter forms are available, textual equivalents may be used (such as "ss" in place of German sharp "s").</p>
</div>
<div id="p3.8.5.4.2" class="paragraph">
<p><span class="red">§3.8.5.4.2.</span>
Normally, and where sensibly possible, all punctuation and letter characters in ISO 8859-1 Latin1 should be readable from the interpreter&#8217;s keyboard. (However, some interpreters may want to provide alternative keyboard mappings, or to run in a different ISO 8859 set: Cyrillic, for example.)</p>
</div>
<div id="p3.8.5.4.3" class="paragraph">
<p><span class="red">§3.8.5.4.3.</span>
<strong>*</strong>*[1.0]* An interpreter is not required to have suitable letter-forms for printing Unicode characters <strong>$0100</strong> to <strong>$FFFF</strong>. (It may, if it chooses, allow the user to configure certain fonts for certain Unicode ranges; but this is not required.) If a Unicode character must be printed which an interpreter has no letter-form for, a question mark should be printed instead.</p>
</div>
<div id="p3.8.5.4.4" class="paragraph">
<p><span class="red">§3.8.5.4.4.</span>
The Z-machine is not required to handle complex Unicode formatting like combining characters, bidirectional formatting and unusual line-wrapping rules.</p>
</div>
<div class="paragraph">
<p>In Versions other than 6, interpreters may either handle these features, or not, in window 0. In window 1, and all version 6 windows, they should be ignored.</p>
</div>
<div id="p3.8.5.4.5" class="paragraph">
<p><span class="red">§3.8.5.4.5.</span>
Unicode characters U+0000 to U+001F and U+007F to U+009F are control codes, and must not be used.</p>
</div>
<div id="p3.8.6" class="paragraph">
<p><span class="red">§3.8.6.</span>
ZSCII codes 252 to 254 are defined for input only:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>252: menu click   253: mouse double-click   254: mouse single-click</pre>
</div>
</div>
<div class="paragraph">
<p>Menu clicks are available only in Version 6. A single click, or the first click of a double-click, is passed in as 254. The second click of a double-click is passed in as 253. In Versions 5 and later it is recommended that an interpreter should only send code 254, whether the mouse is clicked once or twice.</p>
</div>
<div id="p3.8.7" class="paragraph">
<p><span class="red">§3.8.7.</span>
ZSCII code 255 is undefined. (This value is needed in the "terminating characters table" as a wildcard, indicating "any Input-only character with code 128 or above." However, it cannot itself be printed or read from the keyboard.)</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 3. <strong>Table 1: default Unicode translations (see S 3.8.5.3)</strong></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">ZSCII code (dec)</th>
<th class="tableblock halign-left valign-top">Unicode code (hex)</th>
<th class="tableblock halign-left valign-top">Name</th>
<th class="tableblock halign-left valign-top">Character</th>
<th class="tableblock halign-left valign-top">Textual Equivalent</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">155</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ä</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ae</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">156</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ö</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">157</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0fc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ü</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">158</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ä</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ae</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">159</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ö</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Oe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">160</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0dc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ü</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ue</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">161</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0df</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sz-ligature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ß</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ss</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">162</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0bb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">quotation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">»</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&gt;&gt; or "</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">163</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ab</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">marks</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">«</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;&lt; or "</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">164</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0eb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ë</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">165</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ef</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ï</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">166</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ff</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ÿ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">167</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0cb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ë</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">168</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0cf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-diaeresis</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ï</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">169</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">á</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">170</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">é</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">171</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ed</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">í</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">172</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ó</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">173</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0fa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ú</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">174</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0fd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ý</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">175</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Á</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">176</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">É</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">177</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0cd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Í</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">178</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ó</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">179</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0da</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ú</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">180</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0dd</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y-acute</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ý</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">181</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">à</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">182</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">è</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">183</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ec</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ì</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">184</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ò</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">185</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ù</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">186</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">À</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">187</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">È</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">188</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0cc</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ì</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">189</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ò</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">190</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-grave</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ù</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">191</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">â</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">192</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ea</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ê</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">e</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">193</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ee</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">î</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">i</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">194</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ô</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">195</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0fb</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">û</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">u</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">196</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Â</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">197</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ca</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ê</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">198</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0ce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Î</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">I</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">199</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ô</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">200</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0db</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U-circumflex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Û</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">U</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">201</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-ring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">å</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">202</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-ring</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Å</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">203</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-slash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ø</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">204</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-slash</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ø</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">205</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ã</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">a</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">206</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ñ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">n</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">207</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">õ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">o</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">208</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ã</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">209</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ñ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">210</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O-tilde</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Õ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">O</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">211</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ae-ligature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">æ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ae</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">212</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AE-ligature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Æ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">213</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0e7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c-cedilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ç</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">c</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">214</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0c7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C-cedilla</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ç</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">215</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0fe</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Icelandic thorn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">þ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">th</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">216</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0f0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Icelandic eth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ð</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">th</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">217</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0de</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Icelandic Thorn</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Þ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Th</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">218</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0d0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Icelandic Eth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ð</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Th</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">219</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0a3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pound symbol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">£</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">L</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">220</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">153</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oe-ligature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">œ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">oe</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">221</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">152</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OE-ligature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Œ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OE</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">222</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0a1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inverted !</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¡</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">!</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">223</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0bf</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">inverted ?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">¿</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="remarks-03"><a class="anchor" href="#remarks-03"></a>Remarks</h3>
<div class="paragraph">
<p>In practice the text compression factor is not really very good: for instance, 155000 characters of text squashes into 99000 bytes. (Text usually accounts for about 75% of a story file.) Encoding does at least encrypt the text so that casual browsers can&#8217;t read it. Well-chosen abbreviations will reduce total story file size by 10% or so.</p>
</div>
<div class="paragraph">
<p>The German translation of 'Zork I' uses an alphabet table to make accented letters (from the standard extra characters set) efficient in dictionary words. In Version 6, 'Shogun' also uses an alphabet table.</p>
</div>
<div class="paragraph">
<p>Unicode translation tables are new in Standard 1.0: in Standard 0.2, the extra characters were always mapped using the default Unicode translation table.</p>
</div>
<div class="paragraph">
<p>Note that if a random stretch of memory is accidentally printed as a string (due to an error in the story file), illegal ZSCII codes may well be printed using the 4-Z-character escape sequence. It&#8217;s helpful for interpreters to filter out any such illegal codes so that the resulting on-screen mess will not cause trouble for the terminal (e.g. by causing the interpreter to print ASCII 12, clear screen, or 7, bell sound).</p>
</div>
<div class="paragraph">
<p>The continental European quotation marks <strong>&lt;&lt;</strong> and <strong>&gt;&gt;</strong> should have spacing which looks sensible either in French style <strong>&lt;&lt;</strong>Merci!<strong>&gt;&gt;</strong> or in German style <strong>&gt;&gt;</strong>Danke!<strong>&lt;&lt;</strong>.</p>
</div>
<div class="paragraph">
<p>Ideally, an interpreter should be able to read time delays (for timed input) from stream 1 (i.e., from a script file). See the remarks in <strong>S</strong> 7.</p>
</div>
<div class="paragraph">
<p>The 'Beyond Zork' story file is capable of receiving both mouse-click codes (253 and 254), listing both in its terminating characters table and treating them equally.</p>
</div>
<div class="paragraph">
<p>The extant Infocom games in Versions 4 and 5 use the control characters 1 to 31 only as follows: they all accept 10 or 13 as equivalent, except that 'Bureaucracy' will only accept 13. 'Bureaucracy' needs either 127 or 8 to be a delete code. No other codes are used.</p>
</div>
<div class="paragraph">
<p>Curiously, 'Nord 'n' Bert Couldn&#8217;t Make Head Nor Tail Of It' and 'A Mind Forever Voyaging' allow some letter characters to be typed in with the top bit set. That is, if reading an A, they would recognise 65 or 91 (upper or lower case) and also 193 or 219. Matthew Russotto suggests this was an accommodation for the Apple II, whose keyboard primitives returned the last key pressed in the bottom 7 bits of a byte, plus a top bit flag indicating whether or not the keyboard had been hit since last time.</p>
</div>
<div class="paragraph">
<p>In the past, not just in the Z-machine world, there has been general confusion over the rendering of ASCII/ZSCII/Latin-1/Unicode characters $27 and $60. For the Z-machine, the traditional interpretations of right-single-quote/apostrophe and left-single-quote are preferred over the modern neutral-single-quote and grave accent - see Table 2A of the Inform Designer&#8217;s Manual. $22 is a neutral double-quote.</p>
</div>
<div class="paragraph">
<p>An alternative rendering is to interpret both $27 and $60 as neutral quotes, but interpreting $60 as a grave accent is to be avoided.</p>
</div>
<div class="paragraph">
<p>No doubt aware of this confusion, Infocom never used character $60, and used $27 almost exclusively as an apostrophe - hardly any single quotes appear in Infocom games. Modern authors would do well to follow their lead.</p>
</div>
<div class="paragraph">
<p>The few Infocom games that do use single quotes use $27 for both opening and closing - but even on many of their interpreters this looked a little odd, so suggesting that $27 be a right quote introduces no extra compatibility problems.</p>
</div>
<div class="paragraph">
<p>In Version 3 and later, many of Infocom&#8217;s interpreters (and some subsequent interpreters, such as ITF&#8217;s) treat two consecutive Z-characters 4 or 5 as shift locks, contrary to the Standard. As a result, story files should not use multiple consecutive 4 or 5 codes except for padding at the end of strings and dictionary words. In any case, these shift locks are not used in dictionary words, or any of Infocom&#8217;s story files.</p>
</div>
<div class="paragraph">
<p>To handle languages like Arabic or Hebrew, text would have to be output "visually", with manual line breaks (possibly via an in-game formatting engine).</p>
</div>
<div class="paragraph">
<p>Far eastern languages are generally straightforward, except they usually use no spaces, and line wraps can occur almost anywhere. The easiest to way to handle this would be for the game to turn off buffering. A more sophisticated game might include its own formatting engine. Also, fixed-space output is liable to be problematical with most Far Eastern fonts, which use a mixture of "full width" and "half width" forms - all half-width characters would have to be forced to full width.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.4"><a class="anchor" href="#ch.4"></a>4. How instructions are encoded</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>We do but teach bloody instructions</p>
</div>
<div class="paragraph">
<p>Which, being taught, return to plague th' inventor</p>
</div>
</blockquote>
<div class="attribution">
&#8212; Shakespeare<br>
<cite>Macbeth</cite>
</div>
</div>
<div class="sect2">
<h3 id="s4.1"><a class="anchor" href="#s4.1"></a>4.1. Instructions</h3>
<div class="paragraph">
<p>A single Z-machine instruction consists of the following sections (and in the order shown):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  Opcode               1 or 2 bytes
  (Types of operands)  1 or 2 bytes: 4 or 8 2-bit fields
  Operands             Between 0 and 8 of these: each 1 or 2 bytes
  (Store variable)     1 byte
  (Branch offset)      1 or 2 bytes
  (Text to print)      An encoded string (of unlimited length)</pre>
</div>
</div>
<div class="paragraph">
<p>Bracketed sections are not present in all opcodes. (A few opcodes take both "store" and "branch".)</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.2"><a class="anchor" href="#s4.2"></a>4.2. Operand types</h3>
<div class="paragraph">
<p>There are four 'types' of operand. These are often specified by a number stored in 2 binary digits:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  $$00    Large constant (0 to 65535)    2 bytes
  $$01    Small constant (0 to 255)      1 byte
  $$10    Variable                       1 byte
  $$11    Omitted altogether             0 bytes</pre>
</div>
</div>
<div id="p4.2.1" class="paragraph">
<p><span class="red">§4.2.1.</span>
Large constants, like all 2-byte words of data in the Z-machine, are stored with most significant byte first (e.g. <strong>$2478</strong> is stored as <strong>$24</strong> followed by <strong>$78</strong>). A 'large constant' may in fact be a small number.</p>
</div>
<div id="p4.2.2" class="paragraph">
<p><span class="red">§4.2.2.</span>
Variable number <strong>$00</strong> refers to the top of the stack, <strong>$01</strong> to <strong>$0f</strong> mean the local variables of the current routine and <strong>$10</strong> to <strong>$ff</strong> mean the global variables. It is illegal to refer to local variables which do not exist for the current routine (there may even be none).</p>
</div>
<div id="p4.2.3" class="paragraph">
<p><span class="red">§4.2.3.</span>
The type 'Variable' really means "variable by value". Some instructions take as an operand a "variable by reference": for instance, <strong>inc</strong> has one operand, the reference number of a variable to increment. This operand usually has type 'Small constant' (and Inform automatically assembles a line like <strong>@inc turns</strong> by writing the operand <strong>turns</strong> as a small constant with value the reference number of the variable <strong>turns</strong>).</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.3"><a class="anchor" href="#s4.3"></a>4.3. Form and operand count</h3>
<div class="paragraph">
<p>Each instruction has a form (long, short, extended or variable) and an operand count (0OP, 1OP, 2OP or VAR). If the top two bits of the opcode are <strong>11* the form is variable; if *10</strong>, the form is short. If the opcode is 190 (<strong>$BE</strong> in hexadecimal) and the version is 5 or later, the form is "extended". Otherwise, the form is "long".</p>
</div>
<div id="p4.3.1" class="paragraph">
<p><span class="red">§4.3.1.</span>
In short form, bits 4 and 5 of the opcode byte give an operand type as above. If this is <strong>$11</strong> then the operand count is 0OP; otherwise, 1OP. In either case the opcode number is given in the bottom 4 bits.</p>
</div>
<div id="p4.3.2" class="paragraph">
<p><span class="red">§4.3.2.</span>
In long form the operand count is always 2OP. The opcode number is given in the bottom 5 bits.</p>
</div>
<div id="p4.3.3" class="paragraph">
<p><span class="red">§4.3.3.</span>
In variable form, if bit 5 is 0 then the count is 2OP; if it is 1, then the count is VAR. The opcode number is given in the bottom 5 bits.</p>
</div>
<div id="p4.3.4" class="paragraph">
<p><span class="red">§4.3.4.</span>
In extended form, the operand count is VAR. The opcode number is given in a second opcode byte.</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.4"><a class="anchor" href="#s4.4"></a>4.4. Specifying operand types</h3>
<div class="paragraph">
<p>Next, the types of the operands are specified.</p>
</div>
<div id="p4.4.1" class="paragraph">
<p><span class="red">§4.4.1.</span>
In short form, bits 4 and 5 of the opcode give the type.</p>
</div>
<div id="p4.4.2" class="paragraph">
<p><span class="red">§4.4.2.</span>
In long form, bit 6 of the opcode gives the type of the first operand, bit 5 of the second. A value of 0 means a small constant and 1 means a variable. (If a 2OP instruction needs a large constant as operand, then it should be assembled in variable rather than long form.)</p>
</div>
<div id="p4.4.3" class="paragraph">
<p><span class="red">§4.4.3.</span>
In variable or extended forms, a byte of 4 operand types is given next. This contains 4 2-bit fields: bits 6 and 7 are the first field, bits 0 and 1 the fourth. The values are operand types as above. Once one type has been given as 'omitted', all subsequent ones must be. Example: <strong>$$00101111</strong> means large constant followed by variable (and no third or fourth opcode).</p>
</div>
<div id="p4.4.3.1" class="paragraph">
<p><span class="red">§4.4.3.1.</span>
In the special case of the "double variable" VAR opcodes <strong>call_vs2</strong> and <strong>call_vn2</strong> (opcode numbers 12 and 26), a second byte of types is given, containing the types for the next four operands.</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.5"><a class="anchor" href="#s4.5"></a>4.5. Operands</h3>
<div class="paragraph">
<p>The operands are given next. Operand counts of 0OP, 1OP or 2OP require 0, 1 or 2 operands to be given, respectively. If the count is VAR, there must be as many operands as there were types other than 'omitted'.</p>
</div>
<div id="p4.5.1" class="paragraph">
<p><span class="red">§4.5.1.</span>
Note that only <strong>call_vs2</strong> and <strong>call_vn2</strong> can have more than 4 operands, and no instruction can have more than 8.</p>
</div>
<div id="p4.5.2" class="paragraph">
<p><span class="red">§4.5.2.</span>
Opcode operands are always evaluated from first to last - this order is important when the stack pointer appears as an argument. Thus</p>
</div>
<div class="literalblock">
<div class="content">
<pre>@sub sp sp -&gt; i;</pre>
</div>
</div>
<div class="paragraph">
<p>subtracts the second-from-top stack item from the topmost stack item.</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.6"><a class="anchor" href="#s4.6"></a>4.6. Stores</h3>
<div class="paragraph">
<p>"Store" instructions return a value: e.g., <strong>mul</strong> multiplies its two operands together. Such instructions must be followed by a single byte giving the variable number of where to put the result.</p>
</div>
</div>
<div class="sect2">
<h3 id="s4.7"><a class="anchor" href="#s4.7"></a>4.7. Branches</h3>
<div class="paragraph">
<p>Instructions which test a condition are called "branch" instructions. The branch information is stored in one or two bytes, indicating what to do with the result of the test. If bit 7 of the first byte is 0, a branch occurs when the condition was false; if 1, then branch is on true. If bit 6 is set, then the branch occupies 1 byte only, and the "offset" is in the range 0 to 63, given in the bottom 6 bits. If bit 6 is clear, then the offset is a signed 14-bit number given in bits 0 to 5 of the first byte followed by all 8 of the second.</p>
</div>
<div id="p4.7.1" class="paragraph">
<p><span class="red">§4.7.1.</span>
An offset of 0 means "return false from the current routine", and 1 means "return true from the current routine".</p>
</div>
<div id="p4.7.2" class="paragraph">
<p><span class="red">§4.7.2.</span>
Otherwise, a branch moves execution to the instruction at address</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  Address after branch data + Offset - 2.</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="s4.8"><a class="anchor" href="#s4.8"></a>4.8. Text opcodes</h3>
<div class="paragraph">
<p>Two opcodes, <strong>print</strong> and <strong>print_ret</strong>, are followed by a text string. This is stored according to the usual rules: in particular execution continues after the last 2-byte word of text (the one with top bit set).</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-04"><a class="anchor" href="#remarks-04"></a>Remarks</h3>
<div class="paragraph">
<p>Some opcodes have type VAR only because the available codes for the other types had run out; <strong>print_char</strong>, for instance. Others, especially <strong>call</strong>, need the flexibility to have between 1 and 4 operands.</p>
</div>
<div class="paragraph">
<p>The Inform assembler can assemble branches in either form, though the programmer should always use long form unless there&#8217;s a good reason. Inform automatically optimises branch statements so as to force as many of them as possible into short form. (This optimisation will happen to branches written by hand in assembler as well as to branches compiled by Inform.)</p>
</div>
<div class="paragraph">
<p>The disassembler <strong>Txd</strong> numbers locals from 0 to 14 and globals from 0 to 239 in its output (corresponding to variable numbers 1 to 15, and 16 to 255, respectively).</p>
</div>
<div class="paragraph">
<p>The branch formula is sensible because in the natural implementation, the program counter is at the address after the branch data when the branch takes place: thus it can be regarded as</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  PC = PC + Offset - 2.</pre>
</div>
</div>
<div class="paragraph">
<p>If the rule were simply "add the offset" then, since the offset couldn&#8217;t be 0 or 1 (because of the return-false and return-true values), we would never be able to skip past a 1-byte instruction (say, a 0OP like <strong>quit</strong>), or specify the branch "don&#8217;t branch at all" (sometimes useful to ignore the result of the test altogether). Subtracting 2 means that the only effects we can&#8217;t achieve are</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  PC = PC - 1     and     PC = PC - 2</pre>
</div>
</div>
<div class="paragraph">
<p>and we would never want these anyway, since they would put the program counter somewhere back inside the same instruction, with horrid consequences.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_on_disassembly"><a class="anchor" href="#_on_disassembly"></a>On disassembly</h3>
<div class="paragraph">
<p>Briefly, the first byte of an instruction can be decoded using the following table:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  $00 -- $1f  long      2OP     small constant, small constant
  $20 -- $3f  long      2OP     small constant, variable
  $40 -- $5f  long      2OP     variable, small constant
  $60 -- $7f  long      2OP     variable, variable
  $80 -- $8f  short     1OP     large constant
  $90 -- $9f  short     1OP     small constant
  $a0 -- $af  short     1OP     variable
  $b0 -- $bf  short     0OP
  except $be  extended opcode given in next byte
  $c0 -- $df  variable  2OP     (operand types in next byte)
  $e0 -- $ff  variable  VAR     (operand types in next byte(s))</pre>
</div>
</div>
<div class="paragraph">
<p>Here is an example disassembly:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  @inc_chk c 0 label;    05 02 00 d4
      long form; count 2OP; opcode number 5; operands:
          02     small constant (referring to variable c)
          00     small constant 0
      branch if true: 1-byte offset, 20 (since label is
      18 bytes forward from here).
  @print "Hello.^";      b2 11 aa 46 34 16 45 9c a5
      short form; count 0OP.
      literal string, Z-chars: 4 13 10  17 17 20  5 18 5  7 5 5.
  @mul 1000 c -&gt; sp;     d6 2f 03 e8 02 00
      variable form; count 2OP; opcode number 22; operands:
          03 e8  long constant (1000 decimal)
          02     variable c
      store result to stack pointer (var number 00).
  @call_1n Message;      8f 01 56
      short form; count 1OP; opcode number 15; operand:
          01 56  long constant (packed address of routine)
  .label;</pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.5"><a class="anchor" href="#ch.5"></a>5. How routines are encoded</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s5.1"><a class="anchor" href="#s5.1"></a>5.1. Start position</h3>
<div class="paragraph">
<p>A routine is required to begin at an address in memory which can be represented by a packed address (for instance, in Version 5 it must occur at a byte address which is divisible by 4).</p>
</div>
</div>
<div class="sect2">
<h3 id="s5.2"><a class="anchor" href="#s5.2"></a>5.2. Header</h3>
<div class="paragraph">
<p>A routine begins with one byte indicating the number of local variables it has (between 0 and 15 inclusive).</p>
</div>
<div id="p5.2.1" class="paragraph">
<p><span class="red">§5.2.1.</span>
In Versions 1 to 4, that number of 2-byte words follows, giving initial values for these local variables. In Versions 5 and later, the initial values are all zero.</p>
</div>
</div>
<div class="sect2">
<h3 id="s5.3"><a class="anchor" href="#s5.3"></a>5.3. First instruction</h3>
<div class="paragraph">
<p>Execution of instructions begins from the byte after this header information. There is no formal 'end-marker' for a routine (it is simply assumed that execution eventually results in a return taking place).</p>
</div>
</div>
<div class="sect2">
<h3 id="s5.4"><a class="anchor" href="#s5.4"></a>5.4. Main routine (V6)</h3>
<div class="paragraph">
<p>In Version 6, there is a "main" routine (whose packed address is stored in the word at <strong>$06</strong> in the header) called when the game starts up. It is illegal to return from this routine.</p>
</div>
</div>
<div class="sect2">
<h3 id="s5.5"><a class="anchor" href="#s5.5"></a>5.5. Initial execution point (other versions)</h3>
<div class="paragraph">
<p>In all other Versions, the word at <strong>$06</strong> contains the byte address of the first instruction to execute. The Z-machine starts in an environment with no local variables from which, again, a return is illegal.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-05"><a class="anchor" href="#remarks-05"></a>Remarks</h3>
<div class="paragraph">
<p>Note that it is permissible for a routine to be in dynamic memory. Marnix Klooster suggests this might be used for compiling code at run time!</p>
</div>
<div class="paragraph">
<p>In Versions 3 and 4, Inform always stores 0 as the initial values for local variables.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.6"><a class="anchor" href="#ch.6"></a>6. The game state: storage and routine calls</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s6.1"><a class="anchor" href="#s6.1"></a>6.1. Saved states</h3>
<div class="paragraph">
<p>The "state of play" is defined as the following: the contents of dynamic memory; the contents of the stack; the value of the program counter (PC), and the "routine call state" (that is, the chain of routines which have called each other in sequence, and the values of their local variables). Note that the routine call state, the stack and the PC must be stored outside the Z-machine memory map, in the interpreter&#8217;s private memory.</p>
</div>
<div id="p6.1.1" class="paragraph">
<p><span class="red">§6.1.1.</span>
The entire state of play must be stored when the game is saved.</p>
</div>
<div id="p6.1.1.1" class="paragraph">
<p><span class="red">§6.1.1.1.</span>
The format of a saved game file is not specified.</p>
</div>
<div id="p6.1.1.2" class="paragraph">
<p><span class="red">§6.1.1.2.</span>
An internal saved game for "undo" purposes (if there is one) is not part of the state of play. This is important: if a saved game file also contained the internal saved game at the time of saving, it would be impossible to undo the act of restoration. It also prevents internal saved games from growing larger and larger as they include their predecessors.</p>
</div>
<div id="p6.1.1.3" class="paragraph">
<p><span class="red">§6.1.1.3.</span>
It is illegal to save the game (either with <strong>save</strong> or <strong>save_undo</strong>) during an "interrupt routine" (one coming about through timed input, sound effect termination or newline interrupts). Therefore saved games need not store information capable of restoring such a position.</p>
</div>
<div id="p6.1.2" class="paragraph">
<p><span class="red">§6.1.2.</span>
On a "restore" or "undo" (which restores a game saved into internal memory), the entire state of play is written back except that 'Flags 2' in the header is preserved. (This information includes whether the game is being transcribed to printer and whether a fixed-pitch font is being used.)</p>
</div>
<div id="p6.1.2.1" class="paragraph">
<p><span class="red">§6.1.2.1.</span>
Before a "restore", an interpreter should check that the file to be used has been saved from the same game currently being played. (See remark below.)</p>
</div>
<div id="p6.1.2.2" class="paragraph">
<p><span class="red">§6.1.2.2.</span>
After a "restore" or "undo", an interpreter should reset the header values marked <strong>Rst</strong> in the header table of <strong>S</strong> 11. (It should not be assumed that the game was saved by the same interpreter.)</p>
</div>
<div id="p6.1.3" class="paragraph">
<p><span class="red">§6.1.3.</span>
A "restart" is similar: the entire state is restored from the original story file, and the stack is emptied; but 'Flags 2' is preserved; and the interpreter should reset the <strong>Rst</strong> parts of the header.</p>
</div>
<div id="p6.1.4" class="paragraph">
<p><span class="red">§6.1.4.</span>
In Versions 5 and later, an interpreter unable to save the game state into internal memory (for "undo" purposes) must clear bit 4 of 'Flags 2' in the header.</p>
</div>
</div>
<div class="sect2">
<h3 id="s6.2"><a class="anchor" href="#s6.2"></a>6.2. Storage of global variables</h3>
<div class="paragraph">
<p>Global variables (variable numbers <strong>$10</strong> to <strong>$ff</strong>) are stored in a table in the Z-machine&#8217;s dynamic memory, at a byte address given in word 6 of the header. The table consists of 240 2-byte words and the initial values of the global variables are the values initially contained in the table. (It is legal for a program to alter the table&#8217;s contents directly in play, though not for it to change the table&#8217;s address.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s6.3"><a class="anchor" href="#s6.3"></a>6.3. The stack</h3>
<div class="paragraph">
<p>Writing to the stack pointer (variable number <strong>$00</strong>) pushes a value onto the stack; reading from it pulls a value off. Stack entries are 2-byte words as usual.</p>
</div>
<div id="p6.3.1" class="paragraph">
<p><span class="red">§6.3.1.</span>
The stack is considered as empty at the start of each routine: it is illegal to pull values from it unless values have first been pushed on.</p>
</div>
<div id="p6.3.2" class="paragraph">
<p><span class="red">§6.3.2.</span>
The stack is left empty at the end of each routine: when a return occurs, any values pushed during the routine are thrown away.</p>
</div>
<div id="p6.3.3" class="paragraph">
<p><span class="red">§6.3.3.</span>
The absolute minimum standard for stack size is defined as:</p>
</div>
<div class="paragraph">
<p>let the 'usage' of a routine call be 4 plus the number of local variables it has. During a game the total of the usages for each routine in the recursive chain of routines being called, plus the game&#8217;s own stack usage, can be assumed to never reach 1024.</p>
</div>
<div class="paragraph">
<p>However, more recent games have required a much larger stack size than this allows for. It is advised that interpreters allow for these games by having a larger stack size if at all possible.</p>
</div>
<div class="paragraph">
<p>Two examples of modern interpreters with increased stack size are <strong>Windows Frotz</strong>, with 32768, and <strong>nfrotz</strong> with 61440.</p>
</div>
<div id="p6.3.4" class="paragraph">
<p><span class="red">§6.3.4.</span>
In the seven opcodes that take indirect variable references (<strong>inc</strong>, <strong>dec</strong>, <strong>inc_chk</strong>, <strong>dec_chk</strong>, <strong>load</strong>, <strong>store</strong>, <strong>pull</strong>), an indirect reference to the stack pointer does not push or pull the top item of the stack - it is read or written in place.</p>
</div>
</div>
<div class="sect2">
<h3 id="s6.4"><a class="anchor" href="#s6.4"></a>6.4. Routine calls</h3>
<div class="paragraph">
<p>Routine calls occur in the following circumstances: when one of the <strong>call&#8230;&#8203;</strong> opcodes is executed; in Versions 4 and later, when timed keyboard input is being monitored; in Versions 5 and later, when a sound effect finishes; in Version 6, when the game begins (to call the "main" routine); in Version 6, when a "newline interrupt" occurs.</p>
</div>
<div id="p6.4.1" class="paragraph">
<p><span class="red">§6.4.1.</span>
A routine call may have any number of arguments, from 0 to 3 (in Versions 1 to 3) or 0 to 7 (Versions 4 and later). All routines return a value (though sometimes this value is thrown away afterward: for example by opcodes in the form <strong>call_vn</strong>*).</p>
</div>
<div id="p6.4.2" class="paragraph">
<p><span class="red">§6.4.2.</span>
Routine calls preserve local variables and the stack (except when the return value is stored in a local variable or onto the top of the stack).</p>
</div>
<div id="p6.4.3" class="paragraph">
<p><span class="red">§6.4.3.</span>
A routine call to packed address 0 is legal: it does nothing and returns false (0). Otherwise it is illegal to call a packed address where no routine is present.</p>
</div>
<div id="p6.4.4" class="paragraph">
<p><span class="red">§6.4.4.</span>
When a routine is called, its local variables are created with initial values taken from the routine header (Versions 1 to 4) or with initial value 0 (Versions 5 and later). Next, the arguments are written into the local variables (argument 1 into local 1 and so on).</p>
</div>
<div id="p6.4.4.1" class="paragraph">
<p><span class="red">§6.4.4.1.</span>
It is legal for there to be more arguments than local variables (any spare arguments are thrown away) or for there to be fewer.</p>
</div>
<div id="p6.4.5" class="paragraph">
<p><span class="red">§6.4.5.</span>
The return value of a routine can be any Z-machine number. Returning 'false' means returning 0; returning 'true' means returning 1.</p>
</div>
</div>
<div class="sect2">
<h3 id="s6.5"><a class="anchor" href="#s6.5"></a>6.5. Stack frames</h3>
<div class="paragraph">
<p>A "stack frame" is an index to the routine call state (that is, the call-stack of return addresses from routines currently running, and values of local variables within them). This index is a Z-machine number. The interpreter must be able to produce the current value and to set a value further down the call-stack than the current one, effectively throwing away its recent history (see <strong>catch</strong> and <strong>throw</strong>).</p>
</div>
</div>
<div class="sect2">
<h3 id="s6.6"><a class="anchor" href="#s6.6"></a>6.6. User stacks (V6)</h3>
<div class="paragraph">
<p>In Version 6, the Z-machine understands a third kind of stack: a "user stack", which is a table of words in dynamic memory. The first word in this table always holds the number of spare slots on the stack (so the initial value is the capacity of the stack). The Z-machine makes no check on stack under-flow (i.e., pulling more values than were pushed) which would over-run the length of the table if the program allowed it to happen.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-06"><a class="anchor" href="#remarks-06"></a>Remarks</h3>
<div class="paragraph">
<p>Some interpreters store the whole of dynamic memory to disc as part of their saved game files, which can make them as much as 45K or so long. A player making a serious attack on a game may end up wasting a whole megabyte, more than convenient without a hard disc. A technique invented by Bryan Scattergood, taken up by most modern interpreters, greatly reduces file size by only saving bytes of dynamic memory which differ from the initial state of the game.</p>
</div>
<div class="paragraph">
<p>It is unspecified how an interpreter should decide whether a saved game file belongs to the game currently being played. It is normal to insist that the release numbers, serial codes and checksums all match. The <strong>Pinfocom</strong> interpreter deliberately checks only the release number, so that saved games can be exchanged between different editions of 'Seastalker' (presumably compiled to handle the sonarscope differently).</p>
</div>
<div class="paragraph">
<p>These issues are taken up in great detail in Martin Frost&#8217;s <strong>Quetzal</strong> standard for saved game files, created to allow different interpreters to exchange saved games. This Standard doesn&#8217;t require compliance with <strong>Quetzal</strong>, but interpreter writers are urged to consider it: it can only help authors if players can send them saved games where bugs seem to have appeared.</p>
</div>
<div class="paragraph">
<p>The stack is stored in the interpreter&#8217;s own memory, not anywhere in the Z-machine. The game program has no direct access to the stack memory or stack pointer; on some implementations the game&#8217;s main stack is also used to store the routine call state (i.e. the game stack and the call-stack are the same) but this need not be true.</p>
</div>
<div class="paragraph">
<p>The stack size specification guarantees in particular that if the game itself never uses more than 32 stack entries at once then it can have a recursive depth of at least 90 routine calls. The author believes that old Infocom games will all run with a stack size of 512 words.</p>
</div>
<div class="paragraph">
<p>Note that the "state of play" does not include numerous input/output settings (the current window, cursor position, splitness or otherwise, which streams are selected, etc.): neither does it include the state of the random-number generator. (Games with elaborate status lines must redraw them after a restore has taken place.)</p>
</div>
<div class="paragraph">
<p><strong>Zip</strong> provides "undo" but most versions of the <strong>ITF</strong> interpreter do not (and <strong>save_undo</strong> returns 0, unfortunately). This is probably its greatest failing. Some Infocom-written interpreters will only provide "undo" to a game which has bit 4 of 'Flags 2' set: but Inform 5.5 doesn&#8217;t set this bit, so modern interpreters should be more generous.</p>
</div>
<div class="paragraph">
<p>Given the existence of Quetzal, a portable saved file format, it is quite possible that after loading, the game may be running on a different interpreter to that on which the game started. As a result, it is strongly advisable for games to recheck any interpreter capabilities (eg Standard version, unicode support, etc) after loading.</p>
</div>
</div>
</div>
</div>
<h1 id="_inputoutput" class="sect0"><a class="anchor" href="#_inputoutput"></a>Input/Output</h1>
<div class="sect1">
<h2 id="ch.7"><a class="anchor" href="#ch.7"></a>7. Output streams and file handling</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s7.1"><a class="anchor" href="#s7.1"></a>7.1. Output streams</h3>
<div class="paragraph">
<p>At any given time text is being output through a selection of "output streams" (possibly none, possibly several at once).</p>
</div>
<div id="p7.1.1" class="paragraph">
<p><span class="red">§7.1.1.</span>
Two output streams are common to all Versions: number 1 (the screen) and 2 (the game transcript, usually printed to a printer or a file).</p>
</div>
<div id="p7.1.1.1" class="paragraph">
<p><span class="red">§7.1.1.1.</span>
In Versions 1 to 5, the player&#8217;s input to the <strong>read</strong> opcode should be echoed to output streams 1 and 2 (if stream 2 is active), so that text typed in appears in any transcript. In Version 6 input should be sent only to stream 1 and it is the game&#8217;s responsibility to write to the transcript.</p>
</div>
<div id="p7.1.1.2" class="paragraph">
<p><span class="red">§7.1.1.2.</span>
In Infocom&#8217;s Version 4 game 'A Mind Forever Voyaging', which anticipated a printer rather than a file to receive the transcript, stream 2 is turned off and on again several times in quick succession. Thus if an interpreter decides where to send the transcript by asking the player for a filename, this question should only be asked once per game session, not every time stream 2 is selected.</p>
</div>
<div id="p7.1.2" class="paragraph">
<p><span class="red">§7.1.2.</span>
Versions 3 and later supply these and two other output streams, numbered 3 (Z-machine memory) and 4 (a script file of the player&#8217;s whole commands and of individual keypresses as read by <strong>read_char</strong>).</p>
</div>
<div id="p7.1.2.1" class="paragraph">
<p><span class="red">§7.1.2.1.</span>
Output stream 3 writes to a table in dynamic memory. When the stream is selected, the table may have any contents (even the initial 'size' word will be ignored by the interpreter). While the stream is selected, the table&#8217;s contents are unspecified (and a game cannot safely read or write to it). When the stream is deselected, the initial word of the table holds the number of characters printed and subsequent bytes hold those characters. Similarly, in Version 6, the total width of printing (in units) will then be stored in the word at <strong>$30</strong> in the header. (It is the programmer&#8217;s responsibility to make the table large enough: the interpreter performs no overflow checking.)</p>
</div>
<div id="p7.1.2.1.1" class="paragraph">
<p><span class="red">§7.1.2.1.1.</span>
<strong>*</strong>*[1.0]* It is possible for stream 3 to be selected while it is already on. If this happens, the previous table address is remembered and the previous table is resumed when the new one is finished. This nesting can reach a depth of up to 16: if stream 3 is opened for a seventeenth time, the interpreter should halt with an error message.</p>
</div>
<div id="p7.1.2.2" class="paragraph">
<p><span class="red">§7.1.2.2.</span>
Output stream 3 is unusual in that, while it is selected, no text is sent to any other output streams which are selected. (However, they remain selected.)</p>
</div>
<div id="p7.1.2.2.1" class="paragraph">
<p><span class="red">§7.1.2.2.1.</span>
Newlines are written to output stream 3 as ZSCII 13. (A game should never <strong>print_char</strong> the value 10, or any other value which is undefined as a ZSCII output code.)</p>
</div>
<div id="p7.1.2.3" class="paragraph">
<p><span class="red">§7.1.2.3.</span>
Output stream 4 is unusual in that, when it is selected, the only text printed to it is that of the player&#8217;s commands and keypresses (as read by <strong>read_char</strong>). (Each command is written, in one go, when it has been finished. Time delays and mouse-clicks should ideally be recorded. For suggestions on how this might be achieved, see the remarks section below. Mistypes and uses of 'delete' are not written.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s7.2"><a class="anchor" href="#s7.2"></a>7.2. Buffering</h3>
<div class="paragraph">
<p>On output streams 1 and 2 (only), text printing may be "buffered" in that new-lines are automatically printed to ensure that no word (of length less than the width of the screen) spreads across two lines (if the interpreter is able to control this). (This process is sometimes called "word-wrapping".)</p>
</div>
<div id="p7.2.1" class="paragraph">
<p><span class="red">§7.2.1.</span>
In Versions 1 to 3, buffering is always on. In Versions 4 and later it is on by default (at the start of a game) and a game can switch it on or off using the <strong>buffer_mode</strong> opcode.</p>
</div>
<div id="p7.2.2" class="paragraph">
<p><span class="red">§7.2.2.</span>
In Version 6, each of the eight windows has its own "buffering flag". In Versions 3 to 5, the <strong>buffer_mode</strong> applies only to the lower window, and buffering never happens in the upper window.</p>
</div>
</div>
<div class="sect2">
<h3 id="s7.3"><a class="anchor" href="#s7.3"></a>7.3. Selection (V1 and V2)</h3>
<div class="paragraph">
<p>In Versions 1 and 2, output stream 1 is always selected and stream 2 can be selected or deselected by the game, by setting or clearing bit 0 of 'Flags 2'.</p>
</div>
</div>
<div class="sect2">
<h3 id="s7.4"><a class="anchor" href="#s7.4"></a>7.4. Selection (later versions)</h3>
<div class="paragraph">
<p>In Versions 3 and later, all four output streams can be selected or deselected using the <strong>output_stream</strong> opcode. In addition, stream 2 can be selected or deselected by setting or clearing bit 0 of 'Flags 2'. Whichever method is used, the interpreter must ensure that this flag holds the current status of stream 2. ('A Mind Forever Voyaging' requires this.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s7.5"><a class="anchor" href="#s7.5"></a>7.5. Dealing with Unicode or invalid characters</h3>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* Because of the <strong>print_unicode</strong> opcode, it is possible for arbitrary Unicode characters to be sent to the output streams: that is, for characters which are not in the ZSCII set at all, even in the "extra characters" range.</p>
</div>
<div id="p7.5.1" class="paragraph">
<p><span class="red">§7.5.1.</span>
See <strong>S</strong> 3.8.5.4 for rules on printing Unicode to stream 1.</p>
</div>
<div id="p7.5.2" class="paragraph">
<p><span class="red">§7.5.2.</span>
Interpreters are free to use any representation of non-ASCII Unicode characters in stream 2. For example, they might print "[1a05]" to signify Unicode character <strong>$1a05</strong>; or they might be configurable to write transcript files which conform to any chosen ISO 8859 set.</p>
</div>
<div id="p7.5.3" class="paragraph">
<p><span class="red">§7.5.3.</span>
When printed to stream 3, Unicode characters should be converted to ZSCII if possible. If this is not possible, a question mark should be printed to stream 3.</p>
</div>
<div id="p7.5.4" class="paragraph">
<p><span class="red">§7.5.4.</span>
Non-ZSCII characters never need to be printed to stream 4.</p>
</div>
</div>
<div class="sect2">
<h3 id="s7.6"><a class="anchor" href="#s7.6"></a>7.6. File handling</h3>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* In Versions 5 and later, the Z-machine has the ability to load and save files (using optional operands with the <strong>save</strong> and <strong>restore</strong> opcodes: these operands were not used in Infocom&#8217;s Version 5 games, but I wish to specify them as in Version 5 anyway).</p>
</div>
<div id="p7.6.1" class="paragraph">
<p><span class="red">§7.6.1.</span>
<strong>*</strong>*[1.0]* Filenames have the following format (approximately the MS-DOS 8.3 rule): one to eight alphanumeric characters, a full stop and zero to three alphanumeric characters (the "file extension").</p>
</div>
<div id="p7.6.1.1" class="paragraph">
<p><span class="red">§7.6.1.1.</span>
The interpreter must convert all filenames to upper case before use. If no full stop is given, ".AUX" should be appended.</p>
</div>
<div id="p7.6.1.2" class="paragraph">
<p><span class="red">§7.6.1.2.</span>
Games should avoid the extensions ".INF", ".H", ".Z" followed by a number or ".SAV": otherwise they may be in danger of erasing their own object code, source code or saved game files.</p>
</div>
<div id="p7.6.1.3" class="paragraph">
<p><span class="red">§7.6.1.3.</span>
<strong>*</strong>*[1.1]* The interpreter should delete from the filename any characters illegal for a filename. This will include all of the following characters (and more, if the OS requires it): slash, backslash, angle brackets (less-than and greater-than), colon, double-quote, pipe (vertical bar), question-mark, asterisk. The library should also truncate the argument at the first full stop (delete the first full stop and any following characters). If the result is the empty string, change it to the string "NULL".</p>
</div>
<div id="p7.6.2" class="paragraph">
<p><span class="red">§7.6.2.</span>
<strong>*</strong>*[1.0]* Saved files are not associated with any particular session of a game. They are not part of the "state of play".</p>
</div>
<div id="p7.6.3" class="paragraph">
<p><span class="red">§7.6.3.</span>
<strong>*</strong>*[1.0]* A game may depend on having up to 32 auxiliary files (with different names).</p>
</div>
<div id="p7.6.4" class="paragraph">
<p><span class="red">§7.6.4.</span>
File-handling errors such as "disc corrupt" and "disc full" should be reported directly to the player by the interpreter. The error "file not found" should only cause a failure return code from <strong>restore</strong>.</p>
</div>
<div id="p7.6.5" class="paragraph">
<p><span class="red">§7.6.5.</span>
Interpreters are allowed to not support access to external files (such as with output_stream 2, or the extra features of save and restore), or to only support some methods of access. Interpreters should support these features if possible, as some games may rely on external files, and in any case transcripts are very useful for testing, but in some environments such access is not feasible.</p>
</div>
<div id="p7.6.5.1" class="paragraph">
<p><span class="red">§7.6.5.1.</span>
An attempt by the game to use save or restore in a manner not supported by the interpreter should simply return 0 as with any failure, and the game should notice and take appropriate actions.</p>
</div>
<div id="p7.6.5.2" class="paragraph">
<p><span class="red">§7.6.5.2.</span>
An attempt by the game to use streams to access external files which is not supported by the interpreter should ideally print a warning to the user that the functionality is not available, and otherwise do nothing.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-07"><a class="anchor" href="#remarks-07"></a>Remarks</h3>
<div class="paragraph">
<p>The <strong>ITF</strong> interpreter incorrectly applies buffering when printing to the upper window.</p>
</div>
<div class="paragraph">
<p>Note that the requirement 7.1.2.1.1, that usages of stream 3 can be 'nested', is new in Standard 1.0. This is potentially important for Inform games, as stream 3 is often used to examine text before printing, for instance to choose between the articles "a" and "an" in front of an object name. But the process of printing an object name may itself require a usage of stream 3, and so on.</p>
</div>
<div class="paragraph">
<p>An ambiguous point about output stream 4 is whether it should contain the answers to interpreter questions like "what file name should your saved game have?": it can actually be quite useful to be able to include such answers in test script files. (When running a long script, I often save the game at several places during it, in order to save time in re-running passages.)</p>
</div>
<div class="paragraph">
<p>An interpreter should be able to write time delays (for timed input), accented characters or mouse clicks into stream 4 (i.e., to a script file). One possible style to record this information might be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    take lamp              an ordinary command
    turn it on.[154]       command, full stop, then keypad 9
                           (which might abbreviate for NE)
    look unde[0]           timed out input
    look under the rock    the same input continuing
    [254][10][6]           mouse-click at (10,6)</pre>
</div>
</div>
<div class="paragraph">
<p>A typical auxiliary file might be one containing the player&#8217;s preferred choices. This would be created when he first changed any of the default settings, and loaded (if present) whenever the game started up.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.8"><a class="anchor" href="#ch.8"></a>8. The screen model</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s8.1"><a class="anchor" href="#s8.1"></a>8.1. Fonts</h3>
<div class="paragraph">
<p>Text may be printed in any font of the interpreter&#8217;s choice, variable- or fixed-pitch: except that when bit 1 of 'Flags 2' in the header is set, font 4 has been selected, or when the text style has been set to Fixed Pitch, then a fixed-pitch font must be used. The fixed pitch-bit is deprecated in Version 5 and later, and interpreter support in Version 6 is optional.</p>
</div>
<div id="p8.1.1" class="paragraph">
<p><span class="red">§8.1.1.</span>
In Version 5, the height and width of the current font (in units (see below)) should be written to bytes <strong>$27</strong> and <strong>$26</strong> of the header, respectively. In Version 6, these bytes are the other way round (height in <strong>$27</strong>, width in <strong>$26</strong>). The width of a font is defined as the width of its '0' character.</p>
</div>
<div id="p8.1.2" class="paragraph">
<p><span class="red">§8.1.2.</span>
An interpreter should ideally provide 4 fonts, with ID numbers as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   1: the normal font
   2: a picture font
   3: a character graphics font
   4: a Courier-style font with fixed pitch</pre>
</div>
</div>
<div class="paragraph">
<p>(Selecting font ID 0 is legal, and does not change the current font.) Ideally all text styles should be available for each font (for instance, Courier bold should be obtainable) except that font 3 need only be available in Roman and Reverse Video. Each font should provide characters for character codes 32 to 126 (plus character codes for any accented characters with codes greater than 127 which are being implemented as single accented letters on-screen).</p>
</div>
<div id="p8.1.3" class="paragraph">
<p><span class="red">§8.1.3.</span>
<strong><strong>*[1.0]</strong> A game must not use fonts other than 1 unless allowed to by the interpreter: see the <strong>set_font</strong> opcode for how to give or refuse permission. (This paragraph is marked </strong><strong>*[1.0]</strong> because existing Infocom games determined the availability of font 3 for 'Beyond Zork' in a complicated and unsatisfactory way: see <strong>S</strong> 16.)</p>
</div>
<div id="p8.1.3.1" class="paragraph">
<p><span class="red">§8.1.3.1.</span>
<strong>*</strong>*[1.0]* It is legal for a game to change font at any time, including halfway through the printing of a word. (This might be needed to introduce exotic foreign accents in the future.)</p>
</div>
<div id="p8.1.4" class="paragraph">
<p><span class="red">§8.1.4.</span>
The specification of the "picture font" is unknown (conjecturally, it was intended to provide pictures before Version 6 was properly developed). Interpreters should not implement it, and should refuse permission to any game requesting it.</p>
</div>
<div id="p8.1.5" class="paragraph">
<p><span class="red">§8.1.5.</span>
The specification of the character graphics font is given in <strong>S</strong> 16.</p>
</div>
<div id="p8.1.5.1" class="paragraph">
<p><span class="red">§8.1.5.1.</span>
In Version 5 (only), an interpreter which cannot provide the character graphics font should clear bit 3 of 'Flags 2' in the header.</p>
</div>
<div id="p8.1.6" class="paragraph">
<p><span class="red">§8.1.6.</span>
Any new fonts will have numbers higher than 4. Fonts 5-1023 are reserved for future Standards to specify. Local use may be made of higher font numbers.</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.2"><a class="anchor" href="#s8.2"></a>8.2. Status line</h3>
<div class="paragraph">
<p>In Versions 1 to 3, a status line should be printed by the interpreter, as follows. In Version 3, it must set bit 4 of 'Flags 1' in the header if it is unable to produce a status line.</p>
</div>
<div id="p8.2.1" class="paragraph">
<p><span class="red">§8.2.1.</span>
In Versions 1 and 2, all games are "score games". In Version 3, if bit 1 of 'Flags 1' is clear then the game is a "score game"; if it is set, then the game is a "time game".</p>
</div>
<div id="p8.2.2" class="paragraph">
<p><span class="red">§8.2.2.</span>
The short name of the object whose number is in the first global variable should be printed on the left hand side of the line.</p>
</div>
<div id="p8.2.2.1" class="paragraph">
<p><span class="red">§8.2.2.1.</span>
Whenever the status line is being printed the first global must contain a valid object number. (It would be useful if interpreters could protect themselves in case the game accidentally violates this requirement.)</p>
</div>
<div id="p8.2.2.2" class="paragraph">
<p><span class="red">§8.2.2.2.</span>
If the object&#8217;s short name exceeds the available room on the status line, the author suggests that an interpreter should break it at the last space and append an ellipsis "&#8230;&#8203;". There is no guaranteed maximum length for location names but an interpreter should expect names of length up to at least 49 characters.</p>
</div>
<div id="p8.2.3" class="paragraph">
<p><span class="red">§8.2.3.</span>
If there is room, the right hand side of the status line should display:</p>
</div>
<div id="p8.2.3.1" class="paragraph">
<p><span class="red">§8.2.3.1.</span>
For "score games": the score and number of turns, held in the values of the second and third global variables respectively. The score may be assumed to be in the range -99 to 999 inclusive, and the turn number in the range 0 to 9999.</p>
</div>
<div id="p8.2.3.2" class="paragraph">
<p><span class="red">§8.2.3.2.</span>
For "time games": the time, in the form <strong>hours:minutes</strong> (held in the second and third globals). The time may be given on a 24-hour clock or the number of hours may be reduced modulo 12 (but if so, "AM" or "PM" should be appended). Either way the player should be able to see the difference between 4am and 4pm, for example. The hours global may be assumed to be in the range 0 to 23 and the minutes global in the range 0 to 59.</p>
</div>
<div id="p8.2.4" class="paragraph">
<p><span class="red">§8.2.4.</span>
The status line is updated in exactly two circumstances: when a <strong>show_status</strong> opcode is executed, and just before the keyboard is read by <strong>read</strong>. (It is not displayed when the game begins.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.3"><a class="anchor" href="#s8.3"></a>8.3. Text colours</h3>
<div class="paragraph">
<p>Under Versions 5 and later, text printing has a current foreground and background colour. In Version 6, each window has its own pair. (Note that a Version 6 interpreter going under the Amiga interpreter number must use the same pair of colours for all windows when running Infocom&#8217;s games. If either is changed, then the interpreter must change the colour of all text on the screen to match. This simulates the Amiga hardware, which used two logical colours for text and switched palette to change their physical colour. This behaviour should not occur when running non-Infocom games, and modern games should never expect it. An interpreter that does not wish to handle this behaviour at all should avoid using the Amiga interpreter number when running Infocom&#8217;s Version 6 games.)</p>
</div>
<div id="p8.3.1" class="paragraph">
<p><span class="red">§8.3.1.</span>
The following codes are used to refer to colours:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> -1 = the colour of the pixel under the cursor (if any) (true -3) [V6 only]
  0 = current     (true -2)
  1 = default     (true -1)
  2 = black       (true $0000, $$0000000000000000)
  3 = red         (true $001D, $$0000000000011101)
  4 = green       (true $0340, $$0000001101000000)
  5 = yellow      (true $03BD, $$0000001110111101)
  6 = blue        (true $59A0, $$0101100110100000)
  7 = magenta     (true $7C1F, $$0111110000011111)
  8 = cyan        (true $77A0, $$0111011110100000)
  9 = white       (true $7FFF, $$0111111111111111)
 10 = light grey  (true $5AD6, $$0101101011010110)
 11 = medium grey (true $4631, $$0100011000110001)
 12 = dark grey   (true $2D6B, $$0010110101101011)
 13  reserved
 14  reserved
 15 = transparent (true -4) [V6 only]</pre>
</div>
</div>
<div class="paragraph">
<p>Colours 10, 11, 12, 15 and -1 are available only in Version 6.</p>
</div>
<div id="p8.3.1.1" class="paragraph">
<p><span class="red">§8.3.1.1.</span>
<strong>*</strong>*[1.1]* The equivalences between the colour numbers and true colours are recommended. The interpreter may allow the user to change the mapping, but the given values should be the default. If necessary, the game can check what true colour is being used for a given colour number using window properties 17 and 18.</p>
</div>
<div class="paragraph">
<p>Interpreters may provide different colours (eg making colour 10 dark grey), but if and only if they can detect they are running an original Infocom story file.</p>
</div>
<div id="p8.3.2" class="paragraph">
<p><span class="red">§8.3.2.</span>
If the interpreter cannot produce colours, it should clear bit 0 of 'Flags 1' in the header. In Version 6 it should write colours 2 and 9 (black and white), either way round, into the default background and foreground colours in bytes <strong>$2c</strong> and <strong>$2d</strong> of the header.</p>
</div>
<div id="p8.3.3" class="paragraph">
<p><span class="red">§8.3.3.</span>
If the interpreter can produce colours, it should set bit 0 of 'Flags 1' in the header, and write its default background and foreground colours into bytes <strong>$2c</strong> and <strong>$2d</strong> of the header.</p>
</div>
<div id="p8.3.4" class="paragraph">
<p><span class="red">§8.3.4.</span>
If a game wishes to use colours, it should have bit 6 in 'Flags 2' set in its story file. (However, an interpreter should not rule out the use of colours just because this has not been done.)</p>
</div>
<div id="p8.3.5" class="paragraph">
<p><span class="red">§8.3.5.</span>
If a true colour, or an "under the cursor" colour has been requested by the game, then the foreground or background colour shown in window property 11 is implementation defined, with two exceptions:</p>
</div>
<div id="p8.3.5.1" class="paragraph">
<p><span class="red">§8.3.5.1.</span>
If the colour selected was one of the standard set (2-15), then that colour is indicated in property 11.</p>
</div>
<div id="p8.3.5.2" class="paragraph">
<p><span class="red">§8.3.5.2.</span>
If the colour selected was not one of the standard set (this can happen when using graphics, which may use many more colours), the colour shown in property 11 will be &gt;= 16.</p>
</div>
<div id="p8.3.6" class="paragraph">
<p><span class="red">§8.3.6.</span>
<strong>*</strong>*[1.1]* In Version 6 only, colour 15 is defined as transparent. This is only valid as a background colour; an attempt to select it for the foreground should produce a diagnostic. Interpreters not supporting transparency must ignore any attempt to select colour 15.</p>
</div>
<div class="paragraph">
<p>If the current background colour is transparent, then printed text is superimposed on the current window contents, without filling the background behind the text. <strong>erase_window</strong>, <strong>erase_line</strong> and <strong>erase_picture</strong> become null operations. The intent is to make it possible to superimpose text on non-uniform images. Up until now, only uniform images could be satisfactorily written on by sampling the background colour - that in itself would be problematical if the interpreter used dithering.</p>
</div>
<div class="paragraph">
<p>Scrolling with the background set to transparent is not permitted, so transparent should only be requested in a non-scrolling window. It is not valid to use Reverse Video style with the background set to transparent. Instructions that prompt for user input, such as <strong>read</strong> and <strong>save</strong>, should beavoided when the background is set to transparent, as it will not generally be possible for text entry to take place satisfactorily in the absence of a defined background colour. Printing text multiple times on top itself with the background set to transparent should be avoided, as the interpreter may use anti-aliasing, resulting in the text getting progressively heavier.</p>
</div>
<div id="p8.3.7" class="paragraph">
<p><span class="red">§8.3.7.</span>
<strong>*</strong>*[1.1]* Standard 1.1 adds the ability for games to select many more colours with <strong>set_true_colour</strong>, which uses 15-bit RBG colour values, with the following special values:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> (-1) = default setting
 (-2) = current setting
 (-3) = colour under cursor (V6 only)
 (-4) = transparent (V6 only)</pre>
</div>
</div>
<div id="p8.3.7.1" class="paragraph">
<p><span class="red">§8.3.7.1.</span>
<strong>*</strong>*[1.1]* The interpreter selects the closest approximations available to the requested colours. In V6, the interpreter may store the approximations in window properties 16 and 17, so the program can tell how close it got (although it is acceptable for the interpreter to just store the requested value).</p>
</div>
<div class="paragraph">
<p>In the minimal implementation, interpreters just need to match to the closest of the standard colours and internally call <strong>set_colour</strong> (although that would have to ensure window properties 16 and 17 were updated). In a full implementation this would be turned around and <strong>set_colour</strong> would internally call <strong>set_true_colour</strong>.</p>
</div>
<div class="paragraph">
<p>True colour specifications are in the sRGB colour space, <strong>$0000</strong> being black and <strong>$7FFF</strong> being white. Colours should be gamma adjusted if necessary. See the <strong>PNG</strong> specification for a good introduction to colour spaces and gamma correction.</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.4"><a class="anchor" href="#s8.4"></a>8.4. Screen dimensions</h3>
<div class="paragraph">
<p>The screen should ideally be at least 60 characters wide by 14 lines deep. (Old Apple II interpreters had a 40 character width and some modern laptop ones have a 9 line height, but implementors should seek to avoid these extremes if possible.) The interpreter may change the exact dimensions whenever it likes but must write the current height (in lines) and width (in characters) into bytes <strong>$20</strong> and <strong>$21</strong> in the header.</p>
</div>
<div id="p8.4.1" class="paragraph">
<p><span class="red">§8.4.1.</span>
The interpreter should use the screen height for calculating when to pause and print "[MORE]". A screen height of 255 lines means "infinite height", in which case the interpreter should never stop printing for a "[MORE]" prompt. (In case, say, the screen is actually a teletype printer, or has very good "scrollback".)</p>
</div>
<div id="p8.4.2" class="paragraph">
<p><span class="red">§8.4.2.</span>
Screen dimensions are measured in notional "units". In Versions 1 to 4, one unit is simply the height or width of one character. In Version 5 and later, the interpreter is free to implement units as anything from character sizes down to individual pixels.</p>
</div>
<div id="p8.4.3" class="paragraph">
<p><span class="red">§8.4.3.</span>
In Version 5 and later, the screen&#8217;s width and height in units should be written to the words at <strong>$22</strong> and <strong>$24</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.5"><a class="anchor" href="#s8.5"></a>8.5. Screen model (V1, V2)</h3>
<div class="paragraph">
<p>The screen model for Versions 1 and 2 is as follows:</p>
</div>
<div id="p8.5.1" class="paragraph">
<p><span class="red">§8.5.1.</span>
The screen can only be printed to (like a teletype) and there is no control of the cursor.</p>
</div>
<div id="p8.5.2" class="paragraph">
<p><span class="red">§8.5.2.</span>
At the start of a game, the screen should be cleared and the text cursor placed at the bottom left (so that text scrolls upwards as the game gets under way).</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.6"><a class="anchor" href="#s8.6"></a>8.6. Screen model (V3)</h3>
<div class="paragraph">
<p>The screen model for Version 3 is as follows:</p>
</div>
<div id="p8.6.1" class="paragraph">
<p><span class="red">§8.6.1.</span>
The screen is divided into a lower and an upper window and at any given time one of these is selected. (Initially it is the lower window.) The game uses the <strong>set_window</strong> opcode to select one of the two. Each window has its own cursor position at which text is printed. Operations in the upper window do not move the cursor of the lower. Whenever the upper window is selected, its cursor position is reset to the top left. Selecting, or re-sizing, the upper window does not change the screen&#8217;s appearance.</p>
</div>
<div id="p8.6.1.1" class="paragraph">
<p><span class="red">§8.6.1.1.</span>
The upper window has variable height (of n lines) and the same width as the screen. This should be displayed on the n lines of the screen below the top one (which continues to hold the status line). Initially the upper window has height 0. When the lower window is selected, the game can split off an upper window of any chosen size by using the <strong>split_window</strong> opcode.</p>
</div>
<div id="p8.6.1.1.1" class="paragraph">
<p><span class="red">§8.6.1.1.1.</span>
Printing onto the upper window overlays whatever text is already there.</p>
</div>
<div id="p8.6.1.1.2" class="paragraph">
<p><span class="red">§8.6.1.1.2.</span>
When a screen split takes place in Version 3, the upper window is cleared.</p>
</div>
<div id="p8.6.1.2" class="paragraph">
<p><span class="red">§8.6.1.2.</span>
An interpreter need not provide the upper window at all. If it is going to do so, it should set bit 5 of 'Flags 1' in the header to signal this to the game. It is only legal for a game to use <strong>set_window</strong> or <strong>split_window</strong> if this bit has been set.</p>
</div>
<div id="p8.6.1.3" class="paragraph">
<p><span class="red">§8.6.1.3.</span>
Following a "restore" of the game, the interpreter should automatically collapse the upper window to size 0.</p>
</div>
<div id="p8.6.2" class="paragraph">
<p><span class="red">§8.6.2.</span>
When text reaches the bottom right of the lower window, it should be scrolled upwards. The upper window should never be scrolled: it is legal for a character to be printed on the bottom right position of the upper window (but the position of the cursor after this operation is undefined: the author suggests that it stay put).</p>
</div>
<div id="p8.6.3" class="paragraph">
<p><span class="red">§8.6.3.</span>
At the start of a game, the screen should be cleared and the text cursor placed at the bottom left (so that text scrolls upwards as the game gets under way).</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.7"><a class="anchor" href="#s8.7"></a>8.7. Screen model (V4, V5)</h3>
<div class="paragraph">
<p>The screen model for Versions 4 and later, except Version 6, is as follows:</p>
</div>
<div id="p8.7.1" class="paragraph">
<p><span class="red">§8.7.1.</span>
Text can be printed in five different styles (modelled on the VT100 design of terminal). These are: Roman (the default), Bold, Italic, Reverse Video (usually printed with foreground and background colours reversed) and Fixed Pitch. The specification does not require the interpreter to be able to display more than one of these at once (e.g. to combine italic and bold), and most interpreters can&#8217;t. If the interpreter is going to allow certain combinations, then note that changing back to Roman should turn off all the text styles currently active.</p>
</div>
<div id="p8.7.1.1" class="paragraph">
<p><span class="red">§8.7.1.1.</span>
An interpreter need not provide Bold or Italic (even for font 1) and is free to interpret them broadly. (For example, rendering bold-face by changing the colour, or rendering italic with underlining.)</p>
</div>
<div id="p8.7.1.2" class="paragraph">
<p><span class="red">§8.7.1.2.</span>
It is legal to change text style at any point, including in the middle of a word being printed.</p>
</div>
<div id="p8.7.1.3" class="paragraph">
<p><span class="red">§8.7.1.3.</span>
<strong>*</strong>*[1.1]* Although a story file can determine which individual styles are available by inspecting the header, this gives no indication of which styles can be combined. To improve this situation, at least for Version 6, Standard 1.1 requires window property 10 to show the actual style combination currently in use; with this a story file can probe for the availability of particular combinations.</p>
</div>
<div id="p8.7.2" class="paragraph">
<p><span class="red">§8.7.2.</span>
There are two "windows", called "upper" and "lower": at any given time one of these two is selected. (Initially it is the lower window.) The game uses the <strong>set_window</strong> opcode to select one of the two. Each window has its own cursor position at which text is printed. Operations in the upper window do not move the cursor of the lower. Whenever the upper window is selected, its cursor position is reset to the top left.</p>
</div>
<div id="p8.7.2.1" class="paragraph">
<p><span class="red">§8.7.2.1.</span>
The upper window has variable height (of n lines) and the same width as the screen. (It is usual for interpreters to print the upper window on the top n lines of the screen, overlaying any text which is already there, having been printed in the lower window some time ago.) Initially the upper window has height 0. When the lower window is selected, the game can split off an upper window of any chosen size by using the <strong>split_window</strong> opcode.</p>
</div>
<div id="p8.7.2.1.1" class="paragraph">
<p><span class="red">§8.7.2.1.1.</span>
It is unclear exactly what <strong>split_window</strong> should do if the upper window is currently selected. The author suggests that it should work as usual, leaving the cursor where it is if the cursor is still inside the new upper window, and otherwise moving the cursor back to the top left. (This is analogous to the Version 6 practice.)</p>
</div>
<div id="p8.7.2.2" class="paragraph">
<p><span class="red">§8.7.2.2.</span>
In Version 4, the lower window&#8217;s cursor is always on the bottom screen line. In Version 5 it can be at any line which is not underneath the upper window. If a split takes place which would cause the upper window to swallow the lower window&#8217;s cursor position, the interpreter should move the lower window&#8217;s cursor down to the line just below the upper window&#8217;s new size.</p>
</div>
<div id="p8.7.2.3" class="paragraph">
<p><span class="red">§8.7.2.3.</span>
When the upper window is selected, its cursor position can be moved with <strong>set_cursor</strong>. This position is given in characters in the form (row, column), with (1,1) at the top left. The opcode has no effect when the lower window is selected. It is illegal to move the cursor outside the current size of the upper window.</p>
</div>
<div id="p8.7.2.4" class="paragraph">
<p><span class="red">§8.7.2.4.</span>
An interpreter should use a fixed-pitch font when printing on the upper window.</p>
</div>
<div id="p8.7.2.5" class="paragraph">
<p><span class="red">§8.7.2.5.</span>
In Versions 3 to 5, text buffering is never active in the upper window (even if a game begins printing there without having turned it off).</p>
</div>
<div id="p8.7.3" class="paragraph">
<p><span class="red">§8.7.3.</span>
Clearing regions of the screen:</p>
</div>
<div id="p8.7.3.1" class="paragraph">
<p><span class="red">§8.7.3.1.</span>
When text reaches the bottom right of the lower window, it should be scrolled upwards. (When the text style is Reverse Video the new blank line should <strong>not</strong> have reversed colours.) The upper window should never be scrolled: it is legal for a character to be printed on the bottom right position of the upper window (but the position of the cursor after this operation is undefined: the author suggests that it stay put).</p>
</div>
<div id="p8.7.3.2" class="paragraph">
<p><span class="red">§8.7.3.2.</span>
Using the opcode <strong>erase_window</strong>, the specified window can be cleared to background colour. (Even if the text style is Reverse Video the new blank space should not have reversed colours.)</p>
</div>
<div id="p8.7.3.2.1" class="paragraph">
<p><span class="red">§8.7.3.2.1.</span>
In Versions 5 and later, the cursor for the window being erased should be moved to the top left. In Version 4, the lower window&#8217;s cursor moves to its bottom left, while the upper window&#8217;s cursor moves to top left.</p>
</div>
<div id="p8.7.3.3" class="paragraph">
<p><span class="red">§8.7.3.3.</span>
Erasing window -1 clears the whole screen to the background colour of the lower screen, collapses the upper window to height 0, moves the cursor of the lower screen to bottom left (in Version 4) or top left (in Versions 5 and later) and selects the lower screen. The same operation should happen at the start of a game.</p>
</div>
<div id="p8.7.3.4" class="paragraph">
<p><span class="red">§8.7.3.4.</span>
Using <strong>erase_line</strong> in the upper window should erase the current line from the cursor position to the right-hand edge, clearing it to background colour. (Even if the text style is Reverse Video the new blank space should not have reversed colours.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s8.8"><a class="anchor" href="#s8.8"></a>8.8. Screen model (V6)</h3>
<div class="paragraph">
<p>The screen model for Version 6 is as follows:</p>
</div>
<div id="p8.8.1" class="paragraph">
<p><span class="red">§8.8.1.</span>
The display is an array of pixels. Coordinates are usually given (in units) in the form (y,x), with (1,1) in the top left.</p>
</div>
<div id="p8.8.2" class="paragraph">
<p><span class="red">§8.8.2.</span>
If the interpreter thinks the screen should be redrawn (e.g. because a menu window has been clicked over it), it may set bit 2 of 'Flags 2'. The game is expected to notice, take action and clear the bit. (However, a more efficient interpreter would handle redraws itself.)</p>
</div>
<div id="p8.8.3" class="paragraph">
<p><span class="red">§8.8.3.</span>
There are eight "windows", numbered 0 to 7. The code -3 is used as a window number to mean "the currently selected window". This selection can be changed with the <strong>set_window</strong> opcode. Windows are invisible and usually lie on top of each other. All text and graphics plotting is always clipped to the current window, and anything showing through is plotted onto the screen. Subsequent movements of the window do not move what was printed and there is no sense in which characters or graphics 'belong' to any particular window once printed. Each window has a position (in units), a size (in units), a cursor position within it (in units, relative to its own origin), a number of flags called "attributes" and a number of variables called "properties".</p>
</div>
<div id="p8.8.3.1" class="paragraph">
<p><span class="red">§8.8.3.1.</span>
There are four attributes, numbered as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    0: wrapping
    1: scrolling
    2: text copied to output stream 2 (the transcript, if selected)
    3: buffered printing</pre>
</div>
</div>
<div class="paragraph">
<p>Each can be turned on or off, using the <strong>window_style</strong> opcode.</p>
</div>
<div id="p8.8.3.1.1" class="paragraph">
<p><span class="red">§8.8.3.1.1.</span>
"Wrapping" is the continuation of printed text from one line to the next. Text running up to the right margin will continue from the left margin of the following line. If "wrapping" is off then characters will be printed until no more can be fitted in without hitting the right margin, at which point the cursor will move to the right margin and stay there, so that any further text will be ignored.</p>
</div>
<div id="p8.8.3.1.2" class="paragraph">
<p><span class="red">§8.8.3.1.2.</span>
"Buffered printing" means that text to be printed in the window is temporarily stored in a buffer and only flushed onto the screen at intervals convenient for the interpreter.</p>
</div>
<div id="p8.8.3.1.2.1" class="paragraph">
<p><span class="red">§8.8.3.1.2.1.</span>
"Buffered printing" has two practical effects: firstly it causes a delay before printed text actually appears.</p>
</div>
<div id="p8.8.3.1.2.2" class="paragraph">
<p><span class="red">§8.8.3.1.2.2.</span>
Secondly it affects the way "wrapping" is done. If "buffered printing" is on, then text is wrapped after the last word which could fit on a line. If not, then text is wrapped after the last character that could fit.</p>
</div>
<div class="paragraph">
<p>Example: suppose the text "Here is an abacus" is printed in a narrow window. The appearance (after the buffer has been flushed, if there is buffered printing) might be:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>                                     |...margins....|
    wrapping on    buffering on       Here is an
                                      abacus^
             off   buffering on       Here is an aba^

    wrapping on    buffering off      Here is an aba
                                      cus^
             off   buffering off      Here is an aba^</pre>
</div>
</div>
<div class="paragraph">
<p>where the caret denotes the final position of the cursor. (Games often alter "wrapping": it would normally be on for a window holding running text but off for a status-line window, which is why window 0 has "wrapping" on by default but all other windows have "wrapping" off by default. On the other hand all windows have "buffered printing" on by default and games only alter this in rare circumstances to avoid delays in the appearance of individual printed characters.)</p>
</div>
<div id="p8.8.3.2" class="paragraph">
<p><span class="red">§8.8.3.2.</span>
There are 16 properties, numbered as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    0  y coordinate    6   left margin size            12  font number
    1  x coordinate    7   right margin size           13  font size
    2  y size          8   newline interrupt routine   14  attributes
    3  x size          9   interrupt countdown         15  line count
    4  y cursor        10  text style                  16 true foreground colour
    5  x cursor        11  colour data                 17 true background colour</pre>
</div>
</div>
<div class="paragraph">
<p>Each property is a standard Z-machine number and is readable with <strong>get_wind_prop</strong>. Properties 0 through 15 are writeable with <strong>put_wind_prop</strong>. However, a game should only use <strong>put_wind_prop</strong> to set the newline interrupt routine, the interrupt countdown and the line count: everything else is either set by the interpreter or by specialised opcodes (such as <strong>set_font</strong>). The true foreground and true background properties must not be written by put_wind_prop.</p>
</div>
<div id="p8.8.3.2.1" class="paragraph">
<p><span class="red">§8.8.3.2.1.</span>
If a window has character wrapping, then text is clipped to stay inside the left and right margins. After a new-line, the cursor moves to the left margin on the next line. Margins can be set with <strong>set_margins</strong> but this should only be done just after a newline or just after the window has been selected. (These values are margin sizes in pixels, and are by default 0.)</p>
</div>
<div id="p8.8.3.2.2" class="paragraph">
<p><span class="red">§8.8.3.2.2.</span>
If the interrupt countdown is set to a non-zero value (which by default it is not), then the line count is decremented on each new-line, and when it hits zero the routine whose packed address is stored in the "newline interrupt routine" property is called before text printing resumes. (This routine may, for example, meddle with margins to roll text around a crinkly-shaped picture.) The interrupt routine should not attempt to print anything.</p>
</div>
<div id="p8.8.3.2.2.1" class="paragraph">
<p><span class="red">§8.8.3.2.2.1.</span>
Because of an Infocom bug, if the interpreter number is 6 (for MSDOS) and the story file is 'Zork Zero' release 393.890714, but in no other case, the interpreter must do the following instead: (1) move to the new line, (2) put the cursor at the current left margin, (3) call the interrupt routine (if it&#8217;s time to do so). This is the least bad way to get around a basic inconsistency in existing Infocom story files and interpreters.</p>
</div>
<div id="p8.8.3.2.2.2" class="paragraph">
<p><span class="red">§8.8.3.2.2.2.</span>
Note that the <strong>set_margins</strong> opcode, which is often used by newline interrupt routines (to adjust the shape of a margin as it flows past a picture), automatically moves the cursor if the change in margins would leave the cursor outside them. The effect will depend, unfortunately, on which sequence of events above takes place.</p>
</div>
<div id="p8.8.3.2.2.3" class="paragraph">
<p><span class="red">§8.8.3.2.2.3.</span>
A line count is never decremented below -999.</p>
</div>
<div id="p8.8.3.2.3" class="paragraph">
<p><span class="red">§8.8.3.2.3.</span>
The text style is set just as in Version 4, using <strong>set_text_style</strong> (which sets that for the current window). The property holds the operand of that instruction (e.g. 4 for italic).</p>
</div>
<div id="p8.8.3.2.4" class="paragraph">
<p><span class="red">§8.8.3.2.4.</span>
The foreground colour is stored in the lower byte of the colour data property, the background colour in the upper byte.</p>
</div>
<div id="p8.8.3.2.5" class="paragraph">
<p><span class="red">§8.8.3.2.5.</span>
The font height (in pixels) is stored in the upper byte of the font size property, the font width (in pixels) in the lower byte.</p>
</div>
<div id="p8.8.3.2.6" class="paragraph">
<p><span class="red">§8.8.3.2.6.</span>
The interpreter should use the line count to see when it should print "[MORE]". A line count of -999 means "never print [MORE]". (Version 6 games often set line counts to manipulate when "[MORE]" is printed.)</p>
</div>
<div id="p8.8.3.2.7" class="paragraph">
<p><span class="red">§8.8.3.2.7.</span>
If an attempt is made by the game to read the cursor position at a time when text is held unprinted in a buffer, then this text should be flushed first, to ensure that the cursor position is accurate before being read.</p>
</div>
<div id="p8.8.3.2.8" class="paragraph">
<p><span class="red">§8.8.3.2.8.</span>
<strong>*</strong>*[1.1]* The true foreground and background colours show the actual colour being used for the foreground and background, whether it was set using <strong>set_colour</strong> or <strong>set_true_colour</strong>. Transparent is indicated as -4. If the colour was sampled from a picture then the value shown may be a 15-bit rounding of a more precise colour, leading to a slight inaccuracy if the colour is read and then written back.</p>
</div>
<div id="p8.8.3.3" class="paragraph">
<p><span class="red">§8.8.3.3.</span>
All eight windows begin at (1,1). Window 0 occupies the whole screen and is initially selected. Window 1 is as wide as the screen but has zero height. Windows 2 to 7 have zero width and height. Window 0 initially has attribute 1 off and 2, 3 and 4 on (scrolling, copy to printer transcript, buffering). Windows 1 to 7 initially have attribute 4 (buffering) on, and the other attributes off.</p>
</div>
<div id="p8.8.3.4" class="paragraph">
<p><span class="red">§8.8.3.4.</span>
A window can be moved with <strong>move_window</strong> and resized with <strong>window_size</strong>. If the window size is reduced so that its cursor lies outside it, the cursor should be reset to the left margin on the top line.</p>
</div>
<div id="p8.8.3.5" class="paragraph">
<p><span class="red">§8.8.3.5.</span>
Each window remembers its own cursor position (relative to its own coordinates, so that the position (1,1) is at its top left). These can be changed using <strong>set_cursor</strong> (and it is legal to move the cursor for an unselected window). It is illegal to move the cursor outside the current window.</p>
</div>
<div id="p8.8.3.6" class="paragraph">
<p><span class="red">§8.8.3.6.</span>
Each window can be scrolled vertically (up or down) any number of pixels, using the <strong>scroll_window</strong> opcode.</p>
</div>
<div id="p8.8.4" class="paragraph">
<p><span class="red">§8.8.4.</span>
To some extent windows 0 and 1 mimic the behaviour of the lower and upper windows in the Version 4 screen model:</p>
</div>
<div id="p8.8.4.1" class="paragraph">
<p><span class="red">§8.8.4.1.</span>
The <strong>split_screen</strong> opcode tiles windows 0 and 1 together to fill the screen, so that window 1 has the given height and is placed at the top left, while window 0 is placed just below it (with its height suitably shortened, possibly making it disappear altogether if window 1 occupies the whole screen).</p>
</div>
<div id="p8.8.4.2" class="paragraph">
<p><span class="red">§8.8.4.2.</span>
An "unsplit" (that is, a <strong>split_screen 0</strong>) takes place when the entire screen is cleared with <strong>erase_window -1</strong>, if a "split" has previously occurred (meaning that windows 0 and 1 have been set up as above).</p>
</div>
<div id="p8.8.5" class="paragraph">
<p><span class="red">§8.8.5.</span>
Screen clearing operations:</p>
</div>
<div id="p8.8.5.1" class="paragraph">
<p><span class="red">§8.8.5.1.</span>
Erasing a picture is like drawing it (see below), except that the space where it would appear is painted over with background colour instead.</p>
</div>
<div id="p8.8.5.2" class="paragraph">
<p><span class="red">§8.8.5.2.</span>
The current line can be erased using <strong>erase_line</strong>, either all the way to the right margin or by any positive number of pixels in that direction. The space is painted over with background colour (even if the current text style is Reverse Video).</p>
</div>
<div id="p8.8.5.3" class="paragraph">
<p><span class="red">§8.8.5.3.</span>
Each window can be erased using <strong>erase_window</strong>, erasing to background colour (even if the current text style is Reverse Video).</p>
</div>
<div id="p8.8.5.3.1" class="paragraph">
<p><span class="red">§8.8.5.3.1.</span>
Erasing window number -1 erases the entire screen to the background colour of window 0, unsplits windows 0 and 1 (see <strong>S</strong> 8.7.3.3 above) and selects window 0.</p>
</div>
<div id="p8.8.5.3.2" class="paragraph">
<p><span class="red">§8.8.5.3.2.</span>
Erasing window -2 erases the entire screen to the current background colour. (It doesn&#8217;t perform <strong>erase_window</strong> for all the individual windows, and it doesn&#8217;t change any window attributes or cursor positions.)</p>
</div>
<div id="p8.8.6" class="paragraph">
<p><span class="red">§8.8.6.</span>
Pictures may accompany the game. They are not stored in the story file (or the Z-machine) itself, and the interpreter is simply expected to know where to find them.</p>
</div>
<div id="p8.8.6.1" class="paragraph">
<p><span class="red">§8.8.6.1.</span>
Pictures are numbered from 1 upwards (not necessarily contiguously). They can be "drawn" or "erased" (using <strong>draw_picture</strong> and <strong>erase_picture</strong>). Before attempting to do so, a game may ask the interpreter about the picture (using <strong>picture_data</strong>): this allows the interpreter to signal that the picture in question is unavailable, or to specify its height and width.</p>
</div>
<div id="p8.8.6.2" class="paragraph">
<p><span class="red">§8.8.6.2.</span>
The game may, if it wishes, use the <strong>picture_table</strong> opcode to give the interpreter advance warning that a group of pictures will soon be needed (for instance, a collection of icons making up a control panel). The interpreter may want to load these pictures off disc and into a memory cache.</p>
</div>
<div id="p8.8.7" class="paragraph">
<p><span class="red">§8.8.7.</span>
<strong>*</strong>*[1.1]* Interpreters may use a backing store to store the Z-machine screen state, rather than plotting directly to the screen. This would normally be the case in a windowed operating system environment. If a backing store is in use, display changes executed by the Z-machine may not be immediately made visible to the user. Standard 1.1 adds the new opcode <strong>buffer_screen</strong> to Version 6 to control screen updates. An interpreter is free to ignore the opcode if it doesn&#8217;t fit its display model (in which case it must act as if <strong>buffer_screen</strong> is always set to 0).</p>
</div>
<div id="p8.8.7.1" class="paragraph">
<p><span class="red">§8.8.7.1.</span>
<strong>*</strong>*[1.1]* When <strong>buffer_screen</strong> is set to 0 (the default), all display changes are expected to become visible to the user either immediately, or within a short period of time, at the interpreter&#8217;s discretion. At a minimum, all updates become visible before waiting for input. Any intermediate display states between input requests may not be seen; for example when printing a large amount of new text into a scrolling window, all the intermediate scroll positions may or may not be shown.</p>
</div>
<div class="paragraph">
<p>When <strong>buffer_screen</strong> is set to 1, the interpreter need not change the visible display at all. Any display changes can be done purely in the backing store. A program may set <strong>buffer_screen</strong> to 1 before carrying out a complex layered graphical composition, to indicate that the intermediate states are not worth showing. It would be extremely ill-advised to prompt for input with <strong>buffer_screen</strong> set to 1.</p>
</div>
<div class="paragraph">
<p>When <strong>buffer_screen</strong> is set back to 0, the display is not necessarily updated immediately. If this is required, the game must request it seperately (see <strong>S</strong> 8.8.7.2 below).</p>
</div>
<div id="p8.8.7.2" class="paragraph">
<p><span class="red">§8.8.7.2.</span>
<strong>*</strong>*[1.1]* With buffer_screen in either state, an update of the visible display can be forced immediately by issuing <strong>buffer_screen</strong> -1, without altering the current buffering state. Note that <strong>buffer_screen</strong> -1 does not flush the text buffer.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-08"><a class="anchor" href="#remarks-08"></a>Remarks</h3>
<div class="paragraph">
<p>See <strong>S</strong> 16 for comment on how 'Beyond Zork' uses fonts.</p>
</div>
<div class="paragraph">
<p>Some interpreters print the status line when they begin running a Version 3 game, but this is incorrect. (It means that a small game printing text and then quitting cannot be run unless it includes an object.) The author&#8217;s preferred status line formats are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Hall of Mists                                 80/733
Lincoln Memorial                              12:03 PM</pre>
</div>
</div>
<div class="paragraph">
<p>Thus the score/turns block always fits in 3+1+4=8 characters and the time in 2+1+2+1+2=8 characters. (Games needing more exotic time lines, for example, should not be written in Version 3.)</p>
</div>
<div class="paragraph">
<p>The only existing Version 3 game to use an upper window is 'Seastalker' (for its sonarscope display).</p>
</div>
<div class="paragraph">
<p>Some ports of <strong>ITF</strong> apply buffering (i.e. word-wrapping) and scrolling to the upper window, with unfortunate consequences. This is why the standard Inform status line is one character short of the width of the screen.</p>
</div>
<div class="paragraph">
<p>The original Infocom files seldom use <strong>erase_window</strong>, except with window -1 (for instance 'Trinity' only uses it in this form). <strong>ITF</strong> does not implement it in any other case.</p>
</div>
<div class="paragraph">
<p>The Version 5 re-releases of older games make use of consecutive <strong>set_text_style</strong> instructions to attempt to combine boldface reverse video (in the hints system).</p>
</div>
<div class="paragraph">
<p>None of Infocom&#8217;s Version 4 or 5 files use <strong>erase_line</strong> at all, and <strong>ITF</strong> implements it badly (with unpredictable behaviour in Reverse Video text style). (It&#8217;s interesting to note that the Version 5 edition of 'Zork I' - one of the earliest Version 5 files&#8201;&#8212;&#8201;blanks out lines by looking up the screen width and printing that many spaces.)</p>
</div>
<div class="paragraph">
<p>It&#8217;s recommended that a Version 5 interpreter always use units to correspond to characters: that is, characters occupy $1\times 1$ units. 'Beyond Zork' was written in the expectation that it could be using either 1x1 or 8x8, and contains correct code to calculate screen positions whatever units are used. (Infocom&#8217;s Version 5 interpreter for MSDOS could either run in a text mode, 1x1, or a graphics mode, 8x8.) However, the German translation of 'Zork I' contains incorrect code to calculate screen positions unless 1x1 units are used.</p>
</div>
<div class="paragraph">
<p>Note that a minor bug in <strong>Zip</strong> writes bytes <strong>$22</strong> to <strong>$25</strong> in the header as four values, giving the screen dimensions in the form left, right, top, bottom: provided units are characters (i.e. provided the font width and height are both 1) then since "left" and "top" are both 0, this bug has no effect.</p>
</div>
<div class="paragraph">
<p>Some details of the known IBM graphics files are given in Paul David Doherty&#8217;s "Infocom Fact Sheet". See also Mark Howell&#8217;s program "pix2gif", which extracts pictures to GIF files. (This is one of his "Ztools" programs.)</p>
</div>
<div class="paragraph">
<p>Although Version 6 graphics files are not specified here, and were released in several different formats by Infocom for different computers, a consensus seems to have emerged that the MCGA pictures are the ones to adopt (files with filenames <strong>*.MG1</strong>). These are visually identical to Amiga pictures (whose format has been deciphered by Mark Knibbs). However, some Version 6 story files were tailored to the interpreters they would run on, and use the pictures differently according to what they expect the pictures to be. (For instance, an Amiga-intended story file will use one big Amiga-format picture where an MSDOS-intended story file will use several smaller MCGA ones.)</p>
</div>
<div class="paragraph">
<p>The easiest option is to interpret only DOS-intended Version 6 story files and only MCGA pictures. But it may be helpful to examine the <strong>Frotz</strong> source code, as <strong>Frotz</strong> implements <strong>draw_picture</strong> and <strong>picture_data</strong> so that Amiga and Macintosh forms of Version 6 story files can also be used.</p>
</div>
<div class="paragraph">
<p>It is generally felt that newly-written graphical games should not imitate the old Infocom graphics formats, which are very awkward to construct and have been overtaken by technology. Instead, the <strong>Blorb</strong> proposal for packaging up resources with Z-machine games calls for PNG format graphics glued together in a fairly simple way. The graphics for Infocom&#8217;s Version 6 games have been made available in <strong>Blorb</strong> format, so that understanding Infocom&#8217;s picture-sets is no longer very useful.</p>
</div>
<div class="paragraph">
<p>The line count of -999 preventing "[MORE]" is a device used by the demonstration mode of 'Zork Zero'.</p>
</div>
<div class="paragraph">
<p>Interpreter authors are advised that all 8 windows in Version 6 must be treated identically. The only ways in which they are distinguished are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Different default positions + sizes</p>
</li>
<li>
<p>Different default attributes</p>
</li>
<li>
<p><strong>split_window</strong> manipulates windows 0 and 1 specifically</p>
</li>
<li>
<p>Window 1 is the default mouse window</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Differences in interpreter behaviour must only arise from differences in window attributes and properties.</p>
</div>
<div class="paragraph">
<p>In V6, it is legal to position the cursor up against the right or bottom of a window - eg at (1,1) in a zero-sized window or at (641,401) in 640x400 window. Indeed, this is the default state of windows 1 to 7, and the cursor may be left at the right-hand side of a window when wrapping is off.</p>
</div>
<div class="paragraph">
<p>Attempting to print text (including new-lines) when the cursor is fewer than font_height units from the bottom of the window results in undefined behaviour - this precludes any printing in windows less than font_height units high.</p>
</div>
<div class="paragraph">
<p>It is legal for interpreters to always show the same value in property 11 if a true or sampled colour is in use. As a result, story files cannot assume that setting a value that was read from property 11 will give the same colour, if <strong>set_colour</strong> -1 has been used in that window.</p>
</div>
<div class="paragraph">
<p>The same rules apply if an interpreter offers non-standard default colours although in this case it would be ill-advised to show the same colour numbers for foreground and background - unless they can be distinguished, non-standard default colours should probably not be offered.</p>
</div>
<div class="paragraph">
<p>If the interpreter offers a limited palette, then there is no problem, as it can be arranged for there to be fewer than 240 distinct non-standard colours. In an interpreter with a higher colour-depth, a good implementation would be to use colours 16-255 to represent the last 240 distinct non-standard colours used, re-using numbers after 240 colours have been used. This will minimize potential problems caused by non-standard colours, particularly when set as defaults.</p>
</div>
<div class="paragraph">
<p>Regardless of the limitations on colour numbers, in Version 6 each window must remember accurately the colour pair selected, so it is preserved across window switches.</p>
</div>
<hr>
<div class="paragraph">
<p><strong>S</strong> 8.7.2.3 states that it is illegal to move the cursor outside the current size of the upper window. <strong>S</strong> 8.8.3.5 gives the equivalent rule for Version 6.</p>
</div>
<div class="paragraph">
<p>Many modern games have been lax in obeying this rule; in particular some of the standard Inform menu libraries have violated it. Infocom&#8217;s Sherlock also miscalculated the size of the upper window to use for box quotes.</p>
</div>
<div class="paragraph">
<p>It is recommended that if the cursor is moved below the split position in V4/V5, interpreters should execute an implicit "split_window" to contain the requested cursor position, if possible. Diagnostics should be produced, but should be suppressable.</p>
</div>
<hr>
<div class="paragraph">
<p>Some modern Z-Machine interpeters (mainly those using Andrew Plotkin&#8217;s <strong>Glk</strong> interface standard) use a seperate text windows for the status line. While this is not Standard behaviour, it largely causes no problems. However Trinity, and many more recent Inform games, print quote boxes using a technique that is not compatible with this implementation.</p>
</div>
<div class="paragraph">
<p>Andrew Plotkin has written up some <a href="http://eblong.com/zarf/glk/quote-box.html">notes</a> on the issue, including a workaround.</p>
</div>
<hr>
<div class="paragraph">
<p>Infocom&#8217;s Version 6 interpreters and story files disagree on the meaning of window attributes 0 and 3 and the opcode <strong>buffer_mode</strong>, in such a way that the original specification is hard to deduce from the final behaviour. If we call the three possible ways that text can appear "word wrap", "char wrap" and "char clip":</p>
</div>
<div class="literalblock">
<div class="content">
<pre>                   |...margins....|
    word wrap       Here is an
                    abacus^
    char wrap       Here is an aba
                    cus^
    char clip       Here is an aba^</pre>
</div>
</div>
<div class="paragraph">
<p>then Infocom&#8217;s interpreters behave as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>                  Apple II      MSDOS         Macintosh   Amiga
A0 off,  A3 off   char clip(LR) char clip()   ---         ---
A0 off,  A3 on    char clip(LR) char clip(LR) ---         ---
A0 on,   A3 off   word wrap     char wrap     ---         ---
A0 on,   A3 on    word wrap     word wrap     ---         ---
buffer_mode off   ---           ---           char wrap   char clip(L)
buffer_mode on    ---           ---           word wrap   word wrap</pre>
</div>
</div>
<div class="paragraph">
<p>Here "---" means that the interpreter ignores the given state, and the presence of L, R or both after "char clipp" indicates which of the left and right margins are respected. The Amiga behaviour may be due to a bug and two bugs have also been found in the MSDOS implementation. Under this standard, the appearance is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>                  Standard
A0 off,  A3 off   char clip(LR)
A0 off,  A3 on    char clip(LR)
A0 on,   A3 off   char wrap
A0 on,   A3 on    word wrap
buffer_mode off   ---
buffer_mode on    ---</pre>
</div>
</div>
<div class="paragraph">
<p>Due to a bug or an oversight, the V6 story files for all interpreters use <strong>buffer_mode</strong> once: to remove buffering while printing "Please wait&#8230;&#8203;" with a row of full stops trickling out during a slow operation. Buffering would frustrate this, but fortunately on modern computers the operation is no longer slow and so the bug does not cause trouble.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.9"><a class="anchor" href="#ch.9"></a>9. Sound effects</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s9.1"><a class="anchor" href="#s9.1"></a>9.1. Sound effects</h3>
<div class="paragraph">
<p>Some games, from Version 3 onward, have sound effects attached. These are not stored in the story files (or the Z-machine) itself, and the interpreter is simply expected to know where to find them. Other games have only one sound effect, usable in a much more restricted way: a beep or bell sound, which we shall call a "bleep".</p>
</div>
<div id="p9.1.1" class="paragraph">
<p><span class="red">§9.1.1.</span>
In Version 6, the interpreter should set bit 5 of 'Flags 1' if it can provide sound effects beyond a bleep.</p>
</div>
<div id="p9.1.2" class="paragraph">
<p><span class="red">§9.1.2.</span>
In Version 5 and later, a game should have bit 7 of 'Flags 2' set in its story file if it wants to use sound effects beyond a bleep. The interpreter should then clear this bit if it cannot oblige.</p>
</div>
</div>
<div class="sect2">
<h3 id="s9.2"><a class="anchor" href="#s9.2"></a>9.2. Numbering of</h3>
<div class="paragraph">
<p>Sound effects are numbered upwards from 1. Number 1 is a high-pitched bleep, number 2 a low-pitched one and effects from 3 upward are supplied by the interpreter somehow for the particular game in question.</p>
</div>
<div id="p9.2.1" class="paragraph">
<p><span class="red">§9.2.1.</span>
<strong>*</strong>*[1.1]* Aside from bleeps, there are two types of sound effect, samples and music. The game has no way of telling the type of a given sound effect.</p>
</div>
</div>
<div class="sect2">
<h3 id="s9.3"><a class="anchor" href="#s9.3"></a>9.3. Volume</h3>
<div class="paragraph">
<p>Sound effects (other than bleeps) can be played at any volume level from 1 to 8 (8 being loudest of these). The volume level -1 should be implemented as "loudest possible".</p>
</div>
</div>
<div class="sect2">
<h3 id="s9.4"><a class="anchor" href="#s9.4"></a>9.4. Sound playing autonymously</h3>
<div class="paragraph">
<p>Bleeps are immediate and brief. Other sound effects take place in the background, while normal operation of the Z-machine is going on. Control is via the <strong>sound_effect</strong> opcode, allowing the game to prepare, start, stop or finish with an effect.</p>
</div>
<div id="p9.4.1" class="paragraph">
<p><span class="red">§9.4.1.</span>
The game may (but need not) "prepare" a sound effect before use. This would indicate to the interpreter that the game intends to use the effect soon: an interpreter might act on this information by loading the sampled sound off disc and into a memory cache.</p>
</div>
<div id="p9.4.2" class="paragraph">
<p><span class="red">§9.4.2.</span>
<strong>*</strong>*[1.1]* A sound effect (other than a bleep) can then be "stopped" or "started". Only one sound effect of each type can play at any given time, so that starting a new music sound effect stops any current music playing, and starting any new sample sound effect stops any current sample sound playing. Samples and music do not interrupt each other.</p>
</div>
<div id="p9.4.3" class="paragraph">
<p><span class="red">§9.4.3.</span>
In Versions 5 and later, a sound effect may repeat any specified number of times, or repeat forever (until stopped).</p>
</div>
<div id="p9.4.4" class="paragraph">
<p><span class="red">§9.4.4.</span>
Eventually, though, if it has not been stopped, it may end by itself. A routine (specified at start time) can then be called. The intention is that this routine may implement effects such as fading in and out, by replaying the sound effect at a different volume. (A game should not place any important code in such a routine.) The routine is only called when the sound has played the requested number of times. If manually stopped or interrupted by another sound, the routine is not called.</p>
</div>
<div id="p9.4.5" class="paragraph">
<p><span class="red">§9.4.5.</span>
The game may, but need not, explicitly "finish with" any sound effect which is not likely to occur again for a while: the interpreter can then throw it out of memory.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-09"><a class="anchor" href="#remarks-09"></a>Remarks</h3>
<div class="paragraph">
<p>The safest way an Inform program can try to produce a bleep is by executing <strong>@sound_effect 1</strong>. Some ports of <strong>Zip</strong> believe that the first operand of this is the number of bleeps to make (so that <strong>@sound_effect 2</strong> bleeps twice), but this is incorrect.</p>
</div>
<div class="paragraph">
<p>Several Infocom games bleep (using <strong>sound_effect</strong> with only one operand, always equal to 1 or 2). Two provided sampled sound effects but did not bleep: 'The Lurking Horror' and 'Sherlock'. Their story files contain the following usages of <strong>sound_effect</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  sound_effect number 2 volume                   (in TLH)
  sound_effect number 2 volume/repeats function  (in Sherlock)
  sound_effect 0 3
  sound_effect number 3
  sound_effect 0 4</pre>
</div>
</div>
<div class="paragraph">
<p>except that, probably due to a bug in its own code, 'TLH' can also generate</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  sound_effect 4 8
  sound_effect 4095 2 15</pre>
</div>
</div>
<div class="paragraph">
<p>A further difficulty with 'TLH' is that it assumes the interpreter is as slow as Infocom&#8217;s Amiga interpreter was: it fires off several sound effects in one game round, assuming there will be time for it to play most of each one. To simulate this, <strong>sound_effect</strong> must be rewritten to pause sometimes:</p>
</div>
<div class="paragraph">
<p>if a new sample sound effect is begun while there is still one playing which was started since the last keyboard input, then wait until that earlier one finishes one cycle before replacing it with the new sound effect. Music sound effects are not affected by this. New music should interrupt old music immediately at all times.</p>
</div>
<div class="paragraph">
<p>Infocom&#8217;s MS-DOS interpreters for V4 to V6 set bit 5 of 'Flags 1' in all circumstances (i.e., whether or not sound effects are available). This would be incorrect behaviour for a standard interpreter.</p>
</div>
<div class="paragraph">
<p>Infocom implemented sound effects differently on different machines. The format of Infocom&#8217;s shipped sound effects files has been documented by Stefan Jokisch and his notes are available from <strong>www.ifarchive.org</strong>.</p>
</div>
<div class="paragraph">
<p>However, modern interpreters are strong encouraged to support Andrew Plotkin&#8217;s <strong>Blorb</strong> format, which is a more modern way to make sound effects available to newer games. Blorb files have been made available for the Infocom sound effects, so that modern interpreters need no longer support the Infocom format.</p>
</div>
<hr>
<div class="paragraph">
<p>When using Blorb resources, the default interpreter behaviour (unless over- ridden by the player) should be for samples played at maximum volume (64), in one channel of a SONG or MOD played at volume 8, to be of equal volume to samples played at maximum volume (8) as an effect. This will be the natural behaviour if effects use one physical channel and MODs/SONGs use four physical channels.</p>
</div>
<div class="paragraph">
<p>Ideally, a sound played at volume <em>n</em> in a SONG played at volume <em>m</em> should sound the same as when played as an effect at volume <em>n*m/64</em>. This mandates that the volume scale for effects be equivalent to the scale defined for samples in the MOD specification.</p>
</div>
<div class="paragraph">
<p>If multi-channel effects are used, the overall volume should be independent of the number of channels used in the sound. Thus a stereo AIFF containing the same samples for left and right should sound as loud as a mono AIFF containing the same data. This will need adjustment of volume if stereo AIFFs use two physical channels and mono AIFFs use one. No adjustment would be required if an interpreter reduced all AIFFs to mono.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.10"><a class="anchor" href="#ch.10"></a>10. Input streams and devices</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s10.1"><a class="anchor" href="#s10.1"></a>10.1. Keyboard only in V1</h3>
<div class="paragraph">
<p>In Versions 1 and 2, the player&#8217;s commands can only be drawn from the keyboard.</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.2"><a class="anchor" href="#s10.2"></a>10.2. Input streams</h3>
<div class="paragraph">
<p>In Versions 3 and later, the player&#8217;s keypresses are drawn from the current "input stream". There are two input streams: numbered 0 (the keyboard) and 1 (a file containing commands). Other inputs (mouse clicks or menu selections), if available, are also implemented as keypresses (see below).</p>
</div>
<div id="p10.2.1" class="paragraph">
<p><span class="red">§10.2.1.</span>
The format of a file containing commands must be the same as that written in output stream 4.</p>
</div>
<div id="p10.2.2" class="paragraph">
<p><span class="red">§10.2.2.</span>
The game can change the current input stream itself, using the opcode <strong>input_stream</strong>. It has no way of finding out which input stream is currently in use. An interpreter is free to change the input stream whenever it likes (e.g. at the player&#8217;s request) or, indeed, to run the entire game under input stream 1 (for testing purposes).</p>
</div>
<div id="p10.2.3" class="paragraph">
<p><span class="red">§10.2.3.</span>
When input stream 1 is first selected, the interpreter may use any method of choosing a file name for the file of commands. (Good practice is to use the same conventions as when choosing a filename for output to stream 4.)</p>
</div>
<div id="p10.2.4" class="paragraph">
<p><span class="red">§10.2.4.</span>
When the the current stream is stream 1, the interpreter should not hold up long passages of text (by printing "[MORE]" and waiting for a keypress, for instance).</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.3"><a class="anchor" href="#s10.3"></a>10.3. Mouse support</h3>
<div class="paragraph">
<p>Mouse support is optional but can be provided in Versions 5 and later.</p>
</div>
<div id="p10.3.1" class="paragraph">
<p><span class="red">§10.3.1.</span>
In a game which wishes to use the mouse, bit 5 of 'Flags 2' in the header should be set in the story file. If it wishes to read the mouse position after clicks, it must provide at least the first two words of a header extension table. (Note that Inform 6.12 and later always provide a header extension table at least this large, but Inform 6.11 and earlier never provide an extension table at all.)</p>
</div>
<div id="p10.3.1.1" class="paragraph">
<p><span class="red">§10.3.1.1.</span>
If the interpreter cannot offer mouse support, then it should clear bit 5 of 'Flags 2' to signal this to the game.</p>
</div>
<div id="p10.3.2" class="paragraph">
<p><span class="red">§10.3.2.</span>
Whenever a mouse click takes place (and provided the header extension table exists and contains at least 2 words) the interpreter should update the coordinates as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   Word 1:  x coordinate where click took place
   Word 2:  y coordinate where click took place</pre>
</div>
</div>
<div id="p10.3.3" class="paragraph">
<p><span class="red">§10.3.3.</span>
The mouse is presumed to have between 0 and 16 buttons. The state of these buttons can be read by the <strong>read_mouse</strong> opcode in Version 6. Otherwise, mouse clicks are treated as keyboard input codes (see below).</p>
</div>
<div id="p10.3.4" class="paragraph">
<p><span class="red">§10.3.4.</span>
In Version 6, the mouse can either be free or constrained to one of the 8 windows: if so, clicks outside the 'mouse window' must be ignored, and the interpreter is at liberty to confine the mouse&#8217;s movement to the boundary of its window.</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.4"><a class="anchor" href="#s10.4"></a>10.4. Menu support</h3>
<div class="paragraph">
<p>Menu support can optionally be provided in Version 6.</p>
</div>
<div id="p10.4.1" class="paragraph">
<p><span class="red">§10.4.1.</span>
In a game which wishes to use menus, bit 8 of 'Flags 2' in the header should be set in the story file.</p>
</div>
<div id="p10.4.1.1" class="paragraph">
<p><span class="red">§10.4.1.1.</span>
If the interpreter cannot offer menu support, then it should clear bit 8 of 'Flags 2' to signal this to the game.</p>
</div>
<div id="p10.4.2" class="paragraph">
<p><span class="red">§10.4.2.</span>
Menus are numbered from 0 upwards. 0, 1 and 2 are reserved for the interpreter to manage (this system has only been implemented on the Macintosh, wherein 0 is the Apple menu, 1 the File menu and 2 the Edit menu). Menus numbered 3 and upwards can be created or removed with the <strong>make_menu</strong> opcode.</p>
</div>
<div id="p10.4.3" class="paragraph">
<p><span class="red">§10.4.3.</span>
Menu selection is reported to the game as a keypress (see below). Details of what selection has been made are read with <strong>read_mouse</strong>.</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.5"><a class="anchor" href="#s10.5"></a>10.5. Terminating characters and timed input</h3>
<div class="paragraph">
<p>Whole commands are read from the input stream using the <strong>read</strong> opcode. (Note that this has two different internal names in Inform, <strong>sread</strong> for Versions 1 to 4 and <strong>aread</strong> subsequently.)</p>
</div>
<div id="p10.5.1" class="paragraph">
<p><span class="red">§10.5.1.</span>
In Versions 1 to 3, the interpreter must redisplay the status line before it begins accepting input.</p>
</div>
<div id="p10.5.2" class="paragraph">
<p><span class="red">§10.5.2.</span>
Commands are normally terminated by a new-line (a carriage return or a line feed as appropriate for the machine&#8217;s keyboard or file format).</p>
</div>
<div id="p10.5.2.1" class="paragraph">
<p><span class="red">§10.5.2.1.</span>
In Versions 5 and later, the game may provide a "terminating characters table" by giving its byte address in the word at <strong>$2e</strong> in the header. This table is a zero-terminated list of input character codes which cause <strong>aread</strong> to finish the command (in addition to new-line). Only function key codes are permitted: these are defined as those between 129 and 154 inclusive, together with 252, 253 and 254. The special value 255 means "any function key code is terminating".</p>
</div>
<div id="p10.5.3" class="paragraph">
<p><span class="red">§10.5.3.</span>
<strong>*</strong>*[1.0]* In Versions 4 and later, an interpreter should ideally be able to time input and to call a (game) routine at periodic intervals: see the <strong>read</strong> opcode. If it is able to do this, it should set bit 7 of 'Flags 1' in the header.</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.6"><a class="anchor" href="#s10.6"></a>10.6. Single keypresses</h3>
<div class="paragraph">
<p>In Versions 4 and later, individual characters can be read from the current input stream, using <strong>read_char</strong>. Again, the interpreter should ideally be able to time input and to call a (game) routine at periodic intervals. If it is able to do this, it should set bit 7 of 'Flags 1' in the header.</p>
</div>
</div>
<div class="sect2">
<h3 id="s10.7"><a class="anchor" href="#s10.7"></a>10.7. Reading ZSCII from the keyboard</h3>
<div class="paragraph">
<p>The only characters which can be read from the keyboard are ZSCII characters defined for input (see <strong>S</strong> 3).</p>
</div>
<div id="p10.7.1" class="paragraph">
<p><span class="red">§10.7.1.</span>
Every ZSCII character defined for input can be returned by <strong>read_char</strong>.</p>
</div>
<div id="p10.7.2" class="paragraph">
<p><span class="red">§10.7.2.</span>
Only ZSCII characters defined for both input and output can be stored in the text buffer supplied to the <strong>read</strong> opcode.</p>
</div>
<div id="p10.7.3" class="paragraph">
<p><span class="red">§10.7.3.</span>
The "escape" code is optional: that is, an interpreter need not provide an escape key. (The Inform library clears and quits menus if this code is returned to <strong>read_char</strong>.)</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-10"><a class="anchor" href="#remarks-10"></a>Remarks</h3>
<div class="paragraph">
<p>Menus in 'Beyond Zork' define cursor up and cursor down as terminating characters, and make use of <strong>read</strong> in the upper window.</p>
</div>
<div class="paragraph">
<p>Mouse co-ordinates, whether returned by <strong>read_mouse</strong> or written into the header during input, are always relative to the top of the display at (1,1), regardless of the position of the current mouse window.</p>
</div>
<div class="paragraph">
<p><strong>read_mouse</strong> is realtime. When called it must read the current mouse location, whether or not the mouse is inside the current mouse window. Interpreters are allowed to show positions and button states outside the Z-machine screen if the pointer is outside the interpreter&#8217;s own user interface (using negative values if needed).</p>
</div>
<div class="paragraph">
<p>Programs must be prepared to cope with this. For example in a painting program you might want to ignore all buttons down outside the screen. When dragging something you might want to keep trying to follow the pointer, even outside the screen, until the buttons are released.</p>
</div>
<div class="paragraph">
<p>Interpreters may constrain the pointer to the screen as long as buttons are held down - this might aid dragging operations - although this is not required.</p>
</div>
</div>
</div>
</div>
<h1 id="_tables" class="sect0"><a class="anchor" href="#_tables"></a>Tables</h1>
<div class="sect1">
<h2 id="ch.11"><a class="anchor" href="#ch.11"></a>11. The format of the header</h2>
<div class="sectionbody">
<div id="p11.1" class="paragraph">
<p><span class="red">§11.1.</span>
The header table summarises those locations in the Z-machine&#8217;s header which an interpreter must deal with. (For further notes on traditional usage, see <a href="#app.b">Appendix B</a>.) "Hex" means the address, in hexadecimal; "V" the earliest Version to which the rule is applicable; "Dyn" means that the byte or bit may legally be changed by the game during play; "Int" means that the interpreter may change it; "Rst" means that the interpreter must set it correctly after loading the game, after a restore or after a restart.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 4. <strong>Header format</strong></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hex</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>V</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Dyn</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Rst</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Contents</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version number (1 to 6)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 1 (in Versions 1 to 3):</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 1: Status line type: 0=score/turns, 1=hours:mins</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2: Story file split across two discs?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4: Status line not available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5: Screen-splitting available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6: Is a variable-pitch font the default?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 1 (from Version 4):</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0: Colours available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1: Picture displaying available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2: Boldface available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3: Italic available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4: Fixed-space style available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5: Sound effects available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>4</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7: Timed keyboard input available?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base of high memory (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Initial value of program counter (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Packed address of initial "main" routine</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of dictionary (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of object table (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of global variables table (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Base of static memory (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 2:</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>1</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 0: Set when transcripting is on</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>3</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1: Game sets to force printing in fixed-pitch font</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2: Int sets to request screen redraw: game clears when it complies with this.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3: If set, game wants to use pictures</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4: If set, game wants to use the UNDO opcodes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5: If set, game wants to use a mouse</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6: If set, game wants to use colours</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>5</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7: If set, game wants to use sound effects</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8: If set, game wants to use menus</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">(For bits 3,4,5,7 and 8, Int clears again if it cannot provide the requested effect.)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of abbreviations table (byte address)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3+</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Length of file (see note)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3+</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Checksum of file</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpreter number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Interpreter version</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Hex</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>V</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Dyn</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Rst</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Contents</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Screen height (lines): 255 means "infinite"</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Screen width (characters)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Screen width in units</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Screen height in units</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Font width in units (defined as width of a '0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Font height in units</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Font height in units</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Font width in units (defined as width of a '0')</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Routines offset (divided by 8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Static strings offset (divided by 8)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default background colour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default foreground colour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Address of terminating characters table (bytes)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">30</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Total width in pixels of text sent to output stream 3</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Standard revision number</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">34</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Alphabet table address (bytes), or 0 for default</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">36</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Header extension table address (bytes)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Some early Version 3 files do not contain length and checksum data, hence the notation <strong>3+</strong>.</p>
</div>
<div id="p11.1.1" class="paragraph">
<p><span class="red">§11.1.1.</span>
It is illegal for a game to alter those fields not marked as "Dyn". An interpreter is therefore free to store values of such fields in its own variables.</p>
</div>
<div id="p11.1.2" class="paragraph">
<p><span class="red">§11.1.2.</span>
The state of the transcription bit (bit 0 of Flags 2) can be changed directly by the game to turn transcribing on or off (see <strong>S</strong> 7.3, <strong>S</strong> 7.4). The interpreter must also alter it if stream 2 is turned on or off, to ensure that the bit always reflects the true state of transcribing. Note that the interpreter ensures that its value survives a restart or restore.</p>
</div>
<div id="p11.1.3" class="paragraph">
<p><span class="red">§11.1.3.</span>
Infocom used the interpreter numbers:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   1   DECSystem-20     5   Atari ST           9   Apple IIc
   2   Apple IIe        6   IBM PC            10   Apple IIgs
   3   Macintosh        7   Commodore 128     11   Tandy Color
   4   Amiga            8   Commodore 64</pre>
</div>
</div>
<div class="paragraph">
<p>(The DECSystem-20 was Infocom&#8217;s own in-house mainframe.) An interpreter should choose the interpreter number most suitable for the machine it will run on. In Versions up to 5, the main consideration is that the behaviour of 'Beyond Zork' depends on the interpreter number (in terms of its usage of the character graphics font). In Version 6, the decision is more serious, as existing Infocom story files depend on interpreter number in many ways: moreover, some story files expect to be run only on the interpreters for a particular machine. (There are, for instance, specifically Amiga versions.)</p>
</div>
<div id="p11.1.3.1" class="paragraph">
<p><span class="red">§11.1.3.1.</span>
Interpreter versions are conventionally ASCII codes for upper-case letters in Versions 4 and 5 (note that Infocom&#8217;s Version 6 interpreters just store numbers here).</p>
</div>
<div class="paragraph">
<p>Modern games are strongly discouraged from testing the interpreter number or interpreter version header information for any game-changing behaviour. It is rarely meaningful, and a Standard interpreter provides many better ways to query the interpreter for information.</p>
</div>
<div id="p11.1.4" class="paragraph">
<p><span class="red">§11.1.4.</span>
<strong>*</strong>*[1.0]* The use of bit 7 in 'Flags 1' to signal whether timed input is available was new in the 1.0 document: see the preface.</p>
</div>
<div id="p11.1.5" class="paragraph">
<p><span class="red">§11.1.5.</span>
<strong>*</strong>*[1.0]* If an interpreter obeys Revision <strong>n.m</strong> of this document <em>perfectly</em>, as far as anyone knows, then byte <strong>$32</strong> should be written with <strong>n</strong> and byte <strong>$33</strong> with <strong>m</strong>. If it is an earlier (non-standard) interpreter, it should leave these bytes as 0.</p>
</div>
<div id="p11.1.6" class="paragraph">
<p><span class="red">§11.1.6.</span>
The file length stored at <strong>$1a</strong> is actually divided by a constant, depending on the Version, to make it fit into a header word. This constant is 2 for Versions 1 to 3, 4 for Versions 4 to 5 or 8 for Versions 6 and later.</p>
</div>
<div id="p11.1.7" class="paragraph">
<p><span class="red">§11.1.7.</span>
The header extension table provides potentially unlimited room for further header information. It is a table of word entries, in which the initial word contains the number of words of data to follow.</p>
</div>
<div id="p11.1.7.1" class="paragraph">
<p><span class="red">§11.1.7.1.</span>
If the interpreter needs to read a word which is beyond the length of the extension table, or the extension table doesn&#8217;t exist at all, then the result is 0.</p>
</div>
<div id="p11.1.7.2" class="paragraph">
<p><span class="red">§11.1.7.2.</span>
If the interpreter needs to write a word which is beyond the length of the extension table, or the extension table doesn&#8217;t exist at all, then the result is that nothing happens.</p>
</div>
<div id="p11.1.7.3" class="paragraph">
<p><span class="red">§11.1.7.3.</span>
<strong>*</strong>*[1.0][1.1]* Words in the header extension table have been allocated as follows:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 5. <strong>Header extension format</strong></caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.667%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Word</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>V</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Dyn</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Int</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Rst</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>Contents</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of further words in table</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">X-coordinate of mouse after a click</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Y-coordinate of mouse after a click</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Unicode translation table address (optional)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 3:</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>6</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0: If set, game wants to use transparency</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True default foreground colour</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">True default background colour</p></td>
</tr>
</tbody>
</table>
<div id="p11.1.7.4" class="paragraph">
<p><span class="red">§11.1.7.4.</span>
<strong>*</strong>*[1.1]* The bits in Flags 3 are set by the game to request use of a feature. If the interpreter cannot provide a feature, it must clear the relevant bit.</p>
</div>
<div id="p11.1.7.4.1" class="paragraph">
<p><span class="red">§11.1.7.4.1.</span>
<strong>*</strong>*[1.1]* All unused bits in Flags 3 must be cleared by the interpreter.</p>
</div>
<div class="sect2">
<h3 id="remarks-11"><a class="anchor" href="#remarks-11"></a>Remarks</h3>
<div class="paragraph">
<p>In the Infocom period, the larger Version 3 story files would not entirely fit on a single Atari 800 disc (though they would fit on a single Apple II, or a single PC disc). Atari versions were therefore made which were identical to the normal ones except for having Flags 1 bit 2 set, and were divided into the resident part on one disc and the rest on another. (This discovery was announced by Stefan Jokisch on 26 August 1997 and sees the end of one of the very few Z-machine mysteries left when Standard 1.0 was first published.)</p>
</div>
<div class="paragraph">
<p>See the "Infocom fact sheet" for numbers and letters of the known interpreters shipped by Infocom. Interpreter versions are conventionally the upper case letters in sequence (A, B, C, &#8230;&#8203;). At present most ports of <strong>Zip</strong> use interpreter number 6, and most of <strong>ITF</strong> use number 2.</p>
</div>
<div class="paragraph">
<p>The unusual behaviour of 'Beyond Zork' concerns its character graphics: see the remarks to <strong>S</strong> 16.</p>
</div>
<div class="paragraph">
<p>The Macintosh story file for 'Zork Zero' erroneously does not set the pictures bit (Flags 2, bit 3).</p>
</div>
<div class="paragraph">
<p>The bit in the header described as "requesting screen redraw" may be set by modern interpreters after, for example, resizing the "screen"; games should ideally redraw the screen if they see this bit set. This will usually mean the game clears the screen contents and rearranges borders, etc, so the bit should not be set except when necessary.</p>
</div>
<div class="paragraph">
<p>The (Version 6) sound and picture bits in Flags 1 indicate general availability of sound and graphics - ie whether the associated opcodes are available and functional.</p>
</div>
<div class="paragraph">
<p>The bits in Flags 2 should ideally be set reflecting current availability, rather than general support. In other words, if no Blorb (or other) resources for this story file have been found, or if the Blorb file contains no graphics or no sound, the corresponding bits should be cleared.</p>
</div>
<div class="paragraph">
<p>Also, it is recommended that interpreters that would prompt for an auxiliary Blorb file should do so immediately on start up if any of the "game wants to use sound/music/graphics" bits are set; this allows the bits to be cleared if no file is forthcoming, before the game starts execution. The game can then take appropriate action.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.12"><a class="anchor" href="#ch.12"></a>12. The object table</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s12.1"><a class="anchor" href="#s12.1"></a>12.1. Storage</h3>
<div class="paragraph">
<p>The object table is held in dynamic memory and its byte address is stored in the word at <strong>$0a</strong> in the header. (Recall that objects have flags attached called attributes, numbered from 0 upward, and variables attached called properties, numbered from 1 upward. An object need not provide every property.)</p>
</div>
</div>
<div class="sect2">
<h3 id="s12.2"><a class="anchor" href="#s12.2"></a>12.2. Property defaults table</h3>
<div class="paragraph">
<p>The table begins with a block known as the property defaults table. This contains 31 words in Versions 1 to 3 and 63 in Versions 4 and later. When the game attempts to read the value of property n for an object which does not provide property n, the n-th entry in this table is the resulting value.</p>
</div>
</div>
<div class="sect2">
<h3 id="s12.3"><a class="anchor" href="#s12.3"></a>12.3. Object tree</h3>
<div class="paragraph">
<p>Next is the object tree. Objects are numbered consecutively from 1 upward, with object number 0 being used to mean "nothing" (though there is formally no such object). The table consists of a list of entries, one for each object.</p>
</div>
<div id="p12.3.1" class="paragraph">
<p><span class="red">§12.3.1.</span>
In Versions 1 to 3, there are at most 255 objects, each having a 9-byte entry as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   the 32 attribute flags     parent     sibling     child   properties
   ---32 bits in 4 bytes---   ---3 bytes------------------  ---2 bytes--</pre>
</div>
</div>
<div class="paragraph">
<p><strong>parent</strong>, <strong>sibling</strong> and <strong>child</strong> must all hold valid object numbers. The <strong>properties</strong> pointer is the byte address of the list of properties attached to the object. Attributes 0 to 31 are flags (at any given time, they are either on (1) or off (0)) and are stored topmost bit first: e.g., attribute 0 is stored in bit 7 of the first byte, attribute 31 is stored in bit 0 of the fourth.</p>
</div>
<div id="p12.3.2" class="paragraph">
<p><span class="red">§12.3.2.</span>
In Version 4 and later, there are at most 65535 objects, each having a 14-byte entry as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    the 48 attribute flags     parent    sibling   child     properties
   ---48 bits in 6 bytes---   ---3 words, i.e. 6 bytes----  ---2 bytes--</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="s12.4"><a class="anchor" href="#s12.4"></a>12.4. Property tables</h3>
<div class="paragraph">
<p>Each object has its own property table. Each of these can be anywhere in dynamic memory (indeed, a game can legally change an object&#8217;s properties table address in play, provided the new address points to another valid properties table). The header of a property table is as follows:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   text-length     text of short name of object
  -----byte----   --some even number of bytes---</pre>
</div>
</div>
<div class="paragraph">
<p>where the <strong>text-length</strong> is the number of 2-byte words making up the text, which is stored in the usual format. (This means that an object&#8217;s short name is limited to 765 Z-characters.) After the header, the properties are listed in descending numerical order. (This order is essential and is not a matter of convention.)</p>
</div>
<div id="p12.4.1" class="paragraph">
<p><span class="red">§12.4.1.</span>
In Versions 1 to 3, each property is stored as a block</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   size byte     the actual property data
                ---between 1 and 8 bytes--</pre>
</div>
</div>
<div class="paragraph">
<p>where the <strong>size byte</strong> is arranged as 32 times the number of data bytes minus one, plus the property number. A property list is terminated by a size byte of 0. (It is otherwise illegal for a size byte to be a multiple of 32.)</p>
</div>
<div id="p12.4.2" class="paragraph">
<p><span class="red">§12.4.2.</span>
In Versions 4 and later, a property block instead has the form</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   size and number       the actual property data
  --1 or 2 bytes---     --between 1 and 64 bytes--</pre>
</div>
</div>
<div class="paragraph">
<p>The property number occupies the bottom 6 bits of the first size byte.</p>
</div>
<div id="p12.4.2.1" class="paragraph">
<p><span class="red">§12.4.2.1.</span>
If the top bit (bit 7) of the first size byte is set, then there are two size-and-number bytes as follows. In the first byte, bits 0 to 5 contain the property number; bit 6 is undetermined (it is clear in all Infocom or Inform story files); bit 7 is set. In the second byte, bits 0 to 5 contain the property data length, counting in bytes; bit 6 is undetermined (it is set in Infocom story files, but clear in Inform ones); bit 7 is always set.</p>
</div>
<div id="p12.4.2.1.1" class="paragraph">
<p><span class="red">§12.4.2.1.1.</span>
<strong>*</strong>*[1.0]* A value of 0 as property data length (in the second byte) should be interpreted as a length of 64. (Inform can compile such properties.)</p>
</div>
<div id="p12.4.2.2" class="paragraph">
<p><span class="red">§12.4.2.2.</span>
If the top bit (bit 7) of the first size byte is clear, then there is only one size-and-number byte. Bits 0 to 5 contain the property number; bit 6 is either clear to indicate a property data length of 1, or set to indicate a length of 2; bit 7 is clear.</p>
</div>
</div>
<div class="sect2">
<h3 id="s12.5"><a class="anchor" href="#s12.5"></a>12.5. Well-foundedness of the tree</h3>
<div class="paragraph">
<p>It is the game&#8217;s responsibility to keep the object tree well-founded: the interpreter is not required to check. "Well-founded" means the following:</p>
</div>
<div class="paragraph">
<p><strong>(a)</strong> An object with a sibling also has a parent.</p>
</div>
<div class="paragraph">
<p><strong>(b)</strong> An object is the parent of exactly those objects in the sibling list of its child.</p>
</div>
<div class="paragraph">
<p><strong>(c)</strong> Each object can be given a level n, such that parentless objects have level 0 and all children of a level n object have level n+1.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-12"><a class="anchor" href="#remarks-12"></a>Remarks</h3>
<div class="paragraph">
<p>The largest valid object number is not directly stored anywhere in the Z-machine. Utility programs like <strong>Infodump</strong> deduce this number by assuming that, initially, the object entries end where the first property table begins.</p>
</div>
<div class="paragraph">
<p>Infocom&#8217;s 'Sherlock' contains a bug making it try to set and clear attribute 48.</p>
</div>
<div class="paragraph">
<p>The reason why the second property size byte needs to have top bit set is that the size field must be parsable either forwards or backwards&#8201;&#8212;&#8201;the Z-machine needs to be able to reconstruct the length of a property given only the address of the first byte of its data. (There are very many (e.g. 2000) property entries in a story file, so optimising size into one byte most of the time is worthwhile.)</p>
</div>
<div class="paragraph">
<p>Bit 6 in the second byte is presently wasted, which is a pity as it could be used to allow up to 128 bytes of property data. But such a change would cause Infocom&#8217;s story files to fail (since they set this bit, unlike Inform story files).</p>
</div>
<div class="paragraph">
<p>Inform can only construct well-founded object trees as the initial game state, but it is easy to compile sequences of code like "move red box to blue box" followed by "move blue box to red box" which leave the object tree in an ill-founded state. (The Inform library protects the standard object-movement verbs against this.)</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.13"><a class="anchor" href="#ch.13"></a>13. The dictionary and lexical analysis</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="s13.1"><a class="anchor" href="#s13.1"></a>13.1. Storage</h3>
<div class="paragraph">
<p>The dictionary table is held in static memory and its byte address is stored in the word at <strong>$08</strong> in the header.</p>
</div>
</div>
<div class="sect2">
<h3 id="s13.2"><a class="anchor" href="#s13.2"></a>13.2. Header</h3>
<div class="paragraph">
<p>The table begins with a short header:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>  n     list of keyboard input codes   entry-length  number-of-entries
 byte  ------n bytes-----------------      byte         2-byte word</pre>
</div>
</div>
<div class="paragraph">
<p>The keyboard input codes are "word-separators": typically (and under Inform mandatorily) these are the ZSCII codes for full stop, comma and double-quote. Note that a space character (32) should never be a word-separator. The "entry length" is the length of each word&#8217;s entry in the dictionary table. (It must be at least 4 in Versions 1 to 3, and at least 6 in later Versions.)</p>
</div>
<div id="p13.2.1" class="paragraph">
<p><span class="red">§13.2.1.</span>
Note that the word-separators table can only contain codes which are defined in ZSCII for both input and output.</p>
</div>
</div>
<div class="sect2">
<h3 id="s13.3"><a class="anchor" href="#s13.3"></a>13.3. Entries (V1 to V3)</h3>
<div class="paragraph">
<p>In Versions 1 to 3, each word has an entry in the form</p>
</div>
<div class="literalblock">
<div class="content">
<pre>   encoded text of word        bytes of data
  ------- 4 bytes ------   (entry length-4) bytes</pre>
</div>
</div>
<div class="paragraph">
<p>The interpreter ignores the bytes of data (presumably the game&#8217;s parser will use them). The encoded text contains 6 Z-characters (it is always padded out with Z-character 5&#8217;s to make up 4 bytes: see <strong>S</strong> 3). The text may include spaces or other word-separators (though, if so, the interpreter will never match any text to the dictionary word in question: surprisingly, this can be useful and is a trick used in the Inform library).</p>
</div>
</div>
<div class="sect2">
<h3 id="s13.4"><a class="anchor" href="#s13.4"></a>13.4. Entries (later versions)</h3>
<div class="paragraph">
<p>In Versions 4 and later, the encoded text has 6 bytes and always contains 9 Z-characters.</p>
</div>
</div>
<div class="sect2">
<h3 id="s13.5"><a class="anchor" href="#s13.5"></a>13.5. Ordering</h3>
<div class="paragraph">
<p>The word entries follow immediately after the dictionary header and must be given in numerical order of the encoded text (when the encoded text is regarded as a 32 or 48-bit binary number with most-significant byte first). It must not contain two entries with the same encoded text.</p>
</div>
</div>
<div class="sect2">
<h3 id="s13.6"><a class="anchor" href="#s13.6"></a>13.6. Lexical analysis</h3>
<div class="paragraph">
<p>Lexical analysis takes place in two circumstances: on request of a <strong>tokenise</strong> opcode (in which case it can use any dictionary table it likes, in the format above) and during acceptance of a game command (in which case the standard dictionary is used).</p>
</div>
<div id="p13.6.1" class="paragraph">
<p><span class="red">§13.6.1.</span>
First, the text is broken up into words. Spaces divide up words and are otherwise ignored. Word separators also divide words, but each one of them is considered a word in its own right. Thus, the erratically-spaced text "fred,go fishing" is divided into four words:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>fred / , / go / fishing</pre>
</div>
</div>
<div id="p13.6.2" class="paragraph">
<p><span class="red">§13.6.2.</span>
Each word is then encoded as a Z-machine string in dictionary form, and searched for in the dictionary.</p>
</div>
<div id="p13.6.3" class="paragraph">
<p><span class="red">§13.6.3.</span>
A "parse table" is then written, recording the number of words, the length and position of each word and the dictionary address of each word which is recognised. For the format, see the <strong>read</strong> opcode.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-13"><a class="anchor" href="#remarks-13"></a>Remarks</h3>
<div class="paragraph">
<p>Usually (under Inform, mandatorily) there are three bytes of data in the word entries, so that dictionary entry lengths are 7 and 9 in the early and late Z-machine, respectively.</p>
</div>
<div class="paragraph">
<p>It is essential that dictionary entries are in numerical order of the bytes of encrypted text so that interpreters can search the dictionary efficiently (e.g. by a binary-chop algorithm). Because the letters in A0 are in alphabetical order, because the bits are ordered in the right way and because the pad character 5 is less than the values for the letters, the numerical ordering corresponds to normal English alphabetical order for ordinary words. (For instance "an" comes before "anaconda".)</p>
</div>
<div class="paragraph">
<p>Both Infocom and Inform-compiled games contain words whose initial character is not a letter (for instance, "#record").</p>
</div>
<div class="paragraph">
<p>Linards Ticmanis reports that some of Infocom&#8217;s interpreters convert question marks to spaces before lexical analysis. This is <em>not</em> Standard behaviour. (Thus, typing "What is a grue?" into 'Zork I' no longer works: the player must type "What is a grue" instead.)</p>
</div>
</div>
</div>
</div>
<h1 id="_instruction_set" class="sect0"><a class="anchor" href="#_instruction_set"></a>Instruction Set</h1>
<div class="sect1">
<h2 id="ch.14"><a class="anchor" href="#ch.14"></a>14. Complete table of opcodes</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="#2OP">2OP</a> / <a href="#1OP">1OP</a> / <a href="#0OP">0OP</a> / <a href="#VAR">VAR</a> / <a href="#EXT">EXT</a></p>
</div>
<hr>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 6. Two-operand opcodes 2OP</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">St</th>
<th class="tableblock halign-center valign-middle">Br</th>
<th class="tableblock halign-center valign-middle">Opcode</th>
<th class="tableblock halign-center valign-middle">Hex</th>
<th class="tableblock halign-center valign-middle">V</th>
<th class="tableblock halign-center valign-middle">Inform name and syntax</th>
<th class="tableblock halign-center valign-middle">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:1</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>je a b ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#je"><strong>je</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:2</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>jl a b ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#jl"><strong>jl</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:3</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>jg a b ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#jg"><strong>jg</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:4</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>dec_chk (variable) value ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#dec_chk"><strong>dec_chk</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:5</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>inc_chk (variable) value ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#inc_chk"><strong>inc_chk</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:6</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>jin obj1 obj2 ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#jin"><strong>jin</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:7</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>test bitmap flags ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#test"><strong>test</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:8</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>or a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#or"><strong>or</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:9</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>and a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#and"><strong>and</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:10</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">A</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>test_attr object attribute ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#test_attr"><strong>test_attr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:11</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">B</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>set_attr object attribute</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#set_attr"><strong>set_attr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:12</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>clear_attr object attribute</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#clear_attr"><strong>clear_attr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:13</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>store (variable) value</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#store"><strong>store</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:14</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>insert_obj object destination</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#insert_obj"><strong>insert_obj</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:15</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>loadw array word-index &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#loadw"><strong>loadw</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:16</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">10</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>loadb array byte-index &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#loadb"><strong>loadb</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:17</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">11</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_prop object property &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_prop"><strong>get_prop</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:18</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">12</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_prop_addr object property &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_prop_addr"><strong>get_prop_addr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:19</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">13</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_next_prop object property &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_next_prop"><strong>get_next_prop</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:20</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">14</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>add a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#add"><strong>add</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:21</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">15</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>sub a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#sub"><strong>sub</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:22</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">16</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>mul a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#mul"><strong>mul</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:23</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">17</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>div a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#div"><strong>div</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:24</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">18</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>mod a b &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#mod"><strong>mod</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:25</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">19</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>call_2s routine arg1 &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#call_2s"><strong>call_2s</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:26</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1A</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>call_2n routine arg1</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#call_2n"><strong>call_2n</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"></td>
<td class="tableblock halign-center valign-middle" rowspan="2"></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock"><code>2OP:27</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">1B</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>set_colour foreground background</code></p></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock"><a href="sect15.html#set_colour"><strong>set_colour</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><code>set_colour foreground background window</code></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>2OP:28</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1C</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5/6</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>throw value stack-frame</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#throw"><strong>throw</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1D</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1E</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1F</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock">&#8201;&#8212;&#8201;</p></td>
<td class="tableblock halign-left valign-middle"></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" colspan="7"><p class="tableblock"><em>Opcode numbers 32 to 127: other forms of 2OP with different types.</em></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all fit-content">
<caption class="title">Table 7. One-operand opcodes 1OP</caption>
<colgroup>
<col>
<col>
<col>
<col>
<col>
<col>
<col>
</colgroup>
<thead>
<tr>
<th class="tableblock halign-center valign-middle">St</th>
<th class="tableblock halign-center valign-middle">Br</th>
<th class="tableblock halign-center valign-middle">Opcode</th>
<th class="tableblock halign-center valign-middle">Hex</th>
<th class="tableblock halign-center valign-middle">V</th>
<th class="tableblock halign-center valign-middle">Inform name and syntax</th>
<th class="tableblock halign-center valign-middle">Link</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:128</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">0</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>jz a ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#jz"><strong>jz</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:129</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_sibling object &#8594; (result) ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_sibling"><strong>get_sibling</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:130</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">2</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_child object &#8594; (result) ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_child"><strong>get_child</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:131</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">3</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_parent object &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_parent"><strong>get_parent</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:132</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>get_prop_len property-address &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#get_prop_len"><strong>get_prop_len</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:133</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>inc (variable)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#inc"><strong>inc</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:134</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">6</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>dec (variable)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#dec"><strong>dec</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:135</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">7</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>print_addr byte-address-of-string</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#print_addr"><strong>print_addr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:136</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">8</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>call_1s routine &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#call_1s"><strong>call_1s</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:137</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">9</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>remove_obj object</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#remove_obj"><strong>remove_obj</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:138</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">A</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>print_obj object</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#print_obj"><strong>print_obj</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:139</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">B</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>ret value</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#ret"><strong>ret</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:140</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">C</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>jump ?(label)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#jump"><strong>jump</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:141</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">D</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>print_paddr packed-address-of-string</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#print_paddr"><strong>print_paddr</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>1OP:142</code></p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">E</p></td>
<td class="tableblock halign-center valign-middle"></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>load (variable) &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#load"><strong>load</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock"><strong>*</strong></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"></td>
<td class="tableblock halign-left valign-middle" rowspan="2"><p class="tableblock"><code>1OP:143</code></p></td>
<td class="tableblock halign-center valign-middle" rowspan="2"><p class="tableblock">F</p></td>
<td class="tableblock halign-center valign-middle"><p class="tableblock">1/4</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>not value &#8594; (result)</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#not"><strong>not</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><code>call_1n routine</code></p></td>
<td class="tableblock halign-left valign-middle"><p class="tableblock"><a href="sect15.html#call_1n"><strong>call_1n</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-center valign-middle" colspan="7"><p class="tableblock"><em>Opcode numbers 144 to 175: other forms of 1OP with different types.</em></p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p><strong>Zero-operand opcodes 0OP</strong></p>
</div>
<div class="paragraph">
<p>St</p>
</div>
<div class="paragraph">
<p>Br</p>
</div>
<div class="paragraph">
<p>Opcode</p>
</div>
<div class="paragraph">
<p>Hex</p>
</div>
<div class="paragraph">
<p>V</p>
</div>
<div class="paragraph">
<p>Inform name and syntax</p>
</div>
<div class="paragraph">
<p>Link</p>
</div>
<div class="paragraph">
<p>0OP:176</p>
</div>
<div class="paragraph">
<p>0</p>
</div>
<div class="paragraph">
<p>rtrue</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#rtrue"><strong>rtrue</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:177</p>
</div>
<div class="paragraph">
<p>1</p>
</div>
<div class="paragraph">
<p>rfalse</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#rfalse"><strong>rfalse</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:178</p>
</div>
<div class="paragraph">
<p>2</p>
</div>
<div class="paragraph">
<p>print (literal-string)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#print"><strong>print</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:179</p>
</div>
<div class="paragraph">
<p>3</p>
</div>
<div class="paragraph">
<p>print_ret (literal-string)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#print_ret"><strong>print_ret</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:180</p>
</div>
<div class="paragraph">
<p>4</p>
</div>
<div class="paragraph">
<p>1/-</p>
</div>
<div class="paragraph">
<p>nop</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#nop"><strong>nop</strong></a></p>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>0OP:181</p>
</div>
<div class="paragraph">
<p>5</p>
</div>
<div class="paragraph">
<p>1</p>
</div>
<div class="paragraph">
<p>save ?(label)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#save"><strong>save</strong></a></p>
</div>
<div class="paragraph">
<p>4</p>
</div>
<div class="paragraph">
<p>save &#8594; (result)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#save"><strong>save</strong></a></p>
</div>
<div class="paragraph">
<p>5</p>
</div>
<div class="paragraph">
<p>[illegal]</p>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>0OP:182</p>
</div>
<div class="paragraph">
<p>6</p>
</div>
<div class="paragraph">
<p>1</p>
</div>
<div class="paragraph">
<p>restore ?(label)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#restore"><strong>restore</strong></a></p>
</div>
<div class="paragraph">
<p>4</p>
</div>
<div class="paragraph">
<p>restore &#8594; (result)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#restore"><strong>restore</strong></a></p>
</div>
<div class="paragraph">
<p>5</p>
</div>
<div class="paragraph">
<p>[illegal]</p>
</div>
<div class="paragraph">
<p>0OP:183</p>
</div>
<div class="paragraph">
<p>7</p>
</div>
<div class="paragraph">
<p>restart</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#restart"><strong>restart</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:184</p>
</div>
<div class="paragraph">
<p>8</p>
</div>
<div class="paragraph">
<p>ret_popped</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#ret_popped"><strong>ret_popped</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:185</p>
</div>
<div class="paragraph">
<p>9</p>
</div>
<div class="paragraph">
<p>1</p>
</div>
<div class="paragraph">
<p>pop</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#pop"><strong>pop</strong></a></p>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>5/6</p>
</div>
<div class="paragraph">
<p>catch &#8594; (result)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#catch"><strong>catch</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:186</p>
</div>
<div class="paragraph">
<p>A</p>
</div>
<div class="paragraph">
<p>quit</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#quit"><strong>quit</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:187</p>
</div>
<div class="paragraph">
<p>B</p>
</div>
<div class="paragraph">
<p>new_line</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#new_line"><strong>new_line</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:188</p>
</div>
<div class="paragraph">
<p>C</p>
</div>
<div class="paragraph">
<p>3</p>
</div>
<div class="paragraph">
<p>show_status</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#show_status"><strong>show_status</strong></a></p>
</div>
<div class="paragraph">
<p>4</p>
</div>
<div class="paragraph">
<p>[illegal]</p>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>0OP:189</p>
</div>
<div class="paragraph">
<p>D</p>
</div>
<div class="paragraph">
<p>3</p>
</div>
<div class="paragraph">
<p>verify ?(label)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#verify"><strong>verify</strong></a></p>
</div>
<div class="paragraph">
<p>0OP:190</p>
</div>
<div class="paragraph">
<p>E</p>
</div>
<div class="paragraph">
<p>5</p>
</div>
<div class="paragraph">
<p>[first byte of extended opcode]</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#extended"><strong>extended</strong></a></p>
</div>
<div class="paragraph">
<p>*</p>
</div>
<div class="paragraph">
<p>0OP:191</p>
</div>
<div class="paragraph">
<p>F</p>
</div>
<div class="paragraph">
<p>5/-</p>
</div>
<div class="paragraph">
<p>piracy ?(label)</p>
</div>
<div class="paragraph">
<p><a href="sect15.html#piracy"><strong>piracy</strong></a></p>
</div>
<div class="paragraph">
<p>Opcode numbers 192 to 223: VAR forms of 2OP:0 to 2OP:31.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 8. <strong>Variable-operand opcodes VAR</strong></caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">St</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Br</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inform name and syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:224</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call routine &#8230;&#8203;0 to 3 args&#8230;&#8203; &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#call"><strong>call</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call_vs routine &#8230;&#8203;0 to 3 args&#8230;&#8203; &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#call_vs"><strong>call_vs</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:225</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storew array word-index value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#storew"><strong>storew</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:226</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">storeb array byte-index value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#storeb"><strong>storeb</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:227</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put_prop object property value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#put_prop"><strong>put_prop</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:228</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sread text parse</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#sread"><strong>sread</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sread text parse time routine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#sread"><strong>sread</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">aread text parse time routine &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#aread"><strong>aread</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:229</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_char output-character-code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#print_char"><strong>print_char</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:230</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_num value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#print_num"><strong>print_num</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:231</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">random range &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#random"><strong>random</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:232</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">push value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#push"><strong>push</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:233</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pull (variable)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#pull"><strong>pull</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pull stack &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#pull"><strong>pull</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:234</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">split_window lines</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#split_window"><strong>split_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:235</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_window window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_window"><strong>set_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:236</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call_vs2 routine &#8230;&#8203;0 to 7 args&#8230;&#8203; &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#call_vs2"><strong>call_vs2</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:237</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">erase_window window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#erase_window"><strong>erase_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:238</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">erase_line value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#erase_line"><strong>erase_line</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">erase_line pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#erase_line"><strong>erase_line</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:239</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_cursor line column</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_cursor"><strong>set_cursor</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_cursor line column window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_cursor"><strong>set_cursor</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:240</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4/6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_cursor array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#get_cursor"><strong>get_cursor</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:241</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_text_style style</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_text_style"><strong>set_text_style</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:242</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer_mode flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#buffer_mode"><strong>buffer_mode</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:243</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">output_stream number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#output_stream"><strong>output_stream</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">output_stream number table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#output_stream"><strong>output_stream</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">output_stream number table width</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#output_stream"><strong>output_stream</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:244</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">input_stream number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#input_stream"><strong>input_stream</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:245</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">sound_effect number effect volume routine</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#sound_effect"><strong>sound_effect</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:246</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read_char 1 time routine &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#read_char"><strong>read_char</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:247</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scan_table x table len form &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#scan_table"><strong>scan_table</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:248</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">not value &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#not"><strong>not</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:249</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call_vn routine &#8230;&#8203;up to 3 args&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#call_vn"><strong>call_vn</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:250</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">call_vn2 routine &#8230;&#8203;up to 7 args&#8230;&#8203;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#call_vn2"><strong>call_vn2</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:251</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">tokenise text parse dictionary flag</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#tokenise"><strong>tokenise</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:252</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">encode_text zscii-text length from coded-text</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#encode_text"><strong>encode_text</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:253</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">copy_table first second size</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#copy_table"><strong>copy_table</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:254</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_table zscii-text width height skip</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#print_table"><strong>print_table</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">VAR:255</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">check_arg_count argument-number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#check_arg_count"><strong>check_arg_count</strong></a></p></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 9. <strong>Extended opcodes EXT</strong></caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2858%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">St</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Br</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Opcode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hex</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">V</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inform name and syntax</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Link</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save table bytes name prompt &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#save"><strong>save</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">restore table bytes name prompt &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#restore"><strong>restore</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">log_shift number places &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#log_shift"><strong>log_shift</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">art_shift number places &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#art_shift"><strong>art_shift</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_font font &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_font"><strong>set_font</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6/-</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_font font window &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_font"><strong>set_font</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">draw_picture picture-number y x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#draw_picture"><strong>draw_picture</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">picture_data picture-number array ?(label)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#picture_data"><strong>picture_data</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">erase_picture picture-number y x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#erase_picture"><strong>erase_picture</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_margins left right window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_margins"><strong>set_margins</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">save_undo &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#save_undo"><strong>save_undo</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">restore_undo &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#restore_undo"><strong>restore_undo</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_unicode char-number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#print_unicode"><strong>print_unicode</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">check_unicode char-number &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#check_unicode"><strong>check_unicode</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5/*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_true_colour foreground background</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_true_colour"><strong>set_true_colour</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6/*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">set_true_colour foreground background window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#set_true_colour"><strong>set_true_colour</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-------</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">E</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-------</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">F</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">---</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">move_window window y x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#move_window"><strong>move_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">window_size window y x</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#window_size"><strong>window_size</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">window_style window flags operation</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#window_style"><strong>window_style</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">get_wind_prop window property-number &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#get_wind_prop"><strong>get_wind_prop</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:20</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">scroll_window window pixels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#scroll_window"><strong>scroll_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:21</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">pop_stack items stack</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#pop_stack"><strong>pop_stack</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">16</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">read_mouse array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#read_mouse"><strong>read_mouse</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:23</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">mouse_window window</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#mouse_window"><strong>mouse_window</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:24</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">push_stack value stack ?(label)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#push_stack"><strong>push_stack</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:25</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">put_wind_prop window property-number value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#put_wind_prop"><strong>put_wind_prop</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:26</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">print_form formatted-table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#print_form"><strong>print_form</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:27</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1B</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">make_menu number table ?(label)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#make_menu"><strong>make_menu</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:28</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1C</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">picture_table table</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#picture_table"><strong>picture_table</strong></a></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">EXT:29</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1D</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6/*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">buffer_screen mode &#8594; (result)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="sect15.html#buffer_screen"><strong>buffer_screen</strong></a></p></td>
</tr>
</tbody>
</table>
<hr>
<div class="sect2">
<h3 id="s14.1"><a class="anchor" href="#s14.1"></a>14.1. Contents</h3>
<div class="paragraph">
<p>This table contains all 119 opcodes and, taken with the dictionary in <strong>S</strong> 15, describes exactly what each should do. In addition, it lists which opcodes are actually used in the known Infocom story files, and documents the Inform assembly language syntax.</p>
</div>
</div>
<div class="sect2">
<h3 id="s14.2"><a class="anchor" href="#s14.2"></a>14.2. Out of range opcodes</h3>
<div class="paragraph">
<p>Formally, it is illegal for a game to contain an opcode not specified for its version. An interpreter should normally halt with a suitable message.</p>
</div>
<div id="p14.2.1" class="paragraph">
<p><span class="red">§14.2.1.</span>
However, extended opcodes in the range EXT:29 to EXT:255 should be simply ignored (perhaps with a warning message somewhere off-screen).</p>
</div>
<div id="p14.2.2" class="paragraph">
<p><span class="red">§14.2.2.</span>
<strong>*</strong>*[1.0][1.1]* EXT:11 and EXT:12 were opcodes added in Standard 1.0 and can be generated in code compiled by Inform 6.12 or later. EXT:13 and EXT:29 are new in Standard 1.1. EXT:14 to EXT:15, and EXT:30 to EXT:127, are reserved for future versions of this document to specify.</p>
</div>
<div id="p14.2.3" class="paragraph">
<p><span class="red">§14.2.3.</span>
Designers who wish to create their own "new" opcodes, for one specific game only, are asked to use opcode numbers in the range EXT:128 to EXT:255. It is easy to modify Inform to name and assemble such opcodes. (Of course the game will then have to be circulated with a suitably modified interpreter to run it.)</p>
</div>
<div id="p14.2.4" class="paragraph">
<p><span class="red">§14.2.4.</span>
Interpreter-writers should ideally make this easy by providing a routine which is called if EXT:128 to EXT:255 are found, so that the minimum possible modification to the interpreter is needed.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="reading"><a class="anchor" href="#reading"></a>Reading the opcode tables</h3>
<div class="paragraph">
<p>The two columns "St" and "Br" (store and branch) mark whether an instruction stores a result in a variable, and whether it must provide a label to jump to, respectively.</p>
</div>
<div class="paragraph">
<p>The "Opcode" is written <strong>TYPE:Decimal</strong> where the <strong>TYPE</strong> is the operand count (2OP, 1OP, 0OP or VAR) or else EXT for two-byte opcodes (where the first byte is (decimal) 190). The decimal number is the lowest possible decimal opcode value. The hex number is the opcode number within each <strong>TYPE</strong>.</p>
</div>
<div class="paragraph">
<p>The "V" column gives the Version information. If nothing is specified, the opcode is as stated from Version 1 onwards. Otherwise, it exists only from the version quoted onwards. Before this time, its use is illegal. Some opcodes change their meanings as the Version increases, and these have more than one line of specification. Others become illegal again, and these are marked <strong>[illegal]</strong>.</p>
</div>
<div class="paragraph">
<p>In a few cases, the Version is given as "3/4" or some such. The first number is the Version number whose specification the opcode belongs to, and the second is the earliest Version in which the opcode is known actually to be used in an Infocom-produced story file. A dash means that it seems never to have been used (in any of Versions 1 to 6). The notation "5/<strong><strong>" or "6/</strong></strong>" means that the opcode was introduced in this Standards document long after the Infocom era.</p>
</div>
<div class="paragraph">
<p>The table explicitly marks opcodes which do not exist in any version of the Z-machine as <strong>------</strong>: in addition, none of the extended set of codes after EXT:29 have been used.</p>
</div>
</div>
<div class="sect2">
<h3 id="inform"><a class="anchor" href="#inform"></a>Inform assembly language</h3>
<div class="paragraph">
<p>This section documents Inform 6 assembly language, which is richer than that of Inform 5. The Inform 6 assembler can generate every legal opcode and automatically sets any consequent header bits (for instance, a usage of <strong>set_colour</strong> will set the "colours needed" bit).</p>
</div>
<div class="paragraph">
<p>One way to get a picture of Inform assembly language is to compile a short program with tracing switched on (using the <strong>-a</strong> or <strong>-t</strong> switches).</p>
</div>
<div class="paragraph">
<p>1. An Inform statement beginning with an <strong>@</strong> is sent directly to the assembler. In the syntax below, <strong>(variable)</strong> and <strong>(result)</strong> must be variables (or <strong>sp</strong>, a special variable name available only in assembly language, and meaning the stack pointer); <strong>(label)</strong> a label (not a routine name).</p>
</div>
<div class="paragraph">
<p><strong>(literal-string)</strong> must be literal text in quotation marks "thus".</p>
</div>
<div class="paragraph">
<p><strong>routine</strong> should be the name of a routine (this assembles to its packed address). Otherwise any Inform constant term (such as <strong>'/'</strong> or <strong>'beetle'</strong>) can be given as an operand.</p>
</div>
<div class="paragraph">
<p>2. It is optional, but sensible, to place a <strong>&#8594;</strong> sign before a store-variable. For example, in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @mul a 56 -&gt; sp;</pre>
</div>
</div>
<div class="paragraph">
<p>("multiply variable <strong>a</strong> by 56, and put the result on the stack") the <strong>&#8594;</strong> can be omitted, but should be included for clarity.</p>
</div>
<div class="paragraph">
<p>3. A label to branch to should be prefaced with a question mark <strong>?</strong>, as in</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @je a b ?Equal;      ! Branch to Equal if a == b</pre>
</div>
</div>
<div class="paragraph">
<p>(If the question mark is omitted, the branch is compiled in the short form, which will only work for very nearby labels and is very seldom useful in code written by hand.) Note that the effect of any branch instruction can be negated using a tilde <strong>~</strong>:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @je a b ?~Different; ! Branch to Different if a ~= b</pre>
</div>
</div>
<div class="paragraph">
<p>4. Labels are assembled using full stops:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    .MyLabel;</pre>
</div>
</div>
<div class="paragraph">
<p>All branches must be to such a label within the same routine. (The Inform assembler imposes the same-routine restriction.)</p>
</div>
<div class="paragraph">
<p>5. Most operands are assembled in the obvious way: numbers and constant values (like characters) as numbers, variables as variables, <strong>sp</strong> as the value on top of the stack. There are two exceptions. "Call" opcodes expect as first operand the name of a routine to call:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @call_1n MyRoutine;</pre>
</div>
</div>
<div class="paragraph">
<p>but one can also give an indirect address, as a constant or variable, using square brackets:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @call_1n [x];        ! Call routine whose address is in x</pre>
</div>
</div>
<div class="paragraph">
<p>Secondly, seven Z-machine opcodes access variables but by their numbers: thus one should write, say, the constant 0 instead of the variable <strong>sp</strong>. This is inconvenient, so the Inform assembler accepts variable names instead. The operands affected are those marked as <strong>(variable)</strong> in the syntax chart; Inform translates the variable name as a "small constant" operand with that variable&#8217;s number as value. The affected opcodes are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    inc,  dec,  inc_chk,  dec_chk,  store,  pull,  load.</pre>
</div>
</div>
<div class="paragraph">
<p>This is useful, but there is another possibility, of genuinely giving a variable operand. The Inform notation for this involves square brackets again:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @inc frog;          ! Increment var "frog"
    @inc [frog];        ! Increment var whose number is in "frog"</pre>
</div>
</div>
<div class="paragraph">
<p>Infocom story files often use such instructions.</p>
</div>
<div class="paragraph">
<p>6. The Inform assembler is also written with possible extensions to the Z-machine instruction set in mind. (Of course these can only work if a customised interpreter is used.) Simply give a specification in double-quotes where you would normally give the opcode name. For example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @"1OP:4S" 34 -&gt; i;
    @get_prop_len 34 -&gt; i;</pre>
</div>
</div>
<div class="paragraph">
<p>are equivalent instructions, since <strong>get_prop_len</strong> is instruction 4 in the 1OP (one-operand) set, and is a Store opcode. The syntax is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    "  0OP       :  decimal-number  flags  "        (range 0 to 15)
       1OP                                                 0    15
       2OP                                                 0    15
       VAR                                                 32   63
       VAR_LONG                                            32   63
       EXT                                                 0    255
       EXT_LONG                                            0    255</pre>
</div>
</div>
<div class="paragraph">
<p>(<strong>EXT_LONG</strong> is a logical possibility but has not been used in the Z-machine so far: the assembler provides it in case it might be useful in future.) The possible flags are:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>       S    Store opcode
       B    Branch opcode
       T    Text in-line instead of operands
            (as with "print" and "print_ret")
       I    "Indirect addressing": first operand is a (variable)
       Fnn  Set bit nn in Flags 2 (signalling to the interpreter that an
            unusual feature has been called for): the number is in decimal</pre>
</div>
</div>
<div class="paragraph">
<p>For example,</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    "EXT:128BSF14"</pre>
</div>
</div>
<div class="paragraph">
<p>is an exotic new opcode, number 128 in the extended range, which is both Branch and Store, and the assembly of which causes bit 14 to be set in "Flags 2". See <strong>S</strong> 14.2 below for rules on how to number newly created opcodes.</p>
</div>
</div>
<div class="sect2">
<h3 id="remarks-14"><a class="anchor" href="#remarks-14"></a>Remarks</h3>
<div class="paragraph">
<p>The opcodes EXT:5 to EXT:8 were very likely in Infocom&#8217;s own Version 5 specification (documentary records of which are lost): they seem to have been partially implemented in existing Infocom interpreters, but do not occur in any existing Version 5 story file. They are here left unspecified.</p>
</div>
<div class="paragraph">
<p>The notation "5/3" for <strong>sound_effect</strong> is because this plainly Version 5 feature was used also in one solitary Version 3 game, 'The Lurking Horror' (the sound version of which was the last Version 3 release, in September 1987).</p>
</div>
<div class="paragraph">
<p>The 2OP opcode 0 was possibly intended for setting break-points in debugging (and may be used for this again). It was not <strong>nop</strong>.</p>
</div>
<div class="paragraph">
<p><strong>read_mouse</strong> and <strong>make_menu</strong> are believed to have been used only in 'Journey' (based on a check of 11 Version 6 story files).</p>
</div>
<div class="paragraph">
<p><strong>picture_table</strong> is used once by 'Shogun' and several times by 'Zork Zero'.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="ch.15"><a class="anchor" href="#ch.15"></a>15. Dictionary of opcodes</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
The highest ideal of a translation&#8230;&#8203; is achieved when the reader flings it impatiently into the fire, and begins patiently to learn the language for himself.
</blockquote>
<div class="attribution">
&#8212; Philip Vellacott
</div>
</div>
<hr>
<div class="paragraph">
<p><a href="#add">A</a> / <a href="#buffer_mode">B</a> / <a href="#call">C</a> / <a href="#dec">D</a> / <a href="#encode_text">E</a> / <a href="#get_child">F</a> / <a href="#get_child">G</a> / <a href="#inc">H</a> / <a href="#inc">I</a> / <a href="#je">J</a> / <a href="#load">K</a> / <a href="#load">L</a> / <a href="#make_menu">M</a> / <a href="#new_line">N</a> / <a href="#or">O</a> / <a href="#picture_data">P</a> / <a href="#quit">Q</a> / <a href="#random">R</a> / <a href="#save">S</a> / <a href="#test">T</a> / <a href="#verify">U</a> / <a href="#verify">V</a> / <a href="#window_size">W</a> / <a href="#window_style">X</a> / <a href="#window_style">Y</a> / <a href="#window_style">Z</a></p>
</div>
<hr>
<div class="sect2">
<h3 id="_15_1"><a class="anchor" href="#_15_1"></a>15.1. 15.1</h3>
<div class="paragraph">
<p>The dictionary below is alphabetical and includes entries on every opcode listed in the table above, as well as brief notes on a few opcodes once thought to exist but now disproved.</p>
</div>
</div>
<div class="sect2">
<h3 id="_15_2"><a class="anchor" href="#_15_2"></a>15.2. 15.2</h3>
<div class="paragraph">
<p>The Z-machine has the same concept of "table" (as an internal data structure) as Inform. Specifically, a table is an array of words (in dynamic or static memory) of which the initial entry is the number of subsequent words in the table. For example, a table with three entries occupies 8 bytes, arranged as the words 3, x, y, z.</p>
</div>
</div>
<div class="sect2">
<h3 id="_15_3"><a class="anchor" href="#_15_3"></a>15.3. 15.3</h3>
<div class="paragraph">
<p>In all cases below where one operand is supposed to be in a particular range, behaviour is undefined if it is not. For instance an interpreter complies with the Standard even if it crashes when an illegal object number (including 0) is given for an object operand. However, see <strong>S</strong> A for guidelines on detecting and dealing with errors.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_add"><a class="anchor" href="#_add"></a>15.4. add</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:20 14 add a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Signed 16-bit addition.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_and"><a class="anchor" href="#_and"></a>15.5. and</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:9 9 and a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Bitwise AND.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_aread"><a class="anchor" href="#_aread"></a>15.6. aread</h3>
<div class="paragraph">
<p>This is the Inform name for the keyboard-reading opcode under Version 5 and later. (Inform calls the same opcode <strong>sread</strong> under Versions 3 and 4.) See <strong>read</strong> for the specification.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_art_shift"><a class="anchor" href="#_art_shift"></a>15.7. art_shift</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:3 3 5/- art_shift number places &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Does an arithmetic shift of <strong>number</strong> by the given number of places, shifting left (i.e. increasing) if places is positive, right if negative. In a right shift, the sign bit is preserved as well as being shifted on down. (The alternative behaviour is <strong>log_shift</strong>.)</p>
</div>
<div class="paragraph">
<p>The "places" operand must be in the range -15 to +15, otherwise behaviour is undefined.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_buffer_mode"><a class="anchor" href="#_buffer_mode"></a>15.8. buffer_mode</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:242 12 4 buffer_mode flag</strong></p>
</div>
<div class="paragraph">
<p>If set to 1, text output on the lower window in stream 1 is buffered up so that it can be word-wrapped properly. If set to 0, it isn&#8217;t.</p>
</div>
<div class="paragraph">
<p>In Version 6, this opcode is redundant (the "buffering" window attribute can be set instead). It is used twice in each of Infocom&#8217;s Version 6 story files, in the <strong>$verify</strong> routine. <strong>Frotz</strong> responds by setting the current window&#8217;s "buffering" attribute, while Infocom&#8217;s own interpreters respond by doing nothing. This standard leaves the result of <strong>buffer_mode</strong> undefined in Version 6.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_buffer_screen"><a class="anchor" href="#_buffer_screen"></a>15.9. buffer_screen</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:29 1D 6/</strong> buffer_screen mode &#8594; (result)*</p>
</div>
<div class="paragraph">
<p>Tells the interpreter how to handle display buffering. If <strong>mode</strong> is 0, updates must be made as soon as possible. If <strong>mode</strong> is 1, the interpreter may make changes to a backing store, and need not update the screen. The interpreter is free to ignore the advice, but if so must always act as though the <strong>mode</strong> is 0 (update the screen as soon as possible).</p>
</div>
<div class="paragraph">
<p>With buffer_screen in either state, an update of the visible display can be forced immediately by issuing <strong>buffer_screen</strong> -1, without altering the current buffering state. Note that <strong>buffer_screen</strong> -1 does not flush the text buffer.</p>
</div>
<div class="paragraph">
<p>The return value is the old buffer_screen state.</p>
</div>
<div class="paragraph">
<p>See <strong>S</strong> 8 for more details.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.1]* This opcode will only be present in interpreters obeying Standard 1.1 or later, so story files should check the standard number of the interpreter before executing this opcode.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call"><a class="anchor" href="#_call"></a>15.10. call</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:224 0 1 call routine &#8230;&#8203;up to 3 args&#8230;&#8203; &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>The only call instruction in Version 3, Inform reads this as <strong>call_vs</strong> in higher versions: it calls the routine with 0, 1, 2 or 3 arguments as supplied and stores the resulting return value. (When the address 0 is called as a routine, nothing happens and the return value is false.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_1n"><a class="anchor" href="#_call_1n"></a>15.11. call_1n</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:143 F 5 call_1n routine</strong></p>
</div>
<div class="paragraph">
<p>Executes <strong>routine()</strong> and throws away result.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_1s"><a class="anchor" href="#_call_1s"></a>15.12. call_1s</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:136 8 4 call_1s routine &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Stores <strong>routine()</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_2n"><a class="anchor" href="#_call_2n"></a>15.13. call_2n</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:26 1A 5 call_2n routine arg1</strong></p>
</div>
<div class="paragraph">
<p>Executes <strong>routine(arg1)</strong> and throws away result.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_2s"><a class="anchor" href="#_call_2s"></a>15.14. call_2s</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:25 19 4 call_2s routine arg1 &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Stores <strong>routine(arg1)</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_vn"><a class="anchor" href="#_call_vn"></a>15.15. call_vn</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:249 19 5 call_vn routine &#8230;&#8203;up to 3 args&#8230;&#8203;</strong></p>
</div>
<div class="paragraph">
<p>Like <strong>call</strong>, but throws away result.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_vs"><a class="anchor" href="#_call_vs"></a>15.16. call_vs</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:224 0 4 call_vs routine &#8230;&#8203;up to 3 args&#8230;&#8203; &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>See <strong>call</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_vn2"><a class="anchor" href="#_call_vn2"></a>15.17. call_vn2</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:250 1A 5 call_vn2 routine &#8230;&#8203;up to 7 args&#8230;&#8203;</strong></p>
</div>
<div class="paragraph">
<p>Call with a variable number (from 0 to 7) of arguments, then throw away the result. This (and <strong>call_vs2</strong>) uniquely have an extra byte of opcode types to specify the types of arguments 4 to 7. Note that it is legal to use these opcodes with fewer than 4 arguments (in which case the second byte of type information will just be <strong>$ff</strong>).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_call_vs2"><a class="anchor" href="#_call_vs2"></a>15.18. call_vs2</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:236 C 4 call_vs2 routine &#8230;&#8203;up to 7 args&#8230;&#8203; &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>See <strong>call_vn2</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_catch"><a class="anchor" href="#_catch"></a>15.19. catch</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:185 9 5/6 catch &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Opposite to <strong>throw</strong> (and occupying the same opcode that <strong>pop</strong> used in Versions 3 and 4). <strong>catch</strong> returns the current "stack frame".</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_check_arg_count"><a class="anchor" href="#_check_arg_count"></a>15.20. check_arg_count</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:255 1F 5 check_arg_count argument-number</strong></p>
</div>
<div class="paragraph">
<p>Branches if the given argument-number (counting from 1) has been provided by the routine call to the current routine. (This allows routines in Versions 5 and later to distinguish between the calls <strong>routine(1)</strong> and <strong>routine(1,0)</strong>, which would otherwise be impossible to tell apart.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_check_unicode"><a class="anchor" href="#_check_unicode"></a>15.21. check_unicode</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:12 C 5/</strong> check_unicode char-number &#8594; (result)*</p>
</div>
<div class="paragraph">
<p>Determines whether or not the interpreter can print, or receive from the keyboard, the given Unicode character. Bit 0 of the result should be set if and only if the interpreter can print the character; bit 1 if and only if the interpreter can receive it from the keyboard. Bits 2 to 15 are undefined.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* This opcode will only be present in interpreters obeying Standard 1.0 or later, so story files should check the standard number of the interpreter before executing this opcode.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_clear_attr"><a class="anchor" href="#_clear_attr"></a>15.22. clear_attr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:12 C clear_attr object attribute</strong></p>
</div>
<div class="paragraph">
<p>Make <strong>object</strong> not have the attribute numbered <strong>attribute</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_copy_table"><a class="anchor" href="#_copy_table"></a>15.23. copy_table</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:253 1D 5 copy_table first second size</strong></p>
</div>
<div class="paragraph">
<p>If <strong>second</strong> is zero, then <strong>size</strong> bytes of <strong>first</strong> are zeroed.</p>
</div>
<div class="paragraph">
<p>Otherwise <strong>first</strong> is copied into <strong>second</strong>, its length in bytes being the absolute value of <strong>size</strong> (i.e., <strong>size</strong> if <strong>size</strong> is positive, <strong>-size</strong> if <strong>size</strong> is negative).</p>
</div>
<div class="paragraph">
<p>The tables are allowed to overlap. If <strong>size</strong> is positive, the interpreter must copy either forwards or backwards so as to avoid corrupting <strong>first</strong> in the copying process. If <strong>size</strong> is negative, the interpreter must copy forwards even if this corrupts <strong>first</strong>. ('Beyond Zork' uses this to fill an array with spaces.)</p>
</div>
<div class="paragraph">
<p>(Version 0.2 of this document wrongly specified that if <strong>size</strong> is positive then copying should always run backward. This results in the player being unable to cross the river near the start of 'Journey', as the game uses <strong>copy_table</strong> to shuffle menu options, and the menu "Downstream, Upstream, Cross, Return" is changed to "Return, Return, Return".)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_dec"><a class="anchor" href="#_dec"></a>15.24. dec</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:134 6 dec (variable)</strong></p>
</div>
<div class="paragraph">
<p>Decrement variable by 1. This is signed, so 0 decrements to -1.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_dec_chk"><a class="anchor" href="#_dec_chk"></a>15.25. dec_chk</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:4 4 dec_chk (variable) value ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Decrement variable, and branch if it is now less than the given value.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_div"><a class="anchor" href="#_div"></a>15.26. div</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:23 17 div a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Signed 16-bit division. Division by zero should halt the interpreter with a suitable error message.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_draw_picture"><a class="anchor" href="#_draw_picture"></a>15.27. draw_picture</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:5 5 6 draw_picture picture-number y x</strong></p>
</div>
<div class="paragraph">
<p>Displays the picture with the given number. (y,x) coordinates (of the top left of the picture) are each optional, in that a value of zero for y or x means the cursor y or x coordinate in the current window. It is illegal to call this with an invalid picture number.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_encode_text"><a class="anchor" href="#_encode_text"></a>15.28. encode_text</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:252 1C 5 encode_text zscii-text length from coded-text</strong></p>
</div>
<div class="paragraph">
<p>Translates a ZSCII word to Z-encoded text format (stored at <strong>coded-text</strong>), as if it were an entry in the dictionary. The text begins at <strong>from</strong> in the <strong>zscii-text</strong> buffer and is <strong>length</strong> characters long. (Some interpreters ignore this and keep translating until they hit a 0 character anyway, or have already filled up the 6-byte Z-encoded string.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_erase_line"><a class="anchor" href="#_erase_line"></a>15.29. erase_line</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:238 E 4/6 erase_line value</strong></p>
</div>
<div class="paragraph">
<p>Versions 4 and 5: if the value is 1, erase from the current cursor position to the end of its line in the current window. If the value is anything other than 1, do nothing.</p>
</div>
<div class="paragraph">
<p>Version 6: if the value is 1, erase from the current cursor position to the end of the its line in the current window. If not, erase the given number of pixels minus one across from the cursor (clipped to stay inside the right margin). The cursor does not move.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_erase_picture"><a class="anchor" href="#_erase_picture"></a>15.30. erase_picture</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:7 7 6 erase_picture picture-number y x</strong></p>
</div>
<div class="paragraph">
<p>Like <strong>draw_picture</strong>, but paints the appropriate region to the background colour for the given window. It is illegal to call this with an invalid picture number.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_erase_window"><a class="anchor" href="#_erase_window"></a>15.31. erase_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:237 D 4 erase_window window</strong></p>
</div>
<div class="paragraph">
<p>Erases window with given number (to background colour); or if -1 it unsplits the screen and clears the lot; or if -2 it clears the screen without unsplitting it. In cases -1 and -2, the cursor may move (see <strong>S</strong> 8 for precise details).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_extended"><a class="anchor" href="#_extended"></a>15.32. "extended"</h3>
<div class="paragraph">
<p>This byte (decimal 190) is not an instruction, but indicates that the opcode is "extended": the next byte contains the number in the extended set.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_child"><a class="anchor" href="#_get_child"></a>15.33. get_child</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:130 2 get_child object &#8594; (result) ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Get first object contained in given object, branching if this exists, i.e. is not <strong>nothing</strong> (i.e., is not 0).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_cursor"><a class="anchor" href="#_get_cursor"></a>15.34. get_cursor</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:240 10 4/6 get_cursor array</strong></p>
</div>
<div class="paragraph">
<p>Puts the current cursor row into the word 0 of the given array, and the current cursor column into word 1. (The array is not a table and has no size information in its initial entry.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_next_prop"><a class="anchor" href="#_get_next_prop"></a>15.35. get_next_prop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:19 13 get_next_prop object property &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Gives the number of the next property provided by the quoted object. This may be zero, indicating the end of the property list; if called with zero, it gives the first property number present. It is illegal to try to find the next property of a property which does not exist, and an interpreter should halt with an error message (if it can efficiently check this condition).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_parent"><a class="anchor" href="#_get_parent"></a>15.36. get_parent</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:131 3 get_parent object &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Get parent object (note that this has no "branch if exists" clause).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_prop"><a class="anchor" href="#_get_prop"></a>15.37. get_prop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:17 11 get_prop object property &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Read property from object (resulting in the default value if it had no such declared property). If the property has length 1, the value is only that byte. If it has length 2, the first two bytes of the property are taken as a word value. It is illegal for the opcode to be used if the property has length greater than 2, and the result is unspecified.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_prop_addr"><a class="anchor" href="#_get_prop_addr"></a>15.38. get_prop_addr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:18 12 get_prop_addr object property &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Get the byte address (in dynamic memory) of the property data for the given object&#8217;s property. This must return 0 if the object hasn&#8217;t got the property.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_prop_len"><a class="anchor" href="#_get_prop_len"></a>15.39. get_prop_len</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:132 4 get_prop_len property-address &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Get length of property data (in bytes) for the given object&#8217;s property. It is illegal to try to find the property length of a property which does not exist for the given object, and an interpreter should halt with an error message (if it can efficiently check this condition).</p>
</div>
<div class="paragraph">
<p>@get_prop_len 0 must return 0. This is required by some Infocom games and files generated by old versions of Inform.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_sibling"><a class="anchor" href="#_get_sibling"></a>15.40. get_sibling</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:129 1 get_sibling object &#8594; (result) ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Get next object in tree, branching if this exists, i.e. is not 0.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_get_wind_prop"><a class="anchor" href="#_get_wind_prop"></a>15.41. get_wind_prop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:19 13 6 get_wind_prop window property-number &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Reads the given property of the given window (see <strong>S</strong> 8).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_inc"><a class="anchor" href="#_inc"></a>15.42. inc</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:133 5 inc (variable)</strong></p>
</div>
<div class="paragraph">
<p>Increment variable by 1. (This is signed, so -1 increments to 0.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_inc_chk"><a class="anchor" href="#_inc_chk"></a>15.43. inc_chk</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:5 5 inc_chk (variable) value ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Increment variable, and branch if now greater than value.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_input_stream"><a class="anchor" href="#_input_stream"></a>15.44. input_stream</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:244 14 3 input_stream number</strong></p>
</div>
<div class="paragraph">
<p>Selects the current input stream.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_insert_obj"><a class="anchor" href="#_insert_obj"></a>15.45. insert_obj</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:14 E insert_obj object destination</strong></p>
</div>
<div class="paragraph">
<p>Moves object O to become the first child of the destination object D. (Thus, after the operation the <strong>child</strong> of D is O, and the <strong>sibling</strong> of O is whatever was previously the <strong>child</strong> of D.) All children of O move with it. (Initially O can be at any point in the object tree; it may legally have <strong>parent</strong> zero.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_je"><a class="anchor" href="#_je"></a>15.46. je</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:1 1 je a b c d ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if <strong>a</strong> is equal to any of the subsequent operands. (Thus <strong>@je a</strong> never jumps and <strong>@je a b</strong> jumps if <strong>a = b</strong>.)</p>
</div>
<div class="paragraph">
<p>je with just 1 operand is not permitted.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_jg"><a class="anchor" href="#_jg"></a>15.47. jg</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:3 3 jg a b ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if <strong>a &gt; b</strong> (using a signed 16-bit comparison).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_jin"><a class="anchor" href="#_jin"></a>15.48. jin</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:6 6 jin obj1 obj2 ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if object <strong>a</strong> is a direct child of <strong>b</strong>, i.e., if <strong>parent</strong> of <strong>a</strong> is <strong>b</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_jl"><a class="anchor" href="#_jl"></a>15.49. jl</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:2 2 jl a b ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if <strong>a &lt; b</strong> (using a signed 16-bit comparison).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_jump"><a class="anchor" href="#_jump"></a>15.50. jump</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:140 C jump ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump (unconditionally) to the given label. (This is not a branch instruction and the operand is a 2-byte signed offset to apply to the program counter.) It is legal for this to jump into a different routine (which should not change the routine call state), although it is considered bad practice to do so and the <strong>Txd</strong> disassembler is confused by it.</p>
</div>
<div class="paragraph">
<p>The destination of the jump opcode is:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Address after instruction + Offset - 2</pre>
</div>
</div>
<div class="paragraph">
<p>This is analogous to the calculation for branch offsets.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_jz"><a class="anchor" href="#_jz"></a>15.51. jz</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:128 0 jz a ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if <strong>a = 0</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_load"><a class="anchor" href="#_load"></a>15.52. load</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:142 E load (variable) &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>The value of the variable referred to by the operand is stored in the result. (Inform doesn&#8217;t use this; see the notes to <strong>S</strong> 14.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_loadb"><a class="anchor" href="#_loadb"></a>15.53. loadb</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:16 10 loadb array byte-index &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Stores <strong>array&#8594;byte-index</strong> (i.e., the byte at address <strong>array+byte-index</strong>, which must lie in static or dynamic memory).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_loadw"><a class="anchor" href="#_loadw"></a>15.54. loadw</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:15 F loadw array word-index &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Stores <strong>array-&#8594;word-index</strong> (i.e., the word at address <strong>array+2*word-index</strong>, which must lie in static or dynamic memory).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_log_shift"><a class="anchor" href="#_log_shift"></a>15.55. log_shift</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:2 2 5 log_shift number places &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Does a logical shift of <strong>number</strong> by the given number of <strong>places</strong>, shifting left (i.e. increasing) if <strong>places</strong> is positive, right if <strong>negative</strong>. In a right shift, the sign is zeroed instead of being shifted on. (See also <strong>art_shift</strong>.)</p>
</div>
<div class="paragraph">
<p>The "places" operand must be in the range -15 to +15, otherwise behaviour is undefined.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_make_menu"><a class="anchor" href="#_make_menu"></a>15.56. make_menu</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:27 1B 6 make_menu number table ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Controls menus with numbers greater than 2 (i.e., it doesn&#8217;t control the three system menus). If the table supplied is 0, the menu is removed. Otherwise it is a table of tables. Each table is a ZSCII string: the first item being a menu name, subsequent ones the entries.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_mod"><a class="anchor" href="#_mod"></a>15.57. mod</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:24 18 mod a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Remainder after signed 16-bit division. Division by zero should halt the interpreter with a suitable error message.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_mouse_window"><a class="anchor" href="#_mouse_window"></a>15.58. mouse_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:23 17 6 mouse_window window</strong></p>
</div>
<div class="paragraph">
<p>Constrain the mouse arrow to sit inside the given window. By default it sits in window 1. Setting to -1 takes all restriction away. (The mouse clicks are not reported if the arrow is outside the window and interpreters are presumably supposed to hold the arrow there by hardware means if possible.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_move_window"><a class="anchor" href="#_move_window"></a>15.59. move_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:16 10 6 move_window window y x</strong></p>
</div>
<div class="paragraph">
<p>Moves the given window to pixels (y,x): (1,1) being the top left. Nothing actually happens (since windows are entirely notional transparencies): but any future plotting happens in the new place.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_mul"><a class="anchor" href="#_mul"></a>15.60. mul</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:22 16 mul a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Signed 16-bit multiplication.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_new_line"><a class="anchor" href="#_new_line"></a>15.61. new_line</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:187 B new_line</strong></p>
</div>
<div class="paragraph">
<p>Print carriage return.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_nop"><a class="anchor" href="#_nop"></a>15.62. nop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:180 4 1/- nop</strong></p>
</div>
<div class="paragraph">
<p>Probably the official "no operation" instruction, which, appropriately, was never operated (in any of the Infocom datafiles): it may once have been a breakpoint.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_not"><a class="anchor" href="#_not"></a>15.63. not</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:143 F 1/4 not value &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:248 18 5/6 not value &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Bitwise NOT (i.e., all 16 bits reversed). Note that in Versions 3 and 4 this is a 1OP instruction, reasonably since it has 1 operand, but in later Versions it was moved into the extended set to make room for <strong>call_1n</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_or"><a class="anchor" href="#_or"></a>15.64. or</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:8 8 or a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Bitwise OR.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_output_stream"><a class="anchor" href="#_output_stream"></a>15.65. output_stream</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:243 13 3 output_stream number table</strong></p>
</div>
<div class="paragraph">
<p><strong>6 output_stream number table width</strong></p>
</div>
<div class="paragraph">
<p>If <strong>stream</strong> is 0, nothing happens. If it is positive, then that stream is selected; if negative, deselected. (Recall that several different streams can be selected at once.)</p>
</div>
<div class="paragraph">
<p>When stream 3 is selected, a <strong>table</strong> must be given into which text can be printed. The first word always holds the number of characters printed, the actual text being stored at bytes <strong>table+2</strong> onward. It is not the interpreter&#8217;s responsibility to worry about the length of this table being overrun.</p>
</div>
<div class="paragraph">
<p>In Version 6, a <strong>width</strong> field may optionally be given: text will then be justified as if it were in the window with that number (if width is zero or positive) or a box -<strong>width</strong> pixels wide (if negative). Then the table will contain not ordinary text but formatted text: see <strong>print_form</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_picture_data"><a class="anchor" href="#_picture_data"></a>15.66. picture_data</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:6 6 6 picture_data picture-number array ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Asks the interpreter for data on the picture with the given number. If the picture number is valid, a branch occurs and information is written to the array: the height in word 0, the width in word 1, in pixels. (This is an array, not a "table" with initial size information.)</p>
</div>
<div class="paragraph">
<p>Otherwise, if the picture number is zero, the interpreter writes the number of available pictures into word 0 of the array and the release number of the picture file into word 1, and branches if any pictures are available. (Infocom&#8217;s first Version 6 Amiga interpreter did not handle this case properly, and early releases of 'Zork Zero' did not use it. The feature may have been added on the MSDOS release of 'Zork Zero'.)</p>
</div>
<div class="paragraph">
<p>Otherwise, nothing happens.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_picture_table"><a class="anchor" href="#_picture_table"></a>15.67. picture_table</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:28 1C 6 picture_table table</strong></p>
</div>
<div class="paragraph">
<p>Given a table of picture numbers, the interpreter may if it wishes load or unpack these pictures from disc into a cache for convenient rapid plotting later. 'Zork Zero' makes frequent use of this, for instance for its peggleboard display. Moreover, it expects rapid plotting only for those images listed in the last call to <strong>picture_table</strong>. In other words, any images still in the cache when <strong>picture_table</strong> is called can safely be thrown away. (The Amiga interpreter 6.14 uses a cache of size 5K and never caches any individual image larger than 1K.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_piracy"><a class="anchor" href="#_piracy"></a>15.68. piracy</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:191 F 5/- piracy ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Branches if the game disc is believed to be genuine by the interpreter (which is assumed to have some arcane way of finding out). Interpreters are asked to be gullible and to unconditionally branch.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_pop"><a class="anchor" href="#_pop"></a>15.69. pop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:185 9 1 pop</strong></p>
</div>
<div class="paragraph">
<p>Throws away the top item on the stack. (This was useful to lose unwanted routine call results in early Versions.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_pop_stack"><a class="anchor" href="#_pop_stack"></a>15.70. pop_stack</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:21 15 6 pop_stack items stack</strong></p>
</div>
<div class="paragraph">
<p>The given number of items are thrown away from the top of a stack: by default the system stack, otherwise the one given as a second operand.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print"><a class="anchor" href="#_print"></a>15.71. print</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:178 2 print &lt;literal-string&gt;</strong></p>
</div>
<div class="paragraph">
<p>Print the quoted (literal) Z-encoded string.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_addr"><a class="anchor" href="#_print_addr"></a>15.72. print_addr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:135 7 print_addr byte-address-of-string</strong></p>
</div>
<div class="paragraph">
<p>Print (Z-encoded) string at given byte address, in dynamic or static memory.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_char"><a class="anchor" href="#_print_char"></a>15.73. print_char</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:229 5 print_char output-character-code</strong></p>
</div>
<div class="paragraph">
<p>Print a ZSCII character. The operand must be a character code defined in ZSCII for output (see <strong>S</strong> 3). In particular, it must certainly not be negative or larger than 1023.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_form"><a class="anchor" href="#_print_form"></a>15.74. print_form</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:26 1A 6 print_form formatted-table</strong></p>
</div>
<div class="paragraph">
<p>Prints a formatted table of the kind written to output stream 3 when formatting is on. This is an elaborated version of <strong>print_table</strong> to cope with fonts, pixels and other impedimenta. It is a sequence of lines, terminated with a zero word. Each line is a word containing the number of characters, followed by that many bytes which hold the characters concerned.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_num"><a class="anchor" href="#_print_num"></a>15.75. print_num</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:230 6 print_num value</strong></p>
</div>
<div class="paragraph">
<p>Print (signed) number in decimal.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_obj"><a class="anchor" href="#_print_obj"></a>15.76. print_obj</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:138 A print_obj object</strong></p>
</div>
<div class="paragraph">
<p>Print short name of object (the Z-encoded string in the object header, not a property). If the object number is invalid, the interpreter should halt with a suitable error message.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_paddr"><a class="anchor" href="#_print_paddr"></a>15.77. print_paddr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:141 D print_paddr packed-address-of-string</strong></p>
</div>
<div class="paragraph">
<p>Print the (Z-encoded) string at the given packed address in high memory.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_ret"><a class="anchor" href="#_print_ret"></a>15.78. print_ret</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:179 3 print_ret &lt;literal-string&gt;</strong></p>
</div>
<div class="paragraph">
<p>Print the quoted (literal) Z-encoded string, then print a new-line and then return true (i.e., 1).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_table"><a class="anchor" href="#_print_table"></a>15.79. print_table</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:254 1E 5 print_table zscii-text width height skip</strong></p>
</div>
<div class="paragraph">
<p>Print a rectangle of text on screen spreading right and down from the current cursor position, of given <strong>width</strong> and <strong>height</strong>, from the table of ZSCII text given. (Height is optional and defaults to 1.) If a <strong>skip</strong> value is given, then that many characters of text are skipped over in between each line and the next. (So one could make this display, for instance, a 2 by 3 window onto a giant 40 by 40 character graphics map.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_print_unicode"><a class="anchor" href="#_print_unicode"></a>15.80. print_unicode</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:11 B 5/</strong> print_unicode char-number*</p>
</div>
<div class="paragraph">
<p>Print a Unicode character. See <strong>S</strong> 3.8.5.4 and <strong>S</strong> 7.5 for details. The given character code must be defined in Unicode.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* This opcode will only be present in interpreters obeying Standard 1.0 or later, so story files should check the standard number of the interpreter before executing this opcode.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_pull"><a class="anchor" href="#_pull"></a>15.81. pull</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:233 9 1 pull (variable)</strong></p>
</div>
<div class="paragraph">
<p><strong>6 pull stack &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Pulls value off a stack. (If the stack underflows, the interpreter should halt with a suitable error message.) In Version 6, the stack in question may be specified as a user one: otherwise it is the game stack.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_push"><a class="anchor" href="#_push"></a>15.82. push</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:232 8 push value</strong></p>
</div>
<div class="paragraph">
<p>Pushes value onto the game stack.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_push_stack"><a class="anchor" href="#_push_stack"></a>15.83. push_stack</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:24 18 6 push_stack value stack ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Pushes the value onto the specified user stack, and branching if this was successful. If the stack overflows, nothing happens (this is not an error condition).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_put_prop"><a class="anchor" href="#_put_prop"></a>15.84. put_prop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:227 3 put_prop object property value</strong></p>
</div>
<div class="paragraph">
<p>Writes the given value to the given property of the given object. If the property does not exist for that object, the interpreter should halt with a suitable error message. If the property length is 1, then the interpreter should store only the least significant byte of the value. (For instance, storing -1 into a 1-byte property results in the property value 255.) As with <strong>get_prop</strong> the property length must not be more than 2: if it is, the behaviour of the opcode is undefined.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_put_wind_prop"><a class="anchor" href="#_put_wind_prop"></a>15.85. put_wind_prop</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:25 19 6 put_wind_prop window property-number value</strong></p>
</div>
<div class="paragraph">
<p>Writes a window property (see <strong>get_wind_prop</strong>). This should only be used when there is no direct command (such as <strong>move_window</strong>) to use instead, as some such operations may have side-effects.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_quit"><a class="anchor" href="#_quit"></a>15.86. quit</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:186 A quit</strong></p>
</div>
<div class="paragraph">
<p>Exit the game immediately. (Any "Are you sure?" question must be asked by the game, not the interpreter.) It is not legal to return from the main routine (that is, from where execution first begins) and this must be used instead.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_random"><a class="anchor" href="#_random"></a>15.87. random</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:231 7 random range &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>If <strong>range</strong> is positive, returns a uniformly random number between 1 and <strong>range</strong>. If <strong>range</strong> is negative, the random number generator is seeded to that value and the return value is 0. Most interpreters consider giving 0 as <strong>range</strong> illegal (because they attempt a division with remainder by the <strong>range</strong>), but correct behaviour is to reseed the generator in as random a way as the interpreter can (e.g. by using the time in milliseconds).</p>
</div>
<div class="paragraph">
<p>(Some version 3 games, such as 'Enchanter' release 29, had a debugging verb <strong>#random</strong> such that typing, say, <strong>#random 14</strong> caused a call of <strong>random</strong> with -14.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_read"><a class="anchor" href="#_read"></a>15.88. read</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:228 4 1 sread text parse</strong></p>
</div>
<div class="paragraph">
<p><strong>4 sread text parse time routine</strong></p>
</div>
<div class="paragraph">
<p><strong>5 aread text parse time routine &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>(Note that Inform internally names the <strong>read</strong> opcode as <strong>aread</strong> in Versions 5 and later and <strong>sread</strong> in Versions 3 and 4.)</p>
</div>
<div class="paragraph">
<p>This opcode reads a whole command from the keyboard (no prompt is automatically displayed). It is legal for this to be called with the cursor at any position on any window.</p>
</div>
<div class="paragraph">
<p>In Versions 1 to 3, the status line is automatically redisplayed first.</p>
</div>
<div class="paragraph">
<p>A sequence of characters is read in from the current input stream until a carriage return (or, in Versions 5 and later, any terminating character) is found.</p>
</div>
<div class="paragraph">
<p>In Versions 1 to 4, byte 0 of the <strong>text-buffer</strong> should initially contain the maximum number of letters which can be typed, minus 1 (the interpreter should not accept more than this). The text typed is reduced to lower case (so that it can tidily be printed back by the program if need be) and stored in bytes 1 onward, with a zero terminator (but without any other terminator, such as a carriage return code). (This means that if byte 0 contains n then the buffer must contain n+1 bytes, which makes it a <strong>string</strong> array of length n in Inform terminology.)</p>
</div>
<div class="paragraph">
<p>In Versions 5 and later, byte 0 of the <strong>text-buffer</strong> should initially contain the maximum number of letters which can be typed (the interpreter should not accept more than this). The interpreter stores the number of characters actually typed in byte 1 (not counting the terminating character), and the characters themselves (reduced to lower case) in bytes 2 onward (not storing the terminating character). (Some interpreters wrongly add a zero byte after the text anyway, so it is wise for the buffer to contain at least n+3 bytes.)</p>
</div>
<div class="paragraph">
<p>Moreover, if byte 1 contains a positive value at the start of the input, then <strong>read</strong> assumes that number of characters are left over from an interrupted previous input, and writes the new characters after those already there. Note that the interpreter does not redisplay the characters left over: the game does this, if it wants to. This is unfortunate for any interpreter wanting to give input text a distinctive appearance on-screen, but 'Beyond Zork', 'Zork Zero' and 'Shogun' clearly require it. ("Just a tremendous pain in my butt"&#8201;&#8212;&#8201;Andrew Plotkin; "the most unfortunate feature of the Z-machine design"&#8201;&#8212;&#8201;Stefan Jokisch.)</p>
</div>
<div class="paragraph">
<p>In Version 4 and later, if the operands <strong>time</strong> and <strong>routine</strong> are supplied (and non-zero) then the routine call <strong>routine()</strong> is made every <strong>time/10</strong> seconds during the keyboard-reading process. If this routine returns true, all input is erased (to zero) and the reading process is terminated at once. (The terminating character code is 0.) The <strong>routine</strong> is permitted to print to the screen even if it returns false to signal "carry on": the interpreter should notice and redraw the input line so far, before input continues. (<strong>Frotz</strong> notices by looking to see if the cursor position is at the left-hand margin after the interrupt routine has returned.)</p>
</div>
<div class="paragraph">
<p>If input was terminated in the usual way, by the player typing a carriage return, then a carriage return is printed (so the cursor moves to the next line). If it was interrupted, the cursor is left at the rightmost end of the text typed in so far.</p>
</div>
<div class="paragraph">
<p>Next, lexical analysis is performed on the text (except that in Versions 5 and later, if <strong>parse-buffer</strong> is zero then this is omitted). Initially, byte 0 of the <strong>parse-buffer</strong> should hold the maximum number of textual words which can be parsed. (If this is n, the buffer must be at least 2 + 4*n bytes long to hold the results of the analysis.)</p>
</div>
<div class="paragraph">
<p>The interpreter divides the text into words and looks them up in the dictionary, as described in <strong>S</strong> 13. The number of words is written in byte 1 and one 4-byte block is written for each word, from byte 2 onwards (except that it should stop before going beyond the maximum number of words specified). Each block consists of the byte address of the word in the dictionary, if it is in the dictionary, or 0 if it isn&#8217;t; followed by a byte giving the number of letters in the word; and finally a byte giving the position in the <strong>text-buffer</strong> of the first letter of the word.</p>
</div>
<div class="paragraph">
<p>In Version 5 and later, this is a store instruction: the return value is the terminating character (note that the user pressing his "enter" key may cause either 10 or 13 to be returned; the interpreter must return 13). A timed-out input returns 0.</p>
</div>
<div class="paragraph">
<p>(Versions 1 and 2 and early Version 3 games mistakenly write the parse buffer length 240 into byte 0 of the parse buffer: later games fix this bug and write 59, because 2+4*59 = 238 so that 59 is the maximum number of textual words which can be parsed into a buffer of length 240 bytes. Old versions of the Inform 5 library commit the same error. Neither mistake has very serious consequences.)</p>
</div>
<div class="paragraph">
<p>(Interpreters are asked to halt with a suitable error message if the text or parse buffers have length of less than 3 or 6 bytes, respectively: this sometimes occurs due to a previous array being overrun, causing bugs which are very difficult to find.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_read_char"><a class="anchor" href="#_read_char"></a>15.89. read_char</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:246 16 4 read_char 1 time routine &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Reads a single character from input stream 0 (the keyboard). The first operand must be 1 (presumably it was provided to support multiple input devices, but only the keyboard was ever used). <strong>time</strong> and <strong>routine</strong> are optional (in Versions 4 and later only) and dealt with as in <strong>read</strong> above.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_read_mouse"><a class="anchor" href="#_read_mouse"></a>15.90. read_mouse</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:22 16 6 read_mouse array</strong></p>
</div>
<div class="paragraph">
<p>The four words in the <strong>array</strong> are written with the mouse y coordinate, x coordinate, button bits, and a menu word.</p>
</div>
<div class="paragraph">
<p>The buttons bits are arranged so that the "primary" button is the lowest bit, the "secondary" (if present) is the next lowest bit, and so on, up to a potential 16 buttons. The ordering of buttons should be that which is most natural for the host system. Here are some suggested assignments:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>                        Button assignments
             Platform   Bit 0 (low)   Bit 1     Bit 2
             ----------------------------------------
             RISC OS    Select        Adjust    Menu
             MacOS      Primary/only  Secondary Tertiary   ...
             Windows    Left          Right     Middle
             X          Left          Right     Middle</pre>
</div>
</div>
<div class="paragraph">
<p>In the menu word, the upper byte is the menu number and the lower byte is the item number (from 0). (Note that the array isn&#8217;t a table and has no initial size information. The data is written to words 0 to 3 in the array.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_remove_obj"><a class="anchor" href="#_remove_obj"></a>15.91. remove_obj</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:137 9 remove_obj object</strong></p>
</div>
<div class="paragraph">
<p>Detach the object from its parent, so that it no longer has any parent. (Its children remain in its possession.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_restart"><a class="anchor" href="#_restart"></a>15.92. restart</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:183 7 1 restart</strong></p>
</div>
<div class="paragraph">
<p>Restart the game. (Any "Are you sure?" question must be asked by the game, not the interpreter.) The only pieces of information surviving from the previous state are the "transcribing to printer" bit (bit 0 of 'Flags 2' in the header, at address <strong>$10</strong>) and the "use fixed pitch font" bit (bit 1 of 'Flags 2').</p>
</div>
<div class="paragraph">
<p>In particular, changing the program start address before a restart will not have the effect of restarting from this new address.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_restore"><a class="anchor" href="#_restore"></a>15.93. restore</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:182 6 1 restore ?(label)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:182 5 4 restore &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:1 1 5 restore table bytes name prompt&#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>See <strong>save</strong>. In Version 3, the branch is never actually made, since either the game has successfully picked up again from where it was saved, or it failed to load the save game file.</p>
</div>
<div class="paragraph">
<p>As with <strong>restart</strong>, the transcription and fixed font bits survive. The interpreter gives the game a way of knowing that a restore has just happened (see <strong>save</strong>).</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* From Version 5 it can have optional parameters as <strong>save</strong> does, and returns the number of bytes loaded if so. (Whether Infocom intended these options as part of Version 5 is doubtful, but it&#8217;s too useful a feature to exclude from this Standard.)</p>
</div>
<div class="paragraph">
<p>If the restore fails, 0 is returned, but once again this necessarily happens since otherwise control is already elsewhere.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_restore_undo"><a class="anchor" href="#_restore_undo"></a>15.94. restore_undo</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:10 A 5 restore_undo &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Like <strong>restore</strong>, but restores the state saved to memory by <strong>save_undo</strong>. (The optional parameters of <strong>restore</strong> may not be supplied.) The behaviour of <strong>restore_undo</strong> is unspecified if no <strong>save_undo</strong> has previously occurred (and a game may not legally use it): an interpreter might simply ignore this.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_ret"><a class="anchor" href="#_ret"></a>15.95. ret</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#1OP">1OP</a>:139 B ret value</strong></p>
</div>
<div class="paragraph">
<p>Returns from the current routine with the value given.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_ret_popped"><a class="anchor" href="#_ret_popped"></a>15.96. ret_popped</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:184 8 ret_popped</strong></p>
</div>
<div class="paragraph">
<p>Pops top of stack and returns that. (This is equivalent to <strong>ret sp</strong>, but is one byte cheaper.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_rfalse"><a class="anchor" href="#_rfalse"></a>15.97. rfalse</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:177 1 rfalse</strong></p>
</div>
<div class="paragraph">
<p>Return false (i.e., 0) from the current routine.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_rtrue"><a class="anchor" href="#_rtrue"></a>15.98. rtrue</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:176 0 rtrue</strong></p>
</div>
<div class="paragraph">
<p>Return true (i.e., 1) from the current routine.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_save"><a class="anchor" href="#_save"></a>15.99. save</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:181 5 1 save ?(label)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:181 5 4 save &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:0 0 5 save table bytes name prompt &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>On Versions 3 and 4, attempts to save the game (all questions about filenames are asked by interpreters) and branches if successful. From Version 5 it is a store rather than a branch instruction; the store value is 0 for failure, 1 for "save succeeded" and 2 for "the game is being restored and is resuming execution again from here, the point where it was saved".</p>
</div>
<div class="paragraph">
<p>It is illegal to use this opcode within an interrupt routine (one called asynchronously by a sound effect, or keyboard timing, or newline counting).</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.0]* The extension also has (optional) parameters, which save a region of the save area, whose address and length are in bytes, and provides a suggested filename: <strong>name</strong> is a pointer to an array of ASCII characters giving this name (as usual preceded by a byte giving the number of characters). See <strong>S</strong> 7.6. (Whether Infocom intended these options as part of Version 5 is doubtful, but it&#8217;s too useful a feature to exclude from this Standard.)</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.1]* As of Standard 1.1 an additional optional parameter, <strong>prompt</strong>, is allowed on Version 5 extended save/restore. This allows a game author to tell the interpreter whether it should ask for confirmation of the provided file name (<strong>prompt</strong> is 1), or just silently save/restore using the provided filename (<strong>prompt</strong> is 0). If the parameter is not provided, whether to prompt or not is a matter for the interpreter - this might be globally user-configurable. Infocom&#8217;s interpreters do prompt for filenames, many modern ones do not.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_save_undo"><a class="anchor" href="#_save_undo"></a>15.100. save_undo</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:9 9 5 save_undo &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Like <strong>save</strong>, except that the optional parameters may not be specified: it saves the game into a cache of memory held by the interpreter. If the interpreter is unable to provide this feature, it must return -1: otherwise it returns the <strong>save</strong> return value.</p>
</div>
<div class="paragraph">
<p>It is illegal to use this opcode within an interrupt routine (one called asynchronously by a sound effect, or keyboard timing, or newline counting).</p>
</div>
<div class="paragraph">
<p>(This call is typically needed once per turn, in order to implement "UNDO", so it needs to be quick.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_scan_table"><a class="anchor" href="#_scan_table"></a>15.101. scan_table</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:247 17 4 scan_table x table len form &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Is <strong>x</strong> one of the words in <strong>table</strong>, which is <strong>len</strong> words long? If so, return the address where it first occurs and branch. If not, return 0 and don&#8217;t.</p>
</div>
<div class="paragraph">
<p>The <strong>form</strong> is optional (and only used in Version 5?): bit 7 is set for words, clear for bytes: the rest contains the length of each field in the table. (The first word or byte in each field being the one looked at.) Thus <strong>$82</strong> is the default.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_scroll_window"><a class="anchor" href="#_scroll_window"></a>15.102. scroll_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:20 14 6 scroll_window window pixels</strong></p>
</div>
<div class="paragraph">
<p>Scrolls the given window by the given number of pixels (a negative value scrolls backwards, i.e., down) writing in blank (background colour) pixels in the new lines. This can be done to any window and is not related to the "scrolling" attribute of a window.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_attr"><a class="anchor" href="#_set_attr"></a>15.103. set_attr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:11 B set_attr object attribute</strong></p>
</div>
<div class="paragraph">
<p>Make <strong>object</strong> have the attribute numbered <strong>attribute</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_colour"><a class="anchor" href="#_set_colour"></a>15.104. set_colour</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:27 1B 5 set_colour foreground background</strong></p>
</div>
<div class="paragraph">
<p><strong>6 set_colour foreground background window</strong></p>
</div>
<div class="paragraph">
<p>If coloured text is available, set text to be foreground-against-background. (Flush any buffered text to screen, in the old colours, first.) In version 6, the <strong>window</strong> argument is optional and is by default the current window. (This option is supported in Infocom&#8217;s Amiga and DOS interpreters.)</p>
</div>
<div class="paragraph">
<p>(One Version 5 game uses this: 'Beyond Zork' (Paul David Doherty reports it as used "76 times in 870915 and 870917, 58 times in 871221") and from the structure of the table it clearly logically belongs in version 5.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_cursor"><a class="anchor" href="#_set_cursor"></a>15.105. set_cursor</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:239 F 4 set_cursor line column</strong></p>
</div>
<div class="paragraph">
<p><strong>6 set_cursor line column window</strong></p>
</div>
<div class="paragraph">
<p>Move cursor in the current window to the position (x,y) (in units) relative to (1,1) in the top left. (In Version 6 the window is supplied and need not be the current one. Also, if the cursor would lie outside the current margin settings, it is moved to the left margin of the current line.)</p>
</div>
<div class="paragraph">
<p>In Version 6, <strong>set_cursor -1</strong> turns the cursor off, and either <strong>set_cursor -2</strong> or <strong>set_cursor -2 0</strong> turn it back on. It is not known what, if anything, this second argument means: in all known cases it is 0.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_font"><a class="anchor" href="#_set_font"></a>15.106. set_font</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:4 4 5 set_font font &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:4 4 6 set_font font window &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>If the requested font is available, then it is chosen for the current window, and the store value is the font ID of the previous font (which is always positive). If the font is unavailable, nothing will happen and the store value is 0.</p>
</div>
<div class="paragraph">
<p>If the font ID requested is 0, the font is not changed, and the ID of the current font is returned.</p>
</div>
<div class="paragraph">
<p>(Infocom&#8217;s old interpreters did not store 0 for an unavailable font, but the feature is clearly useful and so was introduced in release 0.2 of this Standard.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.1]* In Version 6, <strong>set_font</strong> has an optional window parameter, as for <strong>set_colour</strong>. This was part of the original Infocom design, but omitted by earlier Standards. It is reinstated here, as it is useful to be able to measure a font that is about to be used in another window, so that window can be sized before attempting to place the cursor in it. A window number of -3 signifies "the currently selected window"</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_margins"><a class="anchor" href="#_set_margins"></a>15.107. set_margins</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:8 8 6 set_margins left right window</strong></p>
</div>
<div class="paragraph">
<p>Sets the margin widths (in pixels) on the left and right for the given window (which are by default 0). If the cursor is overtaken and now lies outside the margins altogether, move it back to the left margin of the current line (see <strong>S</strong> 8.8.3.2.2.1).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_text_style"><a class="anchor" href="#_set_text_style"></a>15.108. set_text_style</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:241 11 4 set_text_style style</strong></p>
</div>
<div class="paragraph">
<p>Sets the text style to: Roman (if 0), Reverse Video (if 1), Bold (if 2), Italic (4), Fixed Pitch (8). In some interpreters (though this is not required) a combination of styles is possible (such as reverse video and bold). In these, changing to Roman should turn off all the other styles currently set.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.1]* As of Standard 1.1, it is legal to request style combinations in a single <strong>set_text_style</strong> opcode by adding the values (which are powers of two) together. If the parameter is non-zero, then all the styles given are activated. If the parameter is zero, then all styles are deactivated. If the interpreter is unable to provide the requested style combination, it must give precedence first to the styles requested in the most recent call to <strong>set_text_style</strong>, and within that to the highest bit, making the priority Fixed, Italic, Bold, Reverse.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_true_colour"><a class="anchor" href="#_set_true_colour"></a>15.109. set_true_colour</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:13 D 5/</strong> set_true_colour foreground background*</p>
</div>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:13 D 6/</strong> set_true_colour foreground background window*</p>
</div>
<div class="paragraph">
<p>The foreground and background are 15-bit colour values:</p>
</div>
<div class="literalblock">
<div class="content">
<pre> bit 15 = 0
 bits 14-10 blue
 bits 9-5 green
 bits 4-0 red</pre>
</div>
</div>
<div class="paragraph">
<p>The optional window parameter is only allowed in V6, and operates the same as in <strong>set_colour</strong>.</p>
</div>
<div class="paragraph">
<p><strong>*</strong>*[1.1]* This opcode will only be present in interpreters obeying Standard 1.1 or later, so story files should check the standard number of the interpreter before executing this opcode.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_set_window"><a class="anchor" href="#_set_window"></a>15.110. set_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:235 B 3 set_window window</strong></p>
</div>
<div class="paragraph">
<p>Selects the given window for text output.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_show_status"><a class="anchor" href="#_show_status"></a>15.111. show_status</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:188 C 3 show_status</strong></p>
</div>
<div class="paragraph">
<p>(In Version 3 only.) Display and update the status line now (don&#8217;t wait until the next keyboard input). (In theory this opcode is illegal in later Versions but an interpreter should treat it as <strong>nop</strong>, because Version 5 Release 23 of 'Wishbringer' contains this opcode by accident.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_sound_effect"><a class="anchor" href="#_sound_effect"></a>15.112. sound_effect</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:245 15 5/3 sound_effect number effect volume routine</strong></p>
</div>
<div class="paragraph">
<p>The given effect happens to the given sound number. The low byte of <strong>volume</strong> holds the volume level, the high byte the number of repeats. (The value 255 means "loudest possible" and "forever" respectively.) (The "repeats" parameter indicates the total number of times to play the sound, not the number of times to repeat it after the first play.) (In Version 3, repeats are unsupported and the high byte must be 0.)</p>
</div>
<div class="paragraph">
<p>Note that sound effect numbers 1 and 2 are bleeps (see <strong>S</strong> 9) and in these cases the other operands must be omitted. Conversely, if any of the other operands are present, the sound effect number must be 3 or higher.</p>
</div>
<div class="paragraph">
<p>The <strong>effect</strong> can be: 1 (prepare), 2 (start), 3 (stop), 4 (finish with).</p>
</div>
<div class="paragraph">
<p>In Versions 5 and later, the <strong>routine</strong> is called (with no parameters) after the sound has been finished (it has been playing in the background while the Z-machine has been working on other things). (This is used by 'Sherlock' to implement fading in and out, which explains why mysterious numbers like <strong>$34FB</strong> were previously thought to be to do with fading.) The routine is not called if the sound is stopped by another sound or by an effect 3 call.</p>
</div>
<div class="paragraph">
<p>See the remarks to <strong>S</strong> 9 for which forms of this opcode were actually used by Infocom.</p>
</div>
<div class="paragraph">
<p>In theory, <strong>@sound_effect;</strong> (with no operands at all) is illegal. However interpreters are asked to beep (as if the operand were 1) if possible, and in any case not to halt.</p>
</div>
<div class="paragraph">
<p>Setting repeats to zero in V5 is illegal - it is suggested that interpreters treat this as a request to play the sound once, and maybe issue a warning.</p>
</div>
<div class="paragraph">
<p>To clarify:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @sound_effect number 3/4</pre>
</div>
</div>
<div class="paragraph">
<p>will stop (and optionally unload) sound "number" if it is currently playing (or loaded). Otherwise it is ignored.</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    @sound_effect 0 3/4</pre>
</div>
</div>
<div class="paragraph">
<p>will stop (and unload) all sounds - music and effects.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_split_window"><a class="anchor" href="#_split_window"></a>15.113. split_window</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:234 A 3 split_window lines</strong></p>
</div>
<div class="paragraph">
<p>Splits the screen so that the upper window has the given number of lines: or, if this is zero, unsplits the screen again. In Version 3 (only) the upper window should be cleared after the split.</p>
</div>
<div class="paragraph">
<p>In Version 6, this is supposed to roughly emulate the earlier Version 5 behaviour (see <strong>S</strong> 8), though the line count is in units rather than lines. (Existing Version 6 games seem to use this opcode only for bounding cursor movement. 'Journey' creates a status region which is the whole screen and then overlays it with two other windows.)</p>
</div>
<div class="paragraph">
<p>Windows 0 and 1 are tiled together to fill the screen, so that window 1 has the given height and is placed at the top left, while window 0 is placed just below it (with its height suitably shortened, possibly making it disappear altogether if window 1 occupies the whole screen).</p>
</div>
<div class="paragraph">
<p>A cursor remains in the same absolute screen position (which means that its y-coordinate will be different relative to the window origin, since this origin will have moved) unless this position is no longer in the window at all, in which case it is moved to the window origin (at the top left of the window).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_sread"><a class="anchor" href="#_sread"></a>15.114. sread</h3>
<div class="paragraph">
<p>This is the Inform name for the keyboard-reading opcode under Versions 3 and 4. (Inform calls the same opcode <strong>aread</strong> in later Versions.) See <strong>read</strong> for the specification.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_store"><a class="anchor" href="#_store"></a>15.115. store</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:13 D store (variable) value</strong></p>
</div>
<div class="paragraph">
<p>Set the <strong><a href="sect14.html#VAR">VAR</a>iable</strong> referenced by the operand to <strong>value</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_storeb"><a class="anchor" href="#_storeb"></a>15.116. storeb</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:226 2 storeb array byte-index value</strong></p>
</div>
<div class="paragraph">
<p><strong>array&#8594;byte-index = value</strong>, i.e. stores the given value in the byte at address <strong>array+byte-index</strong> (which must lie in dynamic memory). (See <strong>loadb</strong>.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_storew"><a class="anchor" href="#_storew"></a>15.117. storew</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:225 1 storew array word-index value</strong></p>
</div>
<div class="paragraph">
<p><strong>array-&#8594;word-index = value</strong>, i.e. stores the given value in the word at address <strong>array+2*word-index</strong> (which must lie in dynamic memory). (See <strong>loadw</strong>.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_sub"><a class="anchor" href="#_sub"></a>15.118. sub</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:21 15 sub a b &#8594; (result)</strong></p>
</div>
<div class="paragraph">
<p>Signed 16-bit subtraction.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_test"><a class="anchor" href="#_test"></a>15.119. test</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:7 7 test bitmap flags ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if all of the flags in bitmap are set (i.e. if <strong>bitmap &amp; flags == flags</strong>).</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_test_array"><a class="anchor" href="#_test_array"></a>15.120. "test_array"</h3>
<div class="paragraph">
<p>See <strong>clear_flag</strong>. (<strong>ITF</strong> implements this as unconditionally false.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_test_attr"><a class="anchor" href="#_test_attr"></a>15.121. test_attr</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:10 A test_attr object attribute ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Jump if <strong>object</strong> has <strong>attribute</strong>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_throw"><a class="anchor" href="#_throw"></a>15.122. throw</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#2OP">2OP</a>:28 1C 5/6 throw value stack-frame</strong></p>
</div>
<div class="paragraph">
<p>Opposite of <strong>catch</strong>: resets the routine call state to the state it had when the given stack frame value was 'caught', and then returns. In other words, it returns as if from the routine which executed the <strong>catch</strong> which found this stack frame value.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_tokenise"><a class="anchor" href="#_tokenise"></a>15.123. tokenise</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#VAR">VAR</a>:251 1B 5 tokenise text parse dictionary flag</strong></p>
</div>
<div class="paragraph">
<p>This performs lexical analysis (see <strong>read</strong> above).</p>
</div>
<div class="paragraph">
<p>The dictionary and flag operands are optional.</p>
</div>
<div class="paragraph">
<p>If a non-zero <strong>dictionary</strong> is supplied, it is used (if not, the ordinary game dictionary is). If the <strong>flag</strong> is set, unrecognised words are not written into the parse buffer and their slots are left unchanged: this is presumably so that if several <strong>tokenise</strong> instructions are performed in a row, each fills in more slots without wiping those filled by the others.</p>
</div>
<div class="paragraph">
<p>Parsing a user dictionary is slightly different. A user dictionary should look just like the main one but need not be alphabetically sorted. If the number of entries is given as -n, then the interpreter reads this as "n entries unsorted". This is very convenient if the table is being altered in play: if, for instance, the player is naming things.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_verify"><a class="anchor" href="#_verify"></a>15.124. verify</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#0OP">0OP</a>:189 D 3 verify ?(label)</strong></p>
</div>
<div class="paragraph">
<p>Verification counts a (two byte, unsigned) checksum of the file from <strong>$0040</strong> onwards (by taking the sum of the values of each byte in the file, modulo <strong>$10000</strong>) and compares this against the value in the game header, branching if the two values agree. (Early Version 3 games do not have the necessary checksums to make this possible.)</p>
</div>
<div class="paragraph">
<p>The interpreter must stop calculating when the file length (as given in the header) is reached. It is legal for the file to contain more bytes than this, but if so the extra bytes should all be 0. (Some story files are padded out to an exact number of virtual-memory pages.) However, many Infocom story files in fact contain non-zero data in the padding, so interpreters must be sure to exclude the padding from checksum calculations.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_window_size"><a class="anchor" href="#_window_size"></a>15.125. window_size</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:17 11 6 window_size window y x</strong></p>
</div>
<div class="paragraph">
<p>Change size of window in pixels. (Does not change the current display.)</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_window_style"><a class="anchor" href="#_window_style"></a>15.126. window_style</h3>
<div class="paragraph">
<p><strong><a href="sect14.html#EXT">EXT</a>:18 12 6 window_style window flags operation</strong></p>
</div>
<div class="paragraph">
<p>Changes attributes for a given window. A bitmap of attributes is given, in which the bits are: 0&#8201;&#8212;&#8201;keep text within margins, 1&#8201;&#8212;&#8201;scroll when at bottom, 2&#8201;&#8212;&#8201;copy text to output stream 2 (the printer), 3&#8201;&#8212;&#8201;buffer text to word-wrap it between the margins of the window.</p>
</div>
<div class="paragraph">
<p>The operation, by default, is 0, meaning "set to these settings". 1 means "set the bits supplied". 2 means "clear the ones supplied", and 3 means "reverse the bits supplied" (i.e. eXclusive OR).</p>
</div>
</div>
</div>
</div>
<h1 id="_an_unusual_font" class="sect0"><a class="anchor" href="#_an_unusual_font"></a>An Unusual Font</h1>
<div class="sect1">
<h2 id="ch.16"><a class="anchor" href="#ch.16"></a>16. Font 3 and character graphics</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_16_1"><a class="anchor" href="#_16_1"></a>16.1. 16.1</h3>
<div class="paragraph">
<p>The following table of 8x8 bitmaps gives a suitable appearance for font 3. The font must have a fixed pitch and characters must be printed immediately next to each other in all four directions.</p>
</div>
<div class="literalblock">
<div class="content">
<pre> 32( ):  76543210   33(!):  76543210   34("):  76543210   35(#):  76543210
        0                  0                  0                  0       #
        1                  1                  1                  1      #
        2                  2  #               2    #             2     #
        3                  3 ##               3    ##            3    #
        4                  4#######           4#######           4   #
        5                  5 ##               5    ##            5  #
        6                  6  #               6    #             6 #
        7                  7                  7                  7#
 36($):  76543210   37(%):  76543210   38(&amp;):  76543210   39('):  76543210
        0#                 0                  0                  0
        1 #                1                  1                  1
        2  #               2                  2                  2
        3   #              3                  3                  3########
        4    #             4                  4########          4
        5     #            5                  5                  5
        6      #           6                  6                  6
        7       #          7                  7                  7
 40(():  76543210   41()):  76543210   42(*):  76543210   43(+):  76543210
        0    #             0   #              0    #             0
        1    #             1   #              1    #             1
        2    #             2   #              2    #             2
        3    #             3   #              3########          3
        4    #             4   #              4                  4########
        5    #             5   #              5                  5    #
        6    #             6   #              6                  6    #
        7    #             7   #              7                  7    #
 44(,):  76543210   45(-):  76543210   46(.):  76543210   47(/):  76543210
        0    #             0   #              0   #              0
        1    #             1   #              1   #              1
        2    #             2   #              2   #              2
        3    #             3   #              3   #              3   #####
        4    ####          4####              4   #####          4   #
        5    #             5   #              5                  5   #
        6    #             6   #              6                  6   #
        7    #             7   #              7                  7   #</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> 48(0):  76543210   49(1):  76543210   50(2):  76543210   51(3):  76543210
        0                  0    #             0   #              0#
        1                  1    #             1   #              1 #
        2                  2    #             2   #              2  #
        3#####             3    #             3   #              3   #####
        4    #             4#####             4   #####          4   #
        5    #             5                  5  #               5   #
        6    #             6                  6 #                6   #
        7    #             7                  7#                 7   #
 52(4):  76543210   53(5):  76543210   54(6):  76543210   55(7):  76543210
        0       #          0    #             0########          0########
        1      #           1    #             1########          1########
        2     #            2    #             2########          2########
        3#####             3    #             3########          3########
        4    #             4#####             4########          4########
        5    #             5     #            5########          5
        6    #             6      #           6########          6
        7    #             7       #          7########          7
 56(8):  76543210   57(9):  76543210   58(:):  76543210   59(;):  76543210
        0                  0#####             0   #####          0    #
        1                  1#####             1   #####          1    #
        2                  2#####             2   #####          2    #
        3########          3#####             3   #####          3########
        4########          4#####             4   #####          4########
        5########          5#####             5   #####          5########
        6########          6#####             6   #####          6########
        7########          7#####             7   #####          7########
 60(&lt;):  76543210   61(=):  76543210   62(&gt;):  76543210   63(?):  76543210
        0########          0#####             0   #####          0   #####
        1########          1#####             1   #####          1   #####
        2########          2#####             2   #####          2   #####
        3########          3#####             3   #####          3   #####
        4########          4########          4########          4   #####
        5    #             5#####             5   #####          5
        6    #             6#####             6   #####          6
        7    #             7#####             7   #####          7
 64(@):  76543210   65(A):  76543210   66(B):  76543210   67(C):  76543210
        0                  0                  0#####             0   #####
        1                  1                  1#####             1   #####
        2                  2                  2#####             2   #####
        3   #####          3#####             3#####             3   #####
        4   #####          4#####             4#####             4   #####
        5   #####          5#####             5                  5  #
        6   #####          6#####             6                  6 #
        7   #####          7#####             7                  7#</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> 68(D):  76543210   69(E):  76543210   70(F):  76543210   71(G):  76543210
        0#                 0       #          0#####             0       #
        1 #                1      #           1#####             1
        2  #               2     #            2#####             2
        3   #####          3#####             3#####             3
        4   #####          4#####             4#####             4
        5   #####          5#####             5     #            5
        6   #####          6#####             6      #           6
        7   #####          7#####             7       #          7
 72(H):  76543210   73(I):  76543210   74(J):  76543210   75(K):  76543210
        0                  0                  0#                 0########
        1                  1                  1                  1
        2                  2                  2                  2
        3                  3                  3                  3
        4                  4                  4                  4
        5                  5                  5                  5
        6                  6                  6                  6
        7       #          7#                 7                  7
 76(L):  76543210   77(M):  76543210   78(N):  76543210   79(O):  76543210
        0                  0#                 0       #          0
        1                  1#                 1       #          1########
        2                  2#                 2       #          2
        3                  3#                 3       #          3
        4                  4#                 4       #          4
        5                  5#                 5       #          5
        6                  6#                 6       #          6########
        7########          7#                 7       #          7
 80(P):  76543210   81(Q):  76543210   82(R):  76543210   83(S):  76543210
        0                  0                  0                  0
        1########          1########          1########          1########
        2#                 2##                2###               2####
        3#                 3##                3###               3####
        4#                 4##                4###               4####
        5#                 5##                5###               5####
        6########          6########          6########          6########
        7                  7                  7                  7
 84(T):  76543210   85(U):  76543210   86(V):  76543210   87(W):  76543210
        0                  0                  0                  0
        1########          1########          1########          1########
        2#####             2######            2#######           2########
        3#####             3######            3#######           3########
        4#####             4######            4#######           4########
        5#####             5######            5#######           5########
        6########          6########          6########          6########
        7                  7                  7                  7</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre> 88(X):  76543210   89(Y):  76543210   90(Z):  76543210   91([):  76543210
        0                  0                  0#      #          0    #
        1       #          1#                 1 #    #           1    #
        2       #          2#                 2  #  #            2    #
        3       #          3#                 3   ##             3    #
        4       #          4#                 4   ##             4########
        5       #          5#                 5  #  #            5    #
        6       #          6#                 6 #    #           6    #
        7                  7                  7#      #          7    #
 92(\):  76543210   93(]):  76543210   94(^):  76543210   95(_):  76543210
        0   ##             0   ##             0   ##             0########
        1  ####            1   ##             1  ####            1#      #
        2## ## ##          2   ##             2## ## ##          2#      #
        3   ##             3   ##             3   ##             3#      #
        4   ##             4## ## ##          4## ## ##          4#      #
        5   ##             5  ####            5  ####            5#      #
        6   ##             6   ##             6   ##             6#      #
        7                  7                  7                  7########
 96('):  76543210   97(a):  76543210   98(b):  76543210   99(c):  76543210
        0  ####            0##   #            0 ##               0   #
        1 ##  ##           1# # #             1 # #              1   ##
        2     ##           2#  #              2 #  #             2   # #
        3    ##            3##                3 ###              3#  #  #
        4   ##             4# #               4 #  #             4 # #
        5                  5#  #              5 # #              5  ##
        6   ##             6#                 6 ##               6   #
        7                  7                  7                  7
100(d):  76543210  101(e):  76543210  102(f):  76543210  103(g):  76543210
        0#     #           0#     #           0#  # #            0#     #
        1##   ##           1##   ##           1# # #             1 #   #
        2# # # #           2# # # #           2## #              2  # #
        3#  #  #           3#  #  #           3# #               3   #
        4# # # #           4#     #           4##                4  # #
        5##   ##           5#     #           5#                 5 #   #
        6#     #           6#     #           6#                 6#     #
        7                  7                  7                  7
104(h):  76543210  105(i):  76543210  106(j):  76543210  107(k):  76543210
        0##    #           0   #              0   #              0   #
        1# #   #           1   #              1  ###             1   #
        2## #  #           2   #              2 # # #            2   #
        3# # # #           3   #              3#  #  #           3  ###
        4#  # ##           4   #              4 # # #            4 # # #
        5#   # #           5   #              5  ###             5#  #  #
        6#    ##           6   #              6   #              6#  #  #
        7                  7                  7                  7</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>108(l):  76543210  109(m):  76543210  110(n):  76543210  111(o):  76543210
        0   #              0##   ##           0#  #              0##   #
        1   ##             1# # # #           1 # #              1# # ##
        2   # #            2#  #  #           2  ###             2## # #
        3   #  #           3# # # #           3   # #            3# # #
        4   #              4##   ##           4   #  #           4#  #
        5   #              5#     #           5   #              5#
        6   #              6#     #           6   #              6#
        7                  7                  7                  7
112(p):  76543210  113(q):  76543210  114(r):  76543210  115(s):  76543210
        0#                 0 #                0 ##               0 #
        1#                 1 #                1 # #              1 #   #
        2#                 2 #                2 #  #             2 #  ##
        3#  #              3 ####             3 # #              3 # # #
        4# # #             4 #   #            4 ##               4 ##  #
        5##   #            5 #   #            5 # #              5 #   #
        6#     #           6 #   #            6 #  #             6     #
        7                  7                  7                  7
116(t):  76543210  117(u):  76543210  118(v):  76543210  119(w):  76543210
        0   #              0 ##               0   #              0 ##
        1  ###             1 # #              1# ### #           1 # #
        2 # # #            2 #  #             2 # # #            2 #  #
        3#  #  #           3 #   #            3   #              3 # #
        4   #              4 #   #            4   #              4 ##
        5   #              5 #   #            5   #              5 #
        6   #              6 #   #            6   #              6 #
        7                  7                  7                  7
120(x):  76543210  121(y):  76543210  122(z):  76543210  123({):  76543210
        0#  #  #           0###               0   #              0###  ###
        1 # # #            1## #              1  # #             1##    ##
        2  ###             2# # #             2 #   #            2  #  #
        3   #              3#  # #            3  # #             3###  ###
        4   #              4#  ## #           4   #              4###  ###
        5   #              5#  # ##           5  # #             5###  ###
        6   #              6#  #  #           6 #   #            6###  ###
        7                  7                  7                  7########
124( ):  76543210  125(}):  76543210  126(~):  76543210
        0###  ###          0###  ###          0##    ##
        1###  ###          1##    ##          1#  ##  #
        2###  ###          2  #  #            2#####  #
        3###  ###          3###  ###          3####  ##
        4  #  #            4  #  #            4###  ###
        5##    ##          5##    ##          5########
        6###  ###          6###  ###          6###  ###
        7########          7########          7########</pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="remarks-16"><a class="anchor" href="#remarks-16"></a>Remarks</h3>
<div class="paragraph">
<p>Two different versions of font 3 were supplied by Infocom, which we shall call the Amiga and PC forms (the Atari form is the same as for the PC). The arrow shape differed slightly and so did the rune alphabet. Each was an attempt to map the late Anglian ("futhorc") runic alphabet, which has 33 characters, onto our Latin alphabet. The drawings above are from the Amiga set.</p>
</div>
<div class="paragraph">
<p>Most of the mappings are straightforward (e.g., Latin A maps to Anglian a), except that: Latin C is mapped to Anglian eo; K to "other k" (previously a z sound); Q to Anglian k (the same rune as c); V to ea; X to z and Z to oe. The PC runes differ as follows: G has an ornamental circle making it more look like "other z"; K maps to Anglian k (or c); Q is an Anglian ea (which resembles the late Anglian q); V is an oe; X is an "other k" and Z is a symbol Infocom seem to have invented themselves. (Though less well drawn the PC runes arguably have a better sound-mapping.)</p>
</div>
<div class="paragraph">
<p>The font behaviour of 'Beyond Zork', which does have bit 3 of 'Flags 2' set, is rather complicated and depends on the interpreter number it finds in the header (see <strong>S</strong> 11). Specifically:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>(a Digital terminal) 'BZ' asks whether the player has a VT220 terminal (a model capable of character graphics) and uses font 3 if and only if the answer is yes. (An in-house convenience: Infocom used a Digital mainframe.)</p>
</li>
<li>
<p>(Apple IIe) 'BZ' never uses font 3.</p>
</li>
<li>
<p>(Macintosh) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(Amiga) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(Atari ST) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(MSDOS) 'BZ' uses font 3 if it finds bit 3 of 'Flags 2' set (indicating that a graphical screen mode is in use) and otherwise uses IBM PC graphics codes. These need to be converted back into ASCII. The conversion process used by the <strong>Zip</strong> interpreter is as follows:</p>
<div class="literalblock">
<div class="content">
<pre> 179   becomes   a vertical stroke (ASCII 124)
 186             a hash (ASCII 35)
 196             a minus sign (ASCII 45)
 205             an equals sign (ASCII 61)
 all others in the range 179 to 218 become a plus sign (ASCII 43)</pre>
</div>
</div>
</li>
<li>
<p>(Commodore 128) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(Commodore 64) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(Apple IIc) 'BZ' uses Apple character graphics (possibly "Mousetext"), but has problems when the units used are not $1\times 1$.</p>
</li>
<li>
<p>(Apple IIgs) 'BZ' always uses font 3.</p>
</li>
<li>
<p>(Tandy) 'BZ' crashes on the public interpreters.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>A similarly tangled process is used in 'Journey'. It is obviously highly unsatisfactory to have to make the decision in the above way, which is why <strong>set_font</strong> is now required to return 0 indicating non-availability of a font.</p>
</div>
<div class="paragraph">
<p>Stefan Jokisch suggests that Infocom originally intended the graphics bit as a way to develop Version 5 to allow a graphical version in parallel with the normal text one. For instance, when the Infocom MSDOS interpreter starts up, it looks at the graphics flag and:</p>
</div>
<div class="paragraph">
<p>if clear, it sets the font width/height to 1/1 (so that screen units are character positions);</p>
</div>
<div class="paragraph">
<p>if set, it enters MGCA, a graphical screen mode and sets the font width/height to 8/8 (so that screen units are pixels).</p>
</div>
<div class="paragraph">
<p>The "COLOR" command in 'BZ' (typed at the keyboard) also behaves differently depending on the interpreter number, which is legal behaviour and has no impact on the specification.</p>
</div>
</div>
</div>
</div>
<h1 id="_appendices" class="sect0"><a class="anchor" href="#_appendices"></a>Appendices</h1>
<div class="sect1">
<h2 id="app.a"><a class="anchor" href="#app.a"></a>Appendix A: Error messages and debugging</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Older interpreters, such as <strong>ITF</strong>, are extremely curt when an error condition is reached (for example, an illegal opcode). It was assumed that Infocom&#8217;s shipped story files were bug-free, which is mostly true, so that errors could only arise through a bug elsewhere in the interpreter.</p>
</div>
<div class="paragraph">
<p>In debugging Inform games, though, many error conditions can arise and it is extremely helpful to report these as fully as possible. These include:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>An illegal opcode being hit;</p>
</li>
<li>
<p>A call to what can&#8217;t be a routine (because the initial byte is not between 0 and 15);</p>
</li>
<li>
<p>A jump or call to an address beyond the size of the story file;</p>
</li>
<li>
<p>An attempt to <strong>print_obj</strong>, or otherwise access, an object which doesn&#8217;t exist, such as object number 0.</p>
</li>
<li>
<p>An attempt to write to, or get the property length of, a nonexistent property.</p>
</li>
<li>
<p>An attempt to access an attribute outside the range 0 to 31 or 0 to 47 (depending on Version). (But note that Infocom&#8217;s 'Sherlock' contains a bug causing it to try setting or clearing attribute number 48.)</p>
</li>
<li>
<p>Division by zero. The player sometimes then has the annoying task of working out where the error took place in source code. Providing a stack back-trace would be a help.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>As mentioned in <strong>S</strong> 3, it&#8217;s helpful to screen out any illegal ZSCII characters between 0 and 31 which are accidentally printed: crashes can be very mysterious when they cause interpreters to send control codes to the terminal.</p>
</div>
<div class="paragraph">
<p>In addition, an interpreter might provide options for keeping track of maximum stack usage and the typical number of opcodes executed between each read from the keyboard. (But watching these is a time-wasting activity, so they should be options.)</p>
</div>
<div class="paragraph">
<p>Finally, infinite loops fairly often happen, as in any programming language. On a system without pre-emptive multi-tasking, this may lock up the whole machine, as the usual way that porters implement multi-tasking is to return control to the host operating system only when the keyboard is read. This can be avoided by providing a point in the code which could return control to the OS from time to time (say, every 2000 instructions).</p>
</div>
<hr>
<div class="paragraph">
<p>A number of post-Infocom games have been released which contain errors, most often trying to perform illegal operations on object 0. Many interpreters silently ignored these errors, which can make it very to notice and track down bugs.</p>
</div>
<div class="paragraph">
<p>It is desirable for modern interpreters to be able to notify players about these bugs, but this can also ruin gameplay. It is highly recommended, then, that interpreters have four levels of error checking, selectable by the user (through a command-line or menu option, or similar):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Never report the bug.</p>
</li>
<li>
<p>Report the first instance of each type of error.</p>
</li>
<li>
<p>Report every error.</p>
</li>
<li>
<p>Fatal error and close the interpreter on any error.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app.b"><a class="anchor" href="#app.b"></a>Appendix B: Conventional contents of the header</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The header table in <a href="#ch.11">section 11</a> details everything the interpreter needs to know about the header&#8217;s contents. A few other slots in the header are meaningful but only by convention (since existing Infocom and Inform games write them). These additional slots are described here.</p>
</div>
<div class="paragraph">
<p>As in <strong>S</strong> 11, "Hex" means the address, in hexadecimal; "V" the earliest version in which the feature appeared; "Dyn" means that the byte or bit may legally be changed by the game during play (no others may legally be changed by the game); "Int" means that the interpreter may (in some cases must) do so.</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 10. <strong>Conventional usage of unspecified header memory</strong></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hex</th>
<th class="tableblock halign-left valign-top">V</th>
<th class="tableblock halign-left valign-top">Dyn</th>
<th class="tableblock halign-left valign-top">Int</th>
<th class="tableblock halign-left valign-top">Contents</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 1:</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 3: The legendary "Tandy" bit (see note)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Release number (word)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>Flags 2:</em></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><em>3</em></p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bit 4: Set in the Amiga version of The Lurking Horror so presumably to do with sound effects?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10: Possibly set by interpreter to indicate an error with the printer during transcription</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">12</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial code (six characters of ASCII)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Serial number (ASCII for the compilation date in the form YYMMDD)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">38</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">*</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infocom used this as 8 bytes of ASCII: the player&#8217;s user-name on their own mainframe, useful to identify which person played a saved-game (however, the bytes are all 0 in shipped story files)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">3C</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Inform 6 stores 4 bytes of ASCII here, giving the version of Inform used to compile the file: for instance, "6.11".</p></td>
</tr>
</tbody>
</table>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>In Versions 1 to 3, bits 0 and 7 of 'Flags 1' are unused. (The meaning of bit 2 has recently been discovered: see <a href="#ch.11">section 11</a>.) In later Versions, bits 0, 6 and 7 are unused. In 'Flags 2', bits 9 and 11-15 are unused. Infocom used up almost the whole header: only the bytes at <strong>$32</strong> and <strong>$33</strong> are unused in any Version, and those are now allocated for standard interpreters to give their Revision numbers.</p>
</li>
<li>
<p>Some early Infocom games were sold by the Tandy Corporation, who seem to have been sensitive souls. 'Zork I' pretends not to have sequels if it finds the Tandy bit set. And to quote Paul David Doherty:</p>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>In 'The Witness', the Tandy Flag can be set while playing the game, by typing <strong>$DB</strong> and then <strong>$TA</strong>. If it is set, some of the prose will be less offensive. For example, "private dicks" become "private eyes", "bastards" are only "idiots", and all references to "slanteyes" and "necrophilia" are removed.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>We live in an age of censorship.</p>
</div>
</li>
<li>
<p>For comment on interpreter numbers, see <strong>S</strong> 11. Infocom&#8217;s own interpreters were generally rewritten for each of versions 3 to 6. For instance, interpreters known to have been shipped with the Macintosh gave version letters B, C, G, I (Version 3), E, H, I (Version 4), A, B, C (Version 5) and finally 6.1 for Version 6. (Version 6 interpreters seem to have version numbers rather than letters.) See the "Infocom fact sheet" for fuller details.</p>
</li>
<li>
<p>Inform 6 story files are easily distinguished from all other story files by their usage of the last four header bytes. Inform 1 to 5 story files are best distinguished from Infocom ones by the serial code date: anything before 930000 is either an Infocom file, or a fake. (The author of 'Jigsaw' is tempted to compile a millenial version with serial code 991231 when the time comes, but then the next day serial codes will clock over to 000101. The decision of how to continue serial codes past the year 2079 is deferred to a future revision of this Standard.) Clearly there is no point going to any trouble to prevent fakes, but with a little practice it&#8217;s easy to tell whether Zilch or Inform compiled a file from the style of code generated.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app.c"><a class="anchor" href="#app.c"></a>Appendix C: Resources available</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
&#8230;&#8203;the dead hand of the academy had yet to stifle the unbridled enthusiasms of a small band of amateurs in Europe and America.
</blockquote>
<div class="attribution">
&#8212; Michael D. Coe<br>
<cite>Breaking the Maya Code</cite>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the hypertext links in this appendix are to WWW sites external to the standards document, and were correct as of 21th February 2014.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The resources below are mainly available from the <a href="http://www.ifarchive.org/if-archive/">if-archive</a> maintained by David Kinder and Stephen Granade.</p>
</div>
<hr>
<div class="sect2">
<h3 id="_public_interpreters"><a class="anchor" href="#_public_interpreters"></a>C.1. Public Interpreters</h3>
<div class="paragraph">
<p>Since the 1.0 Standard was first introduced, a variety of <a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXinterpreters.html">interpreters</a> have become available, for many different platforms and with a variety of features. The page on <a href="http://inform7.com/if/interpreters/">Playing Interactive Fiction</a> at inform7.com is a good place to start when looking for an interpreter, as is the <a href="http://www.ifwiki.org/index.php/Z-machine#Assorted_Z-machine_interpreters">ifwiki page on the Z-Machine</a>.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_testing_compliance"><a class="anchor" href="#_testing_compliance"></a>C.2. Testing compliance</h3>
<div class="paragraph">
<p>A few story files exist to test interpreter for various Z-Machine features:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="http://ifarchive.org/if-archive/infocom/interpreters/tools/czech_0_8.zip">Czech</a> is a general Z-Machine unit test by Evin Robertson and Amir Karger.</p>
</li>
<li>
<p><a href="http://eblong.com/zarf/ftp/praxix.z5">Praxix</a> is a general Z-Machine unit test by Andrew Plotkin and Dannii Willis.</p>
</li>
<li>
<p><a href="http://ifarchive.org/if-archive/infocom/interpreters/tools/etude.tar.Z">TerpEtude</a> by Andrew Plotkin is a unit test with a focus on IO.</p>
</li>
<li>
<p><a href="http://curiousdannii.github.com/if/tests/unicode.z5">Unicode</a> by David Kinder tests Unicode input and output.</p>
</li>
<li>
<p><a href="http://ifarchive.org/if-archive/infocom/interpreters/tools/strictz.z5">Strict Z Test</a> by Torbjorn Andersson tests an interpreter&#8217;s abilitity to handle errors in story files.</p>
</li>
</ol>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_compilers"><a class="anchor" href="#_compilers"></a>C.3. Compilers</h3>
<div class="paragraph">
<p>Infocom&#8217;s original compiler <strong>Zilch</strong> no longer exists, but a PDF copy of <a href="http://www.xlisp.org/zil.pdf">Learning ZIL</a>, Infocom&#8217;s documentation for their <strong>ZIL</strong> language, is available. Since the emergence of this file, there have been a few attempts at making a new <strong>ZIL</strong> compiler, most notably <a href="https://sourceforge.net/projects/zilf/">ZILF</a> by Jesse McGrew.</p>
</div>
<div class="paragraph">
<p>No continuous part of the source code of any of Infocom&#8217;s games is in the public domain [but see <a href="http://www.ifarchive.org/if-archive/infocom/articles/NZT-Zorkhistory.txt">Stu Galley&#8217;s chapter of an Infocom history article</a>, and the IEEE article, for fragments].</p>
</div>
<div class="paragraph">
<p><strong>Inform</strong> remains the most popular compiler for Z-Machine games. In 2006, the first public release of <a href="http://inform7.com/">Inform 7</a> was made available. <strong>Inform 7</strong> is a very different language from previous versions of Inform, with a focus on natural language and a powerful IDE.</p>
</div>
<div class="paragraph">
<p>While <strong>Inform 7</strong> is the main focus of development, <a href="http://inform-fiction.org/">Inform 6</a> is still widely used and the compiler and libraries continue to be maintained.</p>
</div>
<div class="paragraph">
<p>A few <a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXcompilers.html">other compilers</a> have been made available over the years.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_utility_programs"><a class="anchor" href="#_utility_programs"></a>C.4. Utility programs</h3>
<div class="paragraph">
<p>Mark Howell has written a toolkit of <a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXtoolsXztools.html">Ztools</a>, or utility programs (1991-5, updated 1997), which includes:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong>Txd</strong>, a disassembler for Versions 1 to 8. (Uses the same opcode names as Inform and this document, and has an option to disassemble in Inform assembly-language syntax.)</p>
</li>
<li>
<p><strong>Infodump</strong>, capable of printing the header information, object tree (with properties and attributes), dictionary and grammar tables of any Infocom or Inform-compiled game. (Understands four varieties of grammar table: Infocom pre-Version 6, Infocom Version 6, Inform GV1 and GV2.)</p>
</li>
<li>
<p><strong>Pix2gif</strong>, for converting Version 6 picture data to GIF files.</p>
</li>
<li>
<p><strong>Check</strong>, for verifying Infocom or Inform story files.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>These continue to be maintained (by Matthew Russotto) and the first two are extremely useful. <strong>Infodump</strong> largely supersedes Mike Threepoint&#8217;s vocabulary dumper <strong>Zorkword</strong> (1991-2), which was important in its day (and which this author found extremely helpful when writing Inform 1).</p>
</div>
<div class="paragraph">
<p><a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXtoolsXreform.html">Reform</a>, by Ben Rudiak-Gould, is a decompiler for Z-Machine games which will attempt to convert them into Inform 6 source code.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_story_files"><a class="anchor" href="#_story_files"></a>C.5. Story files</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Numerous <a href="http://www.ifarchive.org/indexes/if-archiveXgamesXzcode.html">Inform-compiled story files</a> are publically available.</p>
</li>
<li>
<p>A few Infocom story files are public, notably two 4-in-1 sample games (released for advertising purposes: <a href="http://www.ifarchive.org/if-archive/infocom/demos/sampler1_R55.z3">55.850823</a> and <a href="http://www.ifarchive.org/if-archive/infocom/demos/sampler2.z3">97.870601</a>) and <a href="http://www.ifarchive.org/if-archive/infocom/demos/minizork.z3">Minizork</a> (a heavily abbreviated form of Zork I released with a Commodore magazine).</p>
</li>
<li>
<p>Almost all Infocom&#8217;s games remain commercially available in anthologies published by <a href="http://www.activision.com">Activision</a>. Copyright resides in them and they should not available by FTP from any site.</p>
</li>
<li>
<p>A few other Infocom story files have existed but are neither on sale nor released from copyright: this applies to several of the Version 6 games, those games involving literary rights or other legal issues ('Shogun', 'Hitch-Hiker&#8217;s Guide To The Galaxy') and ephemera such as beta-test versions (notably the German version of 'Zork I') which have somehow passed into private circulation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Most of the Infocom games exist in <a href="#app.f">several different releases</a>, and some were written for one Version and then ported to later ones. 'Zork I', for instance, has at least 11 releases, 2 early, 8 in Version 3 (with release numbers between 5 to 88 in chronological order) and one in Version 5 (release 52&#8201;&#8212;&#8201;the releases go back to 1 when the version changes).</p>
</div>
<div class="paragraph">
<p>Version 1 and 2 games are extinct, though there are a few fossils in the hands of collectors.</p>
</div>
<hr>
</div>
<div class="sect2">
<h3 id="_documents"><a class="anchor" href="#_documents"></a>C.6. Documents</h3>
<div class="paragraph">
<p>The definitive guide to all Infocom story files known to exist, and an indispensable reference for anyone interested in Infocom, is Paul David Doherty&#8217;s <a href="http://www.ifarchive.org/if-archive/infocom/info/fact-sheet.txt">Infocom fact sheet</a>, which is regularly updated, concise and precise. This supersedes Paul Smith&#8217;s "Infocom Game Information" file.</p>
</div>
<div class="paragraph">
<p>Stefan Jokisch has written a <a href="http://www.ifarchive.org/if-archive/infocom/info/sound_format.txt">brief specification of Infocom-format sound effects files</a>.</p>
</div>
<div class="paragraph">
<p>Martin Frost is the author of the <a href="../quetzal/index.html">Quetzal</a> standard for saved-game files. Patches to adapt <strong>Zip</strong>-based interpreters to use <strong>Quetzal</strong> are available.</p>
</div>
<div class="paragraph">
<p>Andrew Plotkin is the author of the <a href="http://www.eblong.com/zarf/blorb/blorb.html">Blorb</a> standard for packaging up images and sounds with Z-machine games.</p>
</div>
<div class="paragraph">
<p>The <a href="http://www.inform-fiction.org/source/tm/TechMan.txt">Inform Technical Manual</a> documents the format of parsing tables used in Inform games.</p>
</div>
<div class="paragraph">
<p>The documentation for Infocom&#8217;s games is available online (with permission from Activision) courtesy of the <a href="http://infodoc.plover.net/">Infocom Documentation Project</a>. In addition, an archive of the " <a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXshipped-documentation.html">samplers</a>" is publically available, as is <a href="http://www.ifarchive.org/indexes/if-archiveXinfocomXarticles.html">an interesting historical archive of magazine articles</a> concerning Infocom, and articles from Infocom&#8217;s own publicity magazine [indexed <a href="http://www.ifarchive.org/if-archive/infocom/NZT+TSL/NZT+TSL.list">here</a>].</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app.d"><a class="anchor" href="#app.d"></a>Appendix D: A short history of the Z-machine</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Infocom made six main Versions of the Z-machine and several minor variant forms. These are recognisably similar but with labyrinthine differences, like different archaic dialects of the same language. (The archaeological record stops sharply in 1989 when the civilisation in question collapsed.)</p>
</div>
<div class="paragraph">
<p>Broadly, these fall into two groups: early (Versions 1 to 3) and late (4 to 6). More fully:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>Version 1   Early Apple II and TRS-80 Model I games
Version 2   Early Apple II and TRS-80 Model I games
Version 3   "Standard" series games
Version 4   "Plus" series games
Version 5   "Advanced" series games, or, as the marketing division would
            have it, "Solid Gold Interactive Fiction" -- a reference to
            the colour (though not composition) of the boxes they came in
Version 6   Later games with graphics, mouse support, etc.</pre>
</div>
</div>
<div class="paragraph">
<p>Infocom called their own interpreters ZIP (versions 1 to 3), EZIP/LZIP (V4), XZIP (V5) and YZIP (V6). They speculated on the possibility of an interpreter capable of running all Versions, but never published one.</p>
</div>
<div class="paragraph">
<p>The original purpose of the Z-machine was simply to implement as much as possible of the mainframe game "Zork" on the first popular wave of home computers.</p>
</div>
<div class="paragraph">
<p>(Apparently "zork" was a nonsense word used at MIT for the current uninstalled program in progress, and stuck. Just as this document uses the term "Z-machine" for both the machine and its loaded program (which is also sometimes called the "story file"), so ZIP (Zork Implementation Program) was used to mean either the interpreter or the object code it interpreted. Code was written in ZIL (Zork Implementation Language), which was derived from MDL (informally called "muddle"), a particularly unhelpful form of LISP. It was then compiled by ZILCH to assembly code which was passed to ZAP to make the ZIP.)</p>
</div>
<div class="paragraph">
<p>The Z-machine as originally constructed was surprisingly similar to that in use today. Version 1 (by Joel Berez and Marc Blank, in Autumn 1979) contained essentially all of the main architecture: the header, the memory divided into three, the variables and stack, the object tree, the dictionary, the instruction format. It used "shift lock" characters (a text compression trick which did not survive, though it was more efficient on long sequences of capital letters or punctuation characters than the technique which replaced it). The first micro interpreters were for the TRS-80 Model I (by Scott Cutler) and the Apple II (by Bruce K. Daniels). (A TRS-80 Model II interpreter was written but never actually shipped.)</p>
</div>
<div class="paragraph">
<p>Version 2 was only a minor enhancement. Abbreviations (used to help text compression) appeared, but only in one 32-word bank, and the six-digit serial number appeared in the header, though it wasn&#8217;t always the date in those days: Release 7 of 'Zork II', for instance, is numbered <strong>UG3AU5</strong>. (Other bizarre serial numbers, such as <strong>000000</strong>, appear on fakes or beta-test releases.)</p>
</div>
<div class="paragraph">
<p>In Version 3, the text encoding alphabets changed again, and the old "shift lock" codes were dropped in favour of expanding the abbreviations bank to 96 entries. The "verify" opcode and checksums appeared; and a new opcode to reprint the status line at the top of the screen was introduced. (Previously, this had been updated only when input was taken from the keyboard.) The earliest Version 3 releases ('Deadline', then reissues of 'Zork I' and 'II') were in March and April 1982; the last (the 'Minizork', a cassette-based Commodore-64 sample of 'Zork') was in November 1987.</p>
</div>
<div class="paragraph">
<p>The idea of widespread portability finally came of age as (between 1982 and 1985) interpreters were developed for the Atari 400/800, CP/M, the IBM PC, the TRS-80 Model III, the NEC APC, the DEC Rainbow, the Commodore 64, the TI Professional, the DECmate, the Tandy-2000, the Kaypro II, the Osborne 1, MS-DOS, the TI 99/4a, the Apple Macintosh, the Epson QX-10, the Apricot, the Atari ST and the Amiga. Infocom&#8217;s middle period coincided with the bubble in home computers, before the market collapsed to its present apparently stable state (in which IBM and Apple share almost the entire market), and the Z-machine&#8217;s portability gave Infocom a unique advantage over its competitors. Also, it was an expertly marketed quality brand at a time when standards of workmanship were very variable; and text-only games did not seem so dull at a time when graphics were on the whole crude and slow. These factors combined to give Infocom considerable (though never enormous) commercial success.</p>
</div>
<div class="paragraph">
<p>By 1982, then, the Z-machine had stabilised to a clean design which was to remain in use for six years. It was very portable, contained everything reasonably necessary and most of its complications were badly-needed space optimisations. (Although Version 3 can fit 128K of story file, the practical limit in 1982-4 was about 110K, that being the typical disc capacity on target machines.) The ZAP assembler was cleverly written to exploit these optimisations, though the Zilch compiler&#8217;s code generator was much less efficient. (Interestingly, Infocom did not develop any generic central library, and Infocom&#8217;s authors worked fairly independently of each other: each new game would inherit a small core of code from a previous one, but this would make up only about 10K of code (about a third of the size of the Inform library) and would end up being hacked about to suit the new game. Without a central library, Infocom games waste a fair amount of space in duplicating code for routine operations many times over. For this reason, Inform games tend to squash appreciably more design into the format.)</p>
</div>
<div class="paragraph">
<p>"Verify" and checksum data were quickly introduced. However, the first serious variant on Version 3 was made in 1984 when a primitive form of screen-splitting was invented to give 'Seastalker' a sonar display. This design (perhaps accidentally) became the foundation for the graphics systems of later versions.</p>
</div>
<div class="paragraph">
<p>Much later (in 1987) sound effects were added to Version 3 for 'The Lurking Horror', though by that time it was really a Version 5 feature being passed down to the old model (and only to the Amiga interpreter in any case). ('TLH' is contemporaneous with 'Sherlock' (in Version 5), the only other game to actually use the sound effects features.)</p>
</div>
<div class="paragraph">
<p>During 1983-5, Infocom poured resources into an ambitious pet project of its founders: 'Cornerstone', a database which used some of the same portable virtual machine ideas as the Z-machine. The business market, however, was not nearly as diverse as the home computer market: 'Cornerstone' probably was the best database available on the Atari ST, but it made no impression on the IBM PC market. The result was a commercial failure which compounded the company&#8217;s over-expansion problems (driving it into a merger with Activision), though it certainly did not destroy Infocom&#8217;s viability.</p>
</div>
<div class="paragraph">
<p>By 1985, Infocom had begun to write interpreters in C for the sake of portability (previously, a different assembly-language program had to be maintained for every model of computer). The main motivation to keep the format stable was therefore largely removed: it became possible to upgrade the Z-machine for every new game, if need be.</p>
</div>
<div class="paragraph">
<p>There were two basic pressures for change. One was that home computers were larger, and several fundamental restrictions (the game size being only 128K, the number of objects only 255, the attributes only 32, the properties only 31) were beginning to bite. The other was the drive for more gimmicks - character graphics, flashier status lines, sound effects, different typefaces, and so on. The former led to logical, easy to understand structural changes in the machine (designed by Marc Blank). The latter, in contrast, made a mess of the system of opcodes (designed by committee).</p>
</div>
<div class="paragraph">
<p>More does not mean better (halving the price of paper does not double the quality of the novel). The relieving of size restrictions only increased design time&#8201;&#8212;&#8201;or endangered the quality of the designs being produced. The Version 3 games have a spare, concise literary style which is absent from the later games. (But Inform authors have certainly found Version 3 slightly too small for comfort, and it&#8217;s useful to be able to spill over its boundaries.)</p>
</div>
<div class="paragraph">
<p>In August the first Version 4 game ('A Mind Forever Voyaging') reached production. Opinions vary as to whether it was brilliant or awful, but it was certainly a departure (and could not have been written under Version 3). In retrospect there is no doubt about 'Trinity', now generally considered the finest game written: it had previously been shelved as too ambitious for the Version 3 format. Still, most of the new 1985/6 games remained in Version 3: there were still plenty of 8-bit home computers around which were too small for Version 4 games. Despite critical acclaim, the new games consequently did not sell as well. (Brian Moriarty commented that 'Trinity' "sold tolerably well. Better than we&#8217;d hoped." But his previous game, the more modest 'Wishbringer', had sold rather better.)</p>
</div>
<div class="paragraph">
<p>Version 5 games began to appear in September 1987 with 'Beyond Zork' and 'Border Zone'. Both of these games needed new features&#8201;&#8212;&#8201;character graphics run wild in the case of the former, and real-time keyboard interaction in the latter. The number of opcodes grew ever faster as a result.</p>
</div>
<div class="paragraph">
<p>Although five old games were re-released in Version 5 editions (with an in-game hints system added, and benefiting from 9-letter word dictionaries, but otherwise as written), the direction was all too clearly away from the old text game into graphics: 'Beyond Zork' can look like a parody of an early mainframe maze game, for instance. Version 6 completed the process during something of a hiatus in 1988, after which the last few increasingly-unrecognisable Infocom games appeared: 'Zork Zero', 'Shogun', 'Journey' and 'Arthur'.</p>
</div>
<div class="paragraph">
<p>It would be wrong, though, to suggest that Infocom regarded text and graphics as incompatible opposites. Infocom had never been puritanically opposed to graphics&#8201;&#8212;&#8201;</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>We have nothing against graphics per se. However, given the quality of graphics currently available on home computers, we would rather use that disk space for additional puzzles and richer descriptions.</p>
</div>
<div class="paragraph">
<p><strong>The New Zork Times (Spring 1984)</strong></p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>(and, after all, the same author wrote both 'Trinity' and 'Beyond Zork'). Although the old Infocom parser was considered to have passed its sell-by date, Version 6 did not drop textual input in favour of some inane point-and-click interface. Instead, an entirely new parser was devised from scratch ("using the theory of computational linguistics", according to a puff by Stu Galley: broadly an LALR(1) parser).</p>
</div>
<div class="paragraph">
<p>Infocom gradually ceased to exist during 1987-9 as its financial problems grew. But its products were increasingly regarded as anachronistic and most of its staff had left since the middle years: if Infocom had not finally been wound up, whether it would have continued to release text games of the classical style is arguable.</p>
</div>
<div class="paragraph">
<p>Two new formats, versions 7 and 8, have recently been devised to cope with large Inform games.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app.e"><a class="anchor" href="#app.e"></a>Appendix E: Statistics</h2>
<div class="sectionbody">
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>LORD DIMWIT FLATHEAD: "It must have two hundred thousand rooms, four million takeable objects, and understand a vocabulary of every single word ever spoken in every language ever invented."</p>
</div>
</blockquote>
<div class="attribution">
&#8212; The New Zork Times (Winter 1984)
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
the information below has not been updated since the 20th June 1997 revision of this document.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To give some idea of the sizes found in typical story files, here are a few statistics, mostly gathered by Paul David Doherty, whose "Infocom fact sheet" file is the definitive reference.</p>
</div>
<div class="paragraph">
<p>(i) <em>Length</em></p>
</div>
<div class="paragraph">
<p>The shortest files are those dating from the time of the 'Zork' trilogy, at about 85K; middle-period Version 3 games are typically 105K, and only the latest use the full memory map. In Versions 4 and 5, only 'Trinity', 'A Mind Forever Voyaging' and 'Beyond Zork' use the full 256K. 'Border Zone' and 'Sherlock', for instance, are about 180K. (The author&#8217;s short story 'Balances' is about 50K, an edition of 'Adventure' takes 80K, and 'Curses' takes 256K (it&#8217;s padded out to the maximum size with background information; the actual game comprises only about 245K). Under Inform, the library occupies about 35K regardless of the size of game.)</p>
</div>
<div class="paragraph">
<p>(ii) <em>Code size</em></p>
</div>
<div class="paragraph">
<p>'Zork I' uses only about 5500 opcodes, but the number rises steeply with later games; 'Hollywood Hijinx' has 10355 and, e.g. 'Moonmist' has 15900 (both these being Version 3). Against this, 'A Mind Forever Voyaging' has only 18700, and only 'Trinity' and 'Beyond Zork' reach 32000 or so. (Inform games are more efficiently compiled and make better use of common code&#8201;&#8212;&#8201;the library&#8201;&#8212;&#8201;so perform much better here: the old Version 3, release 10 of 'Curses' (128K long, and a larger game than any Infocom Version 3 game) has only 6720 opcodes.)</p>
</div>
<div class="paragraph">
<p>(iii) <em>Objects and rooms</em></p>
</div>
<div class="paragraph">
<p>This varies greatly with the style of game. 'Zork I' has 110 rooms and 60 takeable objects, but several quite complex games have as few as 30 rooms (the mysteries, or 'Hitch-hikers'). The average for Version 3 games is 69 rooms, 39 takeable objects.</p>
</div>
<div class="paragraph">
<p>'A Mind Forever Voyaging' contains many rooms (178) but few objects (30). 'Trinity', a more typical style of game, contains 134 rooms and 49 objects: the Version 5 'Curses' has a few more of each. Of the Version 6 games, only 'Zork Zero' scores highly here, with 215 rooms and 106 objects. The average for Version 4/5 games is 105 rooms and 54 objects.</p>
</div>
<div class="paragraph">
<p>The total number of objects tends to be close to the limit of 255 in Version 3 games. 'Curses' contains 508.</p>
</div>
<div class="paragraph">
<p>(iv) <em>Dictionary</em></p>
</div>
<div class="paragraph">
<p>Early games such as 'Zork I' know about 600 words, but again this rises steeply to about 1000 even in Version 3. Later games know 1569 ('Beyond Zork') to the record, 2120 ('Trinity'). (This is achieved by heroic inclusion of unlikely synonyms: e.g. the Japanese lady with the umbrella can be called WOMAN, LADY, CRONE, MADAM, MADAME, MATRON, DAME or FACE with any of the adjectives OLD, AGED, ANCIENT, JAP, JAPANESE, ORIENTAL or YELLOW.) Version 6 games have smaller dictionaries. So has 'Curses', at 1364.</p>
</div>
<div class="paragraph">
<p>(v) <em>Opcodes</em></p>
</div>
<div class="paragraph">
<p>(a) Of the 1426854 opcodes in the shipped Infocom story files in Paul David Doherty&#8217;s collection, here are the top and bottom ten most popular. (Leaving out those which never occur and so score 0: <strong>nop</strong>, <strong>art_shift</strong>, <strong>piracy</strong> and the two post-Infocom opcodes, <strong>print_unicode</strong> and <strong>check_unicode</strong>.)</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    Top Ten Opcodes Chart          Bottom Ten Opcodes Chart
    1.   je          195959        1.   print_form       2
    2.   print       142755        2.   erase_picture    3
    3.   jz          112016        3.   read_mouse       3
    4.   call_vs     104075        4.   encode_text      7
    5.   print_ret    80870        5.   make_menu        9
    6.   store        71128        6.   not             14
    7.   rtrue        66125        7.   scroll_window   16
    8.   jump         56534        8.   pop_stack       17
    9.   new_line     52553        9.   restore_undo    18
    10.  test_attr    46627        10.  mouse_window    22</pre>
</div>
</div>
<div class="paragraph">
<p>So about 2/3rds of all opcodes are those in the top ten; 1 in 8 opcodes is a <strong>je</strong>, and only 1 in 710000 is a <strong>print_form</strong>.</p>
</div>
<div class="paragraph">
<p>(b) An experiment (conducted with the help of Kevin Bracey) sheds some light on the opcodes most frequently interpreted in typical play. Two very different games ('Zork I', Version 5 "solid gold" edition; 'Museum of Inform', a complex Inform example game) were played for about 50000 cycles of the Z-machine (about 20 moves in 'Zork I', rather less in the 'Museum'). The following table records all opcodes with a frequency of at least 1% (i.e., 0.01):</p>
</div>
<div class="literalblock">
<div class="content">
<pre>    Zork I Solid Gold (Infocom)    Museum of Inform (Inform)
    0.116110  loadb                0.104952  je
    0.103990  storeb               0.101151  jz
    0.101616  jz                   0.092727  jump
    0.074979  dec_chk              0.080985  jg
    0.066375  add                  0.079039  jl
    0.066283  je                   0.070550  inc
    0.060760  store                0.070139  store
    0.053867  loadw                0.047058  loadw
    0.038095  storew               0.034137  get_prop_addr
    0.036428  mul                  0.024105  jin
    0.032069  inc_chk              0.022734  rtrue
    0.030243  jump                 0.021583  storew
    0.029170  test_attr            0.020075  add
    0.020634  call_vs              0.018485  call_vs
    0.011184  get_sibling          0.016731  and
                                   0.016082  loadb
                                   0.012061  call_vn
                                   0.011879  test_attr
                                   0.011824  dec
                                   0.011687  ret</pre>
</div>
</div>
<div class="paragraph">
<p>Adventure games spend most of the time parsing, and the differences between these tables reflect different parser designs (byte arrays versus word arrays and arrays stored in properties) as well as different compiler code generators (Inform does not use <strong>inc_chk</strong> or <strong>dec_chk</strong>, so it uses <strong>inc</strong>, <strong>dec</strong>, <strong>jl</strong> and <strong>jg</strong> correspondingly more). In the case of 'Zork I', about a third of all opcodes are branches: in the case of 'Museum', almost half.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="app.f"><a class="anchor" href="#app.f"></a>Appendix F: Canonical Story Files</h2>
<div class="sectionbody">
<hr>
<div class="paragraph">
<p>Story files are mechanically best identified by their release number and serial code, which are written into the header information at the bottom of Z-machine memory. The release number can be anything between 0 and 65535 but is usually between 1 and 100. The serial code can consist of any six textual characters but is usually the date of compilation, arranged <strong>YYMMDD</strong>: thus 970619 refers to June 19th, 1997. The notation</p>
</div>
<div class="paragraph">
<p><strong>Release number.Serial code</strong></p>
</div>
<div class="paragraph">
<p>identifies particular story files: for example the first production copy of 'Enchanter' is 10.830810.</p>
</div>
<div class="paragraph">
<p>Paul David Doherty&#8217;s investigations into Infocom&#8217;s released games have resulted in the following list of all known story files compiled by <strong>Zilch</strong>, the Infocom compiler:</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 11. <strong>Version 1 story file</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5. (no serial code)</p></td>
</tr>
</tbody>
</table>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 12. <strong>Version 2 story files</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15.UG3AU5</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork II</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">7.UG3AU5</p></td>
</tr>
</tbody>
</table>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 13. <strong>Version 3 story files</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ballyhoo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.851218</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cutthroats</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23.840809</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Deadline</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">18.820311, 19.820427, 21.820512, 26.821108, 27.831005</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Enchanter</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.830810, 15.831107, 16.831118, 24.851118, 29.860820</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Four-In-One Sampler I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26.840731, 53.850407, 55.850823</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Four-In-One Sampler II</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">97.870601</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Hitch Hiker&#8217;s Guide To The Galaxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47.840914, 56.841221, 58.851002, 59.851108</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hollywood Hijinx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">37.861215</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Infidel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22.830916</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leather Goddesses of Phobos</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">118.860325? (beta), 50.860711?, 59.860730, 59.861114</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Lurking Horror</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">203.870506, 219.870912 (s), 221.870918 (s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mini-Zork I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">34.871124</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Moonmist</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.860918, 9.861022</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Planetfall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">20.830708, 29.840118, 37.851003</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Plundered Hearts</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26.870730</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Seastalker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86.840320 (beta), 15.840501, 15.840522, 16.850515, 16.850603</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sorcerer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">67.000000? (beta), 4.840131, 6.840508, 13.851021, 15.851108, 18.860904</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Spellbreaker</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">63.850916, 87.860904</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Starcross</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">15.820901, 17.821021</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Stationfall</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">107.870430</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspect</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">14.841005</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Suspended</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5.830222, 7.830419, 8.830521, 8.840521</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wishbringer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">68.850501, 69.850920</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Witness</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">13.830524, 18.830910, 20.831119, 21.831208, 22.840924</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork I</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23.820428, 25.820515, 26.820803, 28.821013, 30.830330, 75.830929, 76.840509, 88.840726</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork II</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">17.820427, 18.820512, 18.820517, 19.820721, 22.830331, 23.830411, 48.840904, ?.841220?</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork III</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.820818, 15.830331, 16.830410, 15.840518, 17.840727</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>Note that the two samplers and the mini-Zork are in the public domain and may be downloaded from Internet archive sites. One form of 'Zork I' can be downloaded freely from Activision&#8217;s Web pages promoting the Zork brand name.</p>
</div>
<div class="paragraph">
<p>The two problem children here are 'Seastalker', a submarine game which produces a sonar display across the top of the screen (and thus needs more sophisticated screen control features than the other Version 3 games) and 'The Lurking Horror', which uses sound effects (hence the "(s)" notation).</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 14. <strong>Version 4 story files</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">A Mind Forever Voyaging</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">77.850814, 79.851122</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Bureaucracy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">86.870212, 116.870602</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nord and Bert Couldn&#8217;t Make Head Nor Tail Of It</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">19.870722</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Trinity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">11.860509, 12.860926</p></td>
</tr>
</tbody>
</table>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 15. <strong>Version 5 story files</strong></caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Beyond Zork</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">47.870915, 49.870917, 51.870923, 57.871221</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Border Zone</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">9.871008</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">The Hitch Hiker&#8217;s Guide To The Galaxy SG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">31.871119</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Leather Goddesses of Phobos SG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">4.880405</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Planetfall SG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10.880531</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sherlock</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">21.871214, 26.880127 (s)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Wishbringer SG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">23.880706</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork I SG</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">52.871125</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork I German</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3.880113 (beta)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The "SG" games were "solid gold" revisions of existing Version 3 games, adding on-line hints and an UNDO command. Regrettably these are not the versions distributed by Activision on their recent re-releases of the Infocom back catalogue.</p>
</div>
<div class="paragraph">
<p>One form of 'Sherlock' uses sound effects. 'Border Zone' introduces timed input. 'Beyond Zork' features a character-graphics font. But the most interesting file is the German translation of 'Zork I', which was never commercially released, introducing an alphabet table to the format.</p>
</div>
<hr>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 16. <strong>Version 6 story files</strong></caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Game</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Amiga</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple II</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">IBM</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Arthur</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">54.890606</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">same as Mac</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">63.890622?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">74.890714</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Journey</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">26.890316</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">30.890322</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">77.890616?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">83.890706</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shogun</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">292.890314</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">295.890321</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">311.890510?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">322.890706</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Zork Zero</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">296.881019</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">366.890323</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">383.890602?</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">393.890714</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>The rule that story files should be independent of their target computers was dropped for Version 6 games and this leads to copious footnotes and exceptions in sections 8.8 and 16 of the standard. Story files for a particular game are substantially similar to each other but use fonts, pictures and so on slightly differently.</p>
</div>
<hr>
<div class="paragraph">
<p>Note that a new Infocom game, <em>Zork: The Undiscovered Underground</em> was published by Activision in 1997. 16.970828 is the only public version I know of: however, note that this file was compiled by Inform and not by Zilch. It is therefore not useful as a witness to Z-machine rules.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.1<br>
</div>
</div>
</body>
</html>